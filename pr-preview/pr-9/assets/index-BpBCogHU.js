var Xg=o=>{throw TypeError(o)};var Vm=(o,d,m)=>d.has(o)||Xg("Cannot "+m);var Te=(o,d,m)=>(Vm(o,d,"read from private field"),m?m.call(o):d.get(o)),It=(o,d,m)=>d.has(o)?Xg("Cannot add the same private member more than once"):d instanceof WeakSet?d.add(o):d.set(o,m),vt=(o,d,m,y)=>(Vm(o,d,"write to private field"),y?y.call(o,m):d.set(o,m),m),wn=(o,d,m)=>(Vm(o,d,"access private method"),m);var pm=(o,d,m,y)=>({set _($){vt(o,d,$,m)},get _(){return Te(o,d,y)}});function hv(o,d){for(var m=0;m<d.length;m++){const y=d[m];if(typeof y!="string"&&!Array.isArray(y)){for(const $ in y)if($!=="default"&&!($ in o)){const E=Object.getOwnPropertyDescriptor(y,$);E&&Object.defineProperty(o,$,E.get?E:{enumerable:!0,get:()=>y[$]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))y($);new MutationObserver($=>{for(const E of $)if(E.type==="childList")for(const R of E.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&y(R)}).observe(document,{childList:!0,subtree:!0});function m($){const E={};return $.integrity&&(E.integrity=$.integrity),$.referrerPolicy&&(E.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?E.credentials="include":$.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function y($){if($.ep)return;$.ep=!0;const E=m($);fetch($.href,E)}})();function mv(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Hm={exports:{}},Dp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zg;function gv(){if(Zg)return Dp;Zg=1;var o=Symbol.for("react.transitional.element"),d=Symbol.for("react.fragment");function m(y,$,E){var R=null;if(E!==void 0&&(R=""+E),$.key!==void 0&&(R=""+$.key),"key"in $){E={};for(var D in $)D!=="key"&&(E[D]=$[D])}else E=$;return $=E.ref,{$$typeof:o,type:y,key:R,ref:$!==void 0?$:null,props:E}}return Dp.Fragment=d,Dp.jsx=m,Dp.jsxs=m,Dp}var Jg;function yv(){return Jg||(Jg=1,Hm.exports=gv()),Hm.exports}var we=yv(),Pm={exports:{}},bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ey;function vv(){if(ey)return bt;ey=1;var o=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),R=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),M=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),q=Symbol.for("react.activity"),Z=Symbol.iterator;function se(K){return K===null||typeof K!="object"?null:(K=Z&&K[Z]||K["@@iterator"],typeof K=="function"?K:null)}var ce={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ee=Object.assign,he={};function $e(K,Ce,Ge){this.props=K,this.context=Ce,this.refs=he,this.updater=Ge||ce}$e.prototype.isReactComponent={},$e.prototype.setState=function(K,Ce){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,Ce,"setState")},$e.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function De(){}De.prototype=$e.prototype;function me(K,Ce,Ge){this.props=K,this.context=Ce,this.refs=he,this.updater=Ge||ce}var be=me.prototype=new De;be.constructor=me,ee(be,$e.prototype),be.isPureReactComponent=!0;var Me=Array.isArray;function Be(){}var qe={H:null,A:null,T:null,S:null},Re=Object.prototype.hasOwnProperty;function at(K,Ce,Ge){var Ye=Ge.ref;return{$$typeof:o,type:K,key:Ce,ref:Ye!==void 0?Ye:null,props:Ge}}function Xe(K,Ce){return at(K.type,Ce,K.props)}function et(K){return typeof K=="object"&&K!==null&&K.$$typeof===o}function Qe(K){var Ce={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(Ge){return Ce[Ge]})}var _t=/\/+/g;function Dt(K,Ce){return typeof K=="object"&&K!==null&&K.key!=null?Qe(""+K.key):Ce.toString(36)}function ma(K){switch(K.status){case"fulfilled":return K.value;case"rejected":throw K.reason;default:switch(typeof K.status=="string"?K.then(Be,Be):(K.status="pending",K.then(function(Ce){K.status==="pending"&&(K.status="fulfilled",K.value=Ce)},function(Ce){K.status==="pending"&&(K.status="rejected",K.reason=Ce)})),K.status){case"fulfilled":return K.value;case"rejected":throw K.reason}}throw K}function _e(K,Ce,Ge,Ye,mt){var wt=typeof K;(wt==="undefined"||wt==="boolean")&&(K=null);var Lt=!1;if(K===null)Lt=!0;else switch(wt){case"bigint":case"string":case"number":Lt=!0;break;case"object":switch(K.$$typeof){case o:case d:Lt=!0;break;case H:return Lt=K._init,_e(Lt(K._payload),Ce,Ge,Ye,mt)}}if(Lt)return mt=mt(K),Lt=Ye===""?"."+Dt(K,0):Ye,Me(mt)?(Ge="",Lt!=null&&(Ge=Lt.replace(_t,"$&/")+"/"),_e(mt,Ce,Ge,"",function(Xt){return Xt})):mt!=null&&(et(mt)&&(mt=Xe(mt,Ge+(mt.key==null||K&&K.key===mt.key?"":(""+mt.key).replace(_t,"$&/")+"/")+Lt)),Ce.push(mt)),1;Lt=0;var xt=Ye===""?".":Ye+":";if(Me(K))for(var Yt=0;Yt<K.length;Yt++)Ye=K[Yt],wt=xt+Dt(Ye,Yt),Lt+=_e(Ye,Ce,Ge,wt,mt);else if(Yt=se(K),typeof Yt=="function")for(K=Yt.call(K),Yt=0;!(Ye=K.next()).done;)Ye=Ye.value,wt=xt+Dt(Ye,Yt++),Lt+=_e(Ye,Ce,Ge,wt,mt);else if(wt==="object"){if(typeof K.then=="function")return _e(ma(K),Ce,Ge,Ye,mt);throw Ce=String(K),Error("Objects are not valid as a React child (found: "+(Ce==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":Ce)+"). If you meant to render a collection of children, use an array instead.")}return Lt}function Oe(K,Ce,Ge){if(K==null)return K;var Ye=[],mt=0;return _e(K,Ye,"","",function(wt){return Ce.call(Ge,wt,mt++)}),Ye}function Pe(K){if(K._status===-1){var Ce=K._result;Ce=Ce(),Ce.then(function(Ge){(K._status===0||K._status===-1)&&(K._status=1,K._result=Ge)},function(Ge){(K._status===0||K._status===-1)&&(K._status=2,K._result=Ge)}),K._status===-1&&(K._status=0,K._result=Ce)}if(K._status===1)return K._result.default;throw K._result}var At=typeof reportError=="function"?reportError:function(K){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ce=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof K=="object"&&K!==null&&typeof K.message=="string"?String(K.message):String(K),error:K});if(!window.dispatchEvent(Ce))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",K);return}console.error(K)},ht={map:Oe,forEach:function(K,Ce,Ge){Oe(K,function(){Ce.apply(this,arguments)},Ge)},count:function(K){var Ce=0;return Oe(K,function(){Ce++}),Ce},toArray:function(K){return Oe(K,function(Ce){return Ce})||[]},only:function(K){if(!et(K))throw Error("React.Children.only expected to receive a single React element child.");return K}};return bt.Activity=q,bt.Children=ht,bt.Component=$e,bt.Fragment=m,bt.Profiler=$,bt.PureComponent=me,bt.StrictMode=y,bt.Suspense=T,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=qe,bt.__COMPILER_RUNTIME={__proto__:null,c:function(K){return qe.H.useMemoCache(K)}},bt.cache=function(K){return function(){return K.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(K,Ce,Ge){if(K==null)throw Error("The argument must be a React element, but you passed "+K+".");var Ye=ee({},K.props),mt=K.key;if(Ce!=null)for(wt in Ce.key!==void 0&&(mt=""+Ce.key),Ce)!Re.call(Ce,wt)||wt==="key"||wt==="__self"||wt==="__source"||wt==="ref"&&Ce.ref===void 0||(Ye[wt]=Ce[wt]);var wt=arguments.length-2;if(wt===1)Ye.children=Ge;else if(1<wt){for(var Lt=Array(wt),xt=0;xt<wt;xt++)Lt[xt]=arguments[xt+2];Ye.children=Lt}return at(K.type,mt,Ye)},bt.createContext=function(K){return K={$$typeof:R,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null},K.Provider=K,K.Consumer={$$typeof:E,_context:K},K},bt.createElement=function(K,Ce,Ge){var Ye,mt={},wt=null;if(Ce!=null)for(Ye in Ce.key!==void 0&&(wt=""+Ce.key),Ce)Re.call(Ce,Ye)&&Ye!=="key"&&Ye!=="__self"&&Ye!=="__source"&&(mt[Ye]=Ce[Ye]);var Lt=arguments.length-2;if(Lt===1)mt.children=Ge;else if(1<Lt){for(var xt=Array(Lt),Yt=0;Yt<Lt;Yt++)xt[Yt]=arguments[Yt+2];mt.children=xt}if(K&&K.defaultProps)for(Ye in Lt=K.defaultProps,Lt)mt[Ye]===void 0&&(mt[Ye]=Lt[Ye]);return at(K,wt,mt)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(K){return{$$typeof:D,render:K}},bt.isValidElement=et,bt.lazy=function(K){return{$$typeof:H,_payload:{_status:-1,_result:K},_init:Pe}},bt.memo=function(K,Ce){return{$$typeof:M,type:K,compare:Ce===void 0?null:Ce}},bt.startTransition=function(K){var Ce=qe.T,Ge={};qe.T=Ge;try{var Ye=K(),mt=qe.S;mt!==null&&mt(Ge,Ye),typeof Ye=="object"&&Ye!==null&&typeof Ye.then=="function"&&Ye.then(Be,At)}catch(wt){At(wt)}finally{Ce!==null&&Ge.types!==null&&(Ce.types=Ge.types),qe.T=Ce}},bt.unstable_useCacheRefresh=function(){return qe.H.useCacheRefresh()},bt.use=function(K){return qe.H.use(K)},bt.useActionState=function(K,Ce,Ge){return qe.H.useActionState(K,Ce,Ge)},bt.useCallback=function(K,Ce){return qe.H.useCallback(K,Ce)},bt.useContext=function(K){return qe.H.useContext(K)},bt.useDebugValue=function(){},bt.useDeferredValue=function(K,Ce){return qe.H.useDeferredValue(K,Ce)},bt.useEffect=function(K,Ce){return qe.H.useEffect(K,Ce)},bt.useEffectEvent=function(K){return qe.H.useEffectEvent(K)},bt.useId=function(){return qe.H.useId()},bt.useImperativeHandle=function(K,Ce,Ge){return qe.H.useImperativeHandle(K,Ce,Ge)},bt.useInsertionEffect=function(K,Ce){return qe.H.useInsertionEffect(K,Ce)},bt.useLayoutEffect=function(K,Ce){return qe.H.useLayoutEffect(K,Ce)},bt.useMemo=function(K,Ce){return qe.H.useMemo(K,Ce)},bt.useOptimistic=function(K,Ce){return qe.H.useOptimistic(K,Ce)},bt.useReducer=function(K,Ce,Ge){return qe.H.useReducer(K,Ce,Ge)},bt.useRef=function(K){return qe.H.useRef(K)},bt.useState=function(K){return qe.H.useState(K)},bt.useSyncExternalStore=function(K,Ce,Ge){return qe.H.useSyncExternalStore(K,Ce,Ge)},bt.useTransition=function(){return qe.H.useTransition()},bt.version="19.2.4",bt}var ty;function hg(){return ty||(ty=1,Pm.exports=vv()),Pm.exports}var ne=hg();const Qp=mv(ne),bv=hv({__proto__:null,default:Qp},[ne]);var Fm={exports:{}},Bp={},Km={exports:{}},Wm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ay;function _v(){return ay||(ay=1,(function(o){function d(_e,Oe){var Pe=_e.length;_e.push(Oe);e:for(;0<Pe;){var At=Pe-1>>>1,ht=_e[At];if(0<$(ht,Oe))_e[At]=Oe,_e[Pe]=ht,Pe=At;else break e}}function m(_e){return _e.length===0?null:_e[0]}function y(_e){if(_e.length===0)return null;var Oe=_e[0],Pe=_e.pop();if(Pe!==Oe){_e[0]=Pe;e:for(var At=0,ht=_e.length,K=ht>>>1;At<K;){var Ce=2*(At+1)-1,Ge=_e[Ce],Ye=Ce+1,mt=_e[Ye];if(0>$(Ge,Pe))Ye<ht&&0>$(mt,Ge)?(_e[At]=mt,_e[Ye]=Pe,At=Ye):(_e[At]=Ge,_e[Ce]=Pe,At=Ce);else if(Ye<ht&&0>$(mt,Pe))_e[At]=mt,_e[Ye]=Pe,At=Ye;else break e}}return Oe}function $(_e,Oe){var Pe=_e.sortIndex-Oe.sortIndex;return Pe!==0?Pe:_e.id-Oe.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var E=performance;o.unstable_now=function(){return E.now()}}else{var R=Date,D=R.now();o.unstable_now=function(){return R.now()-D}}var T=[],M=[],H=1,q=null,Z=3,se=!1,ce=!1,ee=!1,he=!1,$e=typeof setTimeout=="function"?setTimeout:null,De=typeof clearTimeout=="function"?clearTimeout:null,me=typeof setImmediate<"u"?setImmediate:null;function be(_e){for(var Oe=m(M);Oe!==null;){if(Oe.callback===null)y(M);else if(Oe.startTime<=_e)y(M),Oe.sortIndex=Oe.expirationTime,d(T,Oe);else break;Oe=m(M)}}function Me(_e){if(ee=!1,be(_e),!ce)if(m(T)!==null)ce=!0,Be||(Be=!0,Qe());else{var Oe=m(M);Oe!==null&&ma(Me,Oe.startTime-_e)}}var Be=!1,qe=-1,Re=5,at=-1;function Xe(){return he?!0:!(o.unstable_now()-at<Re)}function et(){if(he=!1,Be){var _e=o.unstable_now();at=_e;var Oe=!0;try{e:{ce=!1,ee&&(ee=!1,De(qe),qe=-1),se=!0;var Pe=Z;try{t:{for(be(_e),q=m(T);q!==null&&!(q.expirationTime>_e&&Xe());){var At=q.callback;if(typeof At=="function"){q.callback=null,Z=q.priorityLevel;var ht=At(q.expirationTime<=_e);if(_e=o.unstable_now(),typeof ht=="function"){q.callback=ht,be(_e),Oe=!0;break t}q===m(T)&&y(T),be(_e)}else y(T);q=m(T)}if(q!==null)Oe=!0;else{var K=m(M);K!==null&&ma(Me,K.startTime-_e),Oe=!1}}break e}finally{q=null,Z=Pe,se=!1}Oe=void 0}}finally{Oe?Qe():Be=!1}}}var Qe;if(typeof me=="function")Qe=function(){me(et)};else if(typeof MessageChannel<"u"){var _t=new MessageChannel,Dt=_t.port2;_t.port1.onmessage=et,Qe=function(){Dt.postMessage(null)}}else Qe=function(){$e(et,0)};function ma(_e,Oe){qe=$e(function(){_e(o.unstable_now())},Oe)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(_e){_e.callback=null},o.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Re=0<_e?Math.floor(1e3/_e):5},o.unstable_getCurrentPriorityLevel=function(){return Z},o.unstable_next=function(_e){switch(Z){case 1:case 2:case 3:var Oe=3;break;default:Oe=Z}var Pe=Z;Z=Oe;try{return _e()}finally{Z=Pe}},o.unstable_requestPaint=function(){he=!0},o.unstable_runWithPriority=function(_e,Oe){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var Pe=Z;Z=_e;try{return Oe()}finally{Z=Pe}},o.unstable_scheduleCallback=function(_e,Oe,Pe){var At=o.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?At+Pe:At):Pe=At,_e){case 1:var ht=-1;break;case 2:ht=250;break;case 5:ht=1073741823;break;case 4:ht=1e4;break;default:ht=5e3}return ht=Pe+ht,_e={id:H++,callback:Oe,priorityLevel:_e,startTime:Pe,expirationTime:ht,sortIndex:-1},Pe>At?(_e.sortIndex=Pe,d(M,_e),m(T)===null&&_e===m(M)&&(ee?(De(qe),qe=-1):ee=!0,ma(Me,Pe-At))):(_e.sortIndex=ht,d(T,_e),ce||se||(ce=!0,Be||(Be=!0,Qe()))),_e},o.unstable_shouldYield=Xe,o.unstable_wrapCallback=function(_e){var Oe=Z;return function(){var Pe=Z;Z=Oe;try{return _e.apply(this,arguments)}finally{Z=Pe}}}})(Wm)),Wm}var ny;function wv(){return ny||(ny=1,Km.exports=_v()),Km.exports}var Qm={exports:{}},xn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iy;function xv(){if(iy)return xn;iy=1;var o=hg();function d(T){var M="https://react.dev/errors/"+T;if(1<arguments.length){M+="?args[]="+encodeURIComponent(arguments[1]);for(var H=2;H<arguments.length;H++)M+="&args[]="+encodeURIComponent(arguments[H])}return"Minified React error #"+T+"; visit "+M+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function m(){}var y={d:{f:m,r:function(){throw Error(d(522))},D:m,C:m,L:m,m,X:m,S:m,M:m},p:0,findDOMNode:null},$=Symbol.for("react.portal");function E(T,M,H){var q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$,key:q==null?null:""+q,children:T,containerInfo:M,implementation:H}}var R=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function D(T,M){if(T==="font")return"";if(typeof M=="string")return M==="use-credentials"?M:""}return xn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=y,xn.createPortal=function(T,M){var H=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!M||M.nodeType!==1&&M.nodeType!==9&&M.nodeType!==11)throw Error(d(299));return E(T,M,null,H)},xn.flushSync=function(T){var M=R.T,H=y.p;try{if(R.T=null,y.p=2,T)return T()}finally{R.T=M,y.p=H,y.d.f()}},xn.preconnect=function(T,M){typeof T=="string"&&(M?(M=M.crossOrigin,M=typeof M=="string"?M==="use-credentials"?M:"":void 0):M=null,y.d.C(T,M))},xn.prefetchDNS=function(T){typeof T=="string"&&y.d.D(T)},xn.preinit=function(T,M){if(typeof T=="string"&&M&&typeof M.as=="string"){var H=M.as,q=D(H,M.crossOrigin),Z=typeof M.integrity=="string"?M.integrity:void 0,se=typeof M.fetchPriority=="string"?M.fetchPriority:void 0;H==="style"?y.d.S(T,typeof M.precedence=="string"?M.precedence:void 0,{crossOrigin:q,integrity:Z,fetchPriority:se}):H==="script"&&y.d.X(T,{crossOrigin:q,integrity:Z,fetchPriority:se,nonce:typeof M.nonce=="string"?M.nonce:void 0})}},xn.preinitModule=function(T,M){if(typeof T=="string")if(typeof M=="object"&&M!==null){if(M.as==null||M.as==="script"){var H=D(M.as,M.crossOrigin);y.d.M(T,{crossOrigin:H,integrity:typeof M.integrity=="string"?M.integrity:void 0,nonce:typeof M.nonce=="string"?M.nonce:void 0})}}else M==null&&y.d.M(T)},xn.preload=function(T,M){if(typeof T=="string"&&typeof M=="object"&&M!==null&&typeof M.as=="string"){var H=M.as,q=D(H,M.crossOrigin);y.d.L(T,H,{crossOrigin:q,integrity:typeof M.integrity=="string"?M.integrity:void 0,nonce:typeof M.nonce=="string"?M.nonce:void 0,type:typeof M.type=="string"?M.type:void 0,fetchPriority:typeof M.fetchPriority=="string"?M.fetchPriority:void 0,referrerPolicy:typeof M.referrerPolicy=="string"?M.referrerPolicy:void 0,imageSrcSet:typeof M.imageSrcSet=="string"?M.imageSrcSet:void 0,imageSizes:typeof M.imageSizes=="string"?M.imageSizes:void 0,media:typeof M.media=="string"?M.media:void 0})}},xn.preloadModule=function(T,M){if(typeof T=="string")if(M){var H=D(M.as,M.crossOrigin);y.d.m(T,{as:typeof M.as=="string"&&M.as!=="script"?M.as:void 0,crossOrigin:H,integrity:typeof M.integrity=="string"?M.integrity:void 0})}else y.d.m(T)},xn.requestFormReset=function(T){y.d.r(T)},xn.unstable_batchedUpdates=function(T,M){return T(M)},xn.useFormState=function(T,M,H){return R.H.useFormState(T,M,H)},xn.useFormStatus=function(){return R.H.useHostTransitionStatus()},xn.version="19.2.4",xn}var ry;function $v(){if(ry)return Qm.exports;ry=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(d){console.error(d)}}return o(),Qm.exports=xv(),Qm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sy;function Sv(){if(sy)return Bp;sy=1;var o=wv(),d=hg(),m=$v();function y(e){var a="https://react.dev/errors/"+e;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)a+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function $(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function E(e){var a=e,i=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,(a.flags&4098)!==0&&(i=a.return),e=a.return;while(e)}return a.tag===3?i:null}function R(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function D(e){if(e.tag===31){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function T(e){if(E(e)!==e)throw Error(y(188))}function M(e){var a=e.alternate;if(!a){if(a=E(e),a===null)throw Error(y(188));return a!==e?null:e}for(var i=e,r=a;;){var c=i.return;if(c===null)break;var h=c.alternate;if(h===null){if(r=c.return,r!==null){i=r;continue}break}if(c.child===h.child){for(h=c.child;h;){if(h===i)return T(c),e;if(h===r)return T(c),a;h=h.sibling}throw Error(y(188))}if(i.return!==r.return)i=c,r=h;else{for(var _=!1,k=c.child;k;){if(k===i){_=!0,i=c,r=h;break}if(k===r){_=!0,r=c,i=h;break}k=k.sibling}if(!_){for(k=h.child;k;){if(k===i){_=!0,i=h,r=c;break}if(k===r){_=!0,r=h,i=c;break}k=k.sibling}if(!_)throw Error(y(189))}}if(i.alternate!==r)throw Error(y(190))}if(i.tag!==3)throw Error(y(188));return i.stateNode.current===i?e:a}function H(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e;for(e=e.child;e!==null;){if(a=H(e),a!==null)return a;e=e.sibling}return null}var q=Object.assign,Z=Symbol.for("react.element"),se=Symbol.for("react.transitional.element"),ce=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),$e=Symbol.for("react.profiler"),De=Symbol.for("react.consumer"),me=Symbol.for("react.context"),be=Symbol.for("react.forward_ref"),Me=Symbol.for("react.suspense"),Be=Symbol.for("react.suspense_list"),qe=Symbol.for("react.memo"),Re=Symbol.for("react.lazy"),at=Symbol.for("react.activity"),Xe=Symbol.for("react.memo_cache_sentinel"),et=Symbol.iterator;function Qe(e){return e===null||typeof e!="object"?null:(e=et&&e[et]||e["@@iterator"],typeof e=="function"?e:null)}var _t=Symbol.for("react.client.reference");function Dt(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===_t?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ee:return"Fragment";case $e:return"Profiler";case he:return"StrictMode";case Me:return"Suspense";case Be:return"SuspenseList";case at:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case ce:return"Portal";case me:return e.displayName||"Context";case De:return(e._context.displayName||"Context")+".Consumer";case be:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case qe:return a=e.displayName||null,a!==null?a:Dt(e.type)||"Memo";case Re:a=e._payload,e=e._init;try{return Dt(e(a))}catch{}}return null}var ma=Array.isArray,_e=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Oe=m.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Pe={pending:!1,data:null,method:null,action:null},At=[],ht=-1;function K(e){return{current:e}}function Ce(e){0>ht||(e.current=At[ht],At[ht]=null,ht--)}function Ge(e,a){ht++,At[ht]=e.current,e.current=a}var Ye=K(null),mt=K(null),wt=K(null),Lt=K(null);function xt(e,a){switch(Ge(wt,a),Ge(mt,e),Ge(Ye,null),a.nodeType){case 9:case 11:e=(e=a.documentElement)&&(e=e.namespaceURI)?We(e):0;break;default:if(e=a.tagName,a=a.namespaceURI)a=We(a),e=ut(a,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Ce(Ye),Ge(Ye,e)}function Yt(){Ce(Ye),Ce(mt),Ce(wt)}function Xt(e){e.memoizedState!==null&&Ge(Lt,e);var a=Ye.current,i=ut(a,e.type);a!==i&&(Ge(mt,e),Ge(Ye,i))}function qr(e){mt.current===e&&(Ce(Ye),Ce(mt)),Lt.current===e&&(Ce(Lt),Op._currentValue=Pe)}var Nn,jr;function ia(e){if(Nn===void 0)try{throw Error()}catch(i){var a=i.stack.trim().match(/\n( *(at )?)/);Nn=a&&a[1]||"",jr=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Nn+e+jr}var ga=!1;function Ma(e,a){if(!e||ga)return"";ga=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(a){var Ae=function(){throw Error()};if(Object.defineProperty(Ae.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ae,[])}catch(ye){var fe=ye}Reflect.construct(e,[],Ae)}else{try{Ae.call()}catch(ye){fe=ye}e.call(Ae.prototype)}}else{try{throw Error()}catch(ye){fe=ye}(Ae=e())&&typeof Ae.catch=="function"&&Ae.catch(function(){})}}catch(ye){if(ye&&fe&&typeof ye.stack=="string")return[ye.stack,fe.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=r.DetermineComponentFrameRoot(),_=h[0],k=h[1];if(_&&k){var P=_.split(`
`),oe=k.split(`
`);for(c=r=0;r<P.length&&!P[r].includes("DetermineComponentFrameRoot");)r++;for(;c<oe.length&&!oe[c].includes("DetermineComponentFrameRoot");)c++;if(r===P.length||c===oe.length)for(r=P.length-1,c=oe.length-1;1<=r&&0<=c&&P[r]!==oe[c];)c--;for(;1<=r&&0<=c;r--,c--)if(P[r]!==oe[c]){if(r!==1||c!==1)do if(r--,c--,0>c||P[r]!==oe[c]){var Se=`
`+P[r].replace(" at new "," at ");return e.displayName&&Se.includes("<anonymous>")&&(Se=Se.replace("<anonymous>",e.displayName)),Se}while(1<=r&&0<=c);break}}}finally{ga=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?ia(i):""}function Wa(e,a){switch(e.tag){case 26:case 27:case 5:return ia(e.type);case 16:return ia("Lazy");case 13:return e.child!==a&&a!==null?ia("Suspense Fallback"):ia("Suspense");case 19:return ia("SuspenseList");case 0:case 15:return Ma(e.type,!1);case 11:return Ma(e.type.render,!1);case 1:return Ma(e.type,!0);case 31:return ia("Activity");default:return""}}function $l(e){try{var a="",i=null;do a+=Wa(e,i),i=e,e=e.return;while(e);return a}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}var Ss=Object.prototype.hasOwnProperty,Ro=o.unstable_scheduleCallback,Yi=o.unstable_cancelCallback,$d=o.unstable_shouldYield,Sd=o.unstable_requestPaint,en=o.unstable_now,Ed=o.unstable_getCurrentPriorityLevel,Bu=o.unstable_ImmediatePriority,Sl=o.unstable_UserBlockingPriority,oa=o.unstable_NormalPriority,Es=o.unstable_LowPriority,El=o.unstable_IdlePriority,Ts=o.log,Cs=o.unstable_setDisableYieldValue,Xi=null,tn=null;function Un(e){if(typeof Ts=="function"&&Cs(e),tn&&typeof tn.setStrictMode=="function")try{tn.setStrictMode(Xi,e)}catch{}}var La=Math.clz32?Math.clz32:Zi,Zt=Math.log,zs=Math.LN2;function Zi(e){return e>>>=0,e===0?32:31-(Zt(e)/zs|0)|0}var Gr=256,Vr=262144,yi=4194304;function ai(e){var a=e&42;if(a!==0)return a;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function vi(e,a,i){var r=e.pendingLanes;if(r===0)return 0;var c=0,h=e.suspendedLanes,_=e.pingedLanes;e=e.warmLanes;var k=r&134217727;return k!==0?(r=k&~h,r!==0?c=ai(r):(_&=k,_!==0?c=ai(_):i||(i=k&~e,i!==0&&(c=ai(i))))):(k=r&~h,k!==0?c=ai(k):_!==0?c=ai(_):i||(i=r&~e,i!==0&&(c=ai(i)))),c===0?0:a!==0&&a!==c&&(a&h)===0&&(h=c&-c,i=a&-a,h>=i||h===32&&(i&4194048)!==0)?a:c}function Ji(e,a){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&a)===0}function As(e,a){switch(e){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tl(){var e=yi;return yi<<=1,(yi&62914560)===0&&(yi=4194304),e}function er(e){for(var a=[],i=0;31>i;i++)a.push(e);return a}function ni(e,a){e.pendingLanes|=a,a!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function tr(e,a,i,r,c,h){var _=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var k=e.entanglements,P=e.expirationTimes,oe=e.hiddenUpdates;for(i=_&~i;0<i;){var Se=31-La(i),Ae=1<<Se;k[Se]=0,P[Se]=-1;var fe=oe[Se];if(fe!==null)for(oe[Se]=null,Se=0;Se<fe.length;Se++){var ye=fe[Se];ye!==null&&(ye.lane&=-536870913)}i&=~Ae}r!==0&&In(e,r,0),h!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=h&~(_&~a))}function In(e,a,i){e.pendingLanes|=a,e.suspendedLanes&=~a;var r=31-La(a);e.entangledLanes|=a,e.entanglements[r]=e.entanglements[r]|1073741824|i&261930}function Hr(e,a){var i=e.entangledLanes|=a;for(e=e.entanglements;i;){var r=31-La(i),c=1<<r;c&a|e[r]&a&&(e[r]|=a),i&=~c}}function Cl(e,a){var i=a&-a;return i=(i&42)!==0?1:Os(i),(i&(e.suspendedLanes|a))!==0?0:i}function Os(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Rs(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Pr(){var e=Oe.p;return e!==0?e:(e=window.event,e===void 0?32:Hg(e.type))}function st(e,a){var i=Oe.p;try{return Oe.p=e,a()}finally{Oe.p=i}}var xa=Math.random().toString(36).slice(2),St="__reactFiber$"+xa,ya="__reactProps$"+xa,Ke="__reactContainer$"+xa,ar="__reactEvents$"+xa,Mo="__reactListeners$"+xa,Td="__reactHandles$"+xa,zl="__reactResources$"+xa,nr="__reactMarker$"+xa;function Ms(e){delete e[St],delete e[ya],delete e[ar],delete e[Mo],delete e[Td]}function Qa(e){var a=e[St];if(a)return a;for(var i=e.parentNode;i;){if(a=i[Ke]||i[St]){if(i=a.alternate,a.child!==null||i!==null&&i.child!==null)for(e=zg(e);e!==null;){if(i=e[St])return i;e=zg(e)}return a}e=i,i=e.parentNode}return null}function bi(e){if(e=e[St]||e[Ke]){var a=e.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return e}return null}function ir(e){var a=e.tag;if(a===5||a===26||a===27||a===6)return e.stateNode;throw Error(y(33))}function Fr(e){var a=e[zl];return a||(a=e[zl]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function jt(e){e[nr]=!0}var an=new Set,nn={};function Sn(e,a){Ln(e,a),Ln(e+"Capture",a)}function Ln(e,a){for(nn[e]=a,e=0;e<a.length;e++)an.add(a[e])}var ks=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Kr={},Ds={};function rt(e){return Ss.call(Ds,e)?!0:Ss.call(Kr,e)?!1:ks.test(e)?Ds[e]=!0:(Kr[e]=!0,!1)}function _i(e,a,i){if(rt(a))if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(a);return;case"boolean":var r=a.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){e.removeAttribute(a);return}}e.setAttribute(a,""+i)}}function Wr(e,a,i){if(i===null)e.removeAttribute(a);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttribute(a,""+i)}}function En(e,a,i,r){if(r===null)e.removeAttribute(i);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(a,i,""+r)}}function qa(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Bs(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function wi(e,a,i){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,a);if(!e.hasOwnProperty(a)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,h=r.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return c.call(this)},set:function(_){i=""+_,h.call(this,_)}}),Object.defineProperty(e,a,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(_){i=""+_},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function Qr(e){if(!e._valueTracker){var a=Bs(e)?"checked":"value";e._valueTracker=wi(e,a,""+e[a])}}function Ns(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var i=a.getValue(),r="";return e&&(r=Bs(e)?e.checked?"true":"false":e.value),e=r,e!==i?(a.setValue(e),!0):!1}function gt(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Tn=/[\n"\\]/g;function ja(e){return e.replace(Tn,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function qn(e,a,i,r,c,h,_,k){e.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.type=_:e.removeAttribute("type"),a!=null?_==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+qa(a)):e.value!==""+qa(a)&&(e.value=""+qa(a)):_!=="submit"&&_!=="reset"||e.removeAttribute("value"),a!=null?xi(e,_,qa(a)):i!=null?xi(e,_,qa(i)):r!=null&&e.removeAttribute("value"),c==null&&h!=null&&(e.defaultChecked=!!h),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?e.name=""+qa(k):e.removeAttribute("name")}function pe(e,a,i,r,c,h,_,k){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),a!=null||i!=null){if(!(h!=="submit"&&h!=="reset"||a!=null)){Qr(e);return}i=i!=null?""+qa(i):"",a=a!=null?""+qa(a):i,k||a===e.value||(e.value=a),e.defaultValue=a}r=r??c,r=typeof r!="function"&&typeof r!="symbol"&&!!r,e.checked=k?e.checked:!!r,e.defaultChecked=!!r,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(e.name=_),Qr(e)}function xi(e,a,i){a==="number"&&gt(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ii(e,a,i,r){if(e=e.options,a){a={};for(var c=0;c<i.length;c++)a["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=a.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&r&&(e[i].defaultSelected=!0)}else{for(i=""+qa(i),a=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,r&&(e[c].defaultSelected=!0);return}a!==null||e[c].disabled||(a=e[c])}a!==null&&(a.selected=!0)}}function Al(e,a,i){if(a!=null&&(a=""+qa(a),a!==e.value&&(e.value=a),i==null)){e.defaultValue!==a&&(e.defaultValue=a);return}e.defaultValue=i!=null?""+qa(i):""}function jn(e,a,i,r){if(a==null){if(r!=null){if(i!=null)throw Error(y(92));if(ma(r)){if(1<r.length)throw Error(y(93));r=r[0]}i=r}i==null&&(i=""),a=i}i=qa(a),e.defaultValue=i,r=e.textContent,r===i&&r!==""&&r!==null&&(e.value=r),Qr(e)}function He(e,a){if(a){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=a;return}}e.textContent=a}var $i=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function rr(e,a,i){var r=a.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?r?e.setProperty(a,""):a==="float"?e.cssFloat="":e[a]="":r?e.setProperty(a,i):typeof i!="number"||i===0||$i.has(a)?a==="float"?e.cssFloat=i:e[a]=(""+i).trim():e[a]=i+"px"}function Si(e,a,i){if(a!=null&&typeof a!="object")throw Error(y(62));if(e=e.style,i!=null){for(var r in i)!i.hasOwnProperty(r)||a!=null&&a.hasOwnProperty(r)||(r.indexOf("--")===0?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="");for(var c in a)r=a[c],a.hasOwnProperty(c)&&i[c]!==r&&rr(e,c,r)}else for(var h in a)a.hasOwnProperty(h)&&rr(e,h,a[h])}function Ei(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Us=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Is=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pn(e){return Is.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function ka(){}var Yr=null;function Xr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ri=null,Ti=null;function Ol(e){var a=bi(e);if(a&&(e=a.stateNode)){var i=e[ya]||null;e:switch(e=a.stateNode,a.type){case"input":if(qn(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),a=i.name,i.type==="radio"&&a!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ja(""+a)+'"][type="radio"]'),a=0;a<i.length;a++){var r=i[a];if(r!==e&&r.form===e.form){var c=r[ya]||null;if(!c)throw Error(y(90));qn(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(a=0;a<i.length;a++)r=i[a],r.form===e.form&&Ns(r)}break e;case"textarea":Al(e,i.value,i.defaultValue);break e;case"select":a=i.value,a!=null&&ii(e,!!i.multiple,a,!1)}}}var Rl=!1;function sr(e,a,i){if(Rl)return e(a,i);Rl=!0;try{var r=e(a);return r}finally{if(Rl=!1,(ri!==null||Ti!==null)&&(gu(),ri&&(a=ri,e=Ti,Ti=ri=null,Ol(a),e)))for(a=0;a<e.length;a++)Ol(e[a])}}function lr(e,a){var i=e.stateNode;if(i===null)return null;var r=i[ya]||null;if(r===null)return null;i=r[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(y(231,a,typeof i));return i}var Cn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ls=!1;if(Cn)try{var Ci={};Object.defineProperty(Ci,"passive",{get:function(){Ls=!0}}),window.addEventListener("test",Ci,Ci),window.removeEventListener("test",Ci,Ci)}catch{Ls=!1}var zn=null,Zr=null,zi=null;function qs(){if(zi)return zi;var e,a=Zr,i=a.length,r,c="value"in zn?zn.value:zn.textContent,h=c.length;for(e=0;e<i&&a[e]===c[e];e++);var _=i-e;for(r=1;r<=_&&a[i-r]===c[h-r];r++);return zi=c.slice(e,1<r?1-r:void 0)}function or(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function ur(){return!0}function Ml(){return!1}function Da(e){function a(i,r,c,h,_){this._reactName=i,this._targetInst=c,this.type=r,this.nativeEvent=h,this.target=_,this.currentTarget=null;for(var k in e)e.hasOwnProperty(k)&&(i=e[k],this[k]=i?i(h):h[k]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?ur:Ml,this.isPropagationStopped=Ml,this}return q(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=ur)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=ur)},persist:function(){},isPersistent:ur}),a}var Ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kl=Da(Ai),S=q({},Ai,{view:0,detail:0}),O=Da(S),I,F,j,ae=q({},S,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ft,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==j&&(j&&e.type==="mousemove"?(I=e.screenX-j.screenX,F=e.screenY-j.screenY):F=I=0,j=e),I)},movementY:function(e){return"movementY"in e?e.movementY:F}}),W=Da(ae),Q=q({},ae,{dataTransfer:0}),re=Da(Q),Ee=q({},S,{relatedTarget:0}),ke=Da(Ee),xe=q({},Ai,{animationName:0,elapsedTime:0,pseudoElement:0}),de=Da(xe),Ve=q({},Ai,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),J=Da(Ve),Ue=q({},Ai,{data:0}),Jt=Da(Ue),ft={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ct={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ze(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=Gt[e])?!!a[e]:!1}function Ft(){return Ze}var Rt=q({},S,{key:function(e){if(e.key){var a=ft[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=or(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ct[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ft,charCode:function(e){return e.type==="keypress"?or(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?or(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Aa=Da(Rt),Ga=q({},ae,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Va=Da(Ga),js=q({},S,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ft}),Ya=Da(js),ko=q({},Ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),Do=Da(ko),Oa=q({},ae,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Gn=Da(Oa),Bo=q({},Ai,{newState:0,oldState:0}),$t=Da(Bo),An=[9,13,27,32],Dl=Cn&&"CompositionEvent"in window,rn=null;Cn&&"documentMode"in document&&(rn=document.documentMode);var Gs=Cn&&"TextEvent"in window&&!rn,va=Cn&&(!Dl||rn&&8<rn&&11>=rn),Ha=" ",Vs=!1;function Pa(e,a){switch(e){case"keyup":return An.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bl(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var cr=!1;function si(e,a){switch(e){case"compositionend":return Bl(a);case"keypress":return a.which!==32?null:(Vs=!0,Ha);case"textInput":return e=a.data,e===Ha&&Vs?null:e;default:return null}}function li(e,a){if(cr)return e==="compositionend"||!Dl&&Pa(e,a)?(e=qs(),zi=Zr=zn=null,cr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return va&&a.locale!=="ko"?null:a.data;default:return null}}var Jr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ba(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!Jr[e.type]:a==="textarea"}function ra(e,a,i,r){ri?Ti?Ti.push(r):Ti=[r]:ri=r,a=L(a,"onChange"),0<a.length&&(i=new kl("onChange","change",null,i,r),e.push({event:i,listeners:a}))}var Xa=null,es=null;function Nu(e){b(e,0)}function Uu(e){var a=ir(e);if(Ns(a))return e}function Vn(e,a){if(e==="change")return a}var Cd=!1;if(Cn){var Nl;if(Cn){var No="oninput"in document;if(!No){var Hn=document.createElement("div");Hn.setAttribute("oninput","return;"),No=typeof Hn.oninput=="function"}Nl=No}else Nl=!1;Cd=Nl&&(!document.documentMode||9<document.documentMode)}function zd(){Xa&&(Xa.detachEvent("onpropertychange",Ad),es=Xa=null)}function Ad(e){if(e.propertyName==="value"&&Uu(es)){var a=[];ra(a,es,e,Xr(e)),sr(Nu,a)}}function lh(e,a,i){e==="focusin"?(zd(),Xa=a,es=i,Xa.attachEvent("onpropertychange",Ad)):e==="focusout"&&zd()}function oh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Uu(es)}function uh(e,a){if(e==="click")return Uu(a)}function ch(e,a){if(e==="input"||e==="change")return Uu(a)}function dh(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var hn=typeof Object.is=="function"?Object.is:dh;function Ul(e,a){if(hn(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var i=Object.keys(e),r=Object.keys(a);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var c=i[r];if(!Ss.call(a,c)||!hn(e[c],a[c]))return!1}return!0}function Od(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Pn(e,a){var i=Od(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=a&&r>=a)return{node:i,offset:a-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Od(i)}}function Rd(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?Rd(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function Md(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var a=gt(e.document);a instanceof e.HTMLIFrameElement;){try{var i=typeof a.contentWindow.location.href=="string"}catch{i=!1}if(i)e=a.contentWindow;else break;a=gt(e.document)}return a}function Iu(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}var fh=Cn&&"documentMode"in document&&11>=document.documentMode,Hs=null,Lu=null,Il=null,qu=!1;function kd(e,a,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;qu||Hs==null||Hs!==gt(r)||(r=Hs,"selectionStart"in r&&Iu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Il&&Ul(Il,r)||(Il=r,r=L(Lu,"onSelect"),0<r.length&&(a=new kl("onSelect","select",null,a,i),e.push({event:a,listeners:r}),a.target=Hs)))}function ts(e,a){var i={};return i[e.toLowerCase()]=a.toLowerCase(),i["Webkit"+e]="webkit"+a,i["Moz"+e]="moz"+a,i}var as={animationend:ts("Animation","AnimationEnd"),animationiteration:ts("Animation","AnimationIteration"),animationstart:ts("Animation","AnimationStart"),transitionrun:ts("Transition","TransitionRun"),transitionstart:ts("Transition","TransitionStart"),transitioncancel:ts("Transition","TransitionCancel"),transitionend:ts("Transition","TransitionEnd")},Uo={},Dd={};Cn&&(Dd=document.createElement("div").style,"AnimationEvent"in window||(delete as.animationend.animation,delete as.animationiteration.animation,delete as.animationstart.animation),"TransitionEvent"in window||delete as.transitionend.transition);function ns(e){if(Uo[e])return Uo[e];if(!as[e])return e;var a=as[e],i;for(i in a)if(a.hasOwnProperty(i)&&i in Dd)return Uo[e]=a[i];return e}var ju=ns("animationend"),ph=ns("animationiteration"),Bd=ns("animationstart"),Gu=ns("transitionrun"),hh=ns("transitionstart"),mh=ns("transitioncancel"),Nd=ns("transitionend"),Ll=new Map,Vu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vu.push("scrollEnd");function Fn(e,a){Ll.set(e,a),Sn(a,[e])}var ql=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},On=[],Ps=0,Hu=0;function Io(){for(var e=Ps,a=Hu=Ps=0;a<e;){var i=On[a];On[a++]=null;var r=On[a];On[a++]=null;var c=On[a];On[a++]=null;var h=On[a];if(On[a++]=null,r!==null&&c!==null){var _=r.pending;_===null?c.next=c:(c.next=_.next,_.next=c),r.pending=c}h!==0&&Ud(i,c,h)}}function Pu(e,a,i,r){On[Ps++]=e,On[Ps++]=a,On[Ps++]=i,On[Ps++]=r,Hu|=r,e.lanes|=r,e=e.alternate,e!==null&&(e.lanes|=r)}function Fu(e,a,i,r){return Pu(e,a,i,r),Ku(e)}function is(e,a){return Pu(e,null,null,a),Ku(e)}function Ud(e,a,i){e.lanes|=i;var r=e.alternate;r!==null&&(r.lanes|=i);for(var c=!1,h=e.return;h!==null;)h.childLanes|=i,r=h.alternate,r!==null&&(r.childLanes|=i),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(c=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,c&&a!==null&&(c=31-La(i),e=h.hiddenUpdates,r=e[c],r===null?e[c]=[a]:r.push(a),a.lane=i|536870912),h):null}function Ku(e){if(50<mu)throw mu=0,Wc=null,Error(y(185));for(var a=e.return;a!==null;)e=a,a=e.return;return e.tag===3?e.stateNode:null}var Fs={};function Nt(e,a,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mn(e,a,i,r){return new Nt(e,a,i,r)}function Wu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Oi(e,a){var i=e.alternate;return i===null?(i=mn(e.tag,a,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=a,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,a=e.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function Id(e,a){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=a,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,a=i.dependencies,e.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),e}function Lo(e,a,i,r,c,h){var _=0;if(r=e,typeof e=="function")Wu(e)&&(_=1);else if(typeof e=="string")_=av(e,i,Ye.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case at:return e=mn(31,i,a,c),e.elementType=at,e.lanes=h,e;case ee:return rs(i.children,c,h,a);case he:_=8,c|=24;break;case $e:return e=mn(12,i,a,c|2),e.elementType=$e,e.lanes=h,e;case Me:return e=mn(13,i,a,c),e.elementType=Me,e.lanes=h,e;case Be:return e=mn(19,i,a,c),e.elementType=Be,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case me:_=10;break e;case De:_=9;break e;case be:_=11;break e;case qe:_=14;break e;case Re:_=16,r=null;break e}_=29,i=Error(y(130,e===null?"null":typeof e,"")),r=null}return a=mn(_,i,a,c),a.elementType=e,a.type=r,a.lanes=h,a}function rs(e,a,i,r){return e=mn(7,e,r,a),e.lanes=i,e}function Qu(e,a,i){return e=mn(6,e,null,a),e.lanes=i,e}function Ld(e){var a=mn(18,null,null,0);return a.stateNode=e,a}function Yu(e,a,i){return a=mn(4,e.children!==null?e.children:[],e.key,a),a.lanes=i,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}var qd=new WeakMap;function Rn(e,a){if(typeof e=="object"&&e!==null){var i=qd.get(e);return i!==void 0?i:(a={value:e,source:a,stack:$l(a)},qd.set(e,a),a)}return{value:e,source:a,stack:$l(a)}}var Ks=[],Ws=0,qo=null,dr=0,Mn=[],sn=0,fr=null,oi=1,ui="";function Ri(e,a){Ks[Ws++]=dr,Ks[Ws++]=qo,qo=e,dr=a}function jd(e,a,i){Mn[sn++]=oi,Mn[sn++]=ui,Mn[sn++]=fr,fr=e;var r=oi;e=ui;var c=32-La(r)-1;r&=~(1<<c),i+=1;var h=32-La(a)+c;if(30<h){var _=c-c%5;h=(r&(1<<_)-1).toString(32),r>>=_,c-=_,oi=1<<32-La(a)+c|i<<c|r,ui=h+e}else oi=1<<h|i<<c|r,ui=e}function Xu(e){e.return!==null&&(Ri(e,1),jd(e,1,0))}function Zu(e){for(;e===qo;)qo=Ks[--Ws],Ks[Ws]=null,dr=Ks[--Ws],Ks[Ws]=null;for(;e===fr;)fr=Mn[--sn],Mn[sn]=null,ui=Mn[--sn],Mn[sn]=null,oi=Mn[--sn],Mn[sn]=null}function Gd(e,a){Mn[sn++]=oi,Mn[sn++]=ui,Mn[sn++]=fr,oi=a.id,ui=a.overflow,fr=e}var Ba=null,ea=null,Mt=!1,pr=null,kn=!1,Ju=Error(y(519));function hr(e){var a=Error(y(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw jl(Rn(a,e)),Ju}function Vd(e){var a=e.stateNode,i=e.type,r=e.memoizedProps;switch(a[St]=e,a[ya]=r,i){case"dialog":v("cancel",a),v("close",a);break;case"iframe":case"object":case"embed":v("load",a);break;case"video":case"audio":for(i=0;i<p.length;i++)v(p[i],a);break;case"source":v("error",a);break;case"img":case"image":case"link":v("error",a),v("load",a);break;case"details":v("toggle",a);break;case"input":v("invalid",a),pe(a,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":v("invalid",a);break;case"textarea":v("invalid",a),jn(a,r.value,r.defaultValue,r.children)}i=r.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||a.textContent===""+i||r.suppressHydrationWarning===!0||ue(a.textContent,i)?(r.popover!=null&&(v("beforetoggle",a),v("toggle",a)),r.onScroll!=null&&v("scroll",a),r.onScrollEnd!=null&&v("scrollend",a),r.onClick!=null&&(a.onclick=ka),a=!0):a=!1,a||hr(e,!0)}function ec(e){for(Ba=e.return;Ba;)switch(Ba.tag){case 5:case 31:case 13:kn=!1;return;case 27:case 3:kn=!0;return;default:Ba=Ba.return}}function Qs(e){if(e!==Ba)return!1;if(!Mt)return ec(e),Mt=!0,!1;var a=e.tag,i;if((i=a!==3&&a!==27)&&((i=a===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||Qt(e.type,e.memoizedProps)),i=!i),i&&ea&&hr(e),ec(e),a===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(y(317));ea=Cg(e)}else if(a===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(y(317));ea=Cg(e)}else a===27?(a=ea,Jn(e.type)?(e=Tp,Tp=null,ea=e):ea=a):ea=Ba?ei(e.stateNode.nextSibling):null;return!0}function mr(){ea=Ba=null,Mt=!1}function jo(){var e=pr;return e!==null&&(bn===null?bn=e:bn.push.apply(bn,e),pr=null),e}function jl(e){pr===null?pr=[e]:pr.push(e)}var tc=K(null),ss=null,Mi=null;function gr(e,a,i){Ge(tc,a._currentValue),a._currentValue=i}function ki(e){e._currentValue=tc.current,Ce(tc)}function Go(e,a,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,r!==null&&(r.childLanes|=a)):r!==null&&(r.childLanes&a)!==a&&(r.childLanes|=a),e===i)break;e=e.return}}function ac(e,a,i,r){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var h=c.dependencies;if(h!==null){var _=c.child;h=h.firstContext;e:for(;h!==null;){var k=h;h=c;for(var P=0;P<a.length;P++)if(k.context===a[P]){h.lanes|=i,k=h.alternate,k!==null&&(k.lanes|=i),Go(h.return,i,e),r||(_=null);break e}h=k.next}}else if(c.tag===18){if(_=c.return,_===null)throw Error(y(341));_.lanes|=i,h=_.alternate,h!==null&&(h.lanes|=i),Go(_,i,e),_=null}else _=c.child;if(_!==null)_.return=c;else for(_=c;_!==null;){if(_===e){_=null;break}if(c=_.sibling,c!==null){c.return=_.return,_=c;break}_=_.return}c=_}}function Ys(e,a,i,r){e=null;for(var c=a,h=!1;c!==null;){if(!h){if((c.flags&524288)!==0)h=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var _=c.alternate;if(_===null)throw Error(y(387));if(_=_.memoizedProps,_!==null){var k=c.type;hn(c.pendingProps.value,_.value)||(e!==null?e.push(k):e=[k])}}else if(c===Lt.current){if(_=c.alternate,_===null)throw Error(y(387));_.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Op):e=[Op])}c=c.return}e!==null&&ac(a,e,i,r),a.flags|=262144}function Vo(e){for(e=e.firstContext;e!==null;){if(!hn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Xs(e){ss=e,Mi=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Na(e){return Kn(ss,e)}function Ho(e,a){return ss===null&&Xs(e),Kn(e,a)}function Kn(e,a){var i=a._currentValue;if(a={context:a,memoizedValue:i,next:null},Mi===null){if(e===null)throw Error(y(308));Mi=a,e.dependencies={lanes:0,firstContext:a},e.flags|=524288}else Mi=Mi.next=a;return i}var gh=typeof AbortController<"u"?AbortController:function(){var e=[],a=this.signal={aborted:!1,addEventListener:function(i,r){e.push(r)}};this.abort=function(){a.aborted=!0,e.forEach(function(i){return i()})}},yh=o.unstable_scheduleCallback,vh=o.unstable_NormalPriority,$a={$$typeof:me,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function nc(){return{controller:new gh,data:new Map,refCount:0}}function Gl(e){e.refCount--,e.refCount===0&&yh(vh,function(){e.controller.abort()})}var Vl=null,ic=0,Zs=0,Js=null;function Rm(e,a){if(Vl===null){var i=Vl=[];ic=0,Zs=$p(),Js={status:"pending",value:void 0,then:function(r){i.push(r)}}}return ic++,a.then(Hd,Hd),a}function Hd(){if(--ic===0&&Vl!==null){Js!==null&&(Js.status="fulfilled");var e=Vl;Vl=null,Zs=0,Js=null;for(var a=0;a<e.length;a++)(0,e[a])()}}function bh(e,a){var i=[],r={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){r.status="fulfilled",r.value=a;for(var c=0;c<i.length;c++)(0,i[c])(a)},function(c){for(r.status="rejected",r.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),r}var Pd=_e.S;_e.S=function(e,a){fp=en(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&Rm(e,a),Pd!==null&&Pd(e,a)};var ls=K(null);function rc(){var e=ls.current;return e!==null?e:Wt.pooledCache}function Po(e,a){a===null?Ge(ls,ls.current):Ge(ls,a.pool)}function _h(){var e=rc();return e===null?null:{parent:$a._currentValue,pool:e}}var Wn=Error(y(460)),yr=Error(y(474)),Di=Error(y(542)),Hl={then:function(){}};function os(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ra(e,a,i){switch(i=e[i],i===void 0?e.push(a):i!==a&&(a.then(ka,ka),a=i),a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,wh(e),e;default:if(typeof a.status=="string")a.then(ka,ka);else{if(e=Wt,e!==null&&100<e.shellSuspendCounter)throw Error(y(482));e=a,e.status="pending",e.then(function(r){if(a.status==="pending"){var c=a;c.status="fulfilled",c.value=r}},function(r){if(a.status==="pending"){var c=a;c.status="rejected",c.reason=r}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw e=a.reason,wh(e),e}throw vr=a,Wn}}function us(e){try{var a=e._init;return a(e._payload)}catch(i){throw i!==null&&typeof i=="object"&&typeof i.then=="function"?(vr=i,Wn):i}}var vr=null;function Fd(){if(vr===null)throw Error(y(459));var e=vr;return vr=null,e}function wh(e){if(e===Wn||e===Di)throw Error(y(483))}var Bi=null,el=0;function Pl(e){var a=el;return el+=1,Bi===null&&(Bi=[]),Ra(Bi,e,a)}function Fl(e,a){a=a.props.ref,e.ref=a!==void 0?a:null}function Fo(e,a){throw a.$$typeof===Z?Error(y(525)):(e=Object.prototype.toString.call(a),Error(y(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e)))}function sc(e){function a(ie,Y){if(e){var le=ie.deletions;le===null?(ie.deletions=[Y],ie.flags|=16):le.push(Y)}}function i(ie,Y){if(!e)return null;for(;Y!==null;)a(ie,Y),Y=Y.sibling;return null}function r(ie){for(var Y=new Map;ie!==null;)ie.key!==null?Y.set(ie.key,ie):Y.set(ie.index,ie),ie=ie.sibling;return Y}function c(ie,Y){return ie=Oi(ie,Y),ie.index=0,ie.sibling=null,ie}function h(ie,Y,le){return ie.index=le,e?(le=ie.alternate,le!==null?(le=le.index,le<Y?(ie.flags|=67108866,Y):le):(ie.flags|=67108866,Y)):(ie.flags|=1048576,Y)}function _(ie){return e&&ie.alternate===null&&(ie.flags|=67108866),ie}function k(ie,Y,le,ze){return Y===null||Y.tag!==6?(Y=Qu(le,ie.mode,ze),Y.return=ie,Y):(Y=c(Y,le),Y.return=ie,Y)}function P(ie,Y,le,ze){var ot=le.type;return ot===ee?Se(ie,Y,le.props.children,ze,le.key):Y!==null&&(Y.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===Re&&us(ot)===Y.type)?(Y=c(Y,le.props),Fl(Y,le),Y.return=ie,Y):(Y=Lo(le.type,le.key,le.props,null,ie.mode,ze),Fl(Y,le),Y.return=ie,Y)}function oe(ie,Y,le,ze){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==le.containerInfo||Y.stateNode.implementation!==le.implementation?(Y=Yu(le,ie.mode,ze),Y.return=ie,Y):(Y=c(Y,le.children||[]),Y.return=ie,Y)}function Se(ie,Y,le,ze,ot){return Y===null||Y.tag!==7?(Y=rs(le,ie.mode,ze,ot),Y.return=ie,Y):(Y=c(Y,le),Y.return=ie,Y)}function Ae(ie,Y,le){if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return Y=Qu(""+Y,ie.mode,le),Y.return=ie,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case se:return le=Lo(Y.type,Y.key,Y.props,null,ie.mode,le),Fl(le,Y),le.return=ie,le;case ce:return Y=Yu(Y,ie.mode,le),Y.return=ie,Y;case Re:return Y=us(Y),Ae(ie,Y,le)}if(ma(Y)||Qe(Y))return Y=rs(Y,ie.mode,le,null),Y.return=ie,Y;if(typeof Y.then=="function")return Ae(ie,Pl(Y),le);if(Y.$$typeof===me)return Ae(ie,Ho(ie,Y),le);Fo(ie,Y)}return null}function fe(ie,Y,le,ze){var ot=Y!==null?Y.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return ot!==null?null:k(ie,Y,""+le,ze);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case se:return le.key===ot?P(ie,Y,le,ze):null;case ce:return le.key===ot?oe(ie,Y,le,ze):null;case Re:return le=us(le),fe(ie,Y,le,ze)}if(ma(le)||Qe(le))return ot!==null?null:Se(ie,Y,le,ze,null);if(typeof le.then=="function")return fe(ie,Y,Pl(le),ze);if(le.$$typeof===me)return fe(ie,Y,Ho(ie,le),ze);Fo(ie,le)}return null}function ye(ie,Y,le,ze,ot){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return ie=ie.get(le)||null,k(Y,ie,""+ze,ot);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case se:return ie=ie.get(ze.key===null?le:ze.key)||null,P(Y,ie,ze,ot);case ce:return ie=ie.get(ze.key===null?le:ze.key)||null,oe(Y,ie,ze,ot);case Re:return ze=us(ze),ye(ie,Y,le,ze,ot)}if(ma(ze)||Qe(ze))return ie=ie.get(le)||null,Se(Y,ie,ze,ot,null);if(typeof ze.then=="function")return ye(ie,Y,le,Pl(ze),ot);if(ze.$$typeof===me)return ye(ie,Y,le,Ho(Y,ze),ot);Fo(Y,ze)}return null}function Je(ie,Y,le,ze){for(var ot=null,Ht=null,it=Y,Ct=Y=0,Ut=null;it!==null&&Ct<le.length;Ct++){it.index>Ct?(Ut=it,it=null):Ut=it.sibling;var Pt=fe(ie,it,le[Ct],ze);if(Pt===null){it===null&&(it=Ut);break}e&&it&&Pt.alternate===null&&a(ie,it),Y=h(Pt,Y,Ct),Ht===null?ot=Pt:Ht.sibling=Pt,Ht=Pt,it=Ut}if(Ct===le.length)return i(ie,it),Mt&&Ri(ie,Ct),ot;if(it===null){for(;Ct<le.length;Ct++)it=Ae(ie,le[Ct],ze),it!==null&&(Y=h(it,Y,Ct),Ht===null?ot=it:Ht.sibling=it,Ht=it);return Mt&&Ri(ie,Ct),ot}for(it=r(it);Ct<le.length;Ct++)Ut=ye(it,ie,Ct,le[Ct],ze),Ut!==null&&(e&&Ut.alternate!==null&&it.delete(Ut.key===null?Ct:Ut.key),Y=h(Ut,Y,Ct),Ht===null?ot=Ut:Ht.sibling=Ut,Ht=Ut);return e&&it.forEach(function(_o){return a(ie,_o)}),Mt&&Ri(ie,Ct),ot}function dt(ie,Y,le,ze){if(le==null)throw Error(y(151));for(var ot=null,Ht=null,it=Y,Ct=Y=0,Ut=null,Pt=le.next();it!==null&&!Pt.done;Ct++,Pt=le.next()){it.index>Ct?(Ut=it,it=null):Ut=it.sibling;var _o=fe(ie,it,Pt.value,ze);if(_o===null){it===null&&(it=Ut);break}e&&it&&_o.alternate===null&&a(ie,it),Y=h(_o,Y,Ct),Ht===null?ot=_o:Ht.sibling=_o,Ht=_o,it=Ut}if(Pt.done)return i(ie,it),Mt&&Ri(ie,Ct),ot;if(it===null){for(;!Pt.done;Ct++,Pt=le.next())Pt=Ae(ie,Pt.value,ze),Pt!==null&&(Y=h(Pt,Y,Ct),Ht===null?ot=Pt:Ht.sibling=Pt,Ht=Pt);return Mt&&Ri(ie,Ct),ot}for(it=r(it);!Pt.done;Ct++,Pt=le.next())Pt=ye(it,ie,Ct,Pt.value,ze),Pt!==null&&(e&&Pt.alternate!==null&&it.delete(Pt.key===null?Ct:Pt.key),Y=h(Pt,Y,Ct),Ht===null?ot=Pt:Ht.sibling=Pt,Ht=Pt);return e&&it.forEach(function(pv){return a(ie,pv)}),Mt&&Ri(ie,Ct),ot}function na(ie,Y,le,ze){if(typeof le=="object"&&le!==null&&le.type===ee&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case se:e:{for(var ot=le.key;Y!==null;){if(Y.key===ot){if(ot=le.type,ot===ee){if(Y.tag===7){i(ie,Y.sibling),ze=c(Y,le.props.children),ze.return=ie,ie=ze;break e}}else if(Y.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===Re&&us(ot)===Y.type){i(ie,Y.sibling),ze=c(Y,le.props),Fl(ze,le),ze.return=ie,ie=ze;break e}i(ie,Y);break}else a(ie,Y);Y=Y.sibling}le.type===ee?(ze=rs(le.props.children,ie.mode,ze,le.key),ze.return=ie,ie=ze):(ze=Lo(le.type,le.key,le.props,null,ie.mode,ze),Fl(ze,le),ze.return=ie,ie=ze)}return _(ie);case ce:e:{for(ot=le.key;Y!==null;){if(Y.key===ot)if(Y.tag===4&&Y.stateNode.containerInfo===le.containerInfo&&Y.stateNode.implementation===le.implementation){i(ie,Y.sibling),ze=c(Y,le.children||[]),ze.return=ie,ie=ze;break e}else{i(ie,Y);break}else a(ie,Y);Y=Y.sibling}ze=Yu(le,ie.mode,ze),ze.return=ie,ie=ze}return _(ie);case Re:return le=us(le),na(ie,Y,le,ze)}if(ma(le))return Je(ie,Y,le,ze);if(Qe(le)){if(ot=Qe(le),typeof ot!="function")throw Error(y(150));return le=ot.call(le),dt(ie,Y,le,ze)}if(typeof le.then=="function")return na(ie,Y,Pl(le),ze);if(le.$$typeof===me)return na(ie,Y,Ho(ie,le),ze);Fo(ie,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,Y!==null&&Y.tag===6?(i(ie,Y.sibling),ze=c(Y,le),ze.return=ie,ie=ze):(i(ie,Y),ze=Qu(le,ie.mode,ze),ze.return=ie,ie=ze),_(ie)):i(ie,Y)}return function(ie,Y,le,ze){try{el=0;var ot=na(ie,Y,le,ze);return Bi=null,ot}catch(it){if(it===Wn||it===Di)throw it;var Ht=mn(29,it,null,ie.mode);return Ht.lanes=ze,Ht.return=ie,Ht}finally{}}}var br=sc(!0),Kd=sc(!1),Ni=!1;function lc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kl(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ui(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function _r(e,a,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,(qt&2)!==0){var c=r.pending;return c===null?a.next=a:(a.next=c.next,c.next=a),r.pending=a,a=Ku(e),Ud(e,null,i),a}return Pu(e,r,a,i),Ku(e)}function Wl(e,a,i){if(a=a.updateQueue,a!==null&&(a=a.shared,(i&4194048)!==0)){var r=a.lanes;r&=e.pendingLanes,i|=r,a.lanes=i,Hr(e,i)}}function Wd(e,a){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var c=null,h=null;if(i=i.firstBaseUpdate,i!==null){do{var _={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};h===null?c=h=_:h=h.next=_,i=i.next}while(i!==null);h===null?c=h=a:h=h.next=a}else c=h=a;i={baseState:r.baseState,firstBaseUpdate:c,lastBaseUpdate:h,shared:r.shared,callbacks:r.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=a:e.next=a,i.lastBaseUpdate=a}var oc=!1;function tl(){if(oc){var e=Js;if(e!==null)throw e}}function wr(e,a,i,r){oc=!1;var c=e.updateQueue;Ni=!1;var h=c.firstBaseUpdate,_=c.lastBaseUpdate,k=c.shared.pending;if(k!==null){c.shared.pending=null;var P=k,oe=P.next;P.next=null,_===null?h=oe:_.next=oe,_=P;var Se=e.alternate;Se!==null&&(Se=Se.updateQueue,k=Se.lastBaseUpdate,k!==_&&(k===null?Se.firstBaseUpdate=oe:k.next=oe,Se.lastBaseUpdate=P))}if(h!==null){var Ae=c.baseState;_=0,Se=oe=P=null,k=h;do{var fe=k.lane&-536870913,ye=fe!==k.lane;if(ye?(kt&fe)===fe:(r&fe)===fe){fe!==0&&fe===Zs&&(oc=!0),Se!==null&&(Se=Se.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var Je=e,dt=k;fe=a;var na=i;switch(dt.tag){case 1:if(Je=dt.payload,typeof Je=="function"){Ae=Je.call(na,Ae,fe);break e}Ae=Je;break e;case 3:Je.flags=Je.flags&-65537|128;case 0:if(Je=dt.payload,fe=typeof Je=="function"?Je.call(na,Ae,fe):Je,fe==null)break e;Ae=q({},Ae,fe);break e;case 2:Ni=!0}}fe=k.callback,fe!==null&&(e.flags|=64,ye&&(e.flags|=8192),ye=c.callbacks,ye===null?c.callbacks=[fe]:ye.push(fe))}else ye={lane:fe,tag:k.tag,payload:k.payload,callback:k.callback,next:null},Se===null?(oe=Se=ye,P=Ae):Se=Se.next=ye,_|=fe;if(k=k.next,k===null){if(k=c.shared.pending,k===null)break;ye=k,k=ye.next,ye.next=null,c.lastBaseUpdate=ye,c.shared.pending=null}}while(!0);Se===null&&(P=Ae),c.baseState=P,c.firstBaseUpdate=oe,c.lastBaseUpdate=Se,h===null&&(c.shared.lanes=0),Cr|=_,e.lanes=_,e.memoizedState=Ae}}function Qd(e,a){if(typeof e!="function")throw Error(y(191,e));e.call(a)}function uc(e,a){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Qd(i[e],a)}var al=K(null),Ko=K(0);function Yd(e,a){e=Fi,Ge(Ko,e),Ge(al,a),Fi=e|a.baseLanes}function Xd(){Ge(Ko,Fi),Ge(al,al.current)}function cc(){Fi=Ko.current,Ce(al),Ce(Ko)}var gn=K(null),Qn=null;function xr(e){var a=e.alternate;Ge(ua,ua.current&1),Ge(gn,e),Qn===null&&(a===null||al.current!==null||a.memoizedState!==null)&&(Qn=e)}function Ql(e){Ge(ua,ua.current),Ge(gn,e),Qn===null&&(Qn=e)}function Zd(e){e.tag===22?(Ge(ua,ua.current),Ge(gn,e),Qn===null&&(Qn=e)):ci()}function ci(){Ge(ua,ua.current),Ge(gn,gn.current)}function ln(e){Ce(gn),Qn===e&&(Qn=null),Ce(ua)}var ua=K(0);function Wo(e){for(var a=e;a!==null;){if(a.tag===13){var i=a.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||Ca(i)||pa(i)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Ii=0,yt=null,Kt=null,Sa=null,dc=!1,nl=!1,cs=!1,Qo=0,il=0,rl=null,xh=0;function la(){throw Error(y(321))}function fc(e,a){if(a===null)return!1;for(var i=0;i<a.length&&i<e.length;i++)if(!hn(e[i],a[i]))return!1;return!0}function pc(e,a,i,r,c,h){return Ii=h,yt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,_e.H=e===null||e.memoizedState===null?Dh:Fa,cs=!1,h=i(r,c),cs=!1,nl&&(h=Jd(a,i,r,c)),$h(e),h}function $h(e){_e.H=to;var a=Kt!==null&&Kt.next!==null;if(Ii=0,Sa=Kt=yt=null,dc=!1,il=0,rl=null,a)throw Error(y(300));e===null||ca||(e=e.dependencies,e!==null&&Vo(e)&&(ca=!0))}function Jd(e,a,i,r){yt=e;var c=0;do{if(nl&&(rl=null),il=0,nl=!1,25<=c)throw Error(y(301));if(c+=1,Sa=Kt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}_e.H=Mf,h=a(i,r)}while(nl);return h}function Sh(){var e=_e.H,a=e.useState()[0];return a=typeof a.then=="function"?Yl(a):a,e=e.useState()[0],(Kt!==null?Kt.memoizedState:null)!==e&&(yt.flags|=1024),a}function hc(){var e=Qo!==0;return Qo=0,e}function ef(e,a,i){a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~i}function mc(e){if(dc){for(e=e.memoizedState;e!==null;){var a=e.queue;a!==null&&(a.pending=null),e=e.next}dc=!1}Ii=0,Sa=Kt=yt=null,nl=!1,il=Qo=0,rl=null}function Za(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sa===null?yt.memoizedState=Sa=e:Sa=Sa.next=e,Sa}function _a(){if(Kt===null){var e=yt.alternate;e=e!==null?e.memoizedState:null}else e=Kt.next;var a=Sa===null?yt.memoizedState:Sa.next;if(a!==null)Sa=a,Kt=e;else{if(e===null)throw yt.alternate===null?Error(y(467)):Error(y(310));Kt=e,e={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},Sa===null?yt.memoizedState=Sa=e:Sa=Sa.next=e}return Sa}function Yo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yl(e){var a=il;return il+=1,rl===null&&(rl=[]),e=Ra(rl,e,a),a=yt,(Sa===null?a.memoizedState:Sa.next)===null&&(a=a.alternate,_e.H=a===null||a.memoizedState===null?Dh:Fa),e}function gc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Yl(e);if(e.$$typeof===me)return Na(e)}throw Error(y(438,String(e)))}function Xl(e){var a=null,i=yt.updateQueue;if(i!==null&&(a=i.memoCache),a==null){var r=yt.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(a={data:r.data.map(function(c){return c.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),i===null&&(i=Yo(),yt.updateQueue=i),i.memoCache=a,i=a.data[a.index],i===void 0)for(i=a.data[a.index]=Array(e),r=0;r<e;r++)i[r]=Xe;return a.index++,i}function Dn(e,a){return typeof a=="function"?a(e):a}function Zl(e){var a=_a();return yc(a,Kt,e)}function yc(e,a,i){var r=e.queue;if(r===null)throw Error(y(311));r.lastRenderedReducer=i;var c=e.baseQueue,h=r.pending;if(h!==null){if(c!==null){var _=c.next;c.next=h.next,h.next=_}a.baseQueue=c=h,r.pending=null}if(h=e.baseState,c===null)e.memoizedState=h;else{a=c.next;var k=_=null,P=null,oe=a,Se=!1;do{var Ae=oe.lane&-536870913;if(Ae!==oe.lane?(kt&Ae)===Ae:(Ii&Ae)===Ae){var fe=oe.revertLane;if(fe===0)P!==null&&(P=P.next={lane:0,revertLane:0,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),Ae===Zs&&(Se=!0);else if((Ii&fe)===fe){oe=oe.next,fe===Zs&&(Se=!0);continue}else Ae={lane:0,revertLane:oe.revertLane,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},P===null?(k=P=Ae,_=h):P=P.next=Ae,yt.lanes|=fe,Cr|=fe;Ae=oe.action,cs&&i(h,Ae),h=oe.hasEagerState?oe.eagerState:i(h,Ae)}else fe={lane:Ae,revertLane:oe.revertLane,gesture:oe.gesture,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},P===null?(k=P=fe,_=h):P=P.next=fe,yt.lanes|=Ae,Cr|=Ae;oe=oe.next}while(oe!==null&&oe!==a);if(P===null?_=h:P.next=k,!hn(h,e.memoizedState)&&(ca=!0,Se&&(i=Js,i!==null)))throw i;e.memoizedState=h,e.baseState=_,e.baseQueue=P,r.lastRenderedState=h}return c===null&&(r.lanes=0),[e.memoizedState,r.dispatch]}function vc(e){var a=_a(),i=a.queue;if(i===null)throw Error(y(311));i.lastRenderedReducer=e;var r=i.dispatch,c=i.pending,h=a.memoizedState;if(c!==null){i.pending=null;var _=c=c.next;do h=e(h,_.action),_=_.next;while(_!==c);hn(h,a.memoizedState)||(ca=!0),a.memoizedState=h,a.baseQueue===null&&(a.baseState=h),i.lastRenderedState=h}return[h,r]}function tf(e,a,i){var r=yt,c=_a(),h=Mt;if(h){if(i===void 0)throw Error(y(407));i=i()}else i=a();var _=!hn((Kt||c).memoizedState,i);if(_&&(c.memoizedState=i,ca=!0),c=c.queue,_c(nf.bind(null,r,c,e),[e]),c.getSnapshot!==a||_||Sa!==null&&Sa.memoizedState.tag&1){if(r.flags|=2048,Jl(9,{destroy:void 0},bc.bind(null,r,c,i,a),null),Wt===null)throw Error(y(349));h||(Ii&127)!==0||af(r,a,i)}return i}function af(e,a,i){e.flags|=16384,e={getSnapshot:a,value:i},a=yt.updateQueue,a===null?(a=Yo(),yt.updateQueue=a,a.stores=[e]):(i=a.stores,i===null?a.stores=[e]:i.push(e))}function bc(e,a,i,r){a.value=i,a.getSnapshot=r,rf(a)&&sf(e)}function nf(e,a,i){return i(function(){rf(a)&&sf(e)})}function rf(e){var a=e.getSnapshot;e=e.value;try{var i=a();return!hn(e,i)}catch{return!0}}function sf(e){var a=is(e,2);a!==null&&cn(a,e,2)}function lf(e){var a=Za();if(typeof e=="function"){var i=e;if(e=i(),cs){Un(!0);try{i()}finally{Un(!1)}}}return a.memoizedState=a.baseState=e,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dn,lastRenderedState:e},a}function of(e,a,i,r){return e.baseState=i,yc(e,Kt,typeof r=="function"?r:Dn)}function uf(e,a,i,r,c){if(Jo(e))throw Error(y(485));if(e=a.action,e!==null){var h={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){h.listeners.push(_)}};_e.T!==null?i(!0):h.isTransition=!1,r(h),i=a.pending,i===null?(h.next=a.pending=h,cf(a,h)):(h.next=i.next,a.pending=i.next=h)}}function cf(e,a){var i=a.action,r=a.payload,c=e.state;if(a.isTransition){var h=_e.T,_={};_e.T=_;try{var k=i(c,r),P=_e.S;P!==null&&P(_,k),df(e,a,k)}catch(oe){pf(e,a,oe)}finally{h!==null&&_.types!==null&&(h.types=_.types),_e.T=h}}else try{h=i(c,r),df(e,a,h)}catch(oe){pf(e,a,oe)}}function df(e,a,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(r){ff(e,a,r)},function(r){return pf(e,a,r)}):ff(e,a,i)}function ff(e,a,i){a.status="fulfilled",a.value=i,hf(a),e.state=i,a=e.pending,a!==null&&(i=a.next,i===a?e.pending=null:(i=i.next,a.next=i,cf(e,i)))}function pf(e,a,i){var r=e.pending;if(e.pending=null,r!==null){r=r.next;do a.status="rejected",a.reason=i,hf(a),a=a.next;while(a!==r)}e.action=null}function hf(e){e=e.listeners;for(var a=0;a<e.length;a++)(0,e[a])()}function mf(e,a){return a}function Eh(e,a){if(Mt){var i=Wt.formState;if(i!==null){e:{var r=yt;if(Mt){if(ea){t:{for(var c=ea,h=kn;c.nodeType!==8;){if(!h){c=null;break t}if(c=ei(c.nextSibling),c===null){c=null;break t}}h=c.data,c=h==="F!"||h==="F"?c:null}if(c){ea=ei(c.nextSibling),r=c.data==="F!";break e}}hr(r)}r=!1}r&&(a=i[0])}}return i=Za(),i.memoizedState=i.baseState=a,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mf,lastRenderedState:a},i.queue=r,i=Af.bind(null,yt,r),r.dispatch=i,r=lf(!1),h=$c.bind(null,yt,!1,r.queue),r=Za(),c={state:a,dispatch:null,action:e,pending:null},r.queue=c,i=uf.bind(null,yt,c,h,i),c.dispatch=i,r.memoizedState=e,[a,i,!1]}function gf(e){var a=_a();return yf(a,Kt,e)}function yf(e,a,i){if(a=yc(e,a,mf)[0],e=Zl(Dn)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var r=Yl(a)}catch(_){throw _===Wn?Di:_}else r=a;a=_a();var c=a.queue,h=c.dispatch;return i!==a.memoizedState&&(yt.flags|=2048,Jl(9,{destroy:void 0},Th.bind(null,c,i),null)),[r,h,e]}function Th(e,a){e.action=a}function vf(e){var a=_a(),i=Kt;if(i!==null)return yf(a,i,e);_a(),a=a.memoizedState,i=_a();var r=i.queue.dispatch;return i.memoizedState=e,[a,r,!1]}function Jl(e,a,i,r){return e={tag:e,create:i,deps:r,inst:a,next:null},a=yt.updateQueue,a===null&&(a=Yo(),yt.updateQueue=a),i=a.lastEffect,i===null?a.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,a.lastEffect=e),e}function bf(){return _a().memoizedState}function Xo(e,a,i,r){var c=Za();yt.flags|=e,c.memoizedState=Jl(1|a,{destroy:void 0},i,r===void 0?null:r)}function Zo(e,a,i,r){var c=_a();r=r===void 0?null:r;var h=c.memoizedState.inst;Kt!==null&&r!==null&&fc(r,Kt.memoizedState.deps)?c.memoizedState=Jl(a,h,i,r):(yt.flags|=e,c.memoizedState=Jl(1|a,h,i,r))}function Ch(e,a){Xo(8390656,8,e,a)}function _c(e,a){Zo(2048,8,e,a)}function zh(e){yt.flags|=4;var a=yt.updateQueue;if(a===null)a=Yo(),yt.updateQueue=a,a.events=[e];else{var i=a.events;i===null?a.events=[e]:i.push(e)}}function _f(e){var a=_a().memoizedState;return zh({ref:a,nextImpl:e}),function(){if((qt&2)!==0)throw Error(y(440));return a.impl.apply(void 0,arguments)}}function wf(e,a){return Zo(4,2,e,a)}function Ah(e,a){return Zo(4,4,e,a)}function xf(e,a){if(typeof a=="function"){e=e();var i=a(e);return function(){typeof i=="function"?i():a(null)}}if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function $f(e,a,i){i=i!=null?i.concat([e]):null,Zo(4,4,xf.bind(null,a,e),i)}function wc(){}function Sf(e,a){var i=_a();a=a===void 0?null:a;var r=i.memoizedState;return a!==null&&fc(a,r[1])?r[0]:(i.memoizedState=[e,a],e)}function Oh(e,a){var i=_a();a=a===void 0?null:a;var r=i.memoizedState;if(a!==null&&fc(a,r[1]))return r[0];if(r=e(),cs){Un(!0);try{e()}finally{Un(!1)}}return i.memoizedState=[r,a],r}function xc(e,a,i){return i===void 0||(Ii&1073741824)!==0&&(kt&261930)===0?e.memoizedState=a:(e.memoizedState=i,e=mp(),yt.lanes|=e,Cr|=e,i)}function Ef(e,a,i,r){return hn(i,a)?i:al.current!==null?(e=xc(e,i,r),hn(e,a)||(ca=!0),e):(Ii&42)===0||(Ii&1073741824)!==0&&(kt&261930)===0?(ca=!0,e.memoizedState=i):(e=mp(),yt.lanes|=e,Cr|=e,a)}function Tf(e,a,i,r,c){var h=Oe.p;Oe.p=h!==0&&8>h?h:8;var _=_e.T,k={};_e.T=k,$c(e,!1,a,i);try{var P=c(),oe=_e.S;if(oe!==null&&oe(k,P),P!==null&&typeof P=="object"&&typeof P.then=="function"){var Se=bh(P,r);eo(e,a,Se,_n(e))}else eo(e,a,r,_n(e))}catch(Ae){eo(e,a,{then:function(){},status:"rejected",reason:Ae},_n())}finally{Oe.p=h,_!==null&&k.types!==null&&(_.types=k.types),_e.T=_}}function Rh(){}function Cf(e,a,i,r){if(e.tag!==5)throw Error(y(476));var c=di(e).queue;Tf(e,c,a,Pe,i===null?Rh:function(){return Li(e),i(r)})}function di(e){var a=e.memoizedState;if(a!==null)return a;a={memoizedState:Pe,baseState:Pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dn,lastRenderedState:Pe},next:null};var i={};return a.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dn,lastRenderedState:i},next:null},e.memoizedState=a,e=e.alternate,e!==null&&(e.memoizedState=a),a}function Li(e){var a=di(e);a.next===null&&(a=e.alternate.memoizedState),eo(e,a.next.queue,{},_n())}function $r(){return Na(Op)}function ds(){return _a().memoizedState}function zf(){return _a().memoizedState}function Mh(e){for(var a=e.return;a!==null;){switch(a.tag){case 24:case 3:var i=_n();e=Ui(i);var r=_r(a,e,i);r!==null&&(cn(r,a,i),Wl(r,a,i)),a={cache:nc()},e.payload=a;return}a=a.return}}function kh(e,a,i){var r=_n();i={lane:r,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Jo(e)?Of(a,i):(i=Fu(e,a,i,r),i!==null&&(cn(i,e,r),Rf(i,a,r)))}function Af(e,a,i){var r=_n();eo(e,a,i,r)}function eo(e,a,i,r){var c={lane:r,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null};if(Jo(e))Of(a,c);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=a.lastRenderedReducer,h!==null))try{var _=a.lastRenderedState,k=h(_,i);if(c.hasEagerState=!0,c.eagerState=k,hn(k,_))return Pu(e,a,c,0),Wt===null&&Io(),!1}catch{}finally{}if(i=Fu(e,a,c,r),i!==null)return cn(i,e,r),Rf(i,a,r),!0}return!1}function $c(e,a,i,r){if(r={lane:2,revertLane:$p(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Jo(e)){if(a)throw Error(y(479))}else a=Fu(e,i,r,2),a!==null&&cn(a,e,2)}function Jo(e){var a=e.alternate;return e===yt||a!==null&&a===yt}function Of(e,a){nl=dc=!0;var i=e.pending;i===null?a.next=a:(a.next=i.next,i.next=a),e.pending=a}function Rf(e,a,i){if((i&4194048)!==0){var r=a.lanes;r&=e.pendingLanes,i|=r,a.lanes=i,Hr(e,i)}}var to={readContext:Na,use:gc,useCallback:la,useContext:la,useEffect:la,useImperativeHandle:la,useLayoutEffect:la,useInsertionEffect:la,useMemo:la,useReducer:la,useRef:la,useState:la,useDebugValue:la,useDeferredValue:la,useTransition:la,useSyncExternalStore:la,useId:la,useHostTransitionStatus:la,useFormState:la,useActionState:la,useOptimistic:la,useMemoCache:la,useCacheRefresh:la};to.useEffectEvent=la;var Dh={readContext:Na,use:gc,useCallback:function(e,a){return Za().memoizedState=[e,a===void 0?null:a],e},useContext:Na,useEffect:Ch,useImperativeHandle:function(e,a,i){i=i!=null?i.concat([e]):null,Xo(4194308,4,xf.bind(null,a,e),i)},useLayoutEffect:function(e,a){return Xo(4194308,4,e,a)},useInsertionEffect:function(e,a){Xo(4,2,e,a)},useMemo:function(e,a){var i=Za();a=a===void 0?null:a;var r=e();if(cs){Un(!0);try{e()}finally{Un(!1)}}return i.memoizedState=[r,a],r},useReducer:function(e,a,i){var r=Za();if(i!==void 0){var c=i(a);if(cs){Un(!0);try{i(a)}finally{Un(!1)}}}else c=a;return r.memoizedState=r.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},r.queue=e,e=e.dispatch=kh.bind(null,yt,e),[r.memoizedState,e]},useRef:function(e){var a=Za();return e={current:e},a.memoizedState=e},useState:function(e){e=lf(e);var a=e.queue,i=Af.bind(null,yt,a);return a.dispatch=i,[e.memoizedState,i]},useDebugValue:wc,useDeferredValue:function(e,a){var i=Za();return xc(i,e,a)},useTransition:function(){var e=lf(!1);return e=Tf.bind(null,yt,e.queue,!0,!1),Za().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,a,i){var r=yt,c=Za();if(Mt){if(i===void 0)throw Error(y(407));i=i()}else{if(i=a(),Wt===null)throw Error(y(349));(kt&127)!==0||af(r,a,i)}c.memoizedState=i;var h={value:i,getSnapshot:a};return c.queue=h,Ch(nf.bind(null,r,h,e),[e]),r.flags|=2048,Jl(9,{destroy:void 0},bc.bind(null,r,h,i,a),null),i},useId:function(){var e=Za(),a=Wt.identifierPrefix;if(Mt){var i=ui,r=oi;i=(r&~(1<<32-La(r)-1)).toString(32)+i,a="_"+a+"R_"+i,i=Qo++,0<i&&(a+="H"+i.toString(32)),a+="_"}else i=xh++,a="_"+a+"r_"+i.toString(32)+"_";return e.memoizedState=a},useHostTransitionStatus:$r,useFormState:Eh,useActionState:Eh,useOptimistic:function(e){var a=Za();a.memoizedState=a.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=i,a=$c.bind(null,yt,!0,i),i.dispatch=a,[e,a]},useMemoCache:Xl,useCacheRefresh:function(){return Za().memoizedState=Mh.bind(null,yt)},useEffectEvent:function(e){var a=Za(),i={impl:e};return a.memoizedState=i,function(){if((qt&2)!==0)throw Error(y(440));return i.impl.apply(void 0,arguments)}}},Fa={readContext:Na,use:gc,useCallback:Sf,useContext:Na,useEffect:_c,useImperativeHandle:$f,useInsertionEffect:wf,useLayoutEffect:Ah,useMemo:Oh,useReducer:Zl,useRef:bf,useState:function(){return Zl(Dn)},useDebugValue:wc,useDeferredValue:function(e,a){var i=_a();return Ef(i,Kt.memoizedState,e,a)},useTransition:function(){var e=Zl(Dn)[0],a=_a().memoizedState;return[typeof e=="boolean"?e:Yl(e),a]},useSyncExternalStore:tf,useId:ds,useHostTransitionStatus:$r,useFormState:gf,useActionState:gf,useOptimistic:function(e,a){var i=_a();return of(i,Kt,e,a)},useMemoCache:Xl,useCacheRefresh:zf};Fa.useEffectEvent=_f;var Mf={readContext:Na,use:gc,useCallback:Sf,useContext:Na,useEffect:_c,useImperativeHandle:$f,useInsertionEffect:wf,useLayoutEffect:Ah,useMemo:Oh,useReducer:vc,useRef:bf,useState:function(){return vc(Dn)},useDebugValue:wc,useDeferredValue:function(e,a){var i=_a();return Kt===null?xc(i,e,a):Ef(i,Kt.memoizedState,e,a)},useTransition:function(){var e=vc(Dn)[0],a=_a().memoizedState;return[typeof e=="boolean"?e:Yl(e),a]},useSyncExternalStore:tf,useId:ds,useHostTransitionStatus:$r,useFormState:vf,useActionState:vf,useOptimistic:function(e,a){var i=_a();return Kt!==null?of(i,Kt,e,a):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:Xl,useCacheRefresh:zf};Mf.useEffectEvent=_f;function Sc(e,a,i,r){a=e.memoizedState,i=i(r,a),i=i==null?a:q({},a,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var eu={enqueueSetState:function(e,a,i){e=e._reactInternals;var r=_n(),c=Ui(r);c.payload=a,i!=null&&(c.callback=i),a=_r(e,c,r),a!==null&&(cn(a,e,r),Wl(a,e,r))},enqueueReplaceState:function(e,a,i){e=e._reactInternals;var r=_n(),c=Ui(r);c.tag=1,c.payload=a,i!=null&&(c.callback=i),a=_r(e,c,r),a!==null&&(cn(a,e,r),Wl(a,e,r))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var i=_n(),r=Ui(i);r.tag=2,a!=null&&(r.callback=a),a=_r(e,r,i),a!==null&&(cn(a,e,i),Wl(a,e,i))}};function kf(e,a,i,r,c,h,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,h,_):a.prototype&&a.prototype.isPureReactComponent?!Ul(i,r)||!Ul(c,h):!0}function ao(e,a,i,r){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(i,r),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(i,r),a.state!==e&&eu.enqueueReplaceState(a,a.state,null)}function fs(e,a){var i=a;if("ref"in a){i={};for(var r in a)r!=="ref"&&(i[r]=a[r])}if(e=e.defaultProps){i===a&&(i=q({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}function Df(e){ql(e)}function Bf(e){console.error(e)}function Nf(e){ql(e)}function tu(e,a){try{var i=e.onUncaughtError;i(a.value,{componentStack:a.stack})}catch(r){setTimeout(function(){throw r})}}function Uf(e,a,i){try{var r=e.onCaughtError;r(i.value,{componentStack:i.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function au(e,a,i){return i=Ui(i),i.tag=3,i.payload={element:null},i.callback=function(){tu(e,a)},i}function If(e){return e=Ui(e),e.tag=3,e}function Lf(e,a,i,r){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var h=r.value;e.payload=function(){return c(h)},e.callback=function(){Uf(a,i,r)}}var _=i.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(e.callback=function(){Uf(a,i,r),typeof c!="function"&&(ms===null?ms=new Set([this]):ms.add(this));var k=r.stack;this.componentDidCatch(r.value,{componentStack:k!==null?k:""})})}function Bh(e,a,i,r,c){if(i.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(a=i.alternate,a!==null&&Ys(a,i,c,!0),i=gn.current,i!==null){switch(i.tag){case 31:case 13:return Qn===null?yu():i.alternate===null&&da===0&&(da=3),i.flags&=-257,i.flags|=65536,i.lanes=c,r===Hl?i.flags|=16384:(a=i.updateQueue,a===null?i.updateQueue=new Set([r]):a.add(r),Mr(e,r,c)),!1;case 22:return i.flags|=65536,r===Hl?i.flags|=16384:(a=i.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([r])},i.updateQueue=a):(i=a.retryQueue,i===null?a.retryQueue=new Set([r]):i.add(r)),Mr(e,r,c)),!1}throw Error(y(435,i.tag))}return Mr(e,r,c),yu(),!1}if(Mt)return a=gn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=c,r!==Ju&&(e=Error(y(422),{cause:r}),jl(Rn(e,i)))):(r!==Ju&&(a=Error(y(423),{cause:r}),jl(Rn(a,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,r=Rn(r,i),c=au(e.stateNode,r,c),Wd(e,c),da!==4&&(da=2)),!1;var h=Error(y(520),{cause:r});if(h=Rn(h,i),uo===null?uo=[h]:uo.push(h),da!==4&&(da=2),a===null)return!0;r=Rn(r,i),i=a;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=au(i.stateNode,r,e),Wd(i,e),!1;case 1:if(a=i.type,h=i.stateNode,(i.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(ms===null||!ms.has(h))))return i.flags|=65536,c&=-c,i.lanes|=c,c=If(c),Lf(c,e,i,r),Wd(i,c),!1}i=i.return}while(i!==null);return!1}var Ec=Error(y(461)),ca=!1;function Ua(e,a,i,r){a.child=e===null?Kd(a,null,i,r):br(a,e.child,i,r)}function qf(e,a,i,r,c){i=i.render;var h=a.ref;if("ref"in r){var _={};for(var k in r)k!=="ref"&&(_[k]=r[k])}else _=r;return Xs(a),r=pc(e,a,i,_,h,c),k=hc(),e!==null&&!ca?(ef(e,a,c),Sr(e,a,c)):(Mt&&k&&Xu(a),a.flags|=1,Ua(e,a,r,c),a.child)}function jf(e,a,i,r,c){if(e===null){var h=i.type;return typeof h=="function"&&!Wu(h)&&h.defaultProps===void 0&&i.compare===null?(a.tag=15,a.type=h,Gf(e,a,h,r,c)):(e=Lo(i.type,null,r,a,a.mode,c),e.ref=a.ref,e.return=a,a.child=e)}if(h=e.child,!Dc(e,c)){var _=h.memoizedProps;if(i=i.compare,i=i!==null?i:Ul,i(_,r)&&e.ref===a.ref)return Sr(e,a,c)}return a.flags|=1,e=Oi(h,r),e.ref=a.ref,e.return=a,a.child=e}function Gf(e,a,i,r,c){if(e!==null){var h=e.memoizedProps;if(Ul(h,r)&&e.ref===a.ref)if(ca=!1,a.pendingProps=r=h,Dc(e,c))(e.flags&131072)!==0&&(ca=!0);else return a.lanes=e.lanes,Sr(e,a,c)}return Ac(e,a,i,r,c)}function Tc(e,a,i,r){var c=r.children,h=e!==null?e.memoizedState:null;if(e===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode==="hidden"){if((a.flags&128)!==0){if(h=h!==null?h.baseLanes|i:i,e!==null){for(r=a.child=e.child,c=0;r!==null;)c=c|r.lanes|r.childLanes,r=r.sibling;r=c&~h}else r=0,a.child=null;return Vf(e,a,h,i,r)}if((i&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},e!==null&&Po(a,h!==null?h.cachePool:null),h!==null?Yd(a,h):Xd(),Zd(a);else return r=a.lanes=536870912,Vf(e,a,h!==null?h.baseLanes|i:i,i,r)}else h!==null?(Po(a,h.cachePool),Yd(a,h),ci(),a.memoizedState=null):(e!==null&&Po(a,null),Xd(),ci());return Ua(e,a,c,i),a.child}function no(e,a){return e!==null&&e.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Vf(e,a,i,r,c){var h=rc();return h=h===null?null:{parent:$a._currentValue,pool:h},a.memoizedState={baseLanes:i,cachePool:h},e!==null&&Po(a,null),Xd(),Zd(a),e!==null&&Ys(e,a,r,!0),a.childLanes=c,null}function Cc(e,a){return a=iu({mode:a.mode,children:a.children},e.mode),a.ref=e.ref,e.child=a,a.return=e,a}function zc(e,a,i){return br(a,e.child,null,i),e=Cc(a,a.pendingProps),e.flags|=2,ln(a),a.memoizedState=null,e}function Nh(e,a,i){var r=a.pendingProps,c=(a.flags&128)!==0;if(a.flags&=-129,e===null){if(Mt){if(r.mode==="hidden")return e=Cc(a,r),a.lanes=536870912,no(null,e);if(Ql(a),(e=ea)?(e=mo(e,kn),e=e!==null&&e.data==="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:fr!==null?{id:oi,overflow:ui}:null,retryLane:536870912,hydrationErrors:null},i=Ld(e),i.return=a,a.child=i,Ba=a,ea=null)):e=null,e===null)throw hr(a);return a.lanes=536870912,null}return Cc(a,r)}var h=e.memoizedState;if(h!==null){var _=h.dehydrated;if(Ql(a),c)if(a.flags&256)a.flags&=-257,a=zc(e,a,i);else if(a.memoizedState!==null)a.child=e.child,a.flags|=128,a=null;else throw Error(y(558));else if(ca||Ys(e,a,i,!1),c=(i&e.childLanes)!==0,ca||c){if(r=Wt,r!==null&&(_=Cl(r,i),_!==0&&_!==h.retryLane))throw h.retryLane=_,is(e,_),cn(r,e,_),Ec;yu(),a=zc(e,a,i)}else e=h.treeContext,ea=ei(_.nextSibling),Ba=a,Mt=!0,pr=null,kn=!1,e!==null&&Gd(a,e),a=Cc(a,r),a.flags|=4096;return a}return e=Oi(e.child,{mode:r.mode,children:r.children}),e.ref=a.ref,a.child=e,e.return=a,e}function nu(e,a){var i=a.ref;if(i===null)e!==null&&e.ref!==null&&(a.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(y(284));(e===null||e.ref!==i)&&(a.flags|=4194816)}}function Ac(e,a,i,r,c){return Xs(a),i=pc(e,a,i,r,void 0,c),r=hc(),e!==null&&!ca?(ef(e,a,c),Sr(e,a,c)):(Mt&&r&&Xu(a),a.flags|=1,Ua(e,a,i,c),a.child)}function Uh(e,a,i,r,c,h){return Xs(a),a.updateQueue=null,i=Jd(a,r,i,c),$h(e),r=hc(),e!==null&&!ca?(ef(e,a,h),Sr(e,a,h)):(Mt&&r&&Xu(a),a.flags|=1,Ua(e,a,i,h),a.child)}function Hf(e,a,i,r,c){if(Xs(a),a.stateNode===null){var h=Fs,_=i.contextType;typeof _=="object"&&_!==null&&(h=Na(_)),h=new i(r,h),a.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=eu,a.stateNode=h,h._reactInternals=a,h=a.stateNode,h.props=r,h.state=a.memoizedState,h.refs={},lc(a),_=i.contextType,h.context=typeof _=="object"&&_!==null?Na(_):Fs,h.state=a.memoizedState,_=i.getDerivedStateFromProps,typeof _=="function"&&(Sc(a,i,_,r),h.state=a.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(_=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),_!==h.state&&eu.enqueueReplaceState(h,h.state,null),wr(a,r,h,c),tl(),h.state=a.memoizedState),typeof h.componentDidMount=="function"&&(a.flags|=4194308),r=!0}else if(e===null){h=a.stateNode;var k=a.memoizedProps,P=fs(i,k);h.props=P;var oe=h.context,Se=i.contextType;_=Fs,typeof Se=="object"&&Se!==null&&(_=Na(Se));var Ae=i.getDerivedStateFromProps;Se=typeof Ae=="function"||typeof h.getSnapshotBeforeUpdate=="function",k=a.pendingProps!==k,Se||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(k||oe!==_)&&ao(a,h,r,_),Ni=!1;var fe=a.memoizedState;h.state=fe,wr(a,r,h,c),tl(),oe=a.memoizedState,k||fe!==oe||Ni?(typeof Ae=="function"&&(Sc(a,i,Ae,r),oe=a.memoizedState),(P=Ni||kf(a,i,P,r,fe,oe,_))?(Se||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(a.flags|=4194308)):(typeof h.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=r,a.memoizedState=oe),h.props=r,h.state=oe,h.context=_,r=P):(typeof h.componentDidMount=="function"&&(a.flags|=4194308),r=!1)}else{h=a.stateNode,Kl(e,a),_=a.memoizedProps,Se=fs(i,_),h.props=Se,Ae=a.pendingProps,fe=h.context,oe=i.contextType,P=Fs,typeof oe=="object"&&oe!==null&&(P=Na(oe)),k=i.getDerivedStateFromProps,(oe=typeof k=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(_!==Ae||fe!==P)&&ao(a,h,r,P),Ni=!1,fe=a.memoizedState,h.state=fe,wr(a,r,h,c),tl();var ye=a.memoizedState;_!==Ae||fe!==ye||Ni||e!==null&&e.dependencies!==null&&Vo(e.dependencies)?(typeof k=="function"&&(Sc(a,i,k,r),ye=a.memoizedState),(Se=Ni||kf(a,i,Se,r,fe,ye,P)||e!==null&&e.dependencies!==null&&Vo(e.dependencies))?(oe||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(r,ye,P),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(r,ye,P)),typeof h.componentDidUpdate=="function"&&(a.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof h.componentDidUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(a.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(a.flags|=1024),a.memoizedProps=r,a.memoizedState=ye),h.props=r,h.state=ye,h.context=P,r=Se):(typeof h.componentDidUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(a.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(a.flags|=1024),r=!1)}return h=r,nu(e,a),r=(a.flags&128)!==0,h||r?(h=a.stateNode,i=r&&typeof i.getDerivedStateFromError!="function"?null:h.render(),a.flags|=1,e!==null&&r?(a.child=br(a,e.child,null,c),a.child=br(a,null,i,c)):Ua(e,a,i,c),a.memoizedState=h.state,e=a.child):e=Sr(e,a,c),e}function Pf(e,a,i,r){return mr(),a.flags|=256,Ua(e,a,i,r),a.child}var Oc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ff(e){return{baseLanes:e,cachePool:_h()}}function Rc(e,a,i){return e=e!==null?e.childLanes&~i:0,a&&(e|=vn),e}function Kf(e,a,i){var r=a.pendingProps,c=!1,h=(a.flags&128)!==0,_;if((_=h)||(_=e!==null&&e.memoizedState===null?!1:(ua.current&2)!==0),_&&(c=!0,a.flags&=-129),_=(a.flags&32)!==0,a.flags&=-33,e===null){if(Mt){if(c?xr(a):ci(),(e=ea)?(e=mo(e,kn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(a.memoizedState={dehydrated:e,treeContext:fr!==null?{id:oi,overflow:ui}:null,retryLane:536870912,hydrationErrors:null},i=Ld(e),i.return=a,a.child=i,Ba=a,ea=null)):e=null,e===null)throw hr(a);return pa(e)?a.lanes=32:a.lanes=536870912,null}var k=r.children;return r=r.fallback,c?(ci(),c=a.mode,k=iu({mode:"hidden",children:k},c),r=rs(r,c,i,null),k.return=a,r.return=a,k.sibling=r,a.child=k,r=a.child,r.memoizedState=Ff(i),r.childLanes=Rc(e,_,i),a.memoizedState=Oc,no(null,r)):(xr(a),Wf(a,k))}var P=e.memoizedState;if(P!==null&&(k=P.dehydrated,k!==null)){if(h)a.flags&256?(xr(a),a.flags&=-257,a=Mc(e,a,i)):a.memoizedState!==null?(ci(),a.child=e.child,a.flags|=128,a=null):(ci(),k=r.fallback,c=a.mode,r=iu({mode:"visible",children:r.children},c),k=rs(k,c,i,null),k.flags|=2,r.return=a,k.return=a,r.sibling=k,a.child=r,br(a,e.child,null,i),r=a.child,r.memoizedState=Ff(i),r.childLanes=Rc(e,_,i),a.memoizedState=Oc,a=no(null,r));else if(xr(a),pa(k)){if(_=k.nextSibling&&k.nextSibling.dataset,_)var oe=_.dgst;_=oe,r=Error(y(419)),r.stack="",r.digest=_,jl({value:r,source:null,stack:null}),a=Mc(e,a,i)}else if(ca||Ys(e,a,i,!1),_=(i&e.childLanes)!==0,ca||_){if(_=Wt,_!==null&&(r=Cl(_,i),r!==0&&r!==P.retryLane))throw P.retryLane=r,is(e,r),cn(_,e,r),Ec;Ca(k)||yu(),a=Mc(e,a,i)}else Ca(k)?(a.flags|=192,a.child=e.child,a=null):(e=P.treeContext,ea=ei(k.nextSibling),Ba=a,Mt=!0,pr=null,kn=!1,e!==null&&Gd(a,e),a=Wf(a,r.children),a.flags|=4096);return a}return c?(ci(),k=r.fallback,c=a.mode,P=e.child,oe=P.sibling,r=Oi(P,{mode:"hidden",children:r.children}),r.subtreeFlags=P.subtreeFlags&65011712,oe!==null?k=Oi(oe,k):(k=rs(k,c,i,null),k.flags|=2),k.return=a,r.return=a,r.sibling=k,a.child=r,no(null,r),r=a.child,k=e.child.memoizedState,k===null?k=Ff(i):(c=k.cachePool,c!==null?(P=$a._currentValue,c=c.parent!==P?{parent:P,pool:P}:c):c=_h(),k={baseLanes:k.baseLanes|i,cachePool:c}),r.memoizedState=k,r.childLanes=Rc(e,_,i),a.memoizedState=Oc,no(e.child,r)):(xr(a),i=e.child,e=i.sibling,i=Oi(i,{mode:"visible",children:r.children}),i.return=a,i.sibling=null,e!==null&&(_=a.deletions,_===null?(a.deletions=[e],a.flags|=16):_.push(e)),a.child=i,a.memoizedState=null,i)}function Wf(e,a){return a=iu({mode:"visible",children:a},e.mode),a.return=e,e.child=a}function iu(e,a){return e=mn(22,e,null,a),e.lanes=0,e}function Mc(e,a,i){return br(a,e.child,null,i),e=Wf(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function Qf(e,a,i){e.lanes|=a;var r=e.alternate;r!==null&&(r.lanes|=a),Go(e.return,a,i)}function kc(e,a,i,r,c,h){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:c,treeForkCount:h}:(_.isBackwards=a,_.rendering=null,_.renderingStartTime=0,_.last=r,_.tail=i,_.tailMode=c,_.treeForkCount=h)}function Yf(e,a,i){var r=a.pendingProps,c=r.revealOrder,h=r.tail;r=r.children;var _=ua.current,k=(_&2)!==0;if(k?(_=_&1|2,a.flags|=128):_&=1,Ge(ua,_),Ua(e,a,r,i),r=Mt?dr:0,!k&&e!==null&&(e.flags&128)!==0)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Qf(e,i,a);else if(e.tag===19)Qf(e,i,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(i=a.child,c=null;i!==null;)e=i.alternate,e!==null&&Wo(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=a.child,a.child=null):(c=i.sibling,i.sibling=null),kc(a,!1,c,i,h,r);break;case"backwards":case"unstable_legacy-backwards":for(i=null,c=a.child,a.child=null;c!==null;){if(e=c.alternate,e!==null&&Wo(e)===null){a.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}kc(a,!0,i,null,h,r);break;case"together":kc(a,!1,null,null,void 0,r);break;default:a.memoizedState=null}return a.child}function Sr(e,a,i){if(e!==null&&(a.dependencies=e.dependencies),Cr|=a.lanes,(i&a.childLanes)===0)if(e!==null){if(Ys(e,a,i,!1),(i&a.childLanes)===0)return null}else return null;if(e!==null&&a.child!==e.child)throw Error(y(153));if(a.child!==null){for(e=a.child,i=Oi(e,e.pendingProps),a.child=i,i.return=a;e.sibling!==null;)e=e.sibling,i=i.sibling=Oi(e,e.pendingProps),i.return=a;i.sibling=null}return a.child}function Dc(e,a){return(e.lanes&a)!==0?!0:(e=e.dependencies,!!(e!==null&&Vo(e)))}function Ih(e,a,i){switch(a.tag){case 3:xt(a,a.stateNode.containerInfo),gr(a,$a,e.memoizedState.cache),mr();break;case 27:case 5:Xt(a);break;case 4:xt(a,a.stateNode.containerInfo);break;case 10:gr(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Ql(a),null;break;case 13:var r=a.memoizedState;if(r!==null)return r.dehydrated!==null?(xr(a),a.flags|=128,null):(i&a.child.childLanes)!==0?Kf(e,a,i):(xr(a),e=Sr(e,a,i),e!==null?e.sibling:null);xr(a);break;case 19:var c=(e.flags&128)!==0;if(r=(i&a.childLanes)!==0,r||(Ys(e,a,i,!1),r=(i&a.childLanes)!==0),c){if(r)return Yf(e,a,i);a.flags|=128}if(c=a.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Ge(ua,ua.current),r)break;return null;case 22:return a.lanes=0,Tc(e,a,i,a.pendingProps);case 24:gr(a,$a,e.memoizedState.cache)}return Sr(e,a,i)}function Xf(e,a,i){if(e!==null)if(e.memoizedProps!==a.pendingProps)ca=!0;else{if(!Dc(e,i)&&(a.flags&128)===0)return ca=!1,Ih(e,a,i);ca=(e.flags&131072)!==0}else ca=!1,Mt&&(a.flags&1048576)!==0&&jd(a,dr,a.index);switch(a.lanes=0,a.tag){case 16:e:{var r=a.pendingProps;if(e=us(a.elementType),a.type=e,typeof e=="function")Wu(e)?(r=fs(e,r),a.tag=1,a=Hf(null,a,e,r,i)):(a.tag=0,a=Ac(null,a,e,r,i));else{if(e!=null){var c=e.$$typeof;if(c===be){a.tag=11,a=qf(null,a,e,r,i);break e}else if(c===qe){a.tag=14,a=jf(null,a,e,r,i);break e}}throw a=Dt(e)||e,Error(y(306,a,""))}}return a;case 0:return Ac(e,a,a.type,a.pendingProps,i);case 1:return r=a.type,c=fs(r,a.pendingProps),Hf(e,a,r,c,i);case 3:e:{if(xt(a,a.stateNode.containerInfo),e===null)throw Error(y(387));r=a.pendingProps;var h=a.memoizedState;c=h.element,Kl(e,a),wr(a,r,null,i);var _=a.memoizedState;if(r=_.cache,gr(a,$a,r),r!==h.cache&&ac(a,[$a],i,!0),tl(),r=_.element,h.isDehydrated)if(h={element:r,isDehydrated:!1,cache:_.cache},a.updateQueue.baseState=h,a.memoizedState=h,a.flags&256){a=Pf(e,a,r,i);break e}else if(r!==c){c=Rn(Error(y(424)),a),jl(c),a=Pf(e,a,r,i);break e}else{switch(e=a.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(ea=ei(e.firstChild),Ba=a,Mt=!0,pr=null,kn=!0,i=Kd(a,null,r,i),a.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(mr(),r===c){a=Sr(e,a,i);break e}Ua(e,a,r,i)}a=a.child}return a;case 26:return nu(e,a),e===null?(i=Mg(a.type,null,a.pendingProps,null))?a.memoizedState=i:Mt||(i=a.type,e=a.pendingProps,r=Tt(wt.current).createElement(i),r[St]=a,r[ya]=e,ve(r,i,e),jt(r),a.stateNode=r):a.memoizedState=Mg(a.type,e.memoizedProps,a.pendingProps,e.memoizedState),null;case 27:return Xt(a),e===null&&Mt&&(r=a.stateNode=Ag(a.type,a.pendingProps,wt.current),Ba=a,kn=!0,c=ea,Jn(a.type)?(Tp=c,ea=ei(r.firstChild)):ea=c),Ua(e,a,a.pendingProps.children,i),nu(e,a),e===null&&(a.flags|=4194304),a.child;case 5:return e===null&&Mt&&((c=r=ea)&&(r=ys(r,a.type,a.pendingProps,kn),r!==null?(a.stateNode=r,Ba=a,ea=ei(r.firstChild),kn=!1,c=!0):c=!1),c||hr(a)),Xt(a),c=a.type,h=a.pendingProps,_=e!==null?e.memoizedProps:null,r=h.children,Qt(c,h)?r=null:_!==null&&Qt(c,_)&&(a.flags|=32),a.memoizedState!==null&&(c=pc(e,a,Sh,null,null,i),Op._currentValue=c),nu(e,a),Ua(e,a,r,i),a.child;case 6:return e===null&&Mt&&((e=i=ea)&&(i=vs(i,a.pendingProps,kn),i!==null?(a.stateNode=i,Ba=a,ea=null,e=!0):e=!1),e||hr(a)),null;case 13:return Kf(e,a,i);case 4:return xt(a,a.stateNode.containerInfo),r=a.pendingProps,e===null?a.child=br(a,null,r,i):Ua(e,a,r,i),a.child;case 11:return qf(e,a,a.type,a.pendingProps,i);case 7:return Ua(e,a,a.pendingProps,i),a.child;case 8:return Ua(e,a,a.pendingProps.children,i),a.child;case 12:return Ua(e,a,a.pendingProps.children,i),a.child;case 10:return r=a.pendingProps,gr(a,a.type,r.value),Ua(e,a,r.children,i),a.child;case 9:return c=a.type._context,r=a.pendingProps.children,Xs(a),c=Na(c),r=r(c),a.flags|=1,Ua(e,a,r,i),a.child;case 14:return jf(e,a,a.type,a.pendingProps,i);case 15:return Gf(e,a,a.type,a.pendingProps,i);case 19:return Yf(e,a,i);case 31:return Nh(e,a,i);case 22:return Tc(e,a,i,a.pendingProps);case 24:return Xs(a),r=Na($a),e===null?(c=rc(),c===null&&(c=Wt,h=nc(),c.pooledCache=h,h.refCount++,h!==null&&(c.pooledCacheLanes|=i),c=h),a.memoizedState={parent:r,cache:c},lc(a),gr(a,$a,c)):((e.lanes&i)!==0&&(Kl(e,a),wr(a,null,null,i),tl()),c=e.memoizedState,h=a.memoizedState,c.parent!==r?(c={parent:r,cache:r},a.memoizedState=c,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=c),gr(a,$a,r)):(r=h.cache,gr(a,$a,r),r!==c.cache&&ac(a,[$a],i,!0))),Ua(e,a,a.pendingProps.children,i),a.child;case 29:throw a.pendingProps}throw Error(y(156,a.tag))}function qi(e){e.flags|=4}function Bc(e,a,i,r,c){if((a=(e.mode&32)!==0)&&(a=!1),a){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(Yc())e.flags|=8192;else throw vr=Hl,yr}else e.flags&=-16777217}function Zf(e,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ug(a))if(Yc())e.flags|=8192;else throw vr=Hl,yr}function ru(e,a){a!==null&&(e.flags|=4),e.flags&16384&&(a=e.tag!==22?Tl():536870912,e.lanes|=a,ul|=a)}function io(e,a){if(!Mt)switch(e.tailMode){case"hidden":a=e.tail;for(var i=null;a!==null;)a.alternate!==null&&(i=a),a=a.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ta(e){var a=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(a)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,r|=c.subtreeFlags&65011712,r|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,r|=c.subtreeFlags,r|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=r,e.childLanes=i,a}function Mm(e,a,i){var r=a.pendingProps;switch(Zu(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(a),null;case 1:return ta(a),null;case 3:return i=a.stateNode,r=null,e!==null&&(r=e.memoizedState.cache),a.memoizedState.cache!==r&&(a.flags|=2048),ki($a),Yt(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Qs(a)?qi(a):e===null||e.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,jo())),ta(a),null;case 26:var c=a.type,h=a.memoizedState;return e===null?(qi(a),h!==null?(ta(a),Zf(a,h)):(ta(a),Bc(a,c,null,r,i))):h?h!==e.memoizedState?(qi(a),ta(a),Zf(a,h)):(ta(a),a.flags&=-16777217):(e=e.memoizedProps,e!==r&&qi(a),ta(a),Bc(a,c,e,r,i)),null;case 27:if(qr(a),i=wt.current,c=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==r&&qi(a);else{if(!r){if(a.stateNode===null)throw Error(y(166));return ta(a),null}e=Ye.current,Qs(a)?Vd(a):(e=Ag(c,r,i),a.stateNode=e,qi(a))}return ta(a),null;case 5:if(qr(a),c=a.type,e!==null&&a.stateNode!=null)e.memoizedProps!==r&&qi(a);else{if(!r){if(a.stateNode===null)throw Error(y(166));return ta(a),null}if(h=Ye.current,Qs(a))Vd(a);else{var _=Tt(wt.current);switch(h){case 1:h=_.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:h=_.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":h=_.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":h=_.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":h=_.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof r.is=="string"?_.createElement("select",{is:r.is}):_.createElement("select"),r.multiple?h.multiple=!0:r.size&&(h.size=r.size);break;default:h=typeof r.is=="string"?_.createElement(c,{is:r.is}):_.createElement(c)}}h[St]=a,h[ya]=r;e:for(_=a.child;_!==null;){if(_.tag===5||_.tag===6)h.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===a)break e;for(;_.sibling===null;){if(_.return===null||_.return===a)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}a.stateNode=h;e:switch(ve(h,c,r),c){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&qi(a)}}return ta(a),Bc(a,a.type,e===null?null:e.memoizedProps,a.pendingProps,i),null;case 6:if(e&&a.stateNode!=null)e.memoizedProps!==r&&qi(a);else{if(typeof r!="string"&&a.stateNode===null)throw Error(y(166));if(e=wt.current,Qs(a)){if(e=a.stateNode,i=a.memoizedProps,r=null,c=Ba,c!==null)switch(c.tag){case 27:case 5:r=c.memoizedProps}e[St]=a,e=!!(e.nodeValue===i||r!==null&&r.suppressHydrationWarning===!0||ue(e.nodeValue,i)),e||hr(a,!0)}else e=Tt(e).createTextNode(r),e[St]=a,a.stateNode=e}return ta(a),null;case 31:if(i=a.memoizedState,e===null||e.memoizedState!==null){if(r=Qs(a),i!==null){if(e===null){if(!r)throw Error(y(318));if(e=a.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(y(557));e[St]=a}else mr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ta(a),e=!1}else i=jo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=i),e=!0;if(!e)return a.flags&256?(ln(a),a):(ln(a),null);if((a.flags&128)!==0)throw Error(y(558))}return ta(a),null;case 13:if(r=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=Qs(a),r!==null&&r.dehydrated!==null){if(e===null){if(!c)throw Error(y(318));if(c=a.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(y(317));c[St]=a}else mr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ta(a),c=!1}else c=jo(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return a.flags&256?(ln(a),a):(ln(a),null)}return ln(a),(a.flags&128)!==0?(a.lanes=i,a):(i=r!==null,e=e!==null&&e.memoizedState!==null,i&&(r=a.child,c=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(c=r.alternate.memoizedState.cachePool.pool),h=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(h=r.memoizedState.cachePool.pool),h!==c&&(r.flags|=2048)),i!==e&&i&&(a.child.flags|=8192),ru(a,a.updateQueue),ta(a),null);case 4:return Yt(),e===null&&C(a.stateNode.containerInfo),ta(a),null;case 10:return ki(a.type),ta(a),null;case 19:if(Ce(ua),r=a.memoizedState,r===null)return ta(a),null;if(c=(a.flags&128)!==0,h=r.rendering,h===null)if(c)io(r,!1);else{if(da!==0||e!==null&&(e.flags&128)!==0)for(e=a.child;e!==null;){if(h=Wo(e),h!==null){for(a.flags|=128,io(r,!1),e=h.updateQueue,a.updateQueue=e,ru(a,e),a.subtreeFlags=0,e=i,i=a.child;i!==null;)Id(i,e),i=i.sibling;return Ge(ua,ua.current&1|2),Mt&&Ri(a,r.treeForkCount),a.child}e=e.sibling}r.tail!==null&&en()>pu&&(a.flags|=128,c=!0,io(r,!1),a.lanes=4194304)}else{if(!c)if(e=Wo(h),e!==null){if(a.flags|=128,c=!0,e=e.updateQueue,a.updateQueue=e,ru(a,e),io(r,!0),r.tail===null&&r.tailMode==="hidden"&&!h.alternate&&!Mt)return ta(a),null}else 2*en()-r.renderingStartTime>pu&&i!==536870912&&(a.flags|=128,c=!0,io(r,!1),a.lanes=4194304);r.isBackwards?(h.sibling=a.child,a.child=h):(e=r.last,e!==null?e.sibling=h:a.child=h,r.last=h)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=en(),e.sibling=null,i=ua.current,Ge(ua,c?i&1|2:i&1),Mt&&Ri(a,r.treeForkCount),e):(ta(a),null);case 22:case 23:return ln(a),cc(),r=a.memoizedState!==null,e!==null?e.memoizedState!==null!==r&&(a.flags|=8192):r&&(a.flags|=8192),r?(i&536870912)!==0&&(a.flags&128)===0&&(ta(a),a.subtreeFlags&6&&(a.flags|=8192)):ta(a),i=a.updateQueue,i!==null&&ru(a,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==i&&(a.flags|=2048),e!==null&&Ce(ls),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),a.memoizedState.cache!==i&&(a.flags|=2048),ki($a),ta(a),null;case 25:return null;case 30:return null}throw Error(y(156,a.tag))}function su(e,a){switch(Zu(a),a.tag){case 1:return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return ki($a),Yt(),e=a.flags,(e&65536)!==0&&(e&128)===0?(a.flags=e&-65537|128,a):null;case 26:case 27:case 5:return qr(a),null;case 31:if(a.memoizedState!==null){if(ln(a),a.alternate===null)throw Error(y(340));mr()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 13:if(ln(a),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(y(340));mr()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return Ce(ua),null;case 4:return Yt(),null;case 10:return ki(a.type),null;case 22:case 23:return ln(a),cc(),e!==null&&Ce(ls),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 24:return ki($a),null;case 25:return null;default:return null}}function Nc(e,a){switch(Zu(a),a.tag){case 3:ki($a),Yt();break;case 26:case 27:case 5:qr(a);break;case 4:Yt();break;case 31:a.memoizedState!==null&&ln(a);break;case 13:ln(a);break;case 19:Ce(ua);break;case 10:ki(a.type);break;case 22:case 23:ln(a),cc(),e!==null&&Ce(ls);break;case 24:ki($a)}}function sl(e,a){try{var i=a.updateQueue,r=i!==null?i.lastEffect:null;if(r!==null){var c=r.next;i=c;do{if((i.tag&e)===e){r=void 0;var h=i.create,_=i.inst;r=h(),_.destroy=r}i=i.next}while(i!==c)}}catch(k){Bt(a,a.return,k)}}function ji(e,a,i){try{var r=a.updateQueue,c=r!==null?r.lastEffect:null;if(c!==null){var h=c.next;r=h;do{if((r.tag&e)===e){var _=r.inst,k=_.destroy;if(k!==void 0){_.destroy=void 0,c=a;var P=i,oe=k;try{oe()}catch(Se){Bt(c,P,Se)}}}r=r.next}while(r!==h)}}catch(Se){Bt(a,a.return,Se)}}function Uc(e){var a=e.updateQueue;if(a!==null){var i=e.stateNode;try{uc(a,i)}catch(r){Bt(e,e.return,r)}}}function Jf(e,a,i){i.props=fs(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(r){Bt(e,a,r)}}function ro(e,a){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;case 30:r=e.stateNode;break;default:r=e.stateNode}typeof i=="function"?e.refCleanup=i(r):i.current=r}}catch(c){Bt(e,a,c)}}function Yn(e,a){var i=e.ref,r=e.refCleanup;if(i!==null)if(typeof r=="function")try{r()}catch(c){Bt(e,a,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){Bt(e,a,c)}else i.current=null}function Ic(e){var a=e.type,i=e.memoizedProps,r=e.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":i.autoFocus&&r.focus();break e;case"img":i.src?r.src=i.src:i.srcSet&&(r.srcset=i.srcSet)}}catch(c){Bt(e,e.return,c)}}function Lc(e,a,i){try{var r=e.stateNode;Le(r,e.type,i,a),r[ya]=a}catch(c){Bt(e,e.return,c)}}function ep(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Jn(e.type)||e.tag===4}function lu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ep(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Jn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qc(e,a,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,a?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,a):(a=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,a.appendChild(e),i=i._reactRootContainer,i!=null||a.onclick!==null||(a.onclick=ka));else if(r!==4&&(r===27&&Jn(e.type)&&(i=e.stateNode,a=null),e=e.child,e!==null))for(qc(e,a,i),e=e.sibling;e!==null;)qc(e,a,i),e=e.sibling}function ou(e,a,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,a?i.insertBefore(e,a):i.appendChild(e);else if(r!==4&&(r===27&&Jn(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(ou(e,a,i),e=e.sibling;e!==null;)ou(e,a,i),e=e.sibling}function jc(e){var a=e.stateNode,i=e.memoizedProps;try{for(var r=e.type,c=a.attributes;c.length;)a.removeAttributeNode(c[0]);ve(a,r,i),a[St]=e,a[ya]=i}catch(h){Bt(e,e.return,h)}}var Gi=!1,Ea=!1,Gc=!1,tp=typeof WeakSet=="function"?WeakSet:Set,Ia=null;function Lh(e,a){if(e=e.containerInfo,tt=sm,e=Md(e),Iu(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var c=r.anchorOffset,h=r.focusNode;r=r.focusOffset;try{i.nodeType,h.nodeType}catch{i=null;break e}var _=0,k=-1,P=-1,oe=0,Se=0,Ae=e,fe=null;t:for(;;){for(var ye;Ae!==i||c!==0&&Ae.nodeType!==3||(k=_+c),Ae!==h||r!==0&&Ae.nodeType!==3||(P=_+r),Ae.nodeType===3&&(_+=Ae.nodeValue.length),(ye=Ae.firstChild)!==null;)fe=Ae,Ae=ye;for(;;){if(Ae===e)break t;if(fe===i&&++oe===c&&(k=_),fe===h&&++Se===r&&(P=_),(ye=Ae.nextSibling)!==null)break;Ae=fe,fe=Ae.parentNode}Ae=ye}i=k===-1||P===-1?null:{start:k,end:P}}else i=null}i=i||{start:0,end:0}}else i=null;for(Et={focusedElem:e,selectionRange:i},sm=!1,Ia=a;Ia!==null;)if(a=Ia,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,Ia=e;else for(;Ia!==null;){switch(a=Ia,h=a.alternate,e=a.flags,a.tag){case 0:if((e&4)!==0&&(e=a.updateQueue,e=e!==null?e.events:null,e!==null))for(i=0;i<e.length;i++)c=e[i],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,i=a,c=h.memoizedProps,h=h.memoizedState,r=i.stateNode;try{var Je=fs(i.type,c);e=r.getSnapshotBeforeUpdate(Je,h),r.__reactInternalSnapshotBeforeUpdate=e}catch(dt){Bt(i,i.return,dt)}}break;case 3:if((e&1024)!==0){if(e=a.stateNode.containerInfo,i=e.nodeType,i===9)Ep(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ep(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(y(163))}if(e=a.sibling,e!==null){e.return=a.return,Ia=e;break}Ia=a.return}}function ap(e,a,i){var r=i.flags;switch(i.tag){case 0:case 11:case 15:Hi(e,i),r&4&&sl(5,i);break;case 1:if(Hi(e,i),r&4)if(e=i.stateNode,a===null)try{e.componentDidMount()}catch(_){Bt(i,i.return,_)}else{var c=fs(i.type,a.memoizedProps);a=a.memoizedState;try{e.componentDidUpdate(c,a,e.__reactInternalSnapshotBeforeUpdate)}catch(_){Bt(i,i.return,_)}}r&64&&Uc(i),r&512&&ro(i,i.return);break;case 3:if(Hi(e,i),r&64&&(e=i.updateQueue,e!==null)){if(a=null,i.child!==null)switch(i.child.tag){case 27:case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}try{uc(e,a)}catch(_){Bt(i,i.return,_)}}break;case 27:a===null&&r&4&&jc(i);case 26:case 5:Hi(e,i),a===null&&r&4&&Ic(i),r&512&&ro(i,i.return);break;case 12:Hi(e,i);break;case 31:Hi(e,i),r&4&&rp(e,i);break;case 13:Hi(e,i),r&4&&qh(e,i),r&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=Kh.bind(null,i),Dr(e,i))));break;case 22:if(r=i.memoizedState!==null||Gi,!r){a=a!==null&&a.memoizedState!==null||Ea,c=Gi;var h=Ea;Gi=r,(Ea=a)&&!h?Pi(e,i,(i.subtreeFlags&8772)!==0):Hi(e,i),Gi=c,Ea=h}break;case 30:break;default:Hi(e,i)}}function np(e){var a=e.alternate;a!==null&&(e.alternate=null,np(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&Ms(a)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var sa=null,yn=!1;function Vi(e,a,i){for(i=i.child;i!==null;)ip(e,a,i),i=i.sibling}function ip(e,a,i){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(Xi,i)}catch{}switch(i.tag){case 26:Ea||Yn(i,a),Vi(e,a,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:Ea||Yn(i,a);var r=sa,c=yn;Jn(i.type)&&(sa=i.stateNode,yn=!1),Vi(e,a,i),Cp(i.stateNode),sa=r,yn=c;break;case 5:Ea||Yn(i,a);case 6:if(r=sa,c=yn,sa=null,Vi(e,a,i),sa=r,yn=c,sa!==null)if(yn)try{(sa.nodeType===9?sa.body:sa.nodeName==="HTML"?sa.ownerDocument.body:sa).removeChild(i.stateNode)}catch(h){Bt(i,a,h)}else try{sa.removeChild(i.stateNode)}catch(h){Bt(i,a,h)}break;case 18:sa!==null&&(yn?(e=sa,Su(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),od(e)):Su(sa,i.stateNode));break;case 4:r=sa,c=yn,sa=i.stateNode.containerInfo,yn=!0,Vi(e,a,i),sa=r,yn=c;break;case 0:case 11:case 14:case 15:ji(2,i,a),Ea||ji(4,i,a),Vi(e,a,i);break;case 1:Ea||(Yn(i,a),r=i.stateNode,typeof r.componentWillUnmount=="function"&&Jf(i,a,r)),Vi(e,a,i);break;case 21:Vi(e,a,i);break;case 22:Ea=(r=Ea)||i.memoizedState!==null,Vi(e,a,i),Ea=r;break;default:Vi(e,a,i)}}function rp(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{od(e)}catch(i){Bt(a,a.return,i)}}}function qh(e,a){if(a.memoizedState===null&&(e=a.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{od(e)}catch(i){Bt(a,a.return,i)}}function jh(e){switch(e.tag){case 31:case 13:case 19:var a=e.stateNode;return a===null&&(a=e.stateNode=new tp),a;case 22:return e=e.stateNode,a=e._retryCache,a===null&&(a=e._retryCache=new tp),a;default:throw Error(y(435,e.tag))}}function uu(e,a){var i=jh(e);a.forEach(function(r){if(!i.has(r)){i.add(r);var c=Wh.bind(null,e,r);r.then(c,c)}})}function on(e,a){var i=a.deletions;if(i!==null)for(var r=0;r<i.length;r++){var c=i[r],h=e,_=a,k=_;e:for(;k!==null;){switch(k.tag){case 27:if(Jn(k.type)){sa=k.stateNode,yn=!1;break e}break;case 5:sa=k.stateNode,yn=!1;break e;case 3:case 4:sa=k.stateNode.containerInfo,yn=!0;break e}k=k.return}if(sa===null)throw Error(y(160));ip(h,_,c),sa=null,yn=!1,h=c.alternate,h!==null&&(h.return=null),c.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Gh(a,e),a=a.sibling}var Xn=null;function Gh(e,a){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:on(a,e),un(e),r&4&&(ji(3,e,e.return),sl(3,e),ji(5,e,e.return));break;case 1:on(a,e),un(e),r&512&&(Ea||i===null||Yn(i,i.return)),r&64&&Gi&&(e=e.updateQueue,e!==null&&(r=e.callbacks,r!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?r:i.concat(r))));break;case 26:var c=Xn;if(on(a,e),un(e),r&512&&(Ea||i===null||Yn(i,i.return)),r&4){var h=i!==null?i.memoizedState:null;if(r=e.memoizedState,i===null)if(r===null)if(e.stateNode===null){e:{r=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(r){case"title":h=c.getElementsByTagName("title")[0],(!h||h[nr]||h[St]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=c.createElement(r),c.head.insertBefore(h,c.querySelector("head > title"))),ve(h,r,i),h[St]=e,jt(h),r=h;break e;case"link":var _=Bg("link","href",c).get(r+(i.href||""));if(_){for(var k=0;k<_.length;k++)if(h=_[k],h.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&h.getAttribute("rel")===(i.rel==null?null:i.rel)&&h.getAttribute("title")===(i.title==null?null:i.title)&&h.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){_.splice(k,1);break t}}h=c.createElement(r),ve(h,r,i),c.head.appendChild(h);break;case"meta":if(_=Bg("meta","content",c).get(r+(i.content||""))){for(k=0;k<_.length;k++)if(h=_[k],h.getAttribute("content")===(i.content==null?null:""+i.content)&&h.getAttribute("name")===(i.name==null?null:i.name)&&h.getAttribute("property")===(i.property==null?null:i.property)&&h.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&h.getAttribute("charset")===(i.charSet==null?null:i.charSet)){_.splice(k,1);break t}}h=c.createElement(r),ve(h,r,i),c.head.appendChild(h);break;default:throw Error(y(468,r))}h[St]=e,jt(h),r=h}e.stateNode=r}else Ng(c,e.type,e.stateNode);else e.stateNode=Dg(c,r,e.memoizedProps);else h!==r?(h===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):h.count--,r===null?Ng(c,e.type,e.stateNode):Dg(c,r,e.memoizedProps)):r===null&&e.stateNode!==null&&Lc(e,e.memoizedProps,i.memoizedProps)}break;case 27:on(a,e),un(e),r&512&&(Ea||i===null||Yn(i,i.return)),i!==null&&r&4&&Lc(e,e.memoizedProps,i.memoizedProps);break;case 5:if(on(a,e),un(e),r&512&&(Ea||i===null||Yn(i,i.return)),e.flags&32){c=e.stateNode;try{He(c,"")}catch(Je){Bt(e,e.return,Je)}}r&4&&e.stateNode!=null&&(c=e.memoizedProps,Lc(e,c,i!==null?i.memoizedProps:c)),r&1024&&(Gc=!0);break;case 6:if(on(a,e),un(e),r&4){if(e.stateNode===null)throw Error(y(162));r=e.memoizedProps,i=e.stateNode;try{i.nodeValue=r}catch(Je){Bt(e,e.return,Je)}}break;case 3:if(am=null,c=Xn,Xn=em(a.containerInfo),on(a,e),Xn=c,un(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{od(a.containerInfo)}catch(Je){Bt(e,e.return,Je)}Gc&&(Gc=!1,sp(e));break;case 4:r=Xn,Xn=em(e.stateNode.containerInfo),on(a,e),un(e),Xn=r;break;case 12:on(a,e),un(e);break;case 31:on(a,e),un(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,uu(e,r)));break;case 13:on(a,e),un(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(fu=en()),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,uu(e,r)));break;case 22:c=e.memoizedState!==null;var P=i!==null&&i.memoizedState!==null,oe=Gi,Se=Ea;if(Gi=oe||c,Ea=Se||P,on(a,e),Ea=Se,Gi=oe,un(e),r&8192)e:for(a=e.stateNode,a._visibility=c?a._visibility&-2:a._visibility|1,c&&(i===null||P||Gi||Ea||Er(e)),i=null,a=e;;){if(a.tag===5||a.tag===26){if(i===null){P=i=a;try{if(h=P.stateNode,c)_=h.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{k=P.stateNode;var Ae=P.memoizedProps.style,fe=Ae!=null&&Ae.hasOwnProperty("display")?Ae.display:null;k.style.display=fe==null||typeof fe=="boolean"?"":(""+fe).trim()}}catch(Je){Bt(P,P.return,Je)}}}else if(a.tag===6){if(i===null){P=a;try{P.stateNode.nodeValue=c?"":P.memoizedProps}catch(Je){Bt(P,P.return,Je)}}}else if(a.tag===18){if(i===null){P=a;try{var ye=P.stateNode;c?Sp(ye,!0):Sp(P.stateNode,!1)}catch(Je){Bt(P,P.return,Je)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===e)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;i===a&&(i=null),a=a.return}i===a&&(i=null),a.sibling.return=a.return,a=a.sibling}r&4&&(r=e.updateQueue,r!==null&&(i=r.retryQueue,i!==null&&(r.retryQueue=null,uu(e,i))));break;case 19:on(a,e),un(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,uu(e,r)));break;case 30:break;case 21:break;default:on(a,e),un(e)}}function un(e){var a=e.flags;if(a&2){try{for(var i,r=e.return;r!==null;){if(ep(r)){i=r;break}r=r.return}if(i==null)throw Error(y(160));switch(i.tag){case 27:var c=i.stateNode,h=lu(e);ou(e,h,c);break;case 5:var _=i.stateNode;i.flags&32&&(He(_,""),i.flags&=-33);var k=lu(e);ou(e,k,_);break;case 3:case 4:var P=i.stateNode.containerInfo,oe=lu(e);qc(e,oe,P);break;default:throw Error(y(161))}}catch(Se){Bt(e,e.return,Se)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function sp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var a=e;sp(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),e=e.sibling}}function Hi(e,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)ap(e,a.alternate,a),a=a.sibling}function Er(e){for(e=e.child;e!==null;){var a=e;switch(a.tag){case 0:case 11:case 14:case 15:ji(4,a,a.return),Er(a);break;case 1:Yn(a,a.return);var i=a.stateNode;typeof i.componentWillUnmount=="function"&&Jf(a,a.return,i),Er(a);break;case 27:Cp(a.stateNode);case 26:case 5:Yn(a,a.return),Er(a);break;case 22:a.memoizedState===null&&Er(a);break;case 30:Er(a);break;default:Er(a)}e=e.sibling}}function Pi(e,a,i){for(i=i&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var r=a.alternate,c=e,h=a,_=h.flags;switch(h.tag){case 0:case 11:case 15:Pi(c,h,i),sl(4,h);break;case 1:if(Pi(c,h,i),r=h,c=r.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(oe){Bt(r,r.return,oe)}if(r=h,c=r.updateQueue,c!==null){var k=r.stateNode;try{var P=c.shared.hiddenCallbacks;if(P!==null)for(c.shared.hiddenCallbacks=null,c=0;c<P.length;c++)Qd(P[c],k)}catch(oe){Bt(r,r.return,oe)}}i&&_&64&&Uc(h),ro(h,h.return);break;case 27:jc(h);case 26:case 5:Pi(c,h,i),i&&r===null&&_&4&&Ic(h),ro(h,h.return);break;case 12:Pi(c,h,i);break;case 31:Pi(c,h,i),i&&_&4&&rp(c,h);break;case 13:Pi(c,h,i),i&&_&4&&qh(c,h);break;case 22:h.memoizedState===null&&Pi(c,h,i),ro(h,h.return);break;case 30:break;default:Pi(c,h,i)}a=a.sibling}}function Vc(e,a){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(e=a.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&Gl(i))}function Hc(e,a){e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Gl(e))}function Zn(e,a,i,r){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)lp(e,a,i,r),a=a.sibling}function lp(e,a,i,r){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Zn(e,a,i,r),c&2048&&sl(9,a);break;case 1:Zn(e,a,i,r);break;case 3:Zn(e,a,i,r),c&2048&&(e=null,a.alternate!==null&&(e=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==e&&(a.refCount++,e!=null&&Gl(e)));break;case 12:if(c&2048){Zn(e,a,i,r),e=a.stateNode;try{var h=a.memoizedProps,_=h.id,k=h.onPostCommit;typeof k=="function"&&k(_,a.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(P){Bt(a,a.return,P)}}else Zn(e,a,i,r);break;case 31:Zn(e,a,i,r);break;case 13:Zn(e,a,i,r);break;case 23:break;case 22:h=a.stateNode,_=a.alternate,a.memoizedState!==null?h._visibility&2?Zn(e,a,i,r):so(e,a):h._visibility&2?Zn(e,a,i,r):(h._visibility|=2,ll(e,a,i,r,(a.subtreeFlags&10256)!==0||!1)),c&2048&&Vc(_,a);break;case 24:Zn(e,a,i,r),c&2048&&Hc(a.alternate,a);break;default:Zn(e,a,i,r)}}function ll(e,a,i,r,c){for(c=c&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var h=e,_=a,k=i,P=r,oe=_.flags;switch(_.tag){case 0:case 11:case 15:ll(h,_,k,P,c),sl(8,_);break;case 23:break;case 22:var Se=_.stateNode;_.memoizedState!==null?Se._visibility&2?ll(h,_,k,P,c):so(h,_):(Se._visibility|=2,ll(h,_,k,P,c)),c&&oe&2048&&Vc(_.alternate,_);break;case 24:ll(h,_,k,P,c),c&&oe&2048&&Hc(_.alternate,_);break;default:ll(h,_,k,P,c)}a=a.sibling}}function so(e,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var i=e,r=a,c=r.flags;switch(r.tag){case 22:so(i,r),c&2048&&Vc(r.alternate,r);break;case 24:so(i,r),c&2048&&Hc(r.alternate,r);break;default:so(i,r)}a=a.sibling}}var lo=8192;function ps(e,a,i){if(e.subtreeFlags&lo)for(e=e.child;e!==null;)op(e,a,i),e=e.sibling}function op(e,a,i){switch(e.tag){case 26:ps(e,a,i),e.flags&lo&&e.memoizedState!==null&&nv(i,Xn,e.memoizedState,e.memoizedProps);break;case 5:ps(e,a,i);break;case 3:case 4:var r=Xn;Xn=em(e.stateNode.containerInfo),ps(e,a,i),Xn=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=lo,lo=16777216,ps(e,a,i),lo=r):ps(e,a,i));break;default:ps(e,a,i)}}function up(e){var a=e.alternate;if(a!==null&&(e=a.child,e!==null)){a.child=null;do a=e.sibling,e.sibling=null,e=a;while(e!==null)}}function oo(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var r=a[i];Ia=r,dp(r,e)}up(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)cp(e),e=e.sibling}function cp(e){switch(e.tag){case 0:case 11:case 15:oo(e),e.flags&2048&&ji(9,e,e.return);break;case 3:oo(e);break;case 12:oo(e);break;case 22:var a=e.stateNode;e.memoizedState!==null&&a._visibility&2&&(e.return===null||e.return.tag!==13)?(a._visibility&=-3,cu(e)):oo(e);break;default:oo(e)}}function cu(e){var a=e.deletions;if((e.flags&16)!==0){if(a!==null)for(var i=0;i<a.length;i++){var r=a[i];Ia=r,dp(r,e)}up(e)}for(e=e.child;e!==null;){switch(a=e,a.tag){case 0:case 11:case 15:ji(8,a,a.return),cu(a);break;case 22:i=a.stateNode,i._visibility&2&&(i._visibility&=-3,cu(a));break;default:cu(a)}e=e.sibling}}function dp(e,a){for(;Ia!==null;){var i=Ia;switch(i.tag){case 0:case 11:case 15:ji(8,i,a);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var r=i.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:Gl(i.memoizedState.cache)}if(r=i.child,r!==null)r.return=i,Ia=r;else e:for(i=e;Ia!==null;){r=Ia;var c=r.sibling,h=r.return;if(np(r),r===i){Ia=null;break e}if(c!==null){c.return=h,Ia=c;break e}Ia=h}}}var Vh={getCacheForType:function(e){var a=Na($a),i=a.data.get(e);return i===void 0&&(i=e(),a.data.set(e,i)),i},cacheSignal:function(){return Na($a).controller.signal}},km=typeof WeakMap=="function"?WeakMap:Map,qt=0,Wt=null,Ot=null,kt=0,Vt=0,Ka=null,Tr=!1,hs=!1,Pc=!1,Fi=0,da=0,Cr=0,ol=0,Fc=0,vn=0,ul=0,uo=null,bn=null,du=!1,fu=0,fp=0,pu=1/0,hu=null,ms=null,Ta=0,zr=null,cl=null,Ar=0,Kc=0,pp=null,hp=null,mu=0,Wc=null;function _n(){return(qt&2)!==0&&kt!==0?kt&-kt:_e.T!==null?$p():Pr()}function mp(){if(vn===0)if((kt&536870912)===0||Mt){var e=Vr;Vr<<=1,(Vr&3932160)===0&&(Vr=262144),vn=e}else vn=536870912;return e=gn.current,e!==null&&(e.flags|=32),vn}function cn(e,a,i){(e===Wt&&(Vt===2||Vt===9)||e.cancelPendingCommit!==null)&&(co(e,0),fi(e,kt,vn,!1)),ni(e,i),((qt&2)===0||e!==Wt)&&(e===Wt&&((qt&2)===0&&(ol|=i),da===4&&fi(e,kt,vn,!1)),pi(e))}function gp(e,a,i){if((qt&6)!==0)throw Error(y(327));var r=!i&&(a&127)===0&&(a&e.expiredLanes)===0||Ji(e,a),c=r?vp(e,a):vu(e,a,!0),h=r;do{if(c===0){hs&&!r&&fi(e,a,0,!1);break}else{if(i=e.current.alternate,h&&!Ph(i)){c=vu(e,a,!1),h=!1;continue}if(c===2){if(h=a,e.errorRecoveryDisabledLanes&h)var _=0;else _=e.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){a=_;e:{var k=e;c=uo;var P=k.current.memoizedState.isDehydrated;if(P&&(co(k,_).flags|=256),_=vu(k,_,!1),_!==2){if(Pc&&!P){k.errorRecoveryDisabledLanes|=h,ol|=h,c=4;break e}h=bn,bn=c,h!==null&&(bn===null?bn=h:bn.push.apply(bn,h))}c=_}if(h=!1,c!==2)continue}}if(c===1){co(e,0),fi(e,a,0,!0);break}e:{switch(r=e,h=c,h){case 0:case 1:throw Error(y(345));case 4:if((a&4194048)!==a)break;case 6:fi(r,a,vn,!Tr);break e;case 2:bn=null;break;case 3:case 5:break;default:throw Error(y(329))}if((a&62914560)===a&&(c=fu+300-en(),10<c)){if(fi(r,a,vn,!Tr),vi(r,0,!0)!==0)break e;Ar=a,r.timeoutHandle=Ne(Hh.bind(null,r,i,bn,hu,du,a,vn,ol,ul,Tr,h,"Throttled",-0,0),c);break e}Hh(r,i,bn,hu,du,a,vn,ol,ul,Tr,h,null,-0,0)}}break}while(!0);pi(e)}function Hh(e,a,i,r,c,h,_,k,P,oe,Se,Ae,fe,ye){if(e.timeoutHandle=-1,Ae=a.subtreeFlags,Ae&8192||(Ae&16785408)===16785408){Ae={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ka},op(a,h,Ae);var Je=(h&62914560)===h?fu-en():(h&4194048)===h?fp-en():0;if(Je=iv(Ae,Je),Je!==null){Ar=h,e.cancelPendingCommit=Je(Rr.bind(null,e,a,h,i,r,c,_,k,P,Se,Ae,null,fe,ye)),fi(e,h,_,!oe);return}}Rr(e,a,h,i,r,c,_,k,P)}function Ph(e){for(var a=e;;){var i=a.tag;if((i===0||i===11||i===15)&&a.flags&16384&&(i=a.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var r=0;r<i.length;r++){var c=i[r],h=c.getSnapshot;c=c.value;try{if(!hn(h(),c))return!1}catch{return!1}}if(i=a.child,a.subtreeFlags&16384&&i!==null)i.return=a,a=i;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function fi(e,a,i,r){a&=~Fc,a&=~ol,e.suspendedLanes|=a,e.pingedLanes&=~a,r&&(e.warmLanes|=a),r=e.expirationTimes;for(var c=a;0<c;){var h=31-La(c),_=1<<h;r[h]=-1,c&=~_}i!==0&&In(e,i,a)}function gu(){return(qt&6)===0?($u(0),!1):!0}function Qc(){if(Ot!==null){if(Vt===0)var e=Ot.return;else e=Ot,Mi=ss=null,mc(e),Bi=null,el=0,e=Ot;for(;e!==null;)Nc(e.alternate,e),e=e.return;Ot=null}}function co(e,a){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,Ie(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Ar=0,Qc(),Wt=e,Ot=i=Oi(e.current,null),kt=a,Vt=0,Ka=null,Tr=!1,hs=Ji(e,a),Pc=!1,ul=vn=Fc=ol=Cr=da=0,bn=uo=null,du=!1,(a&8)!==0&&(a|=a&32);var r=e.entangledLanes;if(r!==0)for(e=e.entanglements,r&=a;0<r;){var c=31-La(r),h=1<<c;a|=e[c],r&=~h}return Fi=a,Io(),i}function yp(e,a){yt=null,_e.H=to,a===Wn||a===Di?(a=Fd(),Vt=3):a===yr?(a=Fd(),Vt=4):Vt=a===Ec?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ka=a,Ot===null&&(da=1,tu(e,Rn(a,e.current)))}function Yc(){var e=gn.current;return e===null?!0:(kt&4194048)===kt?Qn===null:(kt&62914560)===kt||(kt&536870912)!==0?e===Qn:!1}function Xc(){var e=_e.H;return _e.H=to,e===null?to:e}function Or(){var e=_e.A;return _e.A=Vh,e}function yu(){da=4,Tr||(kt&4194048)!==kt&&gn.current!==null||(hs=!0),(Cr&134217727)===0&&(ol&134217727)===0||Wt===null||fi(Wt,kt,vn,!1)}function vu(e,a,i){var r=qt;qt|=2;var c=Xc(),h=Or();(Wt!==e||kt!==a)&&(hu=null,co(e,a)),a=!1;var _=da;e:do try{if(Vt!==0&&Ot!==null){var k=Ot,P=Ka;switch(Vt){case 8:Qc(),_=6;break e;case 3:case 2:case 9:case 6:gn.current===null&&(a=!0);var oe=Vt;if(Vt=0,Ka=null,gs(e,k,P,oe),i&&hs){_=0;break e}break;default:oe=Vt,Vt=0,Ka=null,gs(e,k,P,oe)}}Zc(),_=da;break}catch(Se){yp(e,Se)}while(!0);return a&&e.shellSuspendCounter++,Mi=ss=null,qt=r,_e.H=c,_e.A=h,Ot===null&&(Wt=null,kt=0,Io()),_}function Zc(){for(;Ot!==null;)Jc(Ot)}function vp(e,a){var i=qt;qt|=2;var r=Xc(),c=Or();Wt!==e||kt!==a?(hu=null,pu=en()+500,co(e,a)):hs=Ji(e,a);e:do try{if(Vt!==0&&Ot!==null){a=Ot;var h=Ka;t:switch(Vt){case 1:Vt=0,Ka=null,gs(e,a,h,1);break;case 2:case 9:if(os(h)){Vt=0,Ka=null,ed(a);break}a=function(){Vt!==2&&Vt!==9||Wt!==e||(Vt=7),pi(e)},h.then(a,a);break e;case 3:Vt=7;break e;case 4:Vt=5;break e;case 7:os(h)?(Vt=0,Ka=null,ed(a)):(Vt=0,Ka=null,gs(e,a,h,7));break;case 5:var _=null;switch(Ot.tag){case 26:_=Ot.memoizedState;case 5:case 27:var k=Ot;if(_?Ug(_):k.stateNode.complete){Vt=0,Ka=null;var P=k.sibling;if(P!==null)Ot=P;else{var oe=k.return;oe!==null?(Ot=oe,fo(oe)):Ot=null}break t}}Vt=0,Ka=null,gs(e,a,h,5);break;case 6:Vt=0,Ka=null,gs(e,a,h,6);break;case 8:Qc(),da=6;break e;default:throw Error(y(462))}}bp();break}catch(Se){yp(e,Se)}while(!0);return Mi=ss=null,_e.H=r,_e.A=c,qt=i,Ot!==null?0:(Wt=null,kt=0,Io(),da)}function bp(){for(;Ot!==null&&!$d();)Jc(Ot)}function Jc(e){var a=Xf(e.alternate,e,Fi);e.memoizedProps=e.pendingProps,a===null?fo(e):Ot=a}function ed(e){var a=e,i=a.alternate;switch(a.tag){case 15:case 0:a=Uh(i,a,a.pendingProps,a.type,void 0,kt);break;case 11:a=Uh(i,a,a.pendingProps,a.type.render,a.ref,kt);break;case 5:mc(a);default:Nc(i,a),a=Ot=Id(a,Fi),a=Xf(i,a,Fi)}e.memoizedProps=e.pendingProps,a===null?fo(e):Ot=a}function gs(e,a,i,r){Mi=ss=null,mc(a),Bi=null,el=0;var c=a.return;try{if(Bh(e,c,a,i,kt)){da=1,tu(e,Rn(i,e.current)),Ot=null;return}}catch(h){if(c!==null)throw Ot=c,h;da=1,tu(e,Rn(i,e.current)),Ot=null;return}a.flags&32768?(Mt||r===1?e=!0:hs||(kt&536870912)!==0?e=!1:(Tr=e=!0,(r===2||r===9||r===3||r===6)&&(r=gn.current,r!==null&&r.tag===13&&(r.flags|=16384))),_p(a,e)):fo(a)}function fo(e){var a=e;do{if((a.flags&32768)!==0){_p(a,Tr);return}e=a.return;var i=Mm(a.alternate,a,Fi);if(i!==null){Ot=i;return}if(a=a.sibling,a!==null){Ot=a;return}Ot=a=e}while(a!==null);da===0&&(da=5)}function _p(e,a){do{var i=su(e.alternate,e);if(i!==null){i.flags&=32767,Ot=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!a&&(e=e.sibling,e!==null)){Ot=e;return}Ot=e=i}while(e!==null);da=6,Ot=null}function Rr(e,a,i,r,c,h,_,k,P){e.cancelPendingCommit=null;do fl();while(Ta!==0);if((qt&6)!==0)throw Error(y(327));if(a!==null){if(a===e.current)throw Error(y(177));if(h=a.lanes|a.childLanes,h|=Hu,tr(e,i,h,_,k,P),e===Wt&&(Ot=Wt=null,kt=0),cl=a,zr=e,Ar=i,Kc=h,pp=c,hp=r,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Qh(oa,function(){return td(),null})):(e.callbackNode=null,e.callbackPriority=0),r=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||r){r=_e.T,_e.T=null,c=Oe.p,Oe.p=2,_=qt,qt|=4;try{Lh(e,a,i)}finally{qt=_,Oe.p=c,_e.T=r}}Ta=1,dn(),dl(),po()}}function dn(){if(Ta===1){Ta=0;var e=zr,a=cl,i=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||i){i=_e.T,_e.T=null;var r=Oe.p;Oe.p=2;var c=qt;qt|=4;try{Gh(a,e);var h=Et,_=Md(e.containerInfo),k=h.focusedElem,P=h.selectionRange;if(_!==k&&k&&k.ownerDocument&&Rd(k.ownerDocument.documentElement,k)){if(P!==null&&Iu(k)){var oe=P.start,Se=P.end;if(Se===void 0&&(Se=oe),"selectionStart"in k)k.selectionStart=oe,k.selectionEnd=Math.min(Se,k.value.length);else{var Ae=k.ownerDocument||document,fe=Ae&&Ae.defaultView||window;if(fe.getSelection){var ye=fe.getSelection(),Je=k.textContent.length,dt=Math.min(P.start,Je),na=P.end===void 0?dt:Math.min(P.end,Je);!ye.extend&&dt>na&&(_=na,na=dt,dt=_);var ie=Pn(k,dt),Y=Pn(k,na);if(ie&&Y&&(ye.rangeCount!==1||ye.anchorNode!==ie.node||ye.anchorOffset!==ie.offset||ye.focusNode!==Y.node||ye.focusOffset!==Y.offset)){var le=Ae.createRange();le.setStart(ie.node,ie.offset),ye.removeAllRanges(),dt>na?(ye.addRange(le),ye.extend(Y.node,Y.offset)):(le.setEnd(Y.node,Y.offset),ye.addRange(le))}}}}for(Ae=[],ye=k;ye=ye.parentNode;)ye.nodeType===1&&Ae.push({element:ye,left:ye.scrollLeft,top:ye.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<Ae.length;k++){var ze=Ae[k];ze.element.scrollLeft=ze.left,ze.element.scrollTop=ze.top}}sm=!!tt,Et=tt=null}finally{qt=c,Oe.p=r,_e.T=i}}e.current=a,Ta=2}}function dl(){if(Ta===2){Ta=0;var e=zr,a=cl,i=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||i){i=_e.T,_e.T=null;var r=Oe.p;Oe.p=2;var c=qt;qt|=4;try{ap(e,a.alternate,a)}finally{qt=c,Oe.p=r,_e.T=i}}Ta=3}}function po(){if(Ta===4||Ta===3){Ta=0,Sd();var e=zr,a=cl,i=Ar,r=hp;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Ta=5:(Ta=0,cl=zr=null,ho(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(ms=null),Rs(i),a=a.stateNode,tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(Xi,a,void 0,(a.current.flags&128)===128)}catch{}if(r!==null){a=_e.T,c=Oe.p,Oe.p=2,_e.T=null;try{for(var h=e.onRecoverableError,_=0;_<r.length;_++){var k=r[_];h(k.value,{componentStack:k.stack})}}finally{_e.T=a,Oe.p=c}}(Ar&3)!==0&&fl(),pi(e),c=e.pendingLanes,(i&261930)!==0&&(c&42)!==0?e===Wc?mu++:(mu=0,Wc=e):mu=0,$u(0)}}function ho(e,a){(e.pooledCacheLanes&=a)===0&&(a=e.pooledCache,a!=null&&(e.pooledCache=null,Gl(a)))}function fl(){return dn(),dl(),po(),td()}function td(){if(Ta!==5)return!1;var e=zr,a=Kc;Kc=0;var i=Rs(Ar),r=_e.T,c=Oe.p;try{Oe.p=32>i?32:i,_e.T=null,i=pp,pp=null;var h=zr,_=Ar;if(Ta=0,cl=zr=null,Ar=0,(qt&6)!==0)throw Error(y(331));var k=qt;if(qt|=4,cp(h.current),lp(h,h.current,_,i),qt=k,$u(0,!1),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(Xi,h)}catch{}return!0}finally{Oe.p=c,_e.T=r,ho(e,a)}}function bu(e,a,i){a=Rn(i,a),a=au(e.stateNode,a,2),e=_r(e,a,2),e!==null&&(ni(e,2),pi(e))}function Bt(e,a,i){if(e.tag===3)bu(e,e,i);else for(;a!==null;){if(a.tag===3){bu(a,e,i);break}else if(a.tag===1){var r=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ms===null||!ms.has(r))){e=Rn(i,e),i=If(2),r=_r(a,i,2),r!==null&&(Lf(i,r,a,e),ni(r,2),pi(r));break}}a=a.return}}function Mr(e,a,i){var r=e.pingCache;if(r===null){r=e.pingCache=new km;var c=new Set;r.set(a,c)}else c=r.get(a),c===void 0&&(c=new Set,r.set(a,c));c.has(i)||(Pc=!0,c.add(i),e=Fh.bind(null,e,a,i),a.then(e,e))}function Fh(e,a,i){var r=e.pingCache;r!==null&&r.delete(a),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,Wt===e&&(kt&i)===i&&(da===4||da===3&&(kt&62914560)===kt&&300>en()-fu?(qt&2)===0&&co(e,0):Fc|=i,ul===kt&&(ul=0)),pi(e)}function wp(e,a){a===0&&(a=Tl()),e=is(e,a),e!==null&&(ni(e,a),pi(e))}function Kh(e){var a=e.memoizedState,i=0;a!==null&&(i=a.retryLane),wp(e,i)}function Wh(e,a){var i=0;switch(e.tag){case 31:case 13:var r=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(y(314))}r!==null&&r.delete(a),wp(e,i)}function Qh(e,a){return Ro(e,a)}var _u=null,pl=null,ad=!1,wu=!1,xu=!1,kr=0;function pi(e){e!==pl&&e.next===null&&(pl===null?_u=pl=e:pl=pl.next=e),wu=!0,ad||(ad=!0,Zh())}function $u(e,a){if(!xu&&wu){xu=!0;do for(var i=!1,r=_u;r!==null;){if(e!==0){var c=r.pendingLanes;if(c===0)var h=0;else{var _=r.suspendedLanes,k=r.pingedLanes;h=(1<<31-La(42|e)+1)-1,h&=c&~(_&~k),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(i=!0,Xh(r,h))}else h=kt,h=vi(r,r===Wt?h:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),(h&3)===0||Ji(r,h)||(i=!0,Xh(r,h));r=r.next}while(i);xu=!1}}function Yh(){nd()}function nd(){wu=ad=!1;var e=0;kr!==0&&aa()&&(e=kr);for(var a=en(),i=null,r=_u;r!==null;){var c=r.next,h=id(r,a);h===0?(r.next=null,i===null?_u=c:i.next=c,c===null&&(pl=i)):(i=r,(e!==0||(h&3)!==0)&&(wu=!0)),r=c}Ta!==0&&Ta!==5||$u(e),kr!==0&&(kr=0)}function id(e,a){for(var i=e.suspendedLanes,r=e.pingedLanes,c=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var _=31-La(h),k=1<<_,P=c[_];P===-1?((k&i)===0||(k&r)!==0)&&(c[_]=As(k,a)):P<=a&&(e.expiredLanes|=k),h&=~k}if(a=Wt,i=kt,i=vi(e,e===a?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r=e.callbackNode,i===0||e===a&&(Vt===2||Vt===9)||e.cancelPendingCommit!==null)return r!==null&&r!==null&&Yi(r),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||Ji(e,i)){if(a=i&-i,a===e.callbackPriority)return a;switch(r!==null&&Yi(r),Rs(i)){case 2:case 8:i=Sl;break;case 32:i=oa;break;case 268435456:i=El;break;default:i=oa}return r=xp.bind(null,e),i=Ro(i,r),e.callbackPriority=a,e.callbackNode=i,a}return r!==null&&r!==null&&Yi(r),e.callbackPriority=2,e.callbackNode=null,2}function xp(e,a){if(Ta!==0&&Ta!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(fl()&&e.callbackNode!==i)return null;var r=kt;return r=vi(e,e===Wt?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r===0?null:(gp(e,r,a),id(e,en()),e.callbackNode!=null&&e.callbackNode===i?xp.bind(null,e):null)}function Xh(e,a){if(fl())return null;gp(e,a,!0)}function Zh(){pt(function(){(qt&6)!==0?Ro(Bu,Yh):nd()})}function $p(){if(kr===0){var e=Zs;e===0&&(e=Gr,Gr<<=1,(Gr&261888)===0&&(Gr=256)),kr=e}return kr}function Jh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:pn(""+e)}function t(e,a){var i=a.ownerDocument.createElement("input");return i.name=a.name,i.value=a.value,e.id&&i.setAttribute("form",e.id),a.parentNode.insertBefore(i,a),e=new FormData(e),i.parentNode.removeChild(i),e}function n(e,a,i,r,c){if(a==="submit"&&i&&i.stateNode===c){var h=Jh((c[ya]||null).action),_=r.submitter;_&&(a=(a=_[ya]||null)?Jh(a.formAction):_.getAttribute("formAction"),a!==null&&(h=a,_=null));var k=new kl("action","action",null,r,c);e.push({event:k,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(kr!==0){var P=_?t(c,_):new FormData(c);Cf(i,{pending:!0,data:P,method:c.method,action:h},null,P)}}else typeof h=="function"&&(k.preventDefault(),P=_?t(c,_):new FormData(c),Cf(i,{pending:!0,data:P,method:c.method,action:h},h,P))},currentTarget:c}]})}}for(var s=0;s<Vu.length;s++){var l=Vu[s],u=l.toLowerCase(),f=l[0].toUpperCase()+l.slice(1);Fn(u,"on"+f)}Fn(ju,"onAnimationEnd"),Fn(ph,"onAnimationIteration"),Fn(Bd,"onAnimationStart"),Fn("dblclick","onDoubleClick"),Fn("focusin","onFocus"),Fn("focusout","onBlur"),Fn(Gu,"onTransitionRun"),Fn(hh,"onTransitionStart"),Fn(mh,"onTransitionCancel"),Fn(Nd,"onTransitionEnd"),Ln("onMouseEnter",["mouseout","mouseover"]),Ln("onMouseLeave",["mouseout","mouseover"]),Ln("onPointerEnter",["pointerout","pointerover"]),Ln("onPointerLeave",["pointerout","pointerover"]),Sn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var p="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),g=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(p));function b(e,a){a=(a&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],c=r.event;r=r.listeners;e:{var h=void 0;if(a)for(var _=r.length-1;0<=_;_--){var k=r[_],P=k.instance,oe=k.currentTarget;if(k=k.listener,P!==h&&c.isPropagationStopped())break e;h=k,c.currentTarget=oe;try{h(c)}catch(Se){ql(Se)}c.currentTarget=null,h=P}else for(_=0;_<r.length;_++){if(k=r[_],P=k.instance,oe=k.currentTarget,k=k.listener,P!==h&&c.isPropagationStopped())break e;h=k,c.currentTarget=oe;try{h(c)}catch(Se){ql(Se)}c.currentTarget=null,h=P}}}}function v(e,a){var i=a[ar];i===void 0&&(i=a[ar]=new Set);var r=e+"__bubble";i.has(r)||(z(a,e,2,!1),i.add(r))}function w(e,a,i){var r=0;a&&(r|=4),z(i,e,r,a)}var x="_reactListening"+Math.random().toString(36).slice(2);function C(e){if(!e[x]){e[x]=!0,an.forEach(function(i){i!=="selectionchange"&&(g.has(i)||w(i,!1,e),w(i,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[x]||(a[x]=!0,w("selectionchange",!1,a))}}function z(e,a,i,r){switch(Hg(a)){case 2:var c=lv;break;case 8:c=ov;break;default:c=Im}i=c.bind(null,a,i,e),c=void 0,!Ls||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(c=!0),r?c!==void 0?e.addEventListener(a,i,{capture:!0,passive:c}):e.addEventListener(a,i,!0):c!==void 0?e.addEventListener(a,i,{passive:c}):e.addEventListener(a,i,!1)}function A(e,a,i,r,c){var h=r;if((a&1)===0&&(a&2)===0&&r!==null)e:for(;;){if(r===null)return;var _=r.tag;if(_===3||_===4){var k=r.stateNode.containerInfo;if(k===c)break;if(_===4)for(_=r.return;_!==null;){var P=_.tag;if((P===3||P===4)&&_.stateNode.containerInfo===c)return;_=_.return}for(;k!==null;){if(_=Qa(k),_===null)return;if(P=_.tag,P===5||P===6||P===26||P===27){r=h=_;continue e}k=k.parentNode}}r=r.return}sr(function(){var oe=h,Se=Xr(i),Ae=[];e:{var fe=Ll.get(e);if(fe!==void 0){var ye=kl,Je=e;switch(e){case"keypress":if(or(i)===0)break e;case"keydown":case"keyup":ye=Aa;break;case"focusin":Je="focus",ye=ke;break;case"focusout":Je="blur",ye=ke;break;case"beforeblur":case"afterblur":ye=ke;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=W;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=re;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=Ya;break;case ju:case ph:case Bd:ye=de;break;case Nd:ye=Do;break;case"scroll":case"scrollend":ye=O;break;case"wheel":ye=Gn;break;case"copy":case"cut":case"paste":ye=J;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=Va;break;case"toggle":case"beforetoggle":ye=$t}var dt=(a&4)!==0,na=!dt&&(e==="scroll"||e==="scrollend"),ie=dt?fe!==null?fe+"Capture":null:fe;dt=[];for(var Y=oe,le;Y!==null;){var ze=Y;if(le=ze.stateNode,ze=ze.tag,ze!==5&&ze!==26&&ze!==27||le===null||ie===null||(ze=lr(Y,ie),ze!=null&&dt.push(B(Y,ze,le))),na)break;Y=Y.return}0<dt.length&&(fe=new ye(fe,Je,null,i,Se),Ae.push({event:fe,listeners:dt}))}}if((a&7)===0){e:{if(fe=e==="mouseover"||e==="pointerover",ye=e==="mouseout"||e==="pointerout",fe&&i!==Yr&&(Je=i.relatedTarget||i.fromElement)&&(Qa(Je)||Je[Ke]))break e;if((ye||fe)&&(fe=Se.window===Se?Se:(fe=Se.ownerDocument)?fe.defaultView||fe.parentWindow:window,ye?(Je=i.relatedTarget||i.toElement,ye=oe,Je=Je?Qa(Je):null,Je!==null&&(na=E(Je),dt=Je.tag,Je!==na||dt!==5&&dt!==27&&dt!==6)&&(Je=null)):(ye=null,Je=oe),ye!==Je)){if(dt=W,ze="onMouseLeave",ie="onMouseEnter",Y="mouse",(e==="pointerout"||e==="pointerover")&&(dt=Va,ze="onPointerLeave",ie="onPointerEnter",Y="pointer"),na=ye==null?fe:ir(ye),le=Je==null?fe:ir(Je),fe=new dt(ze,Y+"leave",ye,i,Se),fe.target=na,fe.relatedTarget=le,ze=null,Qa(Se)===oe&&(dt=new dt(ie,Y+"enter",Je,i,Se),dt.target=le,dt.relatedTarget=na,ze=dt),na=ze,ye&&Je)t:{for(dt=U,ie=ye,Y=Je,le=0,ze=ie;ze;ze=dt(ze))le++;ze=0;for(var ot=Y;ot;ot=dt(ot))ze++;for(;0<le-ze;)ie=dt(ie),le--;for(;0<ze-le;)Y=dt(Y),ze--;for(;le--;){if(ie===Y||Y!==null&&ie===Y.alternate){dt=ie;break t}ie=dt(ie),Y=dt(Y)}dt=null}else dt=null;ye!==null&&N(Ae,fe,ye,dt,!1),Je!==null&&na!==null&&N(Ae,na,Je,dt,!0)}}e:{if(fe=oe?ir(oe):window,ye=fe.nodeName&&fe.nodeName.toLowerCase(),ye==="select"||ye==="input"&&fe.type==="file")var Ht=Vn;else if(ba(fe))if(Cd)Ht=ch;else{Ht=oh;var it=lh}else ye=fe.nodeName,!ye||ye.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?oe&&Ei(oe.elementType)&&(Ht=Vn):Ht=uh;if(Ht&&(Ht=Ht(e,oe))){ra(Ae,Ht,i,Se);break e}it&&it(e,fe,oe),e==="focusout"&&oe&&fe.type==="number"&&oe.memoizedProps.value!=null&&xi(fe,"number",fe.value)}switch(it=oe?ir(oe):window,e){case"focusin":(ba(it)||it.contentEditable==="true")&&(Hs=it,Lu=oe,Il=null);break;case"focusout":Il=Lu=Hs=null;break;case"mousedown":qu=!0;break;case"contextmenu":case"mouseup":case"dragend":qu=!1,kd(Ae,i,Se);break;case"selectionchange":if(fh)break;case"keydown":case"keyup":kd(Ae,i,Se)}var Ct;if(Dl)e:{switch(e){case"compositionstart":var Ut="onCompositionStart";break e;case"compositionend":Ut="onCompositionEnd";break e;case"compositionupdate":Ut="onCompositionUpdate";break e}Ut=void 0}else cr?Pa(e,i)&&(Ut="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ut="onCompositionStart");Ut&&(va&&i.locale!=="ko"&&(cr||Ut!=="onCompositionStart"?Ut==="onCompositionEnd"&&cr&&(Ct=qs()):(zn=Se,Zr="value"in zn?zn.value:zn.textContent,cr=!0)),it=L(oe,Ut),0<it.length&&(Ut=new Jt(Ut,e,null,i,Se),Ae.push({event:Ut,listeners:it}),Ct?Ut.data=Ct:(Ct=Bl(i),Ct!==null&&(Ut.data=Ct)))),(Ct=Gs?si(e,i):li(e,i))&&(Ut=L(oe,"onBeforeInput"),0<Ut.length&&(it=new Jt("onBeforeInput","beforeinput",null,i,Se),Ae.push({event:it,listeners:Ut}),it.data=Ct)),n(Ae,e,oe,i,Se)}b(Ae,a)})}function B(e,a,i){return{instance:e,listener:a,currentTarget:i}}function L(e,a){for(var i=a+"Capture",r=[];e!==null;){var c=e,h=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||h===null||(c=lr(e,i),c!=null&&r.unshift(B(e,c,h)),c=lr(e,a),c!=null&&r.push(B(e,c,h))),e.tag===3)return r;e=e.return}return[]}function U(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function N(e,a,i,r,c){for(var h=a._reactName,_=[];i!==null&&i!==r;){var k=i,P=k.alternate,oe=k.stateNode;if(k=k.tag,P!==null&&P===r)break;k!==5&&k!==26&&k!==27||oe===null||(P=oe,c?(oe=lr(i,h),oe!=null&&_.unshift(B(i,oe,P))):c||(oe=lr(i,h),oe!=null&&_.push(B(i,oe,P)))),i=i.return}_.length!==0&&e.push({event:a,listeners:_})}var V=/\r\n?/g,G=/\u0000|\uFFFD/g;function X(e){return(typeof e=="string"?e:""+e).replace(V,`
`).replace(G,"")}function ue(e,a){return a=X(a),X(e)===a}function te(e,a,i,r,c,h){switch(i){case"children":typeof r=="string"?a==="body"||a==="textarea"&&r===""||He(e,r):(typeof r=="number"||typeof r=="bigint")&&a!=="body"&&He(e,""+r);break;case"className":Wr(e,"class",r);break;case"tabIndex":Wr(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Wr(e,i,r);break;case"style":Si(e,r,h);break;case"data":if(a!=="object"){Wr(e,"data",r);break}case"src":case"href":if(r===""&&(a!=="a"||i!=="href")){e.removeAttribute(i);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(i);break}r=pn(""+r),e.setAttribute(i,r);break;case"action":case"formAction":if(typeof r=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(i==="formAction"?(a!=="input"&&te(e,a,"name",c.name,c,null),te(e,a,"formEncType",c.formEncType,c,null),te(e,a,"formMethod",c.formMethod,c,null),te(e,a,"formTarget",c.formTarget,c,null)):(te(e,a,"encType",c.encType,c,null),te(e,a,"method",c.method,c,null),te(e,a,"target",c.target,c,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(i);break}r=pn(""+r),e.setAttribute(i,r);break;case"onClick":r!=null&&(e.onclick=ka);break;case"onScroll":r!=null&&v("scroll",e);break;case"onScrollEnd":r!=null&&v("scrollend",e);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(y(61));if(i=r.__html,i!=null){if(c.children!=null)throw Error(y(60));e.innerHTML=i}}break;case"multiple":e.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":e.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){e.removeAttribute("xlink:href");break}i=pn(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(i,""+r):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":r===!0?e.setAttribute(i,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(i,r):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?e.setAttribute(i,r):e.removeAttribute(i);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?e.removeAttribute(i):e.setAttribute(i,r);break;case"popover":v("beforetoggle",e),v("toggle",e),_i(e,"popover",r);break;case"xlinkActuate":En(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":En(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":En(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":En(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":En(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":En(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":En(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":En(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":En(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":_i(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Us.get(i)||i,_i(e,i,r))}}function ge(e,a,i,r,c,h){switch(i){case"style":Si(e,r,h);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(y(61));if(i=r.__html,i!=null){if(c.children!=null)throw Error(y(60));e.innerHTML=i}}break;case"children":typeof r=="string"?He(e,r):(typeof r=="number"||typeof r=="bigint")&&He(e,""+r);break;case"onScroll":r!=null&&v("scroll",e);break;case"onScrollEnd":r!=null&&v("scrollend",e);break;case"onClick":r!=null&&(e.onclick=ka);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!nn.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),a=i.slice(2,c?i.length-7:void 0),h=e[ya]||null,h=h!=null?h[i]:null,typeof h=="function"&&e.removeEventListener(a,h,c),typeof r=="function")){typeof h!="function"&&h!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(a,r,c);break e}i in e?e[i]=r:r===!0?e.setAttribute(i,""):_i(e,i,r)}}}function ve(e,a,i){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":v("error",e),v("load",e);var r=!1,c=!1,h;for(h in i)if(i.hasOwnProperty(h)){var _=i[h];if(_!=null)switch(h){case"src":r=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(y(137,a));default:te(e,a,h,_,i,null)}}c&&te(e,a,"srcSet",i.srcSet,i,null),r&&te(e,a,"src",i.src,i,null);return;case"input":v("invalid",e);var k=h=_=c=null,P=null,oe=null;for(r in i)if(i.hasOwnProperty(r)){var Se=i[r];if(Se!=null)switch(r){case"name":c=Se;break;case"type":_=Se;break;case"checked":P=Se;break;case"defaultChecked":oe=Se;break;case"value":h=Se;break;case"defaultValue":k=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(y(137,a));break;default:te(e,a,r,Se,i,null)}}pe(e,h,k,P,oe,_,c,!1);return;case"select":v("invalid",e),r=_=h=null;for(c in i)if(i.hasOwnProperty(c)&&(k=i[c],k!=null))switch(c){case"value":h=k;break;case"defaultValue":_=k;break;case"multiple":r=k;default:te(e,a,c,k,i,null)}a=h,i=_,e.multiple=!!r,a!=null?ii(e,!!r,a,!1):i!=null&&ii(e,!!r,i,!0);return;case"textarea":v("invalid",e),h=c=r=null;for(_ in i)if(i.hasOwnProperty(_)&&(k=i[_],k!=null))switch(_){case"value":r=k;break;case"defaultValue":c=k;break;case"children":h=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(y(91));break;default:te(e,a,_,k,i,null)}jn(e,r,c,h);return;case"option":for(P in i)if(i.hasOwnProperty(P)&&(r=i[P],r!=null))switch(P){case"selected":e.selected=r&&typeof r!="function"&&typeof r!="symbol";break;default:te(e,a,P,r,i,null)}return;case"dialog":v("beforetoggle",e),v("toggle",e),v("cancel",e),v("close",e);break;case"iframe":case"object":v("load",e);break;case"video":case"audio":for(r=0;r<p.length;r++)v(p[r],e);break;case"image":v("error",e),v("load",e);break;case"details":v("toggle",e);break;case"embed":case"source":case"link":v("error",e),v("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(oe in i)if(i.hasOwnProperty(oe)&&(r=i[oe],r!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":throw Error(y(137,a));default:te(e,a,oe,r,i,null)}return;default:if(Ei(a)){for(Se in i)i.hasOwnProperty(Se)&&(r=i[Se],r!==void 0&&ge(e,a,Se,r,i,void 0));return}}for(k in i)i.hasOwnProperty(k)&&(r=i[k],r!=null&&te(e,a,k,r,i,null))}function Le(e,a,i,r){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,h=null,_=null,k=null,P=null,oe=null,Se=null;for(ye in i){var Ae=i[ye];if(i.hasOwnProperty(ye)&&Ae!=null)switch(ye){case"checked":break;case"value":break;case"defaultValue":P=Ae;default:r.hasOwnProperty(ye)||te(e,a,ye,null,r,Ae)}}for(var fe in r){var ye=r[fe];if(Ae=i[fe],r.hasOwnProperty(fe)&&(ye!=null||Ae!=null))switch(fe){case"type":h=ye;break;case"name":c=ye;break;case"checked":oe=ye;break;case"defaultChecked":Se=ye;break;case"value":_=ye;break;case"defaultValue":k=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(y(137,a));break;default:ye!==Ae&&te(e,a,fe,ye,r,Ae)}}qn(e,_,k,P,oe,Se,h,c);return;case"select":ye=_=k=fe=null;for(h in i)if(P=i[h],i.hasOwnProperty(h)&&P!=null)switch(h){case"value":break;case"multiple":ye=P;default:r.hasOwnProperty(h)||te(e,a,h,null,r,P)}for(c in r)if(h=r[c],P=i[c],r.hasOwnProperty(c)&&(h!=null||P!=null))switch(c){case"value":fe=h;break;case"defaultValue":k=h;break;case"multiple":_=h;default:h!==P&&te(e,a,c,h,r,P)}a=k,i=_,r=ye,fe!=null?ii(e,!!i,fe,!1):!!r!=!!i&&(a!=null?ii(e,!!i,a,!0):ii(e,!!i,i?[]:"",!1));return;case"textarea":ye=fe=null;for(k in i)if(c=i[k],i.hasOwnProperty(k)&&c!=null&&!r.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:te(e,a,k,null,r,c)}for(_ in r)if(c=r[_],h=i[_],r.hasOwnProperty(_)&&(c!=null||h!=null))switch(_){case"value":fe=c;break;case"defaultValue":ye=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(y(91));break;default:c!==h&&te(e,a,_,c,r,h)}Al(e,fe,ye);return;case"option":for(var Je in i)if(fe=i[Je],i.hasOwnProperty(Je)&&fe!=null&&!r.hasOwnProperty(Je))switch(Je){case"selected":e.selected=!1;break;default:te(e,a,Je,null,r,fe)}for(P in r)if(fe=r[P],ye=i[P],r.hasOwnProperty(P)&&fe!==ye&&(fe!=null||ye!=null))switch(P){case"selected":e.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:te(e,a,P,fe,r,ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var dt in i)fe=i[dt],i.hasOwnProperty(dt)&&fe!=null&&!r.hasOwnProperty(dt)&&te(e,a,dt,null,r,fe);for(oe in r)if(fe=r[oe],ye=i[oe],r.hasOwnProperty(oe)&&fe!==ye&&(fe!=null||ye!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(y(137,a));break;default:te(e,a,oe,fe,r,ye)}return;default:if(Ei(a)){for(var na in i)fe=i[na],i.hasOwnProperty(na)&&fe!==void 0&&!r.hasOwnProperty(na)&&ge(e,a,na,void 0,r,fe);for(Se in r)fe=r[Se],ye=i[Se],!r.hasOwnProperty(Se)||fe===ye||fe===void 0&&ye===void 0||ge(e,a,Se,fe,r,ye);return}}for(var ie in i)fe=i[ie],i.hasOwnProperty(ie)&&fe!=null&&!r.hasOwnProperty(ie)&&te(e,a,ie,null,r,fe);for(Ae in r)fe=r[Ae],ye=i[Ae],!r.hasOwnProperty(Ae)||fe===ye||fe==null&&ye==null||te(e,a,Ae,fe,r,ye)}function nt(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Fe(){if(typeof performance.getEntriesByType=="function"){for(var e=0,a=0,i=performance.getEntriesByType("resource"),r=0;r<i.length;r++){var c=i[r],h=c.transferSize,_=c.initiatorType,k=c.duration;if(h&&k&&nt(_)){for(_=0,k=c.responseEnd,r+=1;r<i.length;r++){var P=i[r],oe=P.startTime;if(oe>k)break;var Se=P.transferSize,Ae=P.initiatorType;Se&&nt(Ae)&&(P=P.responseEnd,_+=Se*(P<k?1:(k-oe)/(P-oe)))}if(--r,a+=8*(h+_)/(c.duration/1e3),e++,10<e)break}}if(0<e)return a/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var tt=null,Et=null;function Tt(e){return e.nodeType===9?e:e.ownerDocument}function We(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ut(e,a){if(e===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&a==="foreignObject"?0:e}function Qt(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var je=null;function aa(){var e=window.event;return e&&e.type==="popstate"?e===je?!1:(je=e,!0):(je=null,!1)}var Ne=typeof setTimeout=="function"?setTimeout:void 0,Ie=typeof clearTimeout=="function"?clearTimeout:void 0,lt=typeof Promise=="function"?Promise:void 0,pt=typeof queueMicrotask=="function"?queueMicrotask:typeof lt<"u"?function(e){return lt.resolve(null).then(e).catch(fa)}:Ne;function fa(e){setTimeout(function(){throw e})}function Jn(e){return e==="head"}function Su(e,a){var i=a,r=0;do{var c=i.nextSibling;if(e.removeChild(i),c&&c.nodeType===8)if(i=c.data,i==="/$"||i==="/&"){if(r===0){e.removeChild(c),od(a);return}r--}else if(i==="$"||i==="$?"||i==="$~"||i==="$!"||i==="&")r++;else if(i==="html")Cp(e.ownerDocument.documentElement);else if(i==="head"){i=e.ownerDocument.head,Cp(i);for(var h=i.firstChild;h;){var _=h.nextSibling,k=h.nodeName;h[nr]||k==="SCRIPT"||k==="STYLE"||k==="LINK"&&h.rel.toLowerCase()==="stylesheet"||i.removeChild(h),h=_}}else i==="body"&&Cp(e.ownerDocument.body);i=c}while(i);od(a)}function Sp(e,a){var i=e;e=0;do{var r=i.nextSibling;if(i.nodeType===1?a?(i._stashedDisplay=i.style.display,i.style.display="none"):(i.style.display=i._stashedDisplay||"",i.getAttribute("style")===""&&i.removeAttribute("style")):i.nodeType===3&&(a?(i._stashedText=i.nodeValue,i.nodeValue=""):i.nodeValue=i._stashedText||""),r&&r.nodeType===8)if(i=r.data,i==="/$"){if(e===0)break;e--}else i!=="$"&&i!=="$?"&&i!=="$~"&&i!=="$!"||e++;i=r}while(i)}function Ep(e){var a=e.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var i=a;switch(a=a.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":Ep(i),Ms(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function ys(e,a,i,r){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==a.toLowerCase()){if(!r&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(r){if(!e[nr])switch(a){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(a==="input"&&e.type==="hidden"){var h=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=ei(e.nextSibling),e===null)break}return null}function vs(e,a,i){if(a==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=ei(e.nextSibling),e===null))return null;return e}function mo(e,a){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=ei(e.nextSibling),e===null))return null;return e}function Ca(e){return e.data==="$?"||e.data==="$~"}function pa(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Dr(e,a){var i=e.ownerDocument;if(e.data==="$~")e._reactRetry=a;else if(e.data!=="$?"||i.readyState!=="loading")a();else{var r=function(){a(),i.removeEventListener("DOMContentLoaded",r)};i.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}function ei(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return e}var Tp=null;function Cg(e){e=e.nextSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"||i==="/&"){if(a===0)return ei(e.nextSibling);a--}else i!=="$"&&i!=="$!"&&i!=="$?"&&i!=="$~"&&i!=="&"||a++}e=e.nextSibling}return null}function zg(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"){if(a===0)return e;a--}else i!=="/$"&&i!=="/&"||a++}e=e.previousSibling}return null}function Ag(e,a,i){switch(a=Tt(i),e){case"html":if(e=a.documentElement,!e)throw Error(y(452));return e;case"head":if(e=a.head,!e)throw Error(y(453));return e;case"body":if(e=a.body,!e)throw Error(y(454));return e;default:throw Error(y(451))}}function Cp(e){for(var a=e.attributes;a.length;)e.removeAttributeNode(a[0]);Ms(e)}var Ki=new Map,Og=new Set;function em(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var hl=Oe.d;Oe.d={f:F0,r:K0,D:W0,C:Q0,L:Y0,m:X0,X:J0,S:Z0,M:ev};function F0(){var e=hl.f(),a=gu();return e||a}function K0(e){var a=bi(e);a!==null&&a.tag===5&&a.type==="form"?Li(a):hl.r(e)}var rd=typeof document>"u"?null:document;function Rg(e,a,i){var r=rd;if(r&&typeof a=="string"&&a){var c=ja(a);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Og.has(c)||(Og.add(c),e={rel:e,crossOrigin:i,href:a},r.querySelector(c)===null&&(a=r.createElement("link"),ve(a,"link",e),jt(a),r.head.appendChild(a)))}}function W0(e){hl.D(e),Rg("dns-prefetch",e,null)}function Q0(e,a){hl.C(e,a),Rg("preconnect",e,a)}function Y0(e,a,i){hl.L(e,a,i);var r=rd;if(r&&e&&a){var c='link[rel="preload"][as="'+ja(a)+'"]';a==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ja(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ja(i.imageSizes)+'"]')):c+='[href="'+ja(e)+'"]';var h=c;switch(a){case"style":h=sd(e);break;case"script":h=ld(e)}Ki.has(h)||(e=q({rel:"preload",href:a==="image"&&i&&i.imageSrcSet?void 0:e,as:a},i),Ki.set(h,e),r.querySelector(c)!==null||a==="style"&&r.querySelector(zp(h))||a==="script"&&r.querySelector(Ap(h))||(a=r.createElement("link"),ve(a,"link",e),jt(a),r.head.appendChild(a)))}}function X0(e,a){hl.m(e,a);var i=rd;if(i&&e){var r=a&&typeof a.as=="string"?a.as:"script",c='link[rel="modulepreload"][as="'+ja(r)+'"][href="'+ja(e)+'"]',h=c;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=ld(e)}if(!Ki.has(h)&&(e=q({rel:"modulepreload",href:e},a),Ki.set(h,e),i.querySelector(c)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Ap(h)))return}r=i.createElement("link"),ve(r,"link",e),jt(r),i.head.appendChild(r)}}}function Z0(e,a,i){hl.S(e,a,i);var r=rd;if(r&&e){var c=Fr(r).hoistableStyles,h=sd(e);a=a||"default";var _=c.get(h);if(!_){var k={loading:0,preload:null};if(_=r.querySelector(zp(h)))k.loading=5;else{e=q({rel:"stylesheet",href:e,"data-precedence":a},i),(i=Ki.get(h))&&Dm(e,i);var P=_=r.createElement("link");jt(P),ve(P,"link",e),P._p=new Promise(function(oe,Se){P.onload=oe,P.onerror=Se}),P.addEventListener("load",function(){k.loading|=1}),P.addEventListener("error",function(){k.loading|=2}),k.loading|=4,tm(_,a,r)}_={type:"stylesheet",instance:_,count:1,state:k},c.set(h,_)}}}function J0(e,a){hl.X(e,a);var i=rd;if(i&&e){var r=Fr(i).hoistableScripts,c=ld(e),h=r.get(c);h||(h=i.querySelector(Ap(c)),h||(e=q({src:e,async:!0},a),(a=Ki.get(c))&&Bm(e,a),h=i.createElement("script"),jt(h),ve(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},r.set(c,h))}}function ev(e,a){hl.M(e,a);var i=rd;if(i&&e){var r=Fr(i).hoistableScripts,c=ld(e),h=r.get(c);h||(h=i.querySelector(Ap(c)),h||(e=q({src:e,async:!0,type:"module"},a),(a=Ki.get(c))&&Bm(e,a),h=i.createElement("script"),jt(h),ve(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},r.set(c,h))}}function Mg(e,a,i,r){var c=(c=wt.current)?em(c):null;if(!c)throw Error(y(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(a=sd(i.href),i=Fr(c).hoistableStyles,r=i.get(a),r||(r={type:"style",instance:null,count:0,state:null},i.set(a,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=sd(i.href);var h=Fr(c).hoistableStyles,_=h.get(e);if(_||(c=c.ownerDocument||c,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,_),(h=c.querySelector(zp(e)))&&!h._p&&(_.instance=h,_.state.loading=5),Ki.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},Ki.set(e,i),h||tv(c,e,i,_.state))),a&&r===null)throw Error(y(528,""));return _}if(a&&r!==null)throw Error(y(529,""));return null;case"script":return a=i.async,i=i.src,typeof i=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=ld(i),i=Fr(c).hoistableScripts,r=i.get(a),r||(r={type:"script",instance:null,count:0,state:null},i.set(a,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(y(444,e))}}function sd(e){return'href="'+ja(e)+'"'}function zp(e){return'link[rel="stylesheet"]['+e+"]"}function kg(e){return q({},e,{"data-precedence":e.precedence,precedence:null})}function tv(e,a,i,r){e.querySelector('link[rel="preload"][as="style"]['+a+"]")?r.loading=1:(a=e.createElement("link"),r.preload=a,a.addEventListener("load",function(){return r.loading|=1}),a.addEventListener("error",function(){return r.loading|=2}),ve(a,"link",i),jt(a),e.head.appendChild(a))}function ld(e){return'[src="'+ja(e)+'"]'}function Ap(e){return"script[async]"+e}function Dg(e,a,i){if(a.count++,a.instance===null)switch(a.type){case"style":var r=e.querySelector('style[data-href~="'+ja(i.href)+'"]');if(r)return a.instance=r,jt(r),r;var c=q({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return r=(e.ownerDocument||e).createElement("style"),jt(r),ve(r,"style",c),tm(r,i.precedence,e),a.instance=r;case"stylesheet":c=sd(i.href);var h=e.querySelector(zp(c));if(h)return a.state.loading|=4,a.instance=h,jt(h),h;r=kg(i),(c=Ki.get(c))&&Dm(r,c),h=(e.ownerDocument||e).createElement("link"),jt(h);var _=h;return _._p=new Promise(function(k,P){_.onload=k,_.onerror=P}),ve(h,"link",r),a.state.loading|=4,tm(h,i.precedence,e),a.instance=h;case"script":return h=ld(i.src),(c=e.querySelector(Ap(h)))?(a.instance=c,jt(c),c):(r=i,(c=Ki.get(h))&&(r=q({},i),Bm(r,c)),e=e.ownerDocument||e,c=e.createElement("script"),jt(c),ve(c,"link",r),e.head.appendChild(c),a.instance=c);case"void":return null;default:throw Error(y(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(r=a.instance,a.state.loading|=4,tm(r,i.precedence,e));return a.instance}function tm(e,a,i){for(var r=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=r.length?r[r.length-1]:null,h=c,_=0;_<r.length;_++){var k=r[_];if(k.dataset.precedence===a)h=k;else if(h!==c)break}h?h.parentNode.insertBefore(e,h.nextSibling):(a=i.nodeType===9?i.head:i,a.insertBefore(e,a.firstChild))}function Dm(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.title==null&&(e.title=a.title)}function Bm(e,a){e.crossOrigin==null&&(e.crossOrigin=a.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=a.referrerPolicy),e.integrity==null&&(e.integrity=a.integrity)}var am=null;function Bg(e,a,i){if(am===null){var r=new Map,c=am=new Map;c.set(i,r)}else c=am,r=c.get(i),r||(r=new Map,c.set(i,r));if(r.has(e))return r;for(r.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var h=i[c];if(!(h[nr]||h[St]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var _=h.getAttribute(a)||"";_=e+_;var k=r.get(_);k?k.push(h):r.set(_,[h])}}return r}function Ng(e,a,i){e=e.ownerDocument||e,e.head.insertBefore(i,a==="title"?e.querySelector("head > title"):null)}function av(e,a,i){if(i===1||a.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return e=a.disabled,typeof a.precedence=="string"&&e==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ug(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function nv(e,a,i,r){if(i.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var c=sd(r.href),h=a.querySelector(zp(c));if(h){a=h._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(e.count++,e=nm.bind(e),a.then(e,e)),i.state.loading|=4,i.instance=h,jt(h);return}h=a.ownerDocument||a,r=kg(r),(c=Ki.get(c))&&Dm(r,c),h=h.createElement("link"),jt(h);var _=h;_._p=new Promise(function(k,P){_.onload=k,_.onerror=P}),ve(h,"link",r),i.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(i,a),(a=i.state.preload)&&(i.state.loading&3)===0&&(e.count++,i=nm.bind(e),a.addEventListener("load",i),a.addEventListener("error",i))}}var Nm=0;function iv(e,a){return e.stylesheets&&e.count===0&&rm(e,e.stylesheets),0<e.count||0<e.imgCount?function(i){var r=setTimeout(function(){if(e.stylesheets&&rm(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+a);0<e.imgBytes&&Nm===0&&(Nm=62500*Fe());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&rm(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>Nm?50:800)+a);return e.unsuspend=i,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(c)}}:null}function nm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)rm(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var im=null;function rm(e,a){e.stylesheets=null,e.unsuspend!==null&&(e.count++,im=new Map,a.forEach(rv,e),im=null,nm.call(e))}function rv(e,a){if(!(a.state.loading&4)){var i=im.get(e);if(i)var r=i.get(null);else{i=new Map,im.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<c.length;h++){var _=c[h];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(i.set(_.dataset.precedence,_),r=_)}r&&i.set(null,r)}c=a.instance,_=c.getAttribute("data-precedence"),h=i.get(_)||r,h===r&&i.set(null,c),i.set(_,c),this.count++,r=nm.bind(this),c.addEventListener("load",r),c.addEventListener("error",r),h?h.parentNode.insertBefore(c,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),a.state.loading|=4}}var Op={$$typeof:me,Provider:null,Consumer:null,_currentValue:Pe,_currentValue2:Pe,_threadCount:0};function sv(e,a,i,r,c,h,_,k,P){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=er(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=er(0),this.hiddenUpdates=er(null),this.identifierPrefix=r,this.onUncaughtError=c,this.onCaughtError=h,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function Ig(e,a,i,r,c,h,_,k,P,oe,Se,Ae){return e=new sv(e,a,i,_,P,oe,Se,Ae,k),a=1,h===!0&&(a|=24),h=mn(3,null,null,a),e.current=h,h.stateNode=e,a=nc(),a.refCount++,e.pooledCache=a,a.refCount++,h.memoizedState={element:r,isDehydrated:i,cache:a},lc(h),e}function Lg(e){return e?(e=Fs,e):Fs}function qg(e,a,i,r,c,h){c=Lg(c),r.context===null?r.context=c:r.pendingContext=c,r=Ui(a),r.payload={element:i},h=h===void 0?null:h,h!==null&&(r.callback=h),i=_r(e,r,a),i!==null&&(cn(i,e,a),Wl(i,e,a))}function jg(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<a?i:a}}function Um(e,a){jg(e,a),(e=e.alternate)&&jg(e,a)}function Gg(e){if(e.tag===13||e.tag===31){var a=is(e,67108864);a!==null&&cn(a,e,67108864),Um(e,67108864)}}function Vg(e){if(e.tag===13||e.tag===31){var a=_n();a=Os(a);var i=is(e,a);i!==null&&cn(i,e,a),Um(e,a)}}var sm=!0;function lv(e,a,i,r){var c=_e.T;_e.T=null;var h=Oe.p;try{Oe.p=2,Im(e,a,i,r)}finally{Oe.p=h,_e.T=c}}function ov(e,a,i,r){var c=_e.T;_e.T=null;var h=Oe.p;try{Oe.p=8,Im(e,a,i,r)}finally{Oe.p=h,_e.T=c}}function Im(e,a,i,r){if(sm){var c=Lm(r);if(c===null)A(e,a,r,lm,i),Pg(e,r);else if(cv(c,e,a,i,r))r.stopPropagation();else if(Pg(e,r),a&4&&-1<uv.indexOf(e)){for(;c!==null;){var h=bi(c);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var _=ai(h.pendingLanes);if(_!==0){var k=h;for(k.pendingLanes|=2,k.entangledLanes|=2;_;){var P=1<<31-La(_);k.entanglements[1]|=P,_&=~P}pi(h),(qt&6)===0&&(pu=en()+500,$u(0))}}break;case 31:case 13:k=is(h,2),k!==null&&cn(k,h,2),gu(),Um(h,2)}if(h=Lm(r),h===null&&A(e,a,r,lm,i),h===c)break;c=h}c!==null&&r.stopPropagation()}else A(e,a,r,null,i)}}function Lm(e){return e=Xr(e),qm(e)}var lm=null;function qm(e){if(lm=null,e=Qa(e),e!==null){var a=E(e);if(a===null)e=null;else{var i=a.tag;if(i===13){if(e=R(a),e!==null)return e;e=null}else if(i===31){if(e=D(a),e!==null)return e;e=null}else if(i===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null)}}return lm=e,null}function Hg(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ed()){case Bu:return 2;case Sl:return 8;case oa:case Es:return 32;case El:return 268435456;default:return 32}default:return 32}}var jm=!1,go=null,yo=null,vo=null,Rp=new Map,Mp=new Map,bo=[],uv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pg(e,a){switch(e){case"focusin":case"focusout":go=null;break;case"dragenter":case"dragleave":yo=null;break;case"mouseover":case"mouseout":vo=null;break;case"pointerover":case"pointerout":Rp.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mp.delete(a.pointerId)}}function kp(e,a,i,r,c,h){return e===null||e.nativeEvent!==h?(e={blockedOn:a,domEventName:i,eventSystemFlags:r,nativeEvent:h,targetContainers:[c]},a!==null&&(a=bi(a),a!==null&&Gg(a)),e):(e.eventSystemFlags|=r,a=e.targetContainers,c!==null&&a.indexOf(c)===-1&&a.push(c),e)}function cv(e,a,i,r,c){switch(a){case"focusin":return go=kp(go,e,a,i,r,c),!0;case"dragenter":return yo=kp(yo,e,a,i,r,c),!0;case"mouseover":return vo=kp(vo,e,a,i,r,c),!0;case"pointerover":var h=c.pointerId;return Rp.set(h,kp(Rp.get(h)||null,e,a,i,r,c)),!0;case"gotpointercapture":return h=c.pointerId,Mp.set(h,kp(Mp.get(h)||null,e,a,i,r,c)),!0}return!1}function Fg(e){var a=Qa(e.target);if(a!==null){var i=E(a);if(i!==null){if(a=i.tag,a===13){if(a=R(i),a!==null){e.blockedOn=a,st(e.priority,function(){Vg(i)});return}}else if(a===31){if(a=D(i),a!==null){e.blockedOn=a,st(e.priority,function(){Vg(i)});return}}else if(a===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function om(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var i=Lm(e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);Yr=r,i.target.dispatchEvent(r),Yr=null}else return a=bi(i),a!==null&&Gg(a),e.blockedOn=i,!1;a.shift()}return!0}function Kg(e,a,i){om(e)&&i.delete(a)}function dv(){jm=!1,go!==null&&om(go)&&(go=null),yo!==null&&om(yo)&&(yo=null),vo!==null&&om(vo)&&(vo=null),Rp.forEach(Kg),Mp.forEach(Kg)}function um(e,a){e.blockedOn===a&&(e.blockedOn=null,jm||(jm=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,dv)))}var cm=null;function Wg(e){cm!==e&&(cm=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){cm===e&&(cm=null);for(var a=0;a<e.length;a+=3){var i=e[a],r=e[a+1],c=e[a+2];if(typeof r!="function"){if(qm(r||i)===null)continue;break}var h=bi(i);h!==null&&(e.splice(a,3),a-=3,Cf(h,{pending:!0,data:c,method:i.method,action:r},r,c))}}))}function od(e){function a(P){return um(P,e)}go!==null&&um(go,e),yo!==null&&um(yo,e),vo!==null&&um(vo,e),Rp.forEach(a),Mp.forEach(a);for(var i=0;i<bo.length;i++){var r=bo[i];r.blockedOn===e&&(r.blockedOn=null)}for(;0<bo.length&&(i=bo[0],i.blockedOn===null);)Fg(i),i.blockedOn===null&&bo.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(r=0;r<i.length;r+=3){var c=i[r],h=i[r+1],_=c[ya]||null;if(typeof h=="function")_||Wg(i);else if(_){var k=null;if(h&&h.hasAttribute("formAction")){if(c=h,_=h[ya]||null)k=_.formAction;else if(qm(c)!==null)continue}else k=_.action;typeof k=="function"?i[r+1]=k:(i.splice(r,3),r-=3),Wg(i)}}}function Qg(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(_){return c=_})},focusReset:"manual",scroll:"manual"})}function a(){c!==null&&(c(),c=null),r||setTimeout(i,20)}function i(){if(!r&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var r=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(i,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),c!==null&&(c(),c=null)}}}function Gm(e){this._internalRoot=e}dm.prototype.render=Gm.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(y(409));var i=a.current,r=_n();qg(i,r,e,a,null,null)},dm.prototype.unmount=Gm.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;qg(e.current,2,null,e,null,null),gu(),a[Ke]=null}};function dm(e){this._internalRoot=e}dm.prototype.unstable_scheduleHydration=function(e){if(e){var a=Pr();e={blockedOn:null,target:e,priority:a};for(var i=0;i<bo.length&&a!==0&&a<bo[i].priority;i++);bo.splice(i,0,e),i===0&&Fg(e)}};var Yg=d.version;if(Yg!=="19.2.4")throw Error(y(527,Yg,"19.2.4"));Oe.findDOMNode=function(e){var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(y(188)):(e=Object.keys(e).join(","),Error(y(268,e)));return e=M(a),e=e!==null?H(e):null,e=e===null?null:e.stateNode,e};var fv={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:_e,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fm.isDisabled&&fm.supportsFiber)try{Xi=fm.inject(fv),tn=fm}catch{}}return Bp.createRoot=function(e,a){if(!$(e))throw Error(y(299));var i=!1,r="",c=Df,h=Bf,_=Nf;return a!=null&&(a.unstable_strictMode===!0&&(i=!0),a.identifierPrefix!==void 0&&(r=a.identifierPrefix),a.onUncaughtError!==void 0&&(c=a.onUncaughtError),a.onCaughtError!==void 0&&(h=a.onCaughtError),a.onRecoverableError!==void 0&&(_=a.onRecoverableError)),a=Ig(e,1,!1,null,null,i,r,null,c,h,_,Qg),e[Ke]=a.current,C(e),new Gm(a)},Bp.hydrateRoot=function(e,a,i){if(!$(e))throw Error(y(299));var r=!1,c="",h=Df,_=Bf,k=Nf,P=null;return i!=null&&(i.unstable_strictMode===!0&&(r=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(h=i.onUncaughtError),i.onCaughtError!==void 0&&(_=i.onCaughtError),i.onRecoverableError!==void 0&&(k=i.onRecoverableError),i.formState!==void 0&&(P=i.formState)),a=Ig(e,1,!0,a,i??null,r,c,P,h,_,k,Qg),a.context=Lg(null),i=a.current,r=_n(),r=Os(r),c=Ui(r),c.callback=null,_r(i,c,r),i=r,a.current.lanes=i,ni(a,i),pi(a),e[Ke]=a.current,C(e),new dm(a)},Bp.version="19.2.4",Bp}var ly;function Ev(){if(ly)return Fm.exports;ly=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(d){console.error(d)}}return o(),Fm.exports=Sv(),Fm.exports}var Tv=Ev(),Em=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(o){return this.listeners.add(o),this.onSubscribe(),()=>{this.listeners.delete(o),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Cv={setTimeout:(o,d)=>setTimeout(o,d),clearTimeout:o=>clearTimeout(o),setInterval:(o,d)=>setInterval(o,d),clearInterval:o=>clearInterval(o)},So,pg,Yy,zv=(Yy=class{constructor(){It(this,So,Cv);It(this,pg,!1)}setTimeoutProvider(o){vt(this,So,o)}setTimeout(o,d){return Te(this,So).setTimeout(o,d)}clearTimeout(o){Te(this,So).clearTimeout(o)}setInterval(o,d){return Te(this,So).setInterval(o,d)}clearInterval(o){Te(this,So).clearInterval(o)}},So=new WeakMap,pg=new WeakMap,Yy),rg=new zv;function Av(o){setTimeout(o,0)}var Tm=typeof window>"u"||"Deno"in globalThis;function Nr(){}function Ov(o,d){return typeof o=="function"?o(d):o}function Rv(o){return typeof o=="number"&&o>=0&&o!==1/0}function Mv(o,d){return Math.max(o+(d||0)-Date.now(),0)}function sg(o,d){return typeof o=="function"?o(d):o}function kv(o,d){return typeof o=="function"?o(d):o}function oy(o,d){const{type:m="all",exact:y,fetchStatus:$,predicate:E,queryKey:R,stale:D}=o;if(R){if(y){if(d.queryHash!==mg(R,d.options))return!1}else if(!Zp(d.queryKey,R))return!1}if(m!=="all"){const T=d.isActive();if(m==="active"&&!T||m==="inactive"&&T)return!1}return!(typeof D=="boolean"&&d.isStale()!==D||$&&$!==d.state.fetchStatus||E&&!E(d))}function uy(o,d){const{exact:m,status:y,predicate:$,mutationKey:E}=o;if(E){if(!d.options.mutationKey)return!1;if(m){if(Xp(d.options.mutationKey)!==Xp(E))return!1}else if(!Zp(d.options.mutationKey,E))return!1}return!(y&&d.state.status!==y||$&&!$(d))}function mg(o,d){return((d==null?void 0:d.queryKeyHashFn)||Xp)(o)}function Xp(o){return JSON.stringify(o,(d,m)=>lg(m)?Object.keys(m).sort().reduce((y,$)=>(y[$]=m[$],y),{}):m)}function Zp(o,d){return o===d?!0:typeof o!=typeof d?!1:o&&d&&typeof o=="object"&&typeof d=="object"?Object.keys(d).every(m=>Zp(o[m],d[m])):!1}var Dv=Object.prototype.hasOwnProperty;function r0(o,d,m=0){if(o===d)return o;if(m>500)return d;const y=cy(o)&&cy(d);if(!y&&!(lg(o)&&lg(d)))return d;const E=(y?o:Object.keys(o)).length,R=y?d:Object.keys(d),D=R.length,T=y?new Array(D):{};let M=0;for(let H=0;H<D;H++){const q=y?H:R[H],Z=o[q],se=d[q];if(Z===se){T[q]=Z,(y?H<E:Dv.call(o,q))&&M++;continue}if(Z===null||se===null||typeof Z!="object"||typeof se!="object"){T[q]=se;continue}const ce=r0(Z,se,m+1);T[q]=ce,ce===Z&&M++}return E===D&&M===E?o:T}function cy(o){return Array.isArray(o)&&o.length===Object.keys(o).length}function lg(o){if(!dy(o))return!1;const d=o.constructor;if(d===void 0)return!0;const m=d.prototype;return!(!dy(m)||!m.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(o)!==Object.prototype)}function dy(o){return Object.prototype.toString.call(o)==="[object Object]"}function Bv(o){return new Promise(d=>{rg.setTimeout(d,o)})}function Nv(o,d,m){return typeof m.structuralSharing=="function"?m.structuralSharing(o,d):m.structuralSharing!==!1?r0(o,d):d}function Uv(o,d,m=0){const y=[...o,d];return m&&y.length>m?y.slice(1):y}function Iv(o,d,m=0){const y=[d,...o];return m&&y.length>m?y.slice(0,-1):y}var gg=Symbol();function s0(o,d){return!o.queryFn&&(d!=null&&d.initialPromise)?()=>d.initialPromise:!o.queryFn||o.queryFn===gg?()=>Promise.reject(new Error(`Missing queryFn: '${o.queryHash}'`)):o.queryFn}function Lv(o,d,m){let y=!1,$;return Object.defineProperty(o,"signal",{enumerable:!0,get:()=>($??($=d()),y||(y=!0,$.aborted?m():$.addEventListener("abort",m,{once:!0})),$)}),o}var zu,Eo,cd,Xy,qv=(Xy=class extends Em{constructor(){super();It(this,zu);It(this,Eo);It(this,cd);vt(this,cd,d=>{if(!Tm&&window.addEventListener){const m=()=>d();return window.addEventListener("visibilitychange",m,!1),()=>{window.removeEventListener("visibilitychange",m)}}})}onSubscribe(){Te(this,Eo)||this.setEventListener(Te(this,cd))}onUnsubscribe(){var d;this.hasListeners()||((d=Te(this,Eo))==null||d.call(this),vt(this,Eo,void 0))}setEventListener(d){var m;vt(this,cd,d),(m=Te(this,Eo))==null||m.call(this),vt(this,Eo,d(y=>{typeof y=="boolean"?this.setFocused(y):this.onFocus()}))}setFocused(d){Te(this,zu)!==d&&(vt(this,zu,d),this.onFocus())}onFocus(){const d=this.isFocused();this.listeners.forEach(m=>{m(d)})}isFocused(){var d;return typeof Te(this,zu)=="boolean"?Te(this,zu):((d=globalThis.document)==null?void 0:d.visibilityState)!=="hidden"}},zu=new WeakMap,Eo=new WeakMap,cd=new WeakMap,Xy),l0=new qv;function jv(){let o,d;const m=new Promise(($,E)=>{o=$,d=E});m.status="pending",m.catch(()=>{});function y($){Object.assign(m,$),delete m.resolve,delete m.reject}return m.resolve=$=>{y({status:"fulfilled",value:$}),o($)},m.reject=$=>{y({status:"rejected",reason:$}),d($)},m}var Gv=Av;function Vv(){let o=[],d=0,m=D=>{D()},y=D=>{D()},$=Gv;const E=D=>{d?o.push(D):$(()=>{m(D)})},R=()=>{const D=o;o=[],D.length&&$(()=>{y(()=>{D.forEach(T=>{m(T)})})})};return{batch:D=>{let T;d++;try{T=D()}finally{d--,d||R()}return T},batchCalls:D=>(...T)=>{E(()=>{D(...T)})},schedule:E,setNotifyFunction:D=>{m=D},setBatchNotifyFunction:D=>{y=D},setScheduler:D=>{$=D}}}var Bn=Vv(),dd,To,fd,Zy,Hv=(Zy=class extends Em{constructor(){super();It(this,dd,!0);It(this,To);It(this,fd);vt(this,fd,d=>{if(!Tm&&window.addEventListener){const m=()=>d(!0),y=()=>d(!1);return window.addEventListener("online",m,!1),window.addEventListener("offline",y,!1),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",y)}}})}onSubscribe(){Te(this,To)||this.setEventListener(Te(this,fd))}onUnsubscribe(){var d;this.hasListeners()||((d=Te(this,To))==null||d.call(this),vt(this,To,void 0))}setEventListener(d){var m;vt(this,fd,d),(m=Te(this,To))==null||m.call(this),vt(this,To,d(this.setOnline.bind(this)))}setOnline(d){Te(this,dd)!==d&&(vt(this,dd,d),this.listeners.forEach(y=>{y(d)}))}isOnline(){return Te(this,dd)}},dd=new WeakMap,To=new WeakMap,fd=new WeakMap,Zy),xm=new Hv;function Pv(o){return Math.min(1e3*2**o,3e4)}function o0(o){return(o??"online")==="online"?xm.isOnline():!0}var og=class extends Error{constructor(o){super("CancelledError"),this.revert=o==null?void 0:o.revert,this.silent=o==null?void 0:o.silent}};function u0(o){let d=!1,m=0,y;const $=jv(),E=()=>$.status!=="pending",R=ee=>{var he;if(!E()){const $e=new og(ee);Z($e),(he=o.onCancel)==null||he.call(o,$e)}},D=()=>{d=!0},T=()=>{d=!1},M=()=>l0.isFocused()&&(o.networkMode==="always"||xm.isOnline())&&o.canRun(),H=()=>o0(o.networkMode)&&o.canRun(),q=ee=>{E()||(y==null||y(),$.resolve(ee))},Z=ee=>{E()||(y==null||y(),$.reject(ee))},se=()=>new Promise(ee=>{var he;y=$e=>{(E()||M())&&ee($e)},(he=o.onPause)==null||he.call(o)}).then(()=>{var ee;y=void 0,E()||(ee=o.onContinue)==null||ee.call(o)}),ce=()=>{if(E())return;let ee;const he=m===0?o.initialPromise:void 0;try{ee=he??o.fn()}catch($e){ee=Promise.reject($e)}Promise.resolve(ee).then(q).catch($e=>{var Be;if(E())return;const De=o.retry??(Tm?0:3),me=o.retryDelay??Pv,be=typeof me=="function"?me(m,$e):me,Me=De===!0||typeof De=="number"&&m<De||typeof De=="function"&&De(m,$e);if(d||!Me){Z($e);return}m++,(Be=o.onFail)==null||Be.call(o,m,$e),Bv(be).then(()=>M()?void 0:se()).then(()=>{d?Z($e):ce()})})};return{promise:$,status:()=>$.status,cancel:R,continue:()=>(y==null||y(),$),cancelRetry:D,continueRetry:T,canStart:H,start:()=>(H()?ce():se().then(ce),$)}}var Au,Jy,c0=(Jy=class{constructor(){It(this,Au)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Rv(this.gcTime)&&vt(this,Au,rg.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(o){this.gcTime=Math.max(this.gcTime||0,o??(Tm?1/0:300*1e3))}clearGcTimeout(){Te(this,Au)&&(rg.clearTimeout(Te(this,Au)),vt(this,Au,void 0))}},Au=new WeakMap,Jy),Ou,pd,Wi,Ru,Ja,eh,Mu,Ur,bl,e0,Fv=(e0=class extends c0{constructor(d){super();It(this,Ur);It(this,Ou);It(this,pd);It(this,Wi);It(this,Ru);It(this,Ja);It(this,eh);It(this,Mu);vt(this,Mu,!1),vt(this,eh,d.defaultOptions),this.setOptions(d.options),this.observers=[],vt(this,Ru,d.client),vt(this,Wi,Te(this,Ru).getQueryCache()),this.queryKey=d.queryKey,this.queryHash=d.queryHash,vt(this,Ou,py(this.options)),this.state=d.state??Te(this,Ou),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var d;return(d=Te(this,Ja))==null?void 0:d.promise}setOptions(d){if(this.options={...Te(this,eh),...d},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const m=py(this.options);m.data!==void 0&&(this.setState(fy(m.data,m.dataUpdatedAt)),vt(this,Ou,m))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Te(this,Wi).remove(this)}setData(d,m){const y=Nv(this.state.data,d,this.options);return wn(this,Ur,bl).call(this,{data:y,type:"success",dataUpdatedAt:m==null?void 0:m.updatedAt,manual:m==null?void 0:m.manual}),y}setState(d,m){wn(this,Ur,bl).call(this,{type:"setState",state:d,setStateOptions:m})}cancel(d){var y,$;const m=(y=Te(this,Ja))==null?void 0:y.promise;return($=Te(this,Ja))==null||$.cancel(d),m?m.then(Nr).catch(Nr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Te(this,Ou))}isActive(){return this.observers.some(d=>kv(d.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===gg||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(d=>sg(d.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(d=>d.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(d=0){return this.state.data===void 0?!0:d==="static"?!1:this.state.isInvalidated?!0:!Mv(this.state.dataUpdatedAt,d)}onFocus(){var m;const d=this.observers.find(y=>y.shouldFetchOnWindowFocus());d==null||d.refetch({cancelRefetch:!1}),(m=Te(this,Ja))==null||m.continue()}onOnline(){var m;const d=this.observers.find(y=>y.shouldFetchOnReconnect());d==null||d.refetch({cancelRefetch:!1}),(m=Te(this,Ja))==null||m.continue()}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),Te(this,Wi).notify({type:"observerAdded",query:this,observer:d}))}removeObserver(d){this.observers.includes(d)&&(this.observers=this.observers.filter(m=>m!==d),this.observers.length||(Te(this,Ja)&&(Te(this,Mu)?Te(this,Ja).cancel({revert:!0}):Te(this,Ja).cancelRetry()),this.scheduleGc()),Te(this,Wi).notify({type:"observerRemoved",query:this,observer:d}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||wn(this,Ur,bl).call(this,{type:"invalidate"})}async fetch(d,m){var T,M,H,q,Z,se,ce,ee,he,$e,De,me;if(this.state.fetchStatus!=="idle"&&((T=Te(this,Ja))==null?void 0:T.status())!=="rejected"){if(this.state.data!==void 0&&(m!=null&&m.cancelRefetch))this.cancel({silent:!0});else if(Te(this,Ja))return Te(this,Ja).continueRetry(),Te(this,Ja).promise}if(d&&this.setOptions(d),!this.options.queryFn){const be=this.observers.find(Me=>Me.options.queryFn);be&&this.setOptions(be.options)}const y=new AbortController,$=be=>{Object.defineProperty(be,"signal",{enumerable:!0,get:()=>(vt(this,Mu,!0),y.signal)})},E=()=>{const be=s0(this.options,m),Be=(()=>{const qe={client:Te(this,Ru),queryKey:this.queryKey,meta:this.meta};return $(qe),qe})();return vt(this,Mu,!1),this.options.persister?this.options.persister(be,Be,this):be(Be)},D=(()=>{const be={fetchOptions:m,options:this.options,queryKey:this.queryKey,client:Te(this,Ru),state:this.state,fetchFn:E};return $(be),be})();(M=this.options.behavior)==null||M.onFetch(D,this),vt(this,pd,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((H=D.fetchOptions)==null?void 0:H.meta))&&wn(this,Ur,bl).call(this,{type:"fetch",meta:(q=D.fetchOptions)==null?void 0:q.meta}),vt(this,Ja,u0({initialPromise:m==null?void 0:m.initialPromise,fn:D.fetchFn,onCancel:be=>{be instanceof og&&be.revert&&this.setState({...Te(this,pd),fetchStatus:"idle"}),y.abort()},onFail:(be,Me)=>{wn(this,Ur,bl).call(this,{type:"failed",failureCount:be,error:Me})},onPause:()=>{wn(this,Ur,bl).call(this,{type:"pause"})},onContinue:()=>{wn(this,Ur,bl).call(this,{type:"continue"})},retry:D.options.retry,retryDelay:D.options.retryDelay,networkMode:D.options.networkMode,canRun:()=>!0}));try{const be=await Te(this,Ja).start();if(be===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(be),(se=(Z=Te(this,Wi).config).onSuccess)==null||se.call(Z,be,this),(ee=(ce=Te(this,Wi).config).onSettled)==null||ee.call(ce,be,this.state.error,this),be}catch(be){if(be instanceof og){if(be.silent)return Te(this,Ja).promise;if(be.revert){if(this.state.data===void 0)throw be;return this.state.data}}throw wn(this,Ur,bl).call(this,{type:"error",error:be}),($e=(he=Te(this,Wi).config).onError)==null||$e.call(he,be,this),(me=(De=Te(this,Wi).config).onSettled)==null||me.call(De,this.state.data,be,this),be}finally{this.scheduleGc()}}},Ou=new WeakMap,pd=new WeakMap,Wi=new WeakMap,Ru=new WeakMap,Ja=new WeakMap,eh=new WeakMap,Mu=new WeakMap,Ur=new WeakSet,bl=function(d){const m=y=>{switch(d.type){case"failed":return{...y,fetchFailureCount:d.failureCount,fetchFailureReason:d.error};case"pause":return{...y,fetchStatus:"paused"};case"continue":return{...y,fetchStatus:"fetching"};case"fetch":return{...y,...Kv(y.data,this.options),fetchMeta:d.meta??null};case"success":const $={...y,...fy(d.data,d.dataUpdatedAt),dataUpdateCount:y.dataUpdateCount+1,...!d.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return vt(this,pd,d.manual?$:void 0),$;case"error":const E=d.error;return{...y,error:E,errorUpdateCount:y.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:y.fetchFailureCount+1,fetchFailureReason:E,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...y,isInvalidated:!0};case"setState":return{...y,...d.state}}};this.state=m(this.state),Bn.batch(()=>{this.observers.forEach(y=>{y.onQueryUpdate()}),Te(this,Wi).notify({query:this,type:"updated",action:d})})},e0);function Kv(o,d){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:o0(d.networkMode)?"fetching":"paused",...o===void 0&&{error:null,status:"pending"}}}function fy(o,d){return{data:o,dataUpdatedAt:d??Date.now(),error:null,isInvalidated:!1,status:"success"}}function py(o){const d=typeof o.initialData=="function"?o.initialData():o.initialData,m=d!==void 0,y=m?typeof o.initialDataUpdatedAt=="function"?o.initialDataUpdatedAt():o.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:m?y??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:m?"success":"pending",fetchStatus:"idle"}}function hy(o){return{onFetch:(d,m)=>{var H,q,Z,se,ce;const y=d.options,$=(Z=(q=(H=d.fetchOptions)==null?void 0:H.meta)==null?void 0:q.fetchMore)==null?void 0:Z.direction,E=((se=d.state.data)==null?void 0:se.pages)||[],R=((ce=d.state.data)==null?void 0:ce.pageParams)||[];let D={pages:[],pageParams:[]},T=0;const M=async()=>{let ee=!1;const he=me=>{Lv(me,()=>d.signal,()=>ee=!0)},$e=s0(d.options,d.fetchOptions),De=async(me,be,Me)=>{if(ee)return Promise.reject();if(be==null&&me.pages.length)return Promise.resolve(me);const qe=(()=>{const et={client:d.client,queryKey:d.queryKey,pageParam:be,direction:Me?"backward":"forward",meta:d.options.meta};return he(et),et})(),Re=await $e(qe),{maxPages:at}=d.options,Xe=Me?Iv:Uv;return{pages:Xe(me.pages,Re,at),pageParams:Xe(me.pageParams,be,at)}};if($&&E.length){const me=$==="backward",be=me?Wv:my,Me={pages:E,pageParams:R},Be=be(y,Me);D=await De(Me,Be,me)}else{const me=o??E.length;do{const be=T===0?R[0]??y.initialPageParam:my(y,D);if(T>0&&be==null)break;D=await De(D,be),T++}while(T<me)}return D};d.options.persister?d.fetchFn=()=>{var ee,he;return(he=(ee=d.options).persister)==null?void 0:he.call(ee,M,{client:d.client,queryKey:d.queryKey,meta:d.options.meta,signal:d.signal},m)}:d.fetchFn=M}}}function my(o,{pages:d,pageParams:m}){const y=d.length-1;return d.length>0?o.getNextPageParam(d[y],d,m[y],m):void 0}function Wv(o,{pages:d,pageParams:m}){var y;return d.length>0?(y=o.getPreviousPageParam)==null?void 0:y.call(o,d[0],d,m[0],m):void 0}var th,bs,$n,ku,_s,$o,t0,Qv=(t0=class extends c0{constructor(d){super();It(this,_s);It(this,th);It(this,bs);It(this,$n);It(this,ku);vt(this,th,d.client),this.mutationId=d.mutationId,vt(this,$n,d.mutationCache),vt(this,bs,[]),this.state=d.state||Yv(),this.setOptions(d.options),this.scheduleGc()}setOptions(d){this.options=d,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(d){Te(this,bs).includes(d)||(Te(this,bs).push(d),this.clearGcTimeout(),Te(this,$n).notify({type:"observerAdded",mutation:this,observer:d}))}removeObserver(d){vt(this,bs,Te(this,bs).filter(m=>m!==d)),this.scheduleGc(),Te(this,$n).notify({type:"observerRemoved",mutation:this,observer:d})}optionalRemove(){Te(this,bs).length||(this.state.status==="pending"?this.scheduleGc():Te(this,$n).remove(this))}continue(){var d;return((d=Te(this,ku))==null?void 0:d.continue())??this.execute(this.state.variables)}async execute(d){var R,D,T,M,H,q,Z,se,ce,ee,he,$e,De,me,be,Me,Be,qe;const m=()=>{wn(this,_s,$o).call(this,{type:"continue"})},y={client:Te(this,th),meta:this.options.meta,mutationKey:this.options.mutationKey};vt(this,ku,u0({fn:()=>this.options.mutationFn?this.options.mutationFn(d,y):Promise.reject(new Error("No mutationFn found")),onFail:(Re,at)=>{wn(this,_s,$o).call(this,{type:"failed",failureCount:Re,error:at})},onPause:()=>{wn(this,_s,$o).call(this,{type:"pause"})},onContinue:m,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Te(this,$n).canRun(this)}));const $=this.state.status==="pending",E=!Te(this,ku).canStart();try{if($)m();else{wn(this,_s,$o).call(this,{type:"pending",variables:d,isPaused:E}),Te(this,$n).config.onMutate&&await Te(this,$n).config.onMutate(d,this,y);const at=await((D=(R=this.options).onMutate)==null?void 0:D.call(R,d,y));at!==this.state.context&&wn(this,_s,$o).call(this,{type:"pending",context:at,variables:d,isPaused:E})}const Re=await Te(this,ku).start();return await((M=(T=Te(this,$n).config).onSuccess)==null?void 0:M.call(T,Re,d,this.state.context,this,y)),await((q=(H=this.options).onSuccess)==null?void 0:q.call(H,Re,d,this.state.context,y)),await((se=(Z=Te(this,$n).config).onSettled)==null?void 0:se.call(Z,Re,null,this.state.variables,this.state.context,this,y)),await((ee=(ce=this.options).onSettled)==null?void 0:ee.call(ce,Re,null,d,this.state.context,y)),wn(this,_s,$o).call(this,{type:"success",data:Re}),Re}catch(Re){try{await(($e=(he=Te(this,$n).config).onError)==null?void 0:$e.call(he,Re,d,this.state.context,this,y))}catch(at){Promise.reject(at)}try{await((me=(De=this.options).onError)==null?void 0:me.call(De,Re,d,this.state.context,y))}catch(at){Promise.reject(at)}try{await((Me=(be=Te(this,$n).config).onSettled)==null?void 0:Me.call(be,void 0,Re,this.state.variables,this.state.context,this,y))}catch(at){Promise.reject(at)}try{await((qe=(Be=this.options).onSettled)==null?void 0:qe.call(Be,void 0,Re,d,this.state.context,y))}catch(at){Promise.reject(at)}throw wn(this,_s,$o).call(this,{type:"error",error:Re}),Re}finally{Te(this,$n).runNext(this)}}},th=new WeakMap,bs=new WeakMap,$n=new WeakMap,ku=new WeakMap,_s=new WeakSet,$o=function(d){const m=y=>{switch(d.type){case"failed":return{...y,failureCount:d.failureCount,failureReason:d.error};case"pause":return{...y,isPaused:!0};case"continue":return{...y,isPaused:!1};case"pending":return{...y,context:d.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:d.isPaused,status:"pending",variables:d.variables,submittedAt:Date.now()};case"success":return{...y,data:d.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...y,data:void 0,error:d.error,failureCount:y.failureCount+1,failureReason:d.error,isPaused:!1,status:"error"}}};this.state=m(this.state),Bn.batch(()=>{Te(this,bs).forEach(y=>{y.onMutationUpdate(d)}),Te(this,$n).notify({mutation:this,type:"updated",action:d})})},t0);function Yv(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var _l,Ir,ah,a0,Xv=(a0=class extends Em{constructor(d={}){super();It(this,_l);It(this,Ir);It(this,ah);this.config=d,vt(this,_l,new Set),vt(this,Ir,new Map),vt(this,ah,0)}build(d,m,y){const $=new Qv({client:d,mutationCache:this,mutationId:++pm(this,ah)._,options:d.defaultMutationOptions(m),state:y});return this.add($),$}add(d){Te(this,_l).add(d);const m=hm(d);if(typeof m=="string"){const y=Te(this,Ir).get(m);y?y.push(d):Te(this,Ir).set(m,[d])}this.notify({type:"added",mutation:d})}remove(d){if(Te(this,_l).delete(d)){const m=hm(d);if(typeof m=="string"){const y=Te(this,Ir).get(m);if(y)if(y.length>1){const $=y.indexOf(d);$!==-1&&y.splice($,1)}else y[0]===d&&Te(this,Ir).delete(m)}}this.notify({type:"removed",mutation:d})}canRun(d){const m=hm(d);if(typeof m=="string"){const y=Te(this,Ir).get(m),$=y==null?void 0:y.find(E=>E.state.status==="pending");return!$||$===d}else return!0}runNext(d){var y;const m=hm(d);if(typeof m=="string"){const $=(y=Te(this,Ir).get(m))==null?void 0:y.find(E=>E!==d&&E.state.isPaused);return($==null?void 0:$.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Bn.batch(()=>{Te(this,_l).forEach(d=>{this.notify({type:"removed",mutation:d})}),Te(this,_l).clear(),Te(this,Ir).clear()})}getAll(){return Array.from(Te(this,_l))}find(d){const m={exact:!0,...d};return this.getAll().find(y=>uy(m,y))}findAll(d={}){return this.getAll().filter(m=>uy(d,m))}notify(d){Bn.batch(()=>{this.listeners.forEach(m=>{m(d)})})}resumePausedMutations(){const d=this.getAll().filter(m=>m.state.isPaused);return Bn.batch(()=>Promise.all(d.map(m=>m.continue().catch(Nr))))}},_l=new WeakMap,Ir=new WeakMap,ah=new WeakMap,a0);function hm(o){var d;return(d=o.options.scope)==null?void 0:d.id}var ws,n0,Zv=(n0=class extends Em{constructor(d={}){super();It(this,ws);this.config=d,vt(this,ws,new Map)}build(d,m,y){const $=m.queryKey,E=m.queryHash??mg($,m);let R=this.get(E);return R||(R=new Fv({client:d,queryKey:$,queryHash:E,options:d.defaultQueryOptions(m),state:y,defaultOptions:d.getQueryDefaults($)}),this.add(R)),R}add(d){Te(this,ws).has(d.queryHash)||(Te(this,ws).set(d.queryHash,d),this.notify({type:"added",query:d}))}remove(d){const m=Te(this,ws).get(d.queryHash);m&&(d.destroy(),m===d&&Te(this,ws).delete(d.queryHash),this.notify({type:"removed",query:d}))}clear(){Bn.batch(()=>{this.getAll().forEach(d=>{this.remove(d)})})}get(d){return Te(this,ws).get(d)}getAll(){return[...Te(this,ws).values()]}find(d){const m={exact:!0,...d};return this.getAll().find(y=>oy(m,y))}findAll(d={}){const m=this.getAll();return Object.keys(d).length>0?m.filter(y=>oy(d,y)):m}notify(d){Bn.batch(()=>{this.listeners.forEach(m=>{m(d)})})}onFocus(){Bn.batch(()=>{this.getAll().forEach(d=>{d.onFocus()})})}onOnline(){Bn.batch(()=>{this.getAll().forEach(d=>{d.onOnline()})})}},ws=new WeakMap,n0),za,Co,zo,hd,md,Ao,gd,yd,i0,Jv=(i0=class{constructor(o={}){It(this,za);It(this,Co);It(this,zo);It(this,hd);It(this,md);It(this,Ao);It(this,gd);It(this,yd);vt(this,za,o.queryCache||new Zv),vt(this,Co,o.mutationCache||new Xv),vt(this,zo,o.defaultOptions||{}),vt(this,hd,new Map),vt(this,md,new Map),vt(this,Ao,0)}mount(){pm(this,Ao)._++,Te(this,Ao)===1&&(vt(this,gd,l0.subscribe(async o=>{o&&(await this.resumePausedMutations(),Te(this,za).onFocus())})),vt(this,yd,xm.subscribe(async o=>{o&&(await this.resumePausedMutations(),Te(this,za).onOnline())})))}unmount(){var o,d;pm(this,Ao)._--,Te(this,Ao)===0&&((o=Te(this,gd))==null||o.call(this),vt(this,gd,void 0),(d=Te(this,yd))==null||d.call(this),vt(this,yd,void 0))}isFetching(o){return Te(this,za).findAll({...o,fetchStatus:"fetching"}).length}isMutating(o){return Te(this,Co).findAll({...o,status:"pending"}).length}getQueryData(o){var m;const d=this.defaultQueryOptions({queryKey:o});return(m=Te(this,za).get(d.queryHash))==null?void 0:m.state.data}ensureQueryData(o){const d=this.defaultQueryOptions(o),m=Te(this,za).build(this,d),y=m.state.data;return y===void 0?this.fetchQuery(o):(o.revalidateIfStale&&m.isStaleByTime(sg(d.staleTime,m))&&this.prefetchQuery(d),Promise.resolve(y))}getQueriesData(o){return Te(this,za).findAll(o).map(({queryKey:d,state:m})=>{const y=m.data;return[d,y]})}setQueryData(o,d,m){const y=this.defaultQueryOptions({queryKey:o}),$=Te(this,za).get(y.queryHash),E=$==null?void 0:$.state.data,R=Ov(d,E);if(R!==void 0)return Te(this,za).build(this,y).setData(R,{...m,manual:!0})}setQueriesData(o,d,m){return Bn.batch(()=>Te(this,za).findAll(o).map(({queryKey:y})=>[y,this.setQueryData(y,d,m)]))}getQueryState(o){var m;const d=this.defaultQueryOptions({queryKey:o});return(m=Te(this,za).get(d.queryHash))==null?void 0:m.state}removeQueries(o){const d=Te(this,za);Bn.batch(()=>{d.findAll(o).forEach(m=>{d.remove(m)})})}resetQueries(o,d){const m=Te(this,za);return Bn.batch(()=>(m.findAll(o).forEach(y=>{y.reset()}),this.refetchQueries({type:"active",...o},d)))}cancelQueries(o,d={}){const m={revert:!0,...d},y=Bn.batch(()=>Te(this,za).findAll(o).map($=>$.cancel(m)));return Promise.all(y).then(Nr).catch(Nr)}invalidateQueries(o,d={}){return Bn.batch(()=>(Te(this,za).findAll(o).forEach(m=>{m.invalidate()}),(o==null?void 0:o.refetchType)==="none"?Promise.resolve():this.refetchQueries({...o,type:(o==null?void 0:o.refetchType)??(o==null?void 0:o.type)??"active"},d)))}refetchQueries(o,d={}){const m={...d,cancelRefetch:d.cancelRefetch??!0},y=Bn.batch(()=>Te(this,za).findAll(o).filter($=>!$.isDisabled()&&!$.isStatic()).map($=>{let E=$.fetch(void 0,m);return m.throwOnError||(E=E.catch(Nr)),$.state.fetchStatus==="paused"?Promise.resolve():E}));return Promise.all(y).then(Nr)}fetchQuery(o){const d=this.defaultQueryOptions(o);d.retry===void 0&&(d.retry=!1);const m=Te(this,za).build(this,d);return m.isStaleByTime(sg(d.staleTime,m))?m.fetch(d):Promise.resolve(m.state.data)}prefetchQuery(o){return this.fetchQuery(o).then(Nr).catch(Nr)}fetchInfiniteQuery(o){return o.behavior=hy(o.pages),this.fetchQuery(o)}prefetchInfiniteQuery(o){return this.fetchInfiniteQuery(o).then(Nr).catch(Nr)}ensureInfiniteQueryData(o){return o.behavior=hy(o.pages),this.ensureQueryData(o)}resumePausedMutations(){return xm.isOnline()?Te(this,Co).resumePausedMutations():Promise.resolve()}getQueryCache(){return Te(this,za)}getMutationCache(){return Te(this,Co)}getDefaultOptions(){return Te(this,zo)}setDefaultOptions(o){vt(this,zo,o)}setQueryDefaults(o,d){Te(this,hd).set(Xp(o),{queryKey:o,defaultOptions:d})}getQueryDefaults(o){const d=[...Te(this,hd).values()],m={};return d.forEach(y=>{Zp(o,y.queryKey)&&Object.assign(m,y.defaultOptions)}),m}setMutationDefaults(o,d){Te(this,md).set(Xp(o),{mutationKey:o,defaultOptions:d})}getMutationDefaults(o){const d=[...Te(this,md).values()],m={};return d.forEach(y=>{Zp(o,y.mutationKey)&&Object.assign(m,y.defaultOptions)}),m}defaultQueryOptions(o){if(o._defaulted)return o;const d={...Te(this,zo).queries,...this.getQueryDefaults(o.queryKey),...o,_defaulted:!0};return d.queryHash||(d.queryHash=mg(d.queryKey,d)),d.refetchOnReconnect===void 0&&(d.refetchOnReconnect=d.networkMode!=="always"),d.throwOnError===void 0&&(d.throwOnError=!!d.suspense),!d.networkMode&&d.persister&&(d.networkMode="offlineFirst"),d.queryFn===gg&&(d.enabled=!1),d}defaultMutationOptions(o){return o!=null&&o._defaulted?o:{...Te(this,zo).mutations,...(o==null?void 0:o.mutationKey)&&this.getMutationDefaults(o.mutationKey),...o,_defaulted:!0}}clear(){Te(this,za).clear(),Te(this,Co).clear()}},za=new WeakMap,Co=new WeakMap,zo=new WeakMap,hd=new WeakMap,md=new WeakMap,Ao=new WeakMap,gd=new WeakMap,yd=new WeakMap,i0),eb=ne.createContext(void 0),tb=({client:o,children:d})=>(ne.useEffect(()=>(o.mount(),()=>{o.unmount()}),[o]),we.jsx(eb.Provider,{value:o,children:d}));/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var gy="popstate";function ab(o={}){function d(y,$){let{pathname:E,search:R,hash:D}=y.location;return ug("",{pathname:E,search:R,hash:D},$.state&&$.state.usr||null,$.state&&$.state.key||"default")}function m(y,$){return typeof $=="string"?$:Jp($)}return ib(d,m,null,o)}function wa(o,d){if(o===!1||o===null||typeof o>"u")throw new Error(d)}function Lr(o,d){if(!o){typeof console<"u"&&console.warn(d);try{throw new Error(d)}catch{}}}function nb(){return Math.random().toString(36).substring(2,10)}function yy(o,d){return{usr:o.state,key:o.key,idx:d}}function ug(o,d,m=null,y){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof d=="string"?bd(d):d,state:m,key:d&&d.key||y||nb()}}function Jp({pathname:o="/",search:d="",hash:m=""}){return d&&d!=="?"&&(o+=d.charAt(0)==="?"?d:"?"+d),m&&m!=="#"&&(o+=m.charAt(0)==="#"?m:"#"+m),o}function bd(o){let d={};if(o){let m=o.indexOf("#");m>=0&&(d.hash=o.substring(m),o=o.substring(0,m));let y=o.indexOf("?");y>=0&&(d.search=o.substring(y),o=o.substring(0,y)),o&&(d.pathname=o)}return d}function ib(o,d,m,y={}){let{window:$=document.defaultView,v5Compat:E=!1}=y,R=$.history,D="POP",T=null,M=H();M==null&&(M=0,R.replaceState({...R.state,idx:M},""));function H(){return(R.state||{idx:null}).idx}function q(){D="POP";let he=H(),$e=he==null?null:he-M;M=he,T&&T({action:D,location:ee.location,delta:$e})}function Z(he,$e){D="PUSH";let De=ug(ee.location,he,$e);M=H()+1;let me=yy(De,M),be=ee.createHref(De);try{R.pushState(me,"",be)}catch(Me){if(Me instanceof DOMException&&Me.name==="DataCloneError")throw Me;$.location.assign(be)}E&&T&&T({action:D,location:ee.location,delta:1})}function se(he,$e){D="REPLACE";let De=ug(ee.location,he,$e);M=H();let me=yy(De,M),be=ee.createHref(De);R.replaceState(me,"",be),E&&T&&T({action:D,location:ee.location,delta:0})}function ce(he){return rb(he)}let ee={get action(){return D},get location(){return o($,R)},listen(he){if(T)throw new Error("A history only accepts one active listener");return $.addEventListener(gy,q),T=he,()=>{$.removeEventListener(gy,q),T=null}},createHref(he){return d($,he)},createURL:ce,encodeLocation(he){let $e=ce(he);return{pathname:$e.pathname,search:$e.search,hash:$e.hash}},push:Z,replace:se,go(he){return R.go(he)}};return ee}function rb(o,d=!1){let m="http://localhost";typeof window<"u"&&(m=window.location.origin!=="null"?window.location.origin:window.location.href),wa(m,"No window.location.(origin|href) available to create URL");let y=typeof o=="string"?o:Jp(o);return y=y.replace(/ $/,"%20"),!d&&y.startsWith("//")&&(y=m+y),new URL(y,m)}function d0(o,d,m="/"){return sb(o,d,m,!1)}function sb(o,d,m,y){let $=typeof d=="string"?bd(d):d,E=xl($.pathname||"/",m);if(E==null)return null;let R=f0(o);lb(R);let D=null;for(let T=0;D==null&&T<R.length;++T){let M=vb(E);D=gb(R[T],M,y)}return D}function f0(o,d=[],m=[],y="",$=!1){let E=(R,D,T=$,M)=>{let H={relativePath:M===void 0?R.path||"":M,caseSensitive:R.caseSensitive===!0,childrenIndex:D,route:R};if(H.relativePath.startsWith("/")){if(!H.relativePath.startsWith(y)&&T)return;wa(H.relativePath.startsWith(y),`Absolute route path "${H.relativePath}" nested under path "${y}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),H.relativePath=H.relativePath.slice(y.length)}let q=wl([y,H.relativePath]),Z=m.concat(H);R.children&&R.children.length>0&&(wa(R.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${q}".`),f0(R.children,d,Z,q,T)),!(R.path==null&&!R.index)&&d.push({path:q,score:hb(q,R.index),routesMeta:Z})};return o.forEach((R,D)=>{var T;if(R.path===""||!((T=R.path)!=null&&T.includes("?")))E(R,D);else for(let M of p0(R.path))E(R,D,!0,M)}),d}function p0(o){let d=o.split("/");if(d.length===0)return[];let[m,...y]=d,$=m.endsWith("?"),E=m.replace(/\?$/,"");if(y.length===0)return $?[E,""]:[E];let R=p0(y.join("/")),D=[];return D.push(...R.map(T=>T===""?E:[E,T].join("/"))),$&&D.push(...R),D.map(T=>o.startsWith("/")&&T===""?"/":T)}function lb(o){o.sort((d,m)=>d.score!==m.score?m.score-d.score:mb(d.routesMeta.map(y=>y.childrenIndex),m.routesMeta.map(y=>y.childrenIndex)))}var ob=/^:[\w-]+$/,ub=3,cb=2,db=1,fb=10,pb=-2,vy=o=>o==="*";function hb(o,d){let m=o.split("/"),y=m.length;return m.some(vy)&&(y+=pb),d&&(y+=cb),m.filter($=>!vy($)).reduce(($,E)=>$+(ob.test(E)?ub:E===""?db:fb),y)}function mb(o,d){return o.length===d.length&&o.slice(0,-1).every((y,$)=>y===d[$])?o[o.length-1]-d[d.length-1]:0}function gb(o,d,m=!1){let{routesMeta:y}=o,$={},E="/",R=[];for(let D=0;D<y.length;++D){let T=y[D],M=D===y.length-1,H=E==="/"?d:d.slice(E.length)||"/",q=$m({path:T.relativePath,caseSensitive:T.caseSensitive,end:M},H),Z=T.route;if(!q&&M&&m&&!y[y.length-1].route.index&&(q=$m({path:T.relativePath,caseSensitive:T.caseSensitive,end:!1},H)),!q)return null;Object.assign($,q.params),R.push({params:$,pathname:wl([E,q.pathname]),pathnameBase:xb(wl([E,q.pathnameBase])),route:Z}),q.pathnameBase!=="/"&&(E=wl([E,q.pathnameBase]))}return R}function $m(o,d){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[m,y]=yb(o.path,o.caseSensitive,o.end),$=d.match(m);if(!$)return null;let E=$[0],R=E.replace(/(.)\/+$/,"$1"),D=$.slice(1);return{params:y.reduce((M,{paramName:H,isOptional:q},Z)=>{if(H==="*"){let ce=D[Z]||"";R=E.slice(0,E.length-ce.length).replace(/(.)\/+$/,"$1")}const se=D[Z];return q&&!se?M[H]=void 0:M[H]=(se||"").replace(/%2F/g,"/"),M},{}),pathname:E,pathnameBase:R,pattern:o}}function yb(o,d=!1,m=!0){Lr(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let y=[],$="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,D,T)=>(y.push({paramName:D,isOptional:T!=null}),T?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(y.push({paramName:"*"}),$+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):m?$+="\\/*$":o!==""&&o!=="/"&&($+="(?:(?=\\/|$))"),[new RegExp($,d?void 0:"i"),y]}function vb(o){try{return o.split("/").map(d=>decodeURIComponent(d).replace(/\//g,"%2F")).join("/")}catch(d){return Lr(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${d}).`),o}}function xl(o,d){if(d==="/")return o;if(!o.toLowerCase().startsWith(d.toLowerCase()))return null;let m=d.endsWith("/")?d.length-1:d.length,y=o.charAt(m);return y&&y!=="/"?null:o.slice(m)||"/"}var bb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function _b(o,d="/"){let{pathname:m,search:y="",hash:$=""}=typeof o=="string"?bd(o):o,E;return m?(m=m.replace(/\/\/+/g,"/"),m.startsWith("/")?E=by(m.substring(1),"/"):E=by(m,d)):E=d,{pathname:E,search:$b(y),hash:Sb($)}}function by(o,d){let m=d.replace(/\/+$/,"").split("/");return o.split("/").forEach($=>{$===".."?m.length>1&&m.pop():$!=="."&&m.push($)}),m.length>1?m.join("/"):"/"}function Ym(o,d,m,y){return`Cannot include a '${o}' character in a manually specified \`to.${d}\` field [${JSON.stringify(y)}].  Please separate it out to the \`to.${m}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function wb(o){return o.filter((d,m)=>m===0||d.route.path&&d.route.path.length>0)}function yg(o){let d=wb(o);return d.map((m,y)=>y===d.length-1?m.pathname:m.pathnameBase)}function vg(o,d,m,y=!1){let $;typeof o=="string"?$=bd(o):($={...o},wa(!$.pathname||!$.pathname.includes("?"),Ym("?","pathname","search",$)),wa(!$.pathname||!$.pathname.includes("#"),Ym("#","pathname","hash",$)),wa(!$.search||!$.search.includes("#"),Ym("#","search","hash",$)));let E=o===""||$.pathname==="",R=E?"/":$.pathname,D;if(R==null)D=m;else{let q=d.length-1;if(!y&&R.startsWith("..")){let Z=R.split("/");for(;Z[0]==="..";)Z.shift(),q-=1;$.pathname=Z.join("/")}D=q>=0?d[q]:"/"}let T=_b($,D),M=R&&R!=="/"&&R.endsWith("/"),H=(E||R===".")&&m.endsWith("/");return!T.pathname.endsWith("/")&&(M||H)&&(T.pathname+="/"),T}var wl=o=>o.join("/").replace(/\/\/+/g,"/"),xb=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),$b=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,Sb=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,Eb=class{constructor(o,d,m,y=!1){this.status=o,this.statusText=d||"",this.internal=y,m instanceof Error?(this.data=m.toString(),this.error=m):this.data=m}};function Tb(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function Cb(o){return o.map(d=>d.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var h0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function m0(o,d){let m=o;if(typeof m!="string"||!bb.test(m))return{absoluteURL:void 0,isExternal:!1,to:m};let y=m,$=!1;if(h0)try{let E=new URL(window.location.href),R=m.startsWith("//")?new URL(E.protocol+m):new URL(m),D=xl(R.pathname,d);R.origin===E.origin&&D!=null?m=D+R.search+R.hash:$=!0}catch{Lr(!1,`<Link to="${m}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:y,isExternal:$,to:m}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var g0=["POST","PUT","PATCH","DELETE"];new Set(g0);var zb=["GET",...g0];new Set(zb);var _d=ne.createContext(null);_d.displayName="DataRouter";var Cm=ne.createContext(null);Cm.displayName="DataRouterState";var Ab=ne.createContext(!1),y0=ne.createContext({isTransitioning:!1});y0.displayName="ViewTransition";var Ob=ne.createContext(new Map);Ob.displayName="Fetchers";var Rb=ne.createContext(null);Rb.displayName="Await";var gi=ne.createContext(null);gi.displayName="Navigation";var nh=ne.createContext(null);nh.displayName="Location";var $s=ne.createContext({outlet:null,matches:[],isDataRoute:!1});$s.displayName="Route";var bg=ne.createContext(null);bg.displayName="RouteError";var v0="REACT_ROUTER_ERROR",Mb="REDIRECT",kb="ROUTE_ERROR_RESPONSE";function Db(o){if(o.startsWith(`${v0}:${Mb}:{`))try{let d=JSON.parse(o.slice(28));if(typeof d=="object"&&d&&typeof d.status=="number"&&typeof d.statusText=="string"&&typeof d.location=="string"&&typeof d.reloadDocument=="boolean"&&typeof d.replace=="boolean")return d}catch{}}function Bb(o){if(o.startsWith(`${v0}:${kb}:{`))try{let d=JSON.parse(o.slice(40));if(typeof d=="object"&&d&&typeof d.status=="number"&&typeof d.statusText=="string")return new Eb(d.status,d.statusText,d.data)}catch{}}function Nb(o,{relative:d}={}){wa(wd(),"useHref() may be used only in the context of a <Router> component.");let{basename:m,navigator:y}=ne.useContext(gi),{hash:$,pathname:E,search:R}=ih(o,{relative:d}),D=E;return m!=="/"&&(D=E==="/"?m:wl([m,E])),y.createHref({pathname:D,search:R,hash:$})}function wd(){return ne.useContext(nh)!=null}function Oo(){return wa(wd(),"useLocation() may be used only in the context of a <Router> component."),ne.useContext(nh).location}var b0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function _0(o){ne.useContext(gi).static||ne.useLayoutEffect(o)}function Du(){let{isDataRoute:o}=ne.useContext($s);return o?Qb():Ub()}function Ub(){wa(wd(),"useNavigate() may be used only in the context of a <Router> component.");let o=ne.useContext(_d),{basename:d,navigator:m}=ne.useContext(gi),{matches:y}=ne.useContext($s),{pathname:$}=Oo(),E=JSON.stringify(yg(y)),R=ne.useRef(!1);return _0(()=>{R.current=!0}),ne.useCallback((T,M={})=>{if(Lr(R.current,b0),!R.current)return;if(typeof T=="number"){m.go(T);return}let H=vg(T,JSON.parse(E),$,M.relative==="path");o==null&&d!=="/"&&(H.pathname=H.pathname==="/"?d:wl([d,H.pathname])),(M.replace?m.replace:m.push)(H,M.state,M)},[d,m,E,$,o])}ne.createContext(null);function ih(o,{relative:d}={}){let{matches:m}=ne.useContext($s),{pathname:y}=Oo(),$=JSON.stringify(yg(m));return ne.useMemo(()=>vg(o,JSON.parse($),y,d==="path"),[o,$,y,d])}function Ib(o,d){return w0(o,d)}function w0(o,d,m,y,$){var De;wa(wd(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:E}=ne.useContext(gi),{matches:R}=ne.useContext($s),D=R[R.length-1],T=D?D.params:{},M=D?D.pathname:"/",H=D?D.pathnameBase:"/",q=D&&D.route;{let me=q&&q.path||"";$0(M,!q||me.endsWith("*")||me.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${M}" (under <Route path="${me}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${me}"> to <Route path="${me==="/"?"*":`${me}/*`}">.`)}let Z=Oo(),se;if(d){let me=typeof d=="string"?bd(d):d;wa(H==="/"||((De=me.pathname)==null?void 0:De.startsWith(H)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${H}" but pathname "${me.pathname}" was given in the \`location\` prop.`),se=me}else se=Z;let ce=se.pathname||"/",ee=ce;if(H!=="/"){let me=H.replace(/^\//,"").split("/");ee="/"+ce.replace(/^\//,"").split("/").slice(me.length).join("/")}let he=d0(o,{pathname:ee});Lr(q||he!=null,`No routes matched location "${se.pathname}${se.search}${se.hash}" `),Lr(he==null||he[he.length-1].route.element!==void 0||he[he.length-1].route.Component!==void 0||he[he.length-1].route.lazy!==void 0,`Matched leaf route at location "${se.pathname}${se.search}${se.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let $e=Vb(he&&he.map(me=>Object.assign({},me,{params:Object.assign({},T,me.params),pathname:wl([H,E.encodeLocation?E.encodeLocation(me.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:me.pathname]),pathnameBase:me.pathnameBase==="/"?H:wl([H,E.encodeLocation?E.encodeLocation(me.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:me.pathnameBase])})),R,m,y,$);return d&&$e?ne.createElement(nh.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...se},navigationType:"POP"}},$e):$e}function Lb(){let o=Wb(),d=Tb(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),m=o instanceof Error?o.stack:null,y="rgba(200,200,200, 0.5)",$={padding:"0.5rem",backgroundColor:y},E={padding:"2px 4px",backgroundColor:y},R=null;return console.error("Error handled by React Router default ErrorBoundary:",o),R=ne.createElement(ne.Fragment,null,ne.createElement("p",null," Hey developer "),ne.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ne.createElement("code",{style:E},"ErrorBoundary")," or"," ",ne.createElement("code",{style:E},"errorElement")," prop on your route.")),ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},d),m?ne.createElement("pre",{style:$},m):null,R)}var qb=ne.createElement(Lb,null),x0=class extends ne.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,d){return d.location!==o.location||d.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:d.error,location:d.location,revalidation:o.revalidation||d.revalidation}}componentDidCatch(o,d){this.props.onError?this.props.onError(o,d):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const m=Bb(o.digest);m&&(o=m)}let d=o!==void 0?ne.createElement($s.Provider,{value:this.props.routeContext},ne.createElement(bg.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?ne.createElement(jb,{error:o},d):d}};x0.contextType=Ab;var Xm=new WeakMap;function jb({children:o,error:d}){let{basename:m}=ne.useContext(gi);if(typeof d=="object"&&d&&"digest"in d&&typeof d.digest=="string"){let y=Db(d.digest);if(y){let $=Xm.get(d);if($)throw $;let E=m0(y.location,m);if(h0&&!Xm.get(d))if(E.isExternal||y.reloadDocument)window.location.href=E.absoluteURL||E.to;else{const R=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(E.to,{replace:y.replace}));throw Xm.set(d,R),R}return ne.createElement("meta",{httpEquiv:"refresh",content:`0;url=${E.absoluteURL||E.to}`})}}return o}function Gb({routeContext:o,match:d,children:m}){let y=ne.useContext(_d);return y&&y.static&&y.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(y.staticContext._deepestRenderedBoundaryId=d.route.id),ne.createElement($s.Provider,{value:o},m)}function Vb(o,d=[],m=null,y=null,$=null){if(o==null){if(!m)return null;if(m.errors)o=m.matches;else if(d.length===0&&!m.initialized&&m.matches.length>0)o=m.matches;else return null}let E=o,R=m==null?void 0:m.errors;if(R!=null){let H=E.findIndex(q=>q.route.id&&(R==null?void 0:R[q.route.id])!==void 0);wa(H>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(R).join(",")}`),E=E.slice(0,Math.min(E.length,H+1))}let D=!1,T=-1;if(m)for(let H=0;H<E.length;H++){let q=E[H];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(T=H),q.route.id){let{loaderData:Z,errors:se}=m,ce=q.route.loader&&!Z.hasOwnProperty(q.route.id)&&(!se||se[q.route.id]===void 0);if(q.route.lazy||ce){D=!0,T>=0?E=E.slice(0,T+1):E=[E[0]];break}}}let M=m&&y?(H,q)=>{var Z,se;y(H,{location:m.location,params:((se=(Z=m.matches)==null?void 0:Z[0])==null?void 0:se.params)??{},unstable_pattern:Cb(m.matches),errorInfo:q})}:void 0;return E.reduceRight((H,q,Z)=>{let se,ce=!1,ee=null,he=null;m&&(se=R&&q.route.id?R[q.route.id]:void 0,ee=q.route.errorElement||qb,D&&(T<0&&Z===0?($0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ce=!0,he=null):T===Z&&(ce=!0,he=q.route.hydrateFallbackElement||null)));let $e=d.concat(E.slice(0,Z+1)),De=()=>{let me;return se?me=ee:ce?me=he:q.route.Component?me=ne.createElement(q.route.Component,null):q.route.element?me=q.route.element:me=H,ne.createElement(Gb,{match:q,routeContext:{outlet:H,matches:$e,isDataRoute:m!=null},children:me})};return m&&(q.route.ErrorBoundary||q.route.errorElement||Z===0)?ne.createElement(x0,{location:m.location,revalidation:m.revalidation,component:ee,error:se,children:De(),routeContext:{outlet:null,matches:$e,isDataRoute:!0},onError:M}):De()},null)}function _g(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Hb(o){let d=ne.useContext(_d);return wa(d,_g(o)),d}function Pb(o){let d=ne.useContext(Cm);return wa(d,_g(o)),d}function Fb(o){let d=ne.useContext($s);return wa(d,_g(o)),d}function wg(o){let d=Fb(o),m=d.matches[d.matches.length-1];return wa(m.route.id,`${o} can only be used on routes that contain a unique "id"`),m.route.id}function Kb(){return wg("useRouteId")}function Wb(){var y;let o=ne.useContext(bg),d=Pb("useRouteError"),m=wg("useRouteError");return o!==void 0?o:(y=d.errors)==null?void 0:y[m]}function Qb(){let{router:o}=Hb("useNavigate"),d=wg("useNavigate"),m=ne.useRef(!1);return _0(()=>{m.current=!0}),ne.useCallback(async($,E={})=>{Lr(m.current,b0),m.current&&(typeof $=="number"?await o.navigate($):await o.navigate($,{fromRouteId:d,...E}))},[o,d])}var _y={};function $0(o,d,m){!d&&!_y[o]&&(_y[o]=!0,Lr(!1,m))}ne.memo(Yb);function Yb({routes:o,future:d,state:m,onError:y}){return w0(o,void 0,m,y,d)}function Xb({to:o,replace:d,state:m,relative:y}){wa(wd(),"<Navigate> may be used only in the context of a <Router> component.");let{static:$}=ne.useContext(gi);Lr(!$,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:E}=ne.useContext($s),{pathname:R}=Oo(),D=Du(),T=vg(o,yg(E),R,y==="path"),M=JSON.stringify(T);return ne.useEffect(()=>{D(JSON.parse(M),{replace:d,state:m,relative:y})},[D,M,y,d,m]),null}function Cu(o){wa(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Zb({basename:o="/",children:d=null,location:m,navigationType:y="POP",navigator:$,static:E=!1,unstable_useTransitions:R}){wa(!wd(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let D=o.replace(/^\/*/,"/"),T=ne.useMemo(()=>({basename:D,navigator:$,static:E,unstable_useTransitions:R,future:{}}),[D,$,E,R]);typeof m=="string"&&(m=bd(m));let{pathname:M="/",search:H="",hash:q="",state:Z=null,key:se="default"}=m,ce=ne.useMemo(()=>{let ee=xl(M,D);return ee==null?null:{location:{pathname:ee,search:H,hash:q,state:Z,key:se},navigationType:y}},[D,M,H,q,Z,se,y]);return Lr(ce!=null,`<Router basename="${D}"> is not able to match the URL "${M}${H}${q}" because it does not start with the basename, so the <Router> won't render anything.`),ce==null?null:ne.createElement(gi.Provider,{value:T},ne.createElement(nh.Provider,{children:d,value:ce}))}function Jb({children:o,location:d}){return Ib(cg(o),d)}function cg(o,d=[]){let m=[];return ne.Children.forEach(o,(y,$)=>{if(!ne.isValidElement(y))return;let E=[...d,$];if(y.type===ne.Fragment){m.push.apply(m,cg(y.props.children,E));return}wa(y.type===Cu,`[${typeof y.type=="string"?y.type:y.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),wa(!y.props.index||!y.props.children,"An index route cannot have child routes.");let R={id:y.props.id||E.join("-"),caseSensitive:y.props.caseSensitive,element:y.props.element,Component:y.props.Component,index:y.props.index,path:y.props.path,middleware:y.props.middleware,loader:y.props.loader,action:y.props.action,hydrateFallbackElement:y.props.hydrateFallbackElement,HydrateFallback:y.props.HydrateFallback,errorElement:y.props.errorElement,ErrorBoundary:y.props.ErrorBoundary,hasErrorBoundary:y.props.hasErrorBoundary===!0||y.props.ErrorBoundary!=null||y.props.errorElement!=null,shouldRevalidate:y.props.shouldRevalidate,handle:y.props.handle,lazy:y.props.lazy};y.props.children&&(R.children=cg(y.props.children,E)),m.push(R)}),m}var bm="get",_m="application/x-www-form-urlencoded";function zm(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function e_(o){return zm(o)&&o.tagName.toLowerCase()==="button"}function t_(o){return zm(o)&&o.tagName.toLowerCase()==="form"}function a_(o){return zm(o)&&o.tagName.toLowerCase()==="input"}function n_(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function i_(o,d){return o.button===0&&(!d||d==="_self")&&!n_(o)}var mm=null;function r_(){if(mm===null)try{new FormData(document.createElement("form"),0),mm=!1}catch{mm=!0}return mm}var s_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zm(o){return o!=null&&!s_.has(o)?(Lr(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_m}"`),null):o}function l_(o,d){let m,y,$,E,R;if(t_(o)){let D=o.getAttribute("action");y=D?xl(D,d):null,m=o.getAttribute("method")||bm,$=Zm(o.getAttribute("enctype"))||_m,E=new FormData(o)}else if(e_(o)||a_(o)&&(o.type==="submit"||o.type==="image")){let D=o.form;if(D==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let T=o.getAttribute("formaction")||D.getAttribute("action");if(y=T?xl(T,d):null,m=o.getAttribute("formmethod")||D.getAttribute("method")||bm,$=Zm(o.getAttribute("formenctype"))||Zm(D.getAttribute("enctype"))||_m,E=new FormData(D,o),!r_()){let{name:M,type:H,value:q}=o;if(H==="image"){let Z=M?`${M}.`:"";E.append(`${Z}x`,"0"),E.append(`${Z}y`,"0")}else M&&E.append(M,q)}}else{if(zm(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');m=bm,y=null,$=_m,R=o}return E&&$==="text/plain"&&(R=E,E=void 0),{action:y,method:m.toLowerCase(),encType:$,formData:E,body:R}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function xg(o,d){if(o===!1||o===null||typeof o>"u")throw new Error(d)}function o_(o,d,m,y){let $=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return m?$.pathname.endsWith("/")?$.pathname=`${$.pathname}_.${y}`:$.pathname=`${$.pathname}.${y}`:$.pathname==="/"?$.pathname=`_root.${y}`:d&&xl($.pathname,d)==="/"?$.pathname=`${d.replace(/\/$/,"")}/_root.${y}`:$.pathname=`${$.pathname.replace(/\/$/,"")}.${y}`,$}async function u_(o,d){if(o.id in d)return d[o.id];try{let m=await import(o.module);return d[o.id]=m,m}catch(m){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(m),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function c_(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function d_(o,d,m){let y=await Promise.all(o.map(async $=>{let E=d.routes[$.route.id];if(E){let R=await u_(E,m);return R.links?R.links():[]}return[]}));return m_(y.flat(1).filter(c_).filter($=>$.rel==="stylesheet"||$.rel==="preload").map($=>$.rel==="stylesheet"?{...$,rel:"prefetch",as:"style"}:{...$,rel:"prefetch"}))}function wy(o,d,m,y,$,E){let R=(T,M)=>m[M]?T.route.id!==m[M].route.id:!0,D=(T,M)=>{var H;return m[M].pathname!==T.pathname||((H=m[M].route.path)==null?void 0:H.endsWith("*"))&&m[M].params["*"]!==T.params["*"]};return E==="assets"?d.filter((T,M)=>R(T,M)||D(T,M)):E==="data"?d.filter((T,M)=>{var q;let H=y.routes[T.route.id];if(!H||!H.hasLoader)return!1;if(R(T,M)||D(T,M))return!0;if(T.route.shouldRevalidate){let Z=T.route.shouldRevalidate({currentUrl:new URL($.pathname+$.search+$.hash,window.origin),currentParams:((q=m[0])==null?void 0:q.params)||{},nextUrl:new URL(o,window.origin),nextParams:T.params,defaultShouldRevalidate:!0});if(typeof Z=="boolean")return Z}return!0}):[]}function f_(o,d,{includeHydrateFallback:m}={}){return p_(o.map(y=>{let $=d.routes[y.route.id];if(!$)return[];let E=[$.module];return $.clientActionModule&&(E=E.concat($.clientActionModule)),$.clientLoaderModule&&(E=E.concat($.clientLoaderModule)),m&&$.hydrateFallbackModule&&(E=E.concat($.hydrateFallbackModule)),$.imports&&(E=E.concat($.imports)),E}).flat(1))}function p_(o){return[...new Set(o)]}function h_(o){let d={},m=Object.keys(o).sort();for(let y of m)d[y]=o[y];return d}function m_(o,d){let m=new Set;return new Set(d),o.reduce((y,$)=>{let E=JSON.stringify(h_($));return m.has(E)||(m.add(E),y.push({key:E,link:$})),y},[])}function S0(){let o=ne.useContext(_d);return xg(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function g_(){let o=ne.useContext(Cm);return xg(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var $g=ne.createContext(void 0);$g.displayName="FrameworkContext";function E0(){let o=ne.useContext($g);return xg(o,"You must render this element inside a <HydratedRouter> element"),o}function y_(o,d){let m=ne.useContext($g),[y,$]=ne.useState(!1),[E,R]=ne.useState(!1),{onFocus:D,onBlur:T,onMouseEnter:M,onMouseLeave:H,onTouchStart:q}=d,Z=ne.useRef(null);ne.useEffect(()=>{if(o==="render"&&R(!0),o==="viewport"){let ee=$e=>{$e.forEach(De=>{R(De.isIntersecting)})},he=new IntersectionObserver(ee,{threshold:.5});return Z.current&&he.observe(Z.current),()=>{he.disconnect()}}},[o]),ne.useEffect(()=>{if(y){let ee=setTimeout(()=>{R(!0)},100);return()=>{clearTimeout(ee)}}},[y]);let se=()=>{$(!0)},ce=()=>{$(!1),R(!1)};return m?o!=="intent"?[E,Z,{}]:[E,Z,{onFocus:Np(D,se),onBlur:Np(T,ce),onMouseEnter:Np(M,se),onMouseLeave:Np(H,ce),onTouchStart:Np(q,se)}]:[!1,Z,{}]}function Np(o,d){return m=>{o&&o(m),m.defaultPrevented||d(m)}}function v_({page:o,...d}){let{router:m}=S0(),y=ne.useMemo(()=>d0(m.routes,o,m.basename),[m.routes,o,m.basename]);return y?ne.createElement(__,{page:o,matches:y,...d}):null}function b_(o){let{manifest:d,routeModules:m}=E0(),[y,$]=ne.useState([]);return ne.useEffect(()=>{let E=!1;return d_(o,d,m).then(R=>{E||$(R)}),()=>{E=!0}},[o,d,m]),y}function __({page:o,matches:d,...m}){let y=Oo(),{future:$,manifest:E,routeModules:R}=E0(),{basename:D}=S0(),{loaderData:T,matches:M}=g_(),H=ne.useMemo(()=>wy(o,d,M,E,y,"data"),[o,d,M,E,y]),q=ne.useMemo(()=>wy(o,d,M,E,y,"assets"),[o,d,M,E,y]),Z=ne.useMemo(()=>{if(o===y.pathname+y.search+y.hash)return[];let ee=new Set,he=!1;if(d.forEach(De=>{var be;let me=E.routes[De.route.id];!me||!me.hasLoader||(!H.some(Me=>Me.route.id===De.route.id)&&De.route.id in T&&((be=R[De.route.id])!=null&&be.shouldRevalidate)||me.hasClientLoader?he=!0:ee.add(De.route.id))}),ee.size===0)return[];let $e=o_(o,D,$.unstable_trailingSlashAwareDataRequests,"data");return he&&ee.size>0&&$e.searchParams.set("_routes",d.filter(De=>ee.has(De.route.id)).map(De=>De.route.id).join(",")),[$e.pathname+$e.search]},[D,$.unstable_trailingSlashAwareDataRequests,T,y,E,H,d,o,R]),se=ne.useMemo(()=>f_(q,E),[q,E]),ce=b_(q);return ne.createElement(ne.Fragment,null,Z.map(ee=>ne.createElement("link",{key:ee,rel:"prefetch",as:"fetch",href:ee,...m})),se.map(ee=>ne.createElement("link",{key:ee,rel:"modulepreload",href:ee,...m})),ce.map(({key:ee,link:he})=>ne.createElement("link",{key:ee,nonce:m.nonce,...he,crossOrigin:he.crossOrigin??m.crossOrigin})))}function w_(...o){return d=>{o.forEach(m=>{typeof m=="function"?m(d):m!=null&&(m.current=d)})}}var x_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{x_&&(window.__reactRouterVersion="7.13.0")}catch{}function $_({basename:o,children:d,unstable_useTransitions:m,window:y}){let $=ne.useRef();$.current==null&&($.current=ab({window:y,v5Compat:!0}));let E=$.current,[R,D]=ne.useState({action:E.action,location:E.location}),T=ne.useCallback(M=>{m===!1?D(M):ne.startTransition(()=>D(M))},[m]);return ne.useLayoutEffect(()=>E.listen(T),[E,T]),ne.createElement(Zb,{basename:o,children:d,location:R.location,navigationType:R.action,navigator:E,unstable_useTransitions:m})}var T0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,C0=ne.forwardRef(function({onClick:d,discover:m="render",prefetch:y="none",relative:$,reloadDocument:E,replace:R,state:D,target:T,to:M,preventScrollReset:H,viewTransition:q,unstable_defaultShouldRevalidate:Z,...se},ce){let{basename:ee,unstable_useTransitions:he}=ne.useContext(gi),$e=typeof M=="string"&&T0.test(M),De=m0(M,ee);M=De.to;let me=Nb(M,{relative:$}),[be,Me,Be]=y_(y,se),qe=C_(M,{replace:R,state:D,target:T,preventScrollReset:H,relative:$,viewTransition:q,unstable_defaultShouldRevalidate:Z,unstable_useTransitions:he});function Re(Xe){d&&d(Xe),Xe.defaultPrevented||qe(Xe)}let at=ne.createElement("a",{...se,...Be,href:De.absoluteURL||me,onClick:De.isExternal||E?d:Re,ref:w_(ce,Me),target:T,"data-discover":!$e&&m==="render"?"true":void 0});return be&&!$e?ne.createElement(ne.Fragment,null,at,ne.createElement(v_,{page:me})):at});C0.displayName="Link";var S_=ne.forwardRef(function({"aria-current":d="page",caseSensitive:m=!1,className:y="",end:$=!1,style:E,to:R,viewTransition:D,children:T,...M},H){let q=ih(R,{relative:M.relative}),Z=Oo(),se=ne.useContext(Cm),{navigator:ce,basename:ee}=ne.useContext(gi),he=se!=null&&M_(q)&&D===!0,$e=ce.encodeLocation?ce.encodeLocation(q).pathname:q.pathname,De=Z.pathname,me=se&&se.navigation&&se.navigation.location?se.navigation.location.pathname:null;m||(De=De.toLowerCase(),me=me?me.toLowerCase():null,$e=$e.toLowerCase()),me&&ee&&(me=xl(me,ee)||me);const be=$e!=="/"&&$e.endsWith("/")?$e.length-1:$e.length;let Me=De===$e||!$&&De.startsWith($e)&&De.charAt(be)==="/",Be=me!=null&&(me===$e||!$&&me.startsWith($e)&&me.charAt($e.length)==="/"),qe={isActive:Me,isPending:Be,isTransitioning:he},Re=Me?d:void 0,at;typeof y=="function"?at=y(qe):at=[y,Me?"active":null,Be?"pending":null,he?"transitioning":null].filter(Boolean).join(" ");let Xe=typeof E=="function"?E(qe):E;return ne.createElement(C0,{...M,"aria-current":Re,className:at,ref:H,style:Xe,to:R,viewTransition:D},typeof T=="function"?T(qe):T)});S_.displayName="NavLink";var E_=ne.forwardRef(({discover:o="render",fetcherKey:d,navigate:m,reloadDocument:y,replace:$,state:E,method:R=bm,action:D,onSubmit:T,relative:M,preventScrollReset:H,viewTransition:q,unstable_defaultShouldRevalidate:Z,...se},ce)=>{let{unstable_useTransitions:ee}=ne.useContext(gi),he=O_(),$e=R_(D,{relative:M}),De=R.toLowerCase()==="get"?"get":"post",me=typeof D=="string"&&T0.test(D),be=Me=>{if(T&&T(Me),Me.defaultPrevented)return;Me.preventDefault();let Be=Me.nativeEvent.submitter,qe=(Be==null?void 0:Be.getAttribute("formmethod"))||R,Re=()=>he(Be||Me.currentTarget,{fetcherKey:d,method:qe,navigate:m,replace:$,state:E,relative:M,preventScrollReset:H,viewTransition:q,unstable_defaultShouldRevalidate:Z});ee&&m!==!1?ne.startTransition(()=>Re()):Re()};return ne.createElement("form",{ref:ce,method:De,action:$e,onSubmit:y?T:be,...se,"data-discover":!me&&o==="render"?"true":void 0})});E_.displayName="Form";function T_(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function z0(o){let d=ne.useContext(_d);return wa(d,T_(o)),d}function C_(o,{target:d,replace:m,state:y,preventScrollReset:$,relative:E,viewTransition:R,unstable_defaultShouldRevalidate:D,unstable_useTransitions:T}={}){let M=Du(),H=Oo(),q=ih(o,{relative:E});return ne.useCallback(Z=>{if(i_(Z,d)){Z.preventDefault();let se=m!==void 0?m:Jp(H)===Jp(q),ce=()=>M(o,{replace:se,state:y,preventScrollReset:$,relative:E,viewTransition:R,unstable_defaultShouldRevalidate:D});T?ne.startTransition(()=>ce()):ce()}},[H,M,q,m,y,d,o,$,E,R,D,T])}var z_=0,A_=()=>`__${String(++z_)}__`;function O_(){let{router:o}=z0("useSubmit"),{basename:d}=ne.useContext(gi),m=Kb(),y=o.fetch,$=o.navigate;return ne.useCallback(async(E,R={})=>{let{action:D,method:T,encType:M,formData:H,body:q}=l_(E,d);if(R.navigate===!1){let Z=R.fetcherKey||A_();await y(Z,m,R.action||D,{unstable_defaultShouldRevalidate:R.unstable_defaultShouldRevalidate,preventScrollReset:R.preventScrollReset,formData:H,body:q,formMethod:R.method||T,formEncType:R.encType||M,flushSync:R.flushSync})}else await $(R.action||D,{unstable_defaultShouldRevalidate:R.unstable_defaultShouldRevalidate,preventScrollReset:R.preventScrollReset,formData:H,body:q,formMethod:R.method||T,formEncType:R.encType||M,replace:R.replace,state:R.state,fromRouteId:m,flushSync:R.flushSync,viewTransition:R.viewTransition})},[y,$,d,m])}function R_(o,{relative:d}={}){let{basename:m}=ne.useContext(gi),y=ne.useContext($s);wa(y,"useFormAction must be used inside a RouteContext");let[$]=y.matches.slice(-1),E={...ih(o||".",{relative:d})},R=Oo();if(o==null){E.search=R.search;let D=new URLSearchParams(E.search),T=D.getAll("index");if(T.some(H=>H==="")){D.delete("index"),T.filter(q=>q).forEach(q=>D.append("index",q));let H=D.toString();E.search=H?`?${H}`:""}}return(!o||o===".")&&$.route.index&&(E.search=E.search?E.search.replace(/^\?/,"?index&"):"?index"),m!=="/"&&(E.pathname=E.pathname==="/"?m:wl([m,E.pathname])),Jp(E)}function M_(o,{relative:d}={}){let m=ne.useContext(y0);wa(m!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:y}=z0("useViewTransitionState"),$=ih(o,{relative:d});if(!m.isTransitioning)return!1;let E=xl(m.currentLocation.pathname,y)||m.currentLocation.pathname,R=xl(m.nextLocation.pathname,y)||m.nextLocation.pathname;return $m($.pathname,R)!=null||$m($.pathname,E)!=null}function A0(o){var d,m,y="";if(typeof o=="string"||typeof o=="number")y+=o;else if(typeof o=="object")if(Array.isArray(o)){var $=o.length;for(d=0;d<$;d++)o[d]&&(m=A0(o[d]))&&(y&&(y+=" "),y+=m)}else for(m in o)o[m]&&(y&&(y+=" "),y+=m);return y}function O0(){for(var o,d,m=0,y="",$=arguments.length;m<$;m++)(o=arguments[m])&&(d=A0(o))&&(y&&(y+=" "),y+=d);return y}const Sg="-",k_=o=>{const d=B_(o),{conflictingClassGroups:m,conflictingClassGroupModifiers:y}=o;return{getClassGroupId:R=>{const D=R.split(Sg);return D[0]===""&&D.length!==1&&D.shift(),R0(D,d)||D_(R)},getConflictingClassGroupIds:(R,D)=>{const T=m[R]||[];return D&&y[R]?[...T,...y[R]]:T}}},R0=(o,d)=>{var R;if(o.length===0)return d.classGroupId;const m=o[0],y=d.nextPart.get(m),$=y?R0(o.slice(1),y):void 0;if($)return $;if(d.validators.length===0)return;const E=o.join(Sg);return(R=d.validators.find(({validator:D})=>D(E)))==null?void 0:R.classGroupId},xy=/^\[(.+)\]$/,D_=o=>{if(xy.test(o)){const d=xy.exec(o)[1],m=d==null?void 0:d.substring(0,d.indexOf(":"));if(m)return"arbitrary.."+m}},B_=o=>{const{theme:d,prefix:m}=o,y={nextPart:new Map,validators:[]};return U_(Object.entries(o.classGroups),m).forEach(([E,R])=>{dg(R,y,E,d)}),y},dg=(o,d,m,y)=>{o.forEach($=>{if(typeof $=="string"){const E=$===""?d:$y(d,$);E.classGroupId=m;return}if(typeof $=="function"){if(N_($)){dg($(y),d,m,y);return}d.validators.push({validator:$,classGroupId:m});return}Object.entries($).forEach(([E,R])=>{dg(R,$y(d,E),m,y)})})},$y=(o,d)=>{let m=o;return d.split(Sg).forEach(y=>{m.nextPart.has(y)||m.nextPart.set(y,{nextPart:new Map,validators:[]}),m=m.nextPart.get(y)}),m},N_=o=>o.isThemeGetter,U_=(o,d)=>d?o.map(([m,y])=>{const $=y.map(E=>typeof E=="string"?d+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([R,D])=>[d+R,D])):E);return[m,$]}):o,I_=o=>{if(o<1)return{get:()=>{},set:()=>{}};let d=0,m=new Map,y=new Map;const $=(E,R)=>{m.set(E,R),d++,d>o&&(d=0,y=m,m=new Map)};return{get(E){let R=m.get(E);if(R!==void 0)return R;if((R=y.get(E))!==void 0)return $(E,R),R},set(E,R){m.has(E)?m.set(E,R):$(E,R)}}},M0="!",L_=o=>{const{separator:d,experimentalParseClassName:m}=o,y=d.length===1,$=d[0],E=d.length,R=D=>{const T=[];let M=0,H=0,q;for(let he=0;he<D.length;he++){let $e=D[he];if(M===0){if($e===$&&(y||D.slice(he,he+E)===d)){T.push(D.slice(H,he)),H=he+E;continue}if($e==="/"){q=he;continue}}$e==="["?M++:$e==="]"&&M--}const Z=T.length===0?D:D.substring(H),se=Z.startsWith(M0),ce=se?Z.substring(1):Z,ee=q&&q>H?q-H:void 0;return{modifiers:T,hasImportantModifier:se,baseClassName:ce,maybePostfixModifierPosition:ee}};return m?D=>m({className:D,parseClassName:R}):R},q_=o=>{if(o.length<=1)return o;const d=[];let m=[];return o.forEach(y=>{y[0]==="["?(d.push(...m.sort(),y),m=[]):m.push(y)}),d.push(...m.sort()),d},j_=o=>({cache:I_(o.cacheSize),parseClassName:L_(o),...k_(o)}),G_=/\s+/,V_=(o,d)=>{const{parseClassName:m,getClassGroupId:y,getConflictingClassGroupIds:$}=d,E=[],R=o.trim().split(G_);let D="";for(let T=R.length-1;T>=0;T-=1){const M=R[T],{modifiers:H,hasImportantModifier:q,baseClassName:Z,maybePostfixModifierPosition:se}=m(M);let ce=!!se,ee=y(ce?Z.substring(0,se):Z);if(!ee){if(!ce){D=M+(D.length>0?" "+D:D);continue}if(ee=y(Z),!ee){D=M+(D.length>0?" "+D:D);continue}ce=!1}const he=q_(H).join(":"),$e=q?he+M0:he,De=$e+ee;if(E.includes(De))continue;E.push(De);const me=$(ee,ce);for(let be=0;be<me.length;++be){const Me=me[be];E.push($e+Me)}D=M+(D.length>0?" "+D:D)}return D};function H_(){let o=0,d,m,y="";for(;o<arguments.length;)(d=arguments[o++])&&(m=k0(d))&&(y&&(y+=" "),y+=m);return y}const k0=o=>{if(typeof o=="string")return o;let d,m="";for(let y=0;y<o.length;y++)o[y]&&(d=k0(o[y]))&&(m&&(m+=" "),m+=d);return m};function P_(o,...d){let m,y,$,E=R;function R(T){const M=d.reduce((H,q)=>q(H),o());return m=j_(M),y=m.cache.get,$=m.cache.set,E=D,D(T)}function D(T){const M=y(T);if(M)return M;const H=V_(T,m);return $(T,H),H}return function(){return E(H_.apply(null,arguments))}}const ha=o=>{const d=m=>m[o]||[];return d.isThemeGetter=!0,d},D0=/^\[(?:([a-z-]+):)?(.+)\]$/i,F_=/^\d+\/\d+$/,K_=new Set(["px","full","screen"]),W_=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Q_=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Y_=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,X_=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Z_=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ml=o=>ud(o)||K_.has(o)||F_.test(o),wo=o=>xd(o,"length",sw),ud=o=>!!o&&!Number.isNaN(Number(o)),Jm=o=>xd(o,"number",ud),Up=o=>!!o&&Number.isInteger(Number(o)),J_=o=>o.endsWith("%")&&ud(o.slice(0,-1)),zt=o=>D0.test(o),xo=o=>W_.test(o),ew=new Set(["length","size","percentage"]),tw=o=>xd(o,ew,B0),aw=o=>xd(o,"position",B0),nw=new Set(["image","url"]),iw=o=>xd(o,nw,ow),rw=o=>xd(o,"",lw),Ip=()=>!0,xd=(o,d,m)=>{const y=D0.exec(o);return y?y[1]?typeof d=="string"?y[1]===d:d.has(y[1]):m(y[2]):!1},sw=o=>Q_.test(o)&&!Y_.test(o),B0=()=>!1,lw=o=>X_.test(o),ow=o=>Z_.test(o),uw=()=>{const o=ha("colors"),d=ha("spacing"),m=ha("blur"),y=ha("brightness"),$=ha("borderColor"),E=ha("borderRadius"),R=ha("borderSpacing"),D=ha("borderWidth"),T=ha("contrast"),M=ha("grayscale"),H=ha("hueRotate"),q=ha("invert"),Z=ha("gap"),se=ha("gradientColorStops"),ce=ha("gradientColorStopPositions"),ee=ha("inset"),he=ha("margin"),$e=ha("opacity"),De=ha("padding"),me=ha("saturate"),be=ha("scale"),Me=ha("sepia"),Be=ha("skew"),qe=ha("space"),Re=ha("translate"),at=()=>["auto","contain","none"],Xe=()=>["auto","hidden","clip","visible","scroll"],et=()=>["auto",zt,d],Qe=()=>[zt,d],_t=()=>["",ml,wo],Dt=()=>["auto",ud,zt],ma=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],_e=()=>["solid","dashed","dotted","double","none"],Oe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Pe=()=>["start","end","center","between","around","evenly","stretch"],At=()=>["","0",zt],ht=()=>["auto","avoid","all","avoid-page","page","left","right","column"],K=()=>[ud,zt];return{cacheSize:500,separator:":",theme:{colors:[Ip],spacing:[ml,wo],blur:["none","",xo,zt],brightness:K(),borderColor:[o],borderRadius:["none","","full",xo,zt],borderSpacing:Qe(),borderWidth:_t(),contrast:K(),grayscale:At(),hueRotate:K(),invert:At(),gap:Qe(),gradientColorStops:[o],gradientColorStopPositions:[J_,wo],inset:et(),margin:et(),opacity:K(),padding:Qe(),saturate:K(),scale:K(),sepia:At(),skew:K(),space:Qe(),translate:Qe()},classGroups:{aspect:[{aspect:["auto","square","video",zt]}],container:["container"],columns:[{columns:[xo]}],"break-after":[{"break-after":ht()}],"break-before":[{"break-before":ht()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ma(),zt]}],overflow:[{overflow:Xe()}],"overflow-x":[{"overflow-x":Xe()}],"overflow-y":[{"overflow-y":Xe()}],overscroll:[{overscroll:at()}],"overscroll-x":[{"overscroll-x":at()}],"overscroll-y":[{"overscroll-y":at()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ee]}],"inset-x":[{"inset-x":[ee]}],"inset-y":[{"inset-y":[ee]}],start:[{start:[ee]}],end:[{end:[ee]}],top:[{top:[ee]}],right:[{right:[ee]}],bottom:[{bottom:[ee]}],left:[{left:[ee]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Up,zt]}],basis:[{basis:et()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",zt]}],grow:[{grow:At()}],shrink:[{shrink:At()}],order:[{order:["first","last","none",Up,zt]}],"grid-cols":[{"grid-cols":[Ip]}],"col-start-end":[{col:["auto",{span:["full",Up,zt]},zt]}],"col-start":[{"col-start":Dt()}],"col-end":[{"col-end":Dt()}],"grid-rows":[{"grid-rows":[Ip]}],"row-start-end":[{row:["auto",{span:[Up,zt]},zt]}],"row-start":[{"row-start":Dt()}],"row-end":[{"row-end":Dt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",zt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",zt]}],gap:[{gap:[Z]}],"gap-x":[{"gap-x":[Z]}],"gap-y":[{"gap-y":[Z]}],"justify-content":[{justify:["normal",...Pe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Pe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Pe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[De]}],px:[{px:[De]}],py:[{py:[De]}],ps:[{ps:[De]}],pe:[{pe:[De]}],pt:[{pt:[De]}],pr:[{pr:[De]}],pb:[{pb:[De]}],pl:[{pl:[De]}],m:[{m:[he]}],mx:[{mx:[he]}],my:[{my:[he]}],ms:[{ms:[he]}],me:[{me:[he]}],mt:[{mt:[he]}],mr:[{mr:[he]}],mb:[{mb:[he]}],ml:[{ml:[he]}],"space-x":[{"space-x":[qe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[qe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",zt,d]}],"min-w":[{"min-w":[zt,d,"min","max","fit"]}],"max-w":[{"max-w":[zt,d,"none","full","min","max","fit","prose",{screen:[xo]},xo]}],h:[{h:[zt,d,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[zt,d,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[zt,d,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[zt,d,"auto","min","max","fit"]}],"font-size":[{text:["base",xo,wo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Jm]}],"font-family":[{font:[Ip]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",zt]}],"line-clamp":[{"line-clamp":["none",ud,Jm]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ml,zt]}],"list-image":[{"list-image":["none",zt]}],"list-style-type":[{list:["none","disc","decimal",zt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[o]}],"placeholder-opacity":[{"placeholder-opacity":[$e]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[o]}],"text-opacity":[{"text-opacity":[$e]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[..._e(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ml,wo]}],"underline-offset":[{"underline-offset":["auto",ml,zt]}],"text-decoration-color":[{decoration:[o]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Qe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",zt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",zt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[$e]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ma(),aw]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",tw]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},iw]}],"bg-color":[{bg:[o]}],"gradient-from-pos":[{from:[ce]}],"gradient-via-pos":[{via:[ce]}],"gradient-to-pos":[{to:[ce]}],"gradient-from":[{from:[se]}],"gradient-via":[{via:[se]}],"gradient-to":[{to:[se]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[D]}],"border-w-x":[{"border-x":[D]}],"border-w-y":[{"border-y":[D]}],"border-w-s":[{"border-s":[D]}],"border-w-e":[{"border-e":[D]}],"border-w-t":[{"border-t":[D]}],"border-w-r":[{"border-r":[D]}],"border-w-b":[{"border-b":[D]}],"border-w-l":[{"border-l":[D]}],"border-opacity":[{"border-opacity":[$e]}],"border-style":[{border:[..._e(),"hidden"]}],"divide-x":[{"divide-x":[D]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[D]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[$e]}],"divide-style":[{divide:_e()}],"border-color":[{border:[$]}],"border-color-x":[{"border-x":[$]}],"border-color-y":[{"border-y":[$]}],"border-color-s":[{"border-s":[$]}],"border-color-e":[{"border-e":[$]}],"border-color-t":[{"border-t":[$]}],"border-color-r":[{"border-r":[$]}],"border-color-b":[{"border-b":[$]}],"border-color-l":[{"border-l":[$]}],"divide-color":[{divide:[$]}],"outline-style":[{outline:["",..._e()]}],"outline-offset":[{"outline-offset":[ml,zt]}],"outline-w":[{outline:[ml,wo]}],"outline-color":[{outline:[o]}],"ring-w":[{ring:_t()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[o]}],"ring-opacity":[{"ring-opacity":[$e]}],"ring-offset-w":[{"ring-offset":[ml,wo]}],"ring-offset-color":[{"ring-offset":[o]}],shadow:[{shadow:["","inner","none",xo,rw]}],"shadow-color":[{shadow:[Ip]}],opacity:[{opacity:[$e]}],"mix-blend":[{"mix-blend":[...Oe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Oe()}],filter:[{filter:["","none"]}],blur:[{blur:[m]}],brightness:[{brightness:[y]}],contrast:[{contrast:[T]}],"drop-shadow":[{"drop-shadow":["","none",xo,zt]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[H]}],invert:[{invert:[q]}],saturate:[{saturate:[me]}],sepia:[{sepia:[Me]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[m]}],"backdrop-brightness":[{"backdrop-brightness":[y]}],"backdrop-contrast":[{"backdrop-contrast":[T]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[H]}],"backdrop-invert":[{"backdrop-invert":[q]}],"backdrop-opacity":[{"backdrop-opacity":[$e]}],"backdrop-saturate":[{"backdrop-saturate":[me]}],"backdrop-sepia":[{"backdrop-sepia":[Me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[R]}],"border-spacing-x":[{"border-spacing-x":[R]}],"border-spacing-y":[{"border-spacing-y":[R]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",zt]}],duration:[{duration:K()}],ease:[{ease:["linear","in","out","in-out",zt]}],delay:[{delay:K()}],animate:[{animate:["none","spin","ping","pulse","bounce",zt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[be]}],"scale-x":[{"scale-x":[be]}],"scale-y":[{"scale-y":[be]}],rotate:[{rotate:[Up,zt]}],"translate-x":[{"translate-x":[Re]}],"translate-y":[{"translate-y":[Re]}],"skew-x":[{"skew-x":[Be]}],"skew-y":[{"skew-y":[Be]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",zt]}],accent:[{accent:["auto",o]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",zt]}],"caret-color":[{caret:[o]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Qe()}],"scroll-mx":[{"scroll-mx":Qe()}],"scroll-my":[{"scroll-my":Qe()}],"scroll-ms":[{"scroll-ms":Qe()}],"scroll-me":[{"scroll-me":Qe()}],"scroll-mt":[{"scroll-mt":Qe()}],"scroll-mr":[{"scroll-mr":Qe()}],"scroll-mb":[{"scroll-mb":Qe()}],"scroll-ml":[{"scroll-ml":Qe()}],"scroll-p":[{"scroll-p":Qe()}],"scroll-px":[{"scroll-px":Qe()}],"scroll-py":[{"scroll-py":Qe()}],"scroll-ps":[{"scroll-ps":Qe()}],"scroll-pe":[{"scroll-pe":Qe()}],"scroll-pt":[{"scroll-pt":Qe()}],"scroll-pr":[{"scroll-pr":Qe()}],"scroll-pb":[{"scroll-pb":Qe()}],"scroll-pl":[{"scroll-pl":Qe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",zt]}],fill:[{fill:[o,"none"]}],"stroke-w":[{stroke:[ml,wo,Jm]}],stroke:[{stroke:[o,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},cw=P_(uw);function mi(...o){return cw(O0(o))}function Sy(o){return new Promise(d=>setTimeout(d,o))}function eg(o){return o[Math.floor(Math.random()*o.length)]}function dw(o){const d=Math.floor(o/60),m=Math.floor(o%60);return`${d}:${m.toString().padStart(2,"0")}`}function vd({children:o,color:d="pink",as:m="span",className:y}){return we.jsx(m,{className:mi("font-display",{"neon-pink":d==="pink","neon-cyan":d==="cyan","neon-gold":d==="gold","neon-green":d==="green"},y),children:o})}function Ey(o,d){if(typeof o=="function")return o(d);o!=null&&(o.current=d)}function fw(...o){return d=>{let m=!1;const y=o.map($=>{const E=Ey($,d);return!m&&typeof E=="function"&&(m=!0),E});if(m)return()=>{for(let $=0;$<y.length;$++){const E=y[$];typeof E=="function"?E():Ey(o[$],null)}}}}var pw=Symbol.for("react.lazy"),Sm=bv[" use ".trim().toString()];function hw(o){return typeof o=="object"&&o!==null&&"then"in o}function N0(o){return o!=null&&typeof o=="object"&&"$$typeof"in o&&o.$$typeof===pw&&"_payload"in o&&hw(o._payload)}function mw(o){const d=yw(o),m=ne.forwardRef((y,$)=>{let{children:E,...R}=y;N0(E)&&typeof Sm=="function"&&(E=Sm(E._payload));const D=ne.Children.toArray(E),T=D.find(bw);if(T){const M=T.props.children,H=D.map(q=>q===T?ne.Children.count(M)>1?ne.Children.only(null):ne.isValidElement(M)?M.props.children:null:q);return we.jsx(d,{...R,ref:$,children:ne.isValidElement(M)?ne.cloneElement(M,void 0,H):null})}return we.jsx(d,{...R,ref:$,children:E})});return m.displayName=`${o}.Slot`,m}var gw=mw("Slot");function yw(o){const d=ne.forwardRef((m,y)=>{let{children:$,...E}=m;if(N0($)&&typeof Sm=="function"&&($=Sm($._payload)),ne.isValidElement($)){const R=ww($),D=_w(E,$.props);return $.type!==ne.Fragment&&(D.ref=y?fw(y,R):R),ne.cloneElement($,D)}return ne.Children.count($)>1?ne.Children.only(null):null});return d.displayName=`${o}.SlotClone`,d}var vw=Symbol("radix.slottable");function bw(o){return ne.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===vw}function _w(o,d){const m={...d};for(const y in d){const $=o[y],E=d[y];/^on[A-Z]/.test(y)?$&&E?m[y]=(...D)=>{const T=E(...D);return $(...D),T}:$&&(m[y]=$):y==="style"?m[y]={...$,...E}:y==="className"&&(m[y]=[$,E].filter(Boolean).join(" "))}return{...o,...m}}function ww(o){var y,$;let d=(y=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:y.get,m=d&&"isReactWarning"in d&&d.isReactWarning;return m?o.ref:(d=($=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:$.get,m=d&&"isReactWarning"in d&&d.isReactWarning,m?o.props.ref:o.props.ref||o.ref)}const Ty=o=>typeof o=="boolean"?`${o}`:o===0?"0":o,Cy=O0,xw=(o,d)=>m=>{var y;if((d==null?void 0:d.variants)==null)return Cy(o,m==null?void 0:m.class,m==null?void 0:m.className);const{variants:$,defaultVariants:E}=d,R=Object.keys($).map(M=>{const H=m==null?void 0:m[M],q=E==null?void 0:E[M];if(H===null)return null;const Z=Ty(H)||Ty(q);return $[M][Z]}),D=m&&Object.entries(m).reduce((M,H)=>{let[q,Z]=H;return Z===void 0||(M[q]=Z),M},{}),T=d==null||(y=d.compoundVariants)===null||y===void 0?void 0:y.reduce((M,H)=>{let{class:q,className:Z,...se}=H;return Object.entries(se).every(ce=>{let[ee,he]=ce;return Array.isArray(he)?he.includes({...E,...D}[ee]):{...E,...D}[ee]===he})?[...M,q,Z]:M},[]);return Cy(o,R,T,m==null?void 0:m.class,m==null?void 0:m.className)},$w=xw("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full text-sm font-extrabold uppercase tracking-widest transition-transform duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95 hover:scale-105",{variants:{variant:{pink:"bg-gradient-to-br from-[#ff2d95] to-[#ff6ec7] text-white shadow-[0_0_20px_rgba(255,45,149,0.4),0_4px_15px_rgba(0,0,0,0.3)]",cyan:"bg-gradient-to-br from-[#00e5ff] to-[#00b8d4] text-[#0a0a1a] shadow-[0_0_20px_rgba(0,229,255,0.4),0_4px_15px_rgba(0,0,0,0.3)]",gold:"bg-gradient-to-br from-[#ffd700] to-[#ffaa00] text-[#0a0a1a] shadow-[0_0_20px_rgba(255,215,0,0.4),0_4px_15px_rgba(0,0,0,0.3)]",red:"bg-gradient-to-br from-[#ff3b3b] to-[#ff6b6b] text-white shadow-[0_0_20px_rgba(255,59,59,0.4),0_4px_15px_rgba(0,0,0,0.3)]",outline:"border-2 border-white/20 bg-transparent text-white/70 hover:border-white/45 hover:text-white",ghost:"bg-transparent hover:bg-white/5 text-white/70 hover:text-white"},size:{default:"px-12 py-4 text-lg",sm:"px-5 py-2 text-sm",icon:"h-8 w-8 rounded-full p-0"}},defaultVariants:{variant:"pink",size:"default"}}),xs=ne.forwardRef(({className:o,variant:d,size:m,asChild:y=!1,...$},E)=>{const R=y?gw:"button";return we.jsx(R,{className:mi($w({variant:d,size:m,className:o})),ref:E,...$})});xs.displayName="Button";const zy=o=>{let d;const m=new Set,y=(M,H)=>{const q=typeof M=="function"?M(d):M;if(!Object.is(q,d)){const Z=d;d=H??(typeof q!="object"||q===null)?q:Object.assign({},d,q),m.forEach(se=>se(d,Z))}},$=()=>d,D={setState:y,getState:$,getInitialState:()=>T,subscribe:M=>(m.add(M),()=>m.delete(M))},T=d=o(y,$,D);return D},Sw=(o=>o?zy(o):zy),Ew=o=>o;function Tw(o,d=Ew){const m=Qp.useSyncExternalStore(o.subscribe,Qp.useCallback(()=>d(o.getState()),[o,d]),Qp.useCallback(()=>d(o.getInitialState()),[o,d]));return Qp.useDebugValue(m),m}const Ay=o=>{const d=Sw(o),m=y=>Tw(d,y);return Object.assign(m,d),m},Cw=(o=>o?Ay(o):Ay),hi=[{name:"neon-pink",hex:"#ff2d95"},{name:"neon-cyan",hex:"#00e5ff"},{name:"neon-gold",hex:"#ffd700"},{name:"neon-green",hex:"#39ff14"},{name:"neon-pink",hex:"#ff6ec7"},{name:"neon-cyan",hex:"#00b8d4"},{name:"neon-gold",hex:"#ffaa00"},{name:"neon-green",hex:"#76ff03"}],Am={quick:{label:"Quick Match",rounds:1,icon:"",description:"One round, pure glory"},tournament3:{label:"Tournament",rounds:3,icon:"",description:"Best of three rounds"},tournament5:{label:"Championship",rounds:5,icon:"",description:"Prove your dominance"},tournament10:{label:"Marathon",rounds:10,icon:"",description:"The ultimate showdown"}},zw=Object.keys(Am),Aw=2,Oy=8,fg=.02,Ry=60,Ow=1800,gm=1.3,ym={energy:.4,pitch:.3,sustain:.2,duration:.1};function My(){return[0,1].map(o=>({name:"",bumpers:!1,color:hi[o%hi.length]}))}const rh=Cw((o,d)=>({players:My(),selectedMode:"quick",totalRounds:1,currentRound:1,currentPlayer:0,scores:[],cumulativeScores:[],addPlayer:()=>{const{players:m}=d();if(m.length>=8)return;const y=m.length;o({players:[...m,{name:"",bumpers:!1,color:hi[y%hi.length]}]})},removePlayer:m=>{const{players:y}=d();if(y.length<=2)return;const $=y.filter((E,R)=>R!==m).map((E,R)=>({...E,color:hi[R%hi.length]}));o({players:$})},updatePlayerName:(m,y)=>{const $=[...d().players],E=$[m];E&&($[m]={...E,name:y}),o({players:$})},updatePlayerBumpers:(m,y)=>{const $=[...d().players],E=$[m];E&&($[m]={...E,bumpers:y}),o({players:$})},setSelectedMode:m=>{o({selectedMode:m})},confirmMode:()=>{const{selectedMode:m}=d();o({totalRounds:Am[m].rounds})},initNewGame:()=>{const{players:m}=d();o({currentRound:1,cumulativeScores:new Array(m.length).fill(0)}),d().startRound()},startRound:()=>{const{players:m}=d();o({scores:new Array(m.length).fill(null),currentPlayer:0})},recordScore:m=>{const{currentPlayer:y,scores:$,cumulativeScores:E}=d(),R=[...$];R[y]=m;const D=[...E];D[y]=(D[y]??0)+m.total,o({scores:R,cumulativeScores:D})},advancePlayer:()=>{o(m=>({currentPlayer:m.currentPlayer+1}))},nextRound:()=>{o(m=>({currentRound:m.currentRound+1})),d().startRound()},resetToPlayerSetup:()=>{o({players:My(),selectedMode:"quick",totalRounds:1,currentRound:1,currentPlayer:0,scores:[],cumulativeScores:[]})}}));function Rw(){const o=Du(),d=rh(y=>y.resetToPlayerSetup);function m(){d(),o("/players")}return we.jsxs("div",{className:"screen-container",children:[we.jsx("div",{className:"text-8xl mb-6 animate-pulse-mic",children:""}),we.jsx(vd,{as:"h1",color:"pink",className:"text-[clamp(3rem,10vw,7rem)] leading-none mb-2",children:"KARAOKE KING"}),we.jsx("p",{className:"text-xl opacity-70 mb-12 tracking-[3px] uppercase",children:"Battle for Glory"}),we.jsx(xs,{variant:"pink",onClick:m,children:"Start Game"})]})}/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mw=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),U0=(...o)=>o.filter((d,m,y)=>!!d&&d.trim()!==""&&y.indexOf(d)===m).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var kw={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dw=ne.forwardRef(({color:o="currentColor",size:d=24,strokeWidth:m=2,absoluteStrokeWidth:y,className:$="",children:E,iconNode:R,...D},T)=>ne.createElement("svg",{ref:T,...kw,width:d,height:d,stroke:o,strokeWidth:y?Number(m)*24/Number(d):m,className:U0("lucide",$),...D},[...R.map(([M,H])=>ne.createElement(M,H)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=(o,d)=>{const m=ne.forwardRef(({className:y,...$},E)=>ne.createElement(Dw,{ref:E,iconNode:d,className:U0(`lucide-${Mw(o)}`,y),...$}));return m.displayName=`${o}`,m};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bw=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Nw=I0("X",Bw);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uw=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Iw=I0("Zap",Uw);function Lw({player:o,index:d,showRemove:m,onNameChange:y,onBumpersChange:$,onRemove:E}){return we.jsxs("div",{className:"flex items-center gap-2.5 w-full animate-slide-in",children:[we.jsx("span",{className:"font-display text-lg w-7 text-center flex-shrink-0",style:{color:o.color.hex},children:d+1}),we.jsx("input",{type:"text",value:o.name,onChange:R=>y(R.target.value),placeholder:`Player ${d+1}...`,maxLength:16,autoComplete:"off",className:mi("flex-1 min-w-0 text-center font-semibold text-lg","bg-white/5 border-2 border-white/15 rounded-2xl","px-4 py-2.5 text-white outline-none","transition-all duration-200","focus:border-[#ff2d95] focus:shadow-[0_0_12px_rgba(255,45,149,0.27)]","placeholder:text-white/30")}),we.jsx("button",{type:"button",title:o.bumpers?"Assist on":"Assist off (score boost)","aria-label":`Toggle assist for player ${d+1}`,"aria-pressed":o.bumpers,onClick:()=>$(!o.bumpers),style:{display:"none"},className:mi("flex items-center justify-center w-10 h-10 rounded-xl flex-shrink-0","border transition-all duration-200",o.bumpers?"bg-[#00e5ff]/15 border-[#00e5ff]/50 text-[#00e5ff] shadow-[0_0_8px_rgba(0,229,255,0.25)]":"bg-white/5 border-white/10 text-white/35 hover:bg-white/10 hover:border-white/20 hover:text-white/60"),children:we.jsx(Iw,{size:16,fill:o.bumpers?"currentColor":"none"})}),we.jsx("button",{onClick:E,className:mi("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0","border border-white/15 bg-red-500/15 text-red-400","transition-all duration-150 hover:bg-red-500/35 hover:scale-110",m?"visible":"invisible"),"aria-label":"Remove player",children:we.jsx(Nw,{size:14})})]})}function qw(){const o=Du(),{players:d,addPlayer:m,removePlayer:y,updatePlayerName:$,updatePlayerBumpers:E}=rh();function R(){o("/mode")}const D=d.length<Oy,T=d.length>Aw;return we.jsxs("div",{className:"screen-container overflow-y-auto py-10 px-5",children:[we.jsx(vd,{as:"h2",color:"cyan",className:"text-[2.2rem] mb-6",children:"ENTER THE ARENA"}),we.jsxs("div",{className:"flex flex-col gap-3 items-center w-full max-w-[420px]",children:[we.jsxs("p",{className:"text-xs uppercase tracking-[2px] opacity-40 self-start",children:[d.length," / ",Oy," Players"]}),we.jsx("div",{className:"flex flex-col gap-2.5 w-full",children:d.map((M,H)=>we.jsx(Lw,{player:M,index:H,showRemove:T,onNameChange:q=>$(H,q),onBumpersChange:q=>E(H,q),onRemove:()=>y(H)},H))}),we.jsx("div",{className:"flex gap-3 mt-1",children:we.jsx(xs,{variant:"cyan",size:"sm",onClick:m,disabled:!D,className:D?"":"opacity-30 pointer-events-none",children:"+ Add Player"})}),we.jsx(xs,{variant:"gold",className:"mt-2 w-full",onClick:R,children:"Let's Go!"})]})]})}const jw={quick:"neon-cyan",tournament3:"neon-gold",tournament5:"neon-pink",tournament10:"neon-green"};function Gw({modeKey:o,config:d,selected:m,onSelect:y}){return we.jsxs("button",{onClick:y,className:mi("flex flex-col items-center justify-center gap-1 rounded-2xl cursor-pointer select-none","bg-white/[0.04] border-2 border-white/[0.08]","transition-all duration-200 hover:-translate-y-1 hover:scale-[1.02] hover:bg-white/[0.07]","p-6 min-h-[140px]",m&&"border-[#ff2d95] shadow-[0_0_24px_rgba(255,45,149,0.27)] bg-[rgba(255,45,149,0.1)]"),children:[we.jsx("div",{className:"text-4xl leading-none mb-1",children:d.icon}),we.jsx("div",{className:mi("font-display text-xl tracking-widest",jw[o]),children:d.label.toUpperCase()}),we.jsx("div",{className:"text-xs uppercase tracking-wide text-white/50",children:d.description}),we.jsx("div",{className:"mt-1 text-xs bg-white/[0.08] rounded-full px-3 py-0.5 tracking-wide text-white/70",children:d.rounds===1?"1 Round":`${d.rounds} Rounds`})]})}function Vw(){const o=Du(),{selectedMode:d,setSelectedMode:m,confirmMode:y,initNewGame:$}=rh();function E(){y(),$(),o("/sing")}return we.jsxs("div",{className:"screen-container gap-0 px-5 py-5",children:[we.jsx(vd,{as:"h2",color:"pink",className:"text-[clamp(1.4rem,4vw,3rem)] mb-1",children:"CHOOSE YOUR BATTLE"}),we.jsx("p",{className:"text-[clamp(0.7rem,1.5vw,0.95rem)] uppercase tracking-[3px] opacity-50 mb-6",children:"Select Game Mode"}),we.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 w-[min(96vw,860px)] mb-6",children:zw.map(R=>we.jsx(Gw,{modeKey:R,config:Am[R],selected:d===R,onSelect:()=>m(R)},R))}),we.jsx(xs,{variant:"gold",className:"text-[clamp(0.9rem,2vw,1.2rem)] px-[clamp(28px,5vw,48px)] py-[clamp(10px,2vh,16px)]",onClick:E,children:"Let's Go! "})]})}function Hw(o,d,m,y,$,E){$<1||(E=Math.min(E,$/2,y/2),o.beginPath(),o.moveTo(d+E,m),o.lineTo(d+y-E,m),o.quadraticCurveTo(d+y,m,d+y,m+E),o.lineTo(d+y,m+$),o.lineTo(d,m+$),o.lineTo(d,m+E),o.quadraticCurveTo(d,m,d+E,m),o.fill())}function Pw(){return{draw:ne.useCallback((d,m)=>{const y=d.getContext("2d");if(!y)return;const $=d.width,E=d.height;y.clearRect(0,0,$,E);const R=64,D=$/R,T=Math.floor(m.length/R);for(let M=0;M<R;M++){const H=(m[M*T]??0)/255,q=H*E*.9,Z=300+M/R*60,se=.4+H*.6;y.fillStyle=`hsla(${Z}, 100%, 60%, ${se})`;const ce=M*D;Hw(y,ce+1,E-q,D-2,q,D*.3)}},[])}}function Fw({freqArray:o,isActive:d}){const m=ne.useRef(null),{draw:y}=Pw(),$=ne.useRef(null);return ne.useEffect(()=>{const E=m.current;if(!E)return;if((()=>{E.parentElement&&(E.width=E.parentElement.clientWidth,E.height=E.parentElement.clientHeight)})(),!d){const T=E.getContext("2d");T==null||T.clearRect(0,0,E.width,E.height);return}const D=()=>{E&&o.current.length>0&&y(E,o.current),$.current=requestAnimationFrame(D)};return $.current=requestAnimationFrame(D),()=>{$.current!==null&&cancelAnimationFrame($.current)}},[d,o,y]),we.jsx("div",{className:"w-full max-w-[600px] h-40 relative rounded-2xl overflow-hidden bg-white/[0.03] border border-white/[0.06]",children:we.jsx("canvas",{ref:m,className:"w-full h-full"})})}function Kw({percent:o}){return we.jsx("div",{className:"w-full max-w-[500px] h-3.5 bg-white/[0.08] rounded-full overflow-hidden",children:we.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-[#ff2d95] via-[#ff6ec7] to-[#ffd700] transition-[width] duration-100",style:{width:`${o}%`}})})}function Ww({message:o,colorClass:d}){const m=ne.useRef(null),y=ne.useRef(o);return ne.useEffect(()=>{o&&o!==y.current&&m.current&&(m.current.classList.remove("animate-feedback-pop"),m.current.offsetWidth,m.current.classList.add("animate-feedback-pop")),y.current=o},[o]),we.jsx("div",{className:"h-12 flex items-center justify-center",children:we.jsx("span",{ref:m,className:mi("font-display text-2xl tracking-widest whitespace-nowrap animate-feedback-pop",d),children:o})})}function Qw({isActive:o,value:d}){return o?we.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-[rgba(10,10,26,0.85)] z-50",children:we.jsx("div",{className:mi("font-display text-[12rem] leading-none animate-count-pop neon-gold"),children:d},String(d))}):null}var tg={},Lp={},ky;function L0(){if(ky)return Lp;ky=1,Object.defineProperty(Lp,"__esModule",{value:!0}),Lp.baseAssetPath=void 0;const d=typeof window<"u"&&typeof window.document<"u"?window.document.currentScript:null;let m="/";return d&&(m=d.src.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^/]+$/,"/")),Lp.baseAssetPath=m,Lp}var qp={},Dy;function Eg(){if(Dy)return qp;Dy=1,Object.defineProperty(qp,"__esModule",{value:!0}),qp.defaultModelFetcher=void 0;const o=d=>fetch(d).then(m=>m.arrayBuffer());return qp.defaultModelFetcher=o,qp}var gl={},jp={},By;function sh(){if(By)return jp;By=1,Object.defineProperty(jp,"__esModule",{value:!0}),jp.log=void 0;const o=d=>m=>{console.log(`VAD | ${d} >`,m)};return jp.log={error:o("error"),debug:o("debug"),warn:o("warn")},jp}var Gp={},Ny;function Om(){if(Ny)return Gp;Ny=1,Object.defineProperty(Gp,"__esModule",{value:!0}),Gp.Message=void 0;var o;return(function(d){d.AudioFrame="AUDIO_FRAME",d.SpeechStart="SPEECH_START",d.VADMisfire="VAD_MISFIRE",d.SpeechEnd="SPEECH_END",d.SpeechStop="SPEECH_STOP",d.SpeechRealStart="SPEECH_REAL_START",d.FrameProcessed="FRAME_PROCESSED"})(o||(Gp.Message=o={})),Gp}var Uy;function Tg(){if(Uy)return gl;Uy=1,Object.defineProperty(gl,"__esModule",{value:!0}),gl.FrameProcessor=gl.validateOptions=gl.defaultFrameProcessorOptions=void 0;const o=sh(),d=Om();gl.defaultFrameProcessorOptions={positiveSpeechThreshold:.3,negativeSpeechThreshold:.25,preSpeechPadMs:800,redemptionMs:1400,minSpeechMs:400,submitUserSpeechOnPause:!1};function m(R){(R.positiveSpeechThreshold<0||R.positiveSpeechThreshold>1)&&o.log.error("positiveSpeechThreshold should be a number between 0 and 1"),(R.negativeSpeechThreshold<0||R.negativeSpeechThreshold>R.positiveSpeechThreshold)&&o.log.error("negativeSpeechThreshold should be between 0 and positiveSpeechThreshold"),R.preSpeechPadMs<0&&o.log.error("preSpeechPadMs should be positive"),R.redemptionMs<0&&o.log.error("redemptionMs should be positive"),R.minSpeechMs<0&&o.log.error("minSpeechMs should be positive")}gl.validateOptions=m;const y=R=>{const D=R.reduce((M,H)=>(M.push(M.at(-1)+H.length),M),[0]),T=new Float32Array(D.at(-1));return R.forEach((M,H)=>{const q=D[H];T.set(M,q)}),T};function $(R,D){const T=Math.floor(R.redemptionMs/D),M=Math.floor(R.preSpeechPadMs/D),H=Math.floor(R.minSpeechMs/D);return{redemptionFrames:T,preSpeechPadFrames:M,minSpeechFrames:H}}class E{constructor(D,T,M,H){this.modelProcessFunc=D,this.modelResetFunc=T,this.options=M,this.msPerFrame=H,this.speaking=!1,this.redemptionCounter=0,this.speechFrameCount=0,this.active=!1,this.speechRealStartFired=!1,this.setOptions=ce=>{this.options={...this.options,...ce};const{redemptionFrames:ee,preSpeechPadFrames:he,minSpeechFrames:$e}=$(this.options,this.msPerFrame);this.redemptionFrames=ee,this.preSpeechPadFrames=he,this.minSpeechFrames=$e},this.reset=()=>{this.speaking=!1,this.speechRealStartFired=!1,this.audioBuffer=[],this.modelResetFunc(),this.redemptionCounter=0,this.speechFrameCount=0},this.pause=ce=>{this.active=!1,this.options.submitUserSpeechOnPause?this.endSegment(ce):this.reset()},this.resume=()=>{this.active=!0},this.endSegment=ce=>{const ee=this.audioBuffer;this.audioBuffer=[];const he=this.speaking;if(this.reset(),he)if(ee.reduce((De,me)=>me.isSpeech?De+1:De,0)>=this.minSpeechFrames){const De=y(ee.map(me=>me.frame));ce({msg:d.Message.SpeechEnd,audio:De})}else ce({msg:d.Message.VADMisfire});return{}},this.process=async(ce,ee)=>{if(!this.active)return;const he=await this.modelProcessFunc(ce),$e=he.isSpeech>=this.options.positiveSpeechThreshold;if(ee({probs:he,msg:d.Message.FrameProcessed,frame:ce}),this.audioBuffer.push({frame:ce,isSpeech:$e}),$e&&(this.speechFrameCount++,this.redemptionCounter=0),$e&&!this.speaking&&(this.speaking=!0,ee({msg:d.Message.SpeechStart})),this.speaking&&this.speechFrameCount===this.minSpeechFrames&&!this.speechRealStartFired&&(this.speechRealStartFired=!0,ee({msg:d.Message.SpeechRealStart})),he.isSpeech<this.options.negativeSpeechThreshold&&this.speaking&&++this.redemptionCounter>=this.redemptionFrames){this.redemptionCounter=0,this.speechFrameCount=0,this.speaking=!1,this.speechRealStartFired=!1;const De=this.audioBuffer;if(this.audioBuffer=[],De.reduce((be,Me)=>Me.isSpeech?be+1:be,0)>=this.minSpeechFrames){const be=y(De.map(Me=>Me.frame));ee({msg:d.Message.SpeechEnd,audio:be})}else ee({msg:d.Message.VADMisfire})}if(!this.speaking){for(;this.audioBuffer.length>this.preSpeechPadFrames;)this.audioBuffer.shift();this.speechFrameCount=0}},this.audioBuffer=[];const{redemptionFrames:q,preSpeechPadFrames:Z,minSpeechFrames:se}=$(this.options,this.msPerFrame);this.redemptionFrames=q,this.preSpeechPadFrames=Z,this.minSpeechFrames=se,this.reset()}}return gl.FrameProcessor=E,gl}var yl={};function Qi(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ag={exports:{}};/*!
 * ONNX Runtime Web v1.24.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Iy;function Yw(){return Iy||(Iy=1,(function(o,d){var m=(()=>{var y=Object.defineProperty,$=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyNames,R=Object.prototype.hasOwnProperty,D=(t=>typeof Qi<"u"?Qi:typeof Proxy<"u"?new Proxy(t,{get:(n,s)=>(typeof Qi<"u"?Qi:n)[s]}):t)(function(t){if(typeof Qi<"u")return Qi.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),T=(t,n)=>()=>(t&&(n=t(t=0)),n),M=(t,n)=>{for(var s in n)y(t,s,{get:n[s],enumerable:!0})},H=(t,n,s,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of E(n))!R.call(t,u)&&u!==s&&y(t,u,{get:()=>n[u],enumerable:!(l=$(n,u))||l.enumerable});return t},q=t=>H(y({},"__esModule",{value:!0}),t),Z,se,ce,ee,he,$e=T(()=>{Z=new Map,se=[],ce=(t,n,s)=>{if(n&&typeof n.init=="function"&&typeof n.createInferenceSessionHandler=="function"){let l=Z.get(t);if(l===void 0)Z.set(t,{backend:n,priority:s});else{if(l.priority>s)return;if(l.priority===s&&l.backend!==n)throw new Error(`cannot register backend "${t}" using priority ${s}`)}if(s>=0){let u=se.indexOf(t);u!==-1&&se.splice(u,1);for(let f=0;f<se.length;f++)if(Z.get(se[f]).priority<=s){se.splice(f,0,t);return}se.push(t)}return}throw new TypeError("not a valid backend")},ee=async t=>{let n=Z.get(t);if(!n)return"backend not found.";if(n.initialized)return n.backend;if(n.aborted)return n.error;{let s=!!n.initPromise;try{return s||(n.initPromise=n.backend.init(t)),await n.initPromise,n.initialized=!0,n.backend}catch(l){return s||(n.error=`${l}`,n.aborted=!0),n.error}finally{delete n.initPromise}}},he=async t=>{let n=t.executionProviders||[],s=n.map(b=>typeof b=="string"?b:b.name),l=s.length===0?se:s,u,f=[],p=new Set;for(let b of l){let v=await ee(b);typeof v=="string"?f.push({name:b,err:v}):(u||(u=v),u===v&&p.add(b))}if(!u)throw new Error(`no available backend found. ERR: ${f.map(b=>`[${b.name}] ${b.err}`).join(", ")}`);for(let{name:b,err:v}of f)s.includes(b)&&console.warn(`removing requested execution provider "${b}" from session options because it is not available: ${v}`);let g=n.filter(b=>p.has(typeof b=="string"?b:b.name));return[u,new Proxy(t,{get:(b,v)=>v==="executionProviders"?g:Reflect.get(b,v)})]}}),De=T(()=>{$e()}),me,be=T(()=>{me="1.24.2"}),Me,Be,qe=T(()=>{be(),Me="warning",Be={wasm:{},webgl:{},webgpu:{},versions:{common:me},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);Me=t}},get logLevel(){return Me}},Object.defineProperty(Be,"logLevel",{enumerable:!0})}),Re,at=T(()=>{qe(),Re=Be}),Xe,et,Qe=T(()=>{Xe=(t,n)=>{let s=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);s.width=t.dims[3],s.height=t.dims[2];let l=s.getContext("2d");if(l!=null){let u,f;(n==null?void 0:n.tensorLayout)!==void 0&&n.tensorLayout==="NHWC"?(u=t.dims[2],f=t.dims[3]):(u=t.dims[3],f=t.dims[2]);let p=(n==null?void 0:n.format)!==void 0?n.format:"RGB",g=n==null?void 0:n.norm,b,v;g===void 0||g.mean===void 0?b=[255,255,255,255]:typeof g.mean=="number"?b=[g.mean,g.mean,g.mean,g.mean]:(b=[g.mean[0],g.mean[1],g.mean[2],0],g.mean[3]!==void 0&&(b[3]=g.mean[3])),g===void 0||g.bias===void 0?v=[0,0,0,0]:typeof g.bias=="number"?v=[g.bias,g.bias,g.bias,g.bias]:(v=[g.bias[0],g.bias[1],g.bias[2],0],g.bias[3]!==void 0&&(v[3]=g.bias[3]));let w=f*u,x=0,C=w,z=w*2,A=-1;p==="RGBA"?(x=0,C=w,z=w*2,A=w*3):p==="RGB"?(x=0,C=w,z=w*2):p==="RBG"&&(x=0,z=w,C=w*2);for(let B=0;B<f;B++)for(let L=0;L<u;L++){let U=(t.data[x++]-v[0])*b[0],N=(t.data[C++]-v[1])*b[1],V=(t.data[z++]-v[2])*b[2],G=A===-1?255:(t.data[A++]-v[3])*b[3];l.fillStyle="rgba("+U+","+N+","+V+","+G+")",l.fillRect(L,B,1,1)}if("toDataURL"in s)return s.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},et=(t,n)=>{let s=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),l;if(s!=null){let u,f,p;(n==null?void 0:n.tensorLayout)!==void 0&&n.tensorLayout==="NHWC"?(u=t.dims[2],f=t.dims[1],p=t.dims[3]):(u=t.dims[3],f=t.dims[2],p=t.dims[1]);let g=n!==void 0&&n.format!==void 0?n.format:"RGB",b=n==null?void 0:n.norm,v,w;b===void 0||b.mean===void 0?v=[255,255,255,255]:typeof b.mean=="number"?v=[b.mean,b.mean,b.mean,b.mean]:(v=[b.mean[0],b.mean[1],b.mean[2],255],b.mean[3]!==void 0&&(v[3]=b.mean[3])),b===void 0||b.bias===void 0?w=[0,0,0,0]:typeof b.bias=="number"?w=[b.bias,b.bias,b.bias,b.bias]:(w=[b.bias[0],b.bias[1],b.bias[2],0],b.bias[3]!==void 0&&(w[3]=b.bias[3]));let x=f*u;if(n!==void 0&&(n.format!==void 0&&p===4&&n.format!=="RGBA"||p===3&&n.format!=="RGB"&&n.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let C=4,z=0,A=1,B=2,L=3,U=0,N=x,V=x*2,G=-1;g==="RGBA"?(U=0,N=x,V=x*2,G=x*3):g==="RGB"?(U=0,N=x,V=x*2):g==="RBG"&&(U=0,V=x,N=x*2),l=s.createImageData(u,f);for(let X=0;X<f*u;z+=C,A+=C,B+=C,L+=C,X++)l.data[z]=(t.data[U++]-w[0])*v[0],l.data[A]=(t.data[N++]-w[1])*v[1],l.data[B]=(t.data[V++]-w[2])*v[2],l.data[L]=G===-1?255:(t.data[G++]-w[3])*v[3]}else throw new Error("Can not access image data");return l}}),_t,Dt,ma,_e,Oe,Pe,At=T(()=>{Yt(),_t=(t,n)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(n.height===void 0||n.width===void 0)throw new Error("Image height and width must be defined");if(n.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:s,width:l}=n,u=n.norm??{mean:255,bias:0},f,p;typeof u.mean=="number"?f=[u.mean,u.mean,u.mean,u.mean]:f=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?p=[u.bias,u.bias,u.bias,u.bias]:p=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let g=n.format!==void 0?n.format:"RGBA",b=n.tensorFormat!==void 0&&n.tensorFormat!==void 0?n.tensorFormat:"RGB",v=s*l,w=b==="RGBA"?new Float32Array(v*4):new Float32Array(v*3),x=4,C=0,z=1,A=2,B=3,L=0,U=v,N=v*2,V=-1;g==="RGB"&&(x=3,C=0,z=1,A=2,B=-1),b==="RGBA"?V=v*3:b==="RBG"?(L=0,N=v,U=v*2):b==="BGR"&&(N=0,U=v,L=v*2);for(let G=0;G<v;G++,C+=x,A+=x,z+=x,B+=x)w[L++]=(t[C]+p[0])/f[0],w[U++]=(t[z]+p[1])/f[1],w[N++]=(t[A]+p[2])/f[2],V!==-1&&B!==-1&&(w[V++]=(t[B]+p[3])/f[3]);return b==="RGBA"?new xt("float32",w,[1,4,s,l]):new xt("float32",w,[1,3,s,l])},Dt=async(t,n)=>{let s=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,l=typeof ImageData<"u"&&t instanceof ImageData,u=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,f=typeof t=="string",p,g=n??{},b=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},v=w=>typeof HTMLCanvasElement<"u"&&w instanceof HTMLCanvasElement||w instanceof OffscreenCanvas?w.getContext("2d"):null;if(s){let w=b();w.width=t.width,w.height=t.height;let x=v(w);if(x!=null){let C=t.height,z=t.width;if(n!==void 0&&n.resizedHeight!==void 0&&n.resizedWidth!==void 0&&(C=n.resizedHeight,z=n.resizedWidth),n!==void 0){if(g=n,n.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");g.tensorFormat="RGBA",g.height=C,g.width=z}else g.tensorFormat="RGBA",g.height=C,g.width=z;x.drawImage(t,0,0),p=x.getImageData(0,0,z,C).data}else throw new Error("Can not access image data")}else if(l){let w,x;if(n!==void 0&&n.resizedWidth!==void 0&&n.resizedHeight!==void 0?(w=n.resizedHeight,x=n.resizedWidth):(w=t.height,x=t.width),n!==void 0&&(g=n),g.format="RGBA",g.height=w,g.width=x,n!==void 0){let C=b();C.width=x,C.height=w;let z=v(C);if(z!=null)z.putImageData(t,0,0),p=z.getImageData(0,0,x,w).data;else throw new Error("Can not access image data")}else p=t.data}else if(u){if(n===void 0)throw new Error("Please provide image config with format for Imagebitmap");let w=b();w.width=t.width,w.height=t.height;let x=v(w);if(x!=null){let C=t.height,z=t.width;return x.drawImage(t,0,0,z,C),p=x.getImageData(0,0,z,C).data,g.height=C,g.width=z,_t(p,g)}else throw new Error("Can not access image data")}else{if(f)return new Promise((w,x)=>{let C=b(),z=v(C);if(!t||!z)return x();let A=new Image;A.crossOrigin="Anonymous",A.src=t,A.onload=()=>{C.width=A.width,C.height=A.height,z.drawImage(A,0,0,C.width,C.height);let B=z.getImageData(0,0,C.width,C.height);g.height=C.height,g.width=C.width,w(_t(B.data,g))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return _t(p,g);throw new Error("Input data provided is not supported - aborted tensor creation")},ma=(t,n)=>{let{width:s,height:l,download:u,dispose:f}=n,p=[1,l,s,4];return new xt({location:"texture",type:"float32",texture:t,dims:p,download:u,dispose:f})},_e=(t,n)=>{let{dataType:s,dims:l,download:u,dispose:f}=n;return new xt({location:"gpu-buffer",type:s??"float32",gpuBuffer:t,dims:l,download:u,dispose:f})},Oe=(t,n)=>{let{dataType:s,dims:l,download:u,dispose:f}=n;return new xt({location:"ml-tensor",type:s??"float32",mlTensor:t,dims:l,download:u,dispose:f})},Pe=(t,n,s)=>new xt({location:"cpu-pinned",type:t,data:n,dims:s??[n.length]})}),ht,K,Ce,Ge,Ye=T(()=>{ht=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),K=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ce=!1,Ge=()=>{if(!Ce){Ce=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,n=typeof BigUint64Array<"u"&&BigUint64Array.from,s=globalThis.Float16Array,l=typeof s<"u"&&s.from;t&&(ht.set("int64",BigInt64Array),K.set(BigInt64Array,"int64")),n&&(ht.set("uint64",BigUint64Array),K.set(BigUint64Array,"uint64")),l?(ht.set("float16",s),K.set(s,"float16")):ht.set("float16",Uint16Array)}}}),mt,wt,Lt=T(()=>{Yt(),mt=t=>{let n=1;for(let s=0;s<t.length;s++){let l=t[s];if(typeof l!="number"||!Number.isSafeInteger(l))throw new TypeError(`dims[${s}] must be an integer, got: ${l}`);if(l<0)throw new RangeError(`dims[${s}] must be a non-negative integer, got: ${l}`);n*=l}return n},wt=(t,n)=>{switch(t.location){case"cpu":return new xt(t.type,t.data,n);case"cpu-pinned":return new xt({location:"cpu-pinned",data:t.data,type:t.type,dims:n});case"texture":return new xt({location:"texture",texture:t.texture,type:t.type,dims:n});case"gpu-buffer":return new xt({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:n});case"ml-tensor":return new xt({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:n});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),xt,Yt=T(()=>{Qe(),At(),Ye(),Lt(),xt=class{constructor(t,n,s){Ge();let l,u;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,l=t.type,u=t.dims,t.location){case"cpu-pinned":{let p=ht.get(l);if(!p)throw new TypeError(`unsupported type "${l}" to create tensor from pinned buffer`);if(!(t.data instanceof p))throw new TypeError(`buffer should be of type ${p.name}`);this.cpuData=t.data;break}case"texture":{if(l!=="float32")throw new TypeError(`unsupported type "${l}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(l!=="float32"&&l!=="float16"&&l!=="int32"&&l!=="int64"&&l!=="uint32"&&l!=="uint8"&&l!=="bool"&&l!=="uint4"&&l!=="int4")throw new TypeError(`unsupported type "${l}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(l!=="float32"&&l!=="float16"&&l!=="int32"&&l!=="int64"&&l!=="uint32"&&l!=="uint64"&&l!=="int8"&&l!=="uint8"&&l!=="bool"&&l!=="uint4"&&l!=="int4")throw new TypeError(`unsupported type "${l}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let p,g;if(typeof t=="string")if(l=t,g=s,t==="string"){if(!Array.isArray(n))throw new TypeError("A string tensor's data must be a string array.");p=n}else{let b=ht.get(t);if(b===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(n)){if(t==="float16"&&b===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${b.name} as data.`);t==="uint64"||t==="int64"?p=b.from(n,BigInt):p=b.from(n)}else if(n instanceof b)p=n;else if(n instanceof Uint8ClampedArray)if(t==="uint8")p=Uint8Array.from(n);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&n instanceof Uint16Array&&b!==Uint16Array)p=new globalThis.Float16Array(n.buffer,n.byteOffset,n.length);else throw new TypeError(`A ${l} tensor's data must be type of ${b}`)}else if(g=n,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let b=typeof t[0];if(b==="string")l="string",p=t;else if(b==="boolean")l="bool",p=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${b}.`)}else if(t instanceof Uint8ClampedArray)l="uint8",p=Uint8Array.from(t);else{let b=K.get(t.constructor);if(b===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);l=b,p=t}if(g===void 0)g=[p.length];else if(!Array.isArray(g))throw new TypeError("A tensor's dims must be a number array");u=g,this.cpuData=p,this.dataLocation="cpu"}let f=mt(u);if(this.cpuData&&f!==this.cpuData.length&&!((l==="uint4"||l==="int4")&&Math.ceil(f/2)===this.cpuData.length))throw new Error(`Tensor's size(${f}) does not match data length(${this.cpuData.length}).`);this.type=l,this.dims=u,this.size=f}static async fromImage(t,n){return Dt(t,n)}static fromTexture(t,n){return ma(t,n)}static fromGpuBuffer(t,n){return _e(t,n)}static fromMLTensor(t,n){return Oe(t,n)}static fromPinnedBuffer(t,n,s){return Pe(t,n,s)}toDataURL(t){return Xe(this,t)}toImageData(t){return et(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let n=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=n,t&&this.disposer&&(this.disposer(),this.disposer=void 0),n}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return wt(this,t)}}}),Xt,qr=T(()=>{Yt(),Xt=xt}),Nn,jr,ia,ga,Ma,Wa,$l=T(()=>{qe(),Nn=(t,n)=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.timeStamp(`${t}::ORT::${n}`)},jr=(t,n)=>{var u;let s=((u=new Error().stack)==null?void 0:u.split(/\r\n|\r|\n/g))||[],l=!1;for(let f=0;f<s.length;f++){if(l&&!s[f].includes("TRACE_FUNC")){let p=`FUNC_${t}::${s[f].trim().split(" ")[1]}`;n&&(p+=`::${n}`),Nn("CPU",p);return}s[f].includes("TRACE_FUNC")&&(l=!0)}},ia=t=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||jr("BEGIN",t)},ga=t=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||jr("END",t)},Ma=t=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.time(`ORT::${t}`)},Wa=t=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.timeEnd(`ORT::${t}`)}}),Ss,Ro=T(()=>{$e(),qr(),$l(),Ss=class q0{constructor(n){this.handler=n}async run(n,s,l){ia(),Ma("InferenceSession.run");let u={},f={};if(typeof n!="object"||n===null||n instanceof Xt||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof Xt)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let v of s){if(typeof v!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(v)===-1)throw new RangeError(`'fetches' contains invalid output name: ${v}.`);u[v]=null}if(typeof l=="object"&&l!==null)f=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else{let v=!1,w=Object.getOwnPropertyNames(s);for(let x of this.outputNames)if(w.indexOf(x)!==-1){let C=s[x];(C===null||C instanceof Xt)&&(v=!0,p=!1,u[x]=C)}if(v){if(typeof l=="object"&&l!==null)f=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else f=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let v of this.inputNames)if(typeof n[v]>"u")throw new Error(`input '${v}' is missing in 'feeds'.`);if(p)for(let v of this.outputNames)u[v]=null;let g=await this.handler.run(n,u,f),b={};for(let v in g)if(Object.hasOwnProperty.call(g,v)){let w=g[v];w instanceof Xt?b[v]=w:b[v]=new Xt(w.type,w.data,w.dims)}return Wa("InferenceSession.run"),ga(),b}async release(){return this.handler.dispose()}static async create(n,s,l,u){ia(),Ma("InferenceSession.create");let f,p={};if(typeof n=="string"){if(f=n,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof Uint8Array){if(f=n,typeof s=="object"&&s!==null)p=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer){let w=n,x=0,C=n.byteLength;if(typeof s=="object"&&s!==null)p=s;else if(typeof s=="number"){if(x=s,!Number.isSafeInteger(x))throw new RangeError("'byteOffset' must be an integer.");if(x<0||x>=w.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${w.byteLength}).`);if(C=n.byteLength-x,typeof l=="number"){if(C=l,!Number.isSafeInteger(C))throw new RangeError("'byteLength' must be an integer.");if(C<=0||x+C>w.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${w.byteLength-x}].`);if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof l<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof s<"u")throw new TypeError("'options' must be an object.");f=new Uint8Array(w,x,C)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[g,b]=await he(p),v=await g.createInferenceSessionHandler(f,b);return Wa("InferenceSession.create"),ga(),new q0(v)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Yi,$d=T(()=>{Ro(),Yi=Ss}),Sd=T(()=>{}),en=T(()=>{}),Ed=T(()=>{}),Bu=T(()=>{}),Sl={};M(Sl,{InferenceSession:()=>Yi,TRACE:()=>Nn,TRACE_EVENT_BEGIN:()=>Ma,TRACE_EVENT_END:()=>Wa,TRACE_FUNC_BEGIN:()=>ia,TRACE_FUNC_END:()=>ga,Tensor:()=>Xt,env:()=>Re,registerBackend:()=>ce});var oa=T(()=>{De(),at(),$d(),qr(),Sd(),en(),$l(),Ed(),Bu()}),Es=T(()=>{}),El={};M(El,{default:()=>Xi});var Ts,Cs,Xi,tn=T(()=>{var t;_p(),xa(),er(),Ts="ort-wasm-proxy-worker",Cs=((t=globalThis.self)==null?void 0:t.name)===Ts,Cs&&(self.onmessage=n=>{let{type:s,in:l}=n.data;try{switch(s){case"init-wasm":Pr(l.wasm).then(()=>{Yc(l).then(()=>{postMessage({type:s})},u=>{postMessage({type:s,err:u})})},u=>{postMessage({type:s,err:u})});break;case"init-ep":{let{epName:u,env:f}=l;Xc(f,u).then(()=>{postMessage({type:s})},p=>{postMessage({type:s,err:p})});break}case"copy-from":{let{buffer:u}=l,f=Zc(u);postMessage({type:s,out:f});break}case"create":{let{model:u,options:f}=l;vp(u,f).then(p=>{postMessage({type:s,out:p})},p=>{postMessage({type:s,err:p})});break}case"release":bp(l),postMessage({type:s});break;case"run":{let{sessionId:u,inputIndices:f,inputs:p,outputIndices:g,options:b}=l;ed(u,f,p,g,new Array(g.length).fill(null),b).then(v=>{v.some(w=>w[3]!=="cpu")?postMessage({type:s,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:s,out:v},fo([...p,...v]))},v=>{postMessage({type:s,err:v})});break}case"end-profiling":gs(l),postMessage({type:s});break;default:}}catch(u){postMessage({type:s,err:u})}}),Xi=Cs?null:n=>new Worker(n??Zt,{type:"classic",name:Ts})}),Un,La,Zt,zs,Zi,Gr,Vr,yi,ai,vi,Ji,As,Tl,er=T(()=>{Es(),Un=typeof location>"u"?void 0:location.origin,La=()=>{var t,n;return typeof document<"u"?(t=document.currentScript)==null?void 0:t.src:typeof self<"u"?(n=self.location)==null?void 0:n.href:void 0},Zt=La(),zs=()=>{if(Zt&&!Zt.startsWith("blob:"))return Zt.substring(0,Zt.lastIndexOf("/")+1)},Zi=(t,n)=>{try{let s=n??Zt;return(s?new URL(t,s):new URL(t)).origin===Un}catch{return!1}},Gr=(t,n)=>{let s=n??Zt;try{return(s?new URL(t,s):new URL(t)).href}catch{return}},Vr=(t,n)=>`${n??"./"}${t}`,yi=async t=>{let n=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(n)},ai=async t=>(await import(t)).default,vi=(tn(),q(El)).default,Ji=async()=>{if(!Zt)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Zi(Zt))return[void 0,vi()];let t=await yi(Zt);return[t,vi(t)]},As=void 0,Tl=async(t,n,s,l)=>{let u=As&&!(t||n);if(u)if(Zt)u=Zi(Zt);else if(l&&!s)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,As];{let f="ort-wasm-simd-threaded.jsep.mjs",p=t??Gr(f,n),g=s&&p&&!Zi(p,n),b=g?await yi(p):p??Vr(f,n);return[g?b:void 0,await ai(b)]}}}),ni,tr,In,Hr,Cl,Os,Rs,Pr,st,xa=T(()=>{er(),tr=!1,In=!1,Hr=!1,Cl=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Os=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Rs=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Pr=async t=>{if(tr)return Promise.resolve();if(In)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Hr)throw new Error("previous call to 'initializeWebAssembly()' failed.");In=!0;let n=t.initTimeout,s=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!Rs())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Os())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let l=Cl();s>1&&!l&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+s+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=s=1);let u=t.wasmPaths,f=typeof u=="string"?u:void 0,p=u==null?void 0:u.mjs,g=(p==null?void 0:p.href)??p,b=u==null?void 0:u.wasm,v=(b==null?void 0:b.href)??b,w=t.wasmBinary,[x,C]=await Tl(g,f,s>1,!!w||!!v),z=!1,A=[];if(n>0&&A.push(new Promise(B=>{setTimeout(()=>{z=!0,B()},n)})),A.push(new Promise((B,L)=>{let U={numThreads:s};if(w)U.wasmBinary=w;else if(v||f)U.locateFile=N=>v??f+N;else if(g&&g.indexOf("blob:")!==0)U.locateFile=N=>new URL(N,g).href;else if(x){let N=zs();N&&(U.locateFile=V=>N+V)}C(U).then(N=>{In=!1,tr=!0,ni=N,B(),x&&URL.revokeObjectURL(x)},N=>{In=!1,Hr=!0,L(N)})})),await Promise.race(A),z)throw new Error(`WebAssembly backend initializing failed due to timeout: ${n}ms`)},st=()=>{if(tr&&ni)return ni;throw new Error("WebAssembly is not initialized yet.")}}),St,ya,Ke,ar=T(()=>{xa(),St=(t,n)=>{let s=st(),l=s.lengthBytesUTF8(t)+1,u=s._malloc(l);return s.stringToUTF8(t,u,l),n.push(u),u},ya=(t,n,s,l)=>{if(typeof t=="object"&&t!==null){if(s.has(t))throw new Error("Circular reference in options");s.add(t)}Object.entries(t).forEach(([u,f])=>{let p=n?n+u:u;if(typeof f=="object")ya(f,p+".",s,l);else if(typeof f=="string"||typeof f=="number")l(p,f.toString());else if(typeof f=="boolean")l(p,f?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof f}`)})},Ke=t=>{let n=st(),s=n.stackSave();try{let l=n.PTR_SIZE,u=n.stackAlloc(2*l);n._OrtGetLastError(u,u+l);let f=Number(n.getValue(u,l===4?"i32":"i64")),p=n.getValue(u+l,"*"),g=p?n.UTF8ToString(p):"";throw new Error(`${t} ERROR_CODE: ${f}, ERROR_MESSAGE: ${g}`)}finally{n.stackRestore(s)}}}),Mo,Td=T(()=>{xa(),ar(),Mo=t=>{let n=st(),s=0,l=[],u=t||{};try{if((t==null?void 0:t.logSeverityLevel)===void 0)u.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${t.logSeverityLevel}`);if((t==null?void 0:t.logVerbosityLevel)===void 0)u.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);(t==null?void 0:t.terminate)===void 0&&(u.terminate=!1);let f=0;return(t==null?void 0:t.tag)!==void 0&&(f=St(t.tag,l)),s=n._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,f),s===0&&Ke("Can't create run options."),(t==null?void 0:t.extra)!==void 0&&ya(t.extra,"",new WeakSet,(p,g)=>{let b=St(p,l),v=St(g,l);n._OrtAddRunConfigEntry(s,b,v)!==0&&Ke(`Can't set a run config entry: ${p} - ${g}.`)}),[s,l]}catch(f){throw s!==0&&n._OrtReleaseRunOptions(s),l.forEach(p=>n._free(p)),f}}}),zl,nr,Ms,Qa,bi,ir,Fr=T(()=>{xa(),ar(),zl=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},nr=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},Ms=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let n=t.extra.session;n.use_ort_model_bytes_directly||(n.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(s=>(typeof s=="string"?s:s.name)==="webgpu")&&(t.enableMemPattern=!1)},Qa=(t,n,s,l)=>{let u=St(n,l),f=St(s,l);st()._OrtAddSessionConfigEntry(t,u,f)!==0&&Ke(`Can't set a session config entry: ${n} - ${s}.`)},bi=async(t,n,s)=>{let l=n.executionProviders;for(let u of l){let f=typeof u=="string"?u:u.name,p=[];switch(f){case"webnn":if(f="WEBNN",typeof u!="string"){let x=u==null?void 0:u.deviceType;x&&Qa(t,"deviceType",x,s)}break;case"webgpu":if(f="JS",typeof u!="string"){let x=u;if(x!=null&&x.preferredLayout){if(x.preferredLayout!=="NCHW"&&x.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${x.preferredLayout}`);Qa(t,"preferredLayout",x.preferredLayout,s)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${f}`)}let g=St(f,s),b=p.length,v=0,w=0;if(b>0){v=st()._malloc(b*st().PTR_SIZE),s.push(v),w=st()._malloc(b*st().PTR_SIZE),s.push(w);for(let x=0;x<b;x++)st().setValue(v+x*st().PTR_SIZE,p[x][0],"*"),st().setValue(w+x*st().PTR_SIZE,p[x][1],"*")}await st()._OrtAppendExecutionProvider(t,g,v,w,b)!==0&&Ke(`Can't append execution provider: ${f}.`)}},ir=async t=>{let n=st(),s=0,l=[],u=t||{};Ms(u);try{let f=zl(u.graphOptimizationLevel??"all"),p=nr(u.executionMode??"sequential"),g=typeof u.logId=="string"?St(u.logId,l):0,b=u.logSeverityLevel??2;if(!Number.isInteger(b)||b<0||b>4)throw new Error(`log severity level is not valid: ${b}`);let v=u.logVerbosityLevel??0;if(!Number.isInteger(v)||v<0||v>4)throw new Error(`log verbosity level is not valid: ${v}`);let w=typeof u.optimizedModelFilePath=="string"?St(u.optimizedModelFilePath,l):0;if(s=n._OrtCreateSessionOptions(f,!!u.enableCpuMemArena,!!u.enableMemPattern,p,!!u.enableProfiling,0,g,b,v,w),s===0&&Ke("Can't create session options."),u.executionProviders&&await bi(s,u,l),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);Qa(s,"enableGraphCapture",u.enableGraphCapture.toString(),l)}if(u.freeDimensionOverrides)for(let[x,C]of Object.entries(u.freeDimensionOverrides)){if(typeof x!="string")throw new Error(`free dimension override name must be a string: ${x}`);if(typeof C!="number"||!Number.isInteger(C)||C<0)throw new Error(`free dimension override value must be a non-negative integer: ${C}`);let z=St(x,l);n._OrtAddFreeDimensionOverride(s,z,C)!==0&&Ke(`Can't set a free dimension override: ${x} - ${C}.`)}return u.extra!==void 0&&ya(u.extra,"",new WeakSet,(x,C)=>{Qa(s,x,C,l)}),[s,l]}catch(f){throw s!==0&&n._OrtReleaseSessionOptions(s)!==0&&Ke("Can't release session options."),l.forEach(p=>n._free(p)),f}}}),jt,an,nn,Sn,Ln,ks,Kr,Ds,rt=T(()=>{jt=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},an=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},nn=(t,n)=>{let s=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],l=typeof n=="number"?n:n.reduce((u,f)=>u*f,1);return s>0?Math.ceil(l*s):void 0},Sn=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},Ln=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},ks=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Kr=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Ds=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),_i,Wr=T(()=>{Es(),_i=async t=>{if(typeof t=="string"){let n=await fetch(t);if(!n.ok)throw new Error(`failed to load external data file: ${t}`);let s=n.headers.get("Content-Length"),l=s?parseInt(s,10):0;if(l<1073741824)return new Uint8Array(await n.arrayBuffer());{if(!n.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let u=n.body.getReader(),f;try{f=new ArrayBuffer(l)}catch(g){if(g instanceof RangeError){let b=Math.ceil(l/65536);f=new WebAssembly.Memory({initial:b,maximum:b}).buffer}else throw g}let p=0;for(;;){let{done:g,value:b}=await u.read();if(g)break;let v=b.byteLength;new Uint8Array(f,p,v).set(b),p+=v}return new Uint8Array(f,0,l)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),En,qa,Bs,wi,Qr,Ns,gt,Tn=T(()=>{rt(),En=["V","I","W","E","F"],qa=(t,n)=>{console.log(`[${En[t]},${new Date().toISOString()}]${n}`)},Qr=(t,n)=>{Bs=t,wi=n},Ns=(t,n)=>{let s=Ln(t),l=Ln(Bs);s>=l&&qa(s,typeof n=="function"?n():n)},gt=(...t)=>{wi&&Ns(...t)}}),ja,qn,pe,xi,ii,Al,jn,He=T(()=>{ja=class{static calcMatMulShape(t,n){return t[1]!==n[0]?void 0:[t[0],n[1]]}},qn=class{static calcShape(t,n,s=!1){let l=t.length,u=n.length;if(l===0)return n;if(u===0)return t;let f=Math.max(t.length,n.length),p=new Array(f);if(s){if(l<2||u<2)return;let g=ja.calcMatMulShape([t[l-2],t[l-1]],[n[u-2],n[u-1]]);if(g===void 0)return;[p[f-2],p[f-1]]=g}for(let g=s?3:1;g<=f;g++){let b=l-g<0?1:t[l-g],v=u-g<0?1:n[u-g];if(b!==v&&b>1&&v>1)return;let w=Math.max(b,v);if(b&&v)p[f-g]=Math.max(b,v);else{if(w>1)return;p[f-g]=0}}return p}static isValidBroadcast(t,n){let s=t.length,l=n.length;if(s>l)return!1;for(let u=1;u<=s;u++)if(t[s-u]!==1&&t[s-u]!==n[l-u])return!1;return!0}},pe=class wm{static size(n){return wm.getSizeFromDimensionRange(n,0,n.length)}static convertShape(n,s=4){let l=n.length;if(l===0)return[];let u=new Array(l),f=l-1;for(;f>=0;){if(n[f]%s===0){u[f]=n[f]/s;break}if(s%n[f]!==0)throw new Error("cannot convert shape");u[f]=1,s/=n[f],f--}for(f--;f>=0;f--)u[f]=n[f];return u}static sizeFromDimension(n,s){if(s<0||s>n.length)throw new Error(`invalid dimension of ${s} for sizeFromDimension as Tensor has ${n.length} dimensions.`);return wm.getSizeFromDimensionRange(n,s,n.length)}static sizeToDimension(n,s){if(s<0||s>n.length)throw new Error(`invalid dimension of ${s} for sizeToDimension as Tensor has ${n.length} dimensions.`);return wm.getSizeFromDimensionRange(n,0,s)}static getSizeFromDimensionRange(n,s,l){let u=1;for(let f=s;f<l;f++){if(n[f]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");u*=Number(n[f])}return u}static computeStrides(n){let s=n.length;if(s===0)return[];if(s===1)return[1];let l=new Array(s);l[s-1]=1,l[s-2]=n[s-1];for(let u=s-3;u>=0;--u)l[u]=l[u+1]*n[u+1];return l}static normalizeAxis(n,s){if(n<-s&&n>=s)throw new Error("unsupported axis for this operation.");return n<0?n+s:n}static normalizeAxes(n,s){return n.map(l=>this.normalizeAxis(l,s??n.length))}static sortBasedOnPerm(n,s){return s?s.map(l=>n[l]):n.slice().reverse()}static padShape(n,s){let l=n.length;return n.map((u,f)=>u+s[f]+s[f+l])}static areEqual(n,s){return n.length!==s.length?!1:n.every((l,u)=>l===s[u])}},xi=class Yp{static adjustPoolAttributes(n,s,l,u,f,p){if(!n&&l.length!==s.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(n)for(let g=0;g<s.length-2;g++)g>=l.length?l.push(s[g+2]):l[g]=s[g+2];for(let g=0;g<l.length;g++)if(g<u.length){if(u[g]<0)throw new Error("strides should be greater than or equal to 1")}else u.push(1);for(let g=0;g<l.length;g++)if(g<f.length){if(f[g]<0)throw new Error("dilations should be greater than or equal to 1")}else f.push(1);for(let g=0;g<l.length*2;g++)if(g<p.length){if(p[g]<0)throw new Error("pad should be greater than or equal to 1")}else p.push(0);for(let g=0;g<l.length;g++){if(l[g]<=0)throw new Error("kernel shapes need to be greater than 0");if(p[g]>=l[g]||p[g+l.length]>=l[g])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(n,s,l,u,f,p,g){if(g){if(f.length!==2*(n.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(s.length!==n.length-2)throw new Error("length of strides should be the length of data dimensions");if(u.length!==n.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let b=0;b<n.length-2;b++)Yp.adjustPadAndReturnShape(n[b+(p?1:2)],s[b],l[b],u[b],f,b,b+n.length-2,g)}}static computePoolOutputShape(n,s,l,u,f,p,g){if(s.length<=0)throw new Error("input shape must be of size greater than 0");let b=[s[0],s[1]];return Yp.computeShapeHelper(n,s,b,l,u,f,p,g),b}static computeConvOutputShape(n,s,l,u,f,p,g){if(n.length<=0||s.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let b=[n[0],s[0]];return Yp.computeShapeHelper(!1,n,b,l,u,f,p,g),b}static computeShapeHelper(n,s,l,u,f,p,g,b){if(n)for(let v=0;v<s.length-2;v++)l.push(1);else for(let v=0;v<s.length-2;v++)l.push(Yp.adjustPadAndReturnShape(s[v+2],u[v],f[v],p[v],g,v,v+s.length-2,b))}static adjustPadAndReturnShape(n,s,l,u,f,p,g,b){let v=l*(u-1)+1;if(b&&b!=="NOTSET")switch(b){case"VALID":return f[p]=0,f[g]=0,Math.floor((n-v)/s+1);case"SAME_LOWER":case"SAME_UPPER":if(l!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let w=((n+s-1)/s-1)*s+u-n;return f[p]=Math.floor(b==="SAME_LOWER"?(w+1)/2:w/2),f[g]=w-f[p],Math.floor((n+w-u)/s+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((n+f[p]+f[g]-v)/s+1)}},ii=class{static getShapeOfGemmResult(t,n,s,l,u){if(t.length!==2||s.length!==2)throw new Error("shape need to be of size 2");let f,p,g;n?(f=t[1],p=t[0]):(f=t[0],p=t[1]);let b=-1;if(l?(g=s[0],b=1):(g=s[1],b=0),s[b]!==p)throw new Error("dimension mismatch");if(f<=0||g<=0||p<=0)throw new Error("invalid shape specified");if(u&&!qn.isValidBroadcast(u,[f,g]))throw new Error("gemm: invalid bias shape for broadcast");return[f,g,p]}},Al=-34028234663852886e22,jn=34028234663852886e22}),$i,rr=T(()=>{rt(),$i=(t,n)=>new(Sn(n))(t)}),Si,Ei,Us,Is,pn,ka,Yr,Xr,ri,Ti,Ol,Rl=T(()=>{rt(),Tn(),Si=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Ei=(t,n)=>{if(n==="int32")return t;let s=Si.get(n);if(!s)throw new Error(`WebNN backend does not support data type: ${n}`);let l=s/8;if(t.byteLength%l!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${l}.`);let u=t.byteLength/l,f=new(Sn(n))(t.buffer,t.byteOffset,u);switch(n){case"int64":case"uint64":{let p=new Int32Array(u);for(let g=0;g<u;g++){let b=f[g];if(b>2147483647n||b<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[g]=Number(b)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(n==="uint32"&&f.some(g=>g>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(f,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${n} to 'int32'`)}},Us=(t,n)=>{if(n==="int32")return t;if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let s=t.byteLength/4,l=new Int32Array(t.buffer,t.byteOffset,s);switch(n){case"int64":{let u=BigInt64Array.from(l,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(l.some(f=>f<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(l,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(l.some(f=>f<-128||f>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(l,Number);return new Uint8Array(u.buffer)}case"uint8":{if(l.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(l,Number)}case"uint32":{if(l.some(f=>f<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(l,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${n}`)}},Is=1,pn=()=>Is++,ka=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Yr=(t,n)=>{let s=Si.get(t);if(!s)throw new Error(`WebNN backend does not support data type: ${t}`);return n.length>0?Math.ceil(n.reduce((l,u)=>l*u)*s/8):0},Xr=class{constructor(t){this.isDataConverted=!1;let{sessionId:n,context:s,tensor:l,dataType:u,shape:f,fallbackDataType:p}=t;this.sessionId=n,this.mlContext=s,this.mlTensor=l,this.dataType=u,this.tensorShape=f,this.fallbackDataType=p}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Yr(this.dataType,this.tensorShape)}destroy(){gt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let n=await this.mlContext.readTensor(this.mlTensor),s=Us(new Uint8Array(n),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(s);return}else return s.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,n,s){return this.mlContext===t&&this.dataType===n&&this.tensorShape.length===s.length&&this.tensorShape.every((l,u)=>l===s[u])}setIsDataConverted(t){this.isDataConverted=t}},ri=class{constructor(t,n){this.tensorManager=t,this.wrapper=n}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,n,s,l){let u=this.tensorManager.getMLContext(t),f=this.tensorManager.getMLOpSupportLimits(t),p;if(!(f!=null&&f.input.dataTypes.includes(n))){if(p=ka.get(n),!p||(f==null?void 0:f.input.dataTypes.includes(p)))throw new Error(`WebNN backend does not support data type: ${n}`);gt("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${n} to ${p}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,n,s))return this.wrapper.tensor;if(l){if(this.wrapper.byteLength!==Yr(n,s))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let g=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,n,s,g,!0,!0,p),l&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let n=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")n=Ei(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(n);return}else gt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(n):this.activeUpload=new Uint8Array(n)}async download(t){var n,s;if(this.activeUpload){let l=(n=this.wrapper)!=null&&n.isDataConverted?Us(this.activeUpload,(s=this.wrapper)==null?void 0:s.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(l):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(l);return}else return l.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},Ti=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let n=this.backend.getMLContext(t);if(!n)throw new Error("MLContext not found for session.");return n}getMLOpSupportLimits(t){return this.backend.getMLOpSupportLimits(t)}reserveTensorId(){let t=pn();return this.tensorTrackersById.set(t,new ri(this)),t}releaseTensorId(t){let n=this.tensorTrackersById.get(t);n&&(this.tensorTrackersById.delete(t),n.tensorWrapper&&this.releaseTensor(n.tensorWrapper))}async ensureTensor(t,n,s,l,u){gt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${n}, dataType: ${s}, shape: ${l}, copyOld: ${u}}`);let f=this.tensorTrackersById.get(n);if(!f)throw new Error("Tensor not found.");return f.ensureTensor(t,s,l,u)}upload(t,n){let s=this.tensorTrackersById.get(t);if(!s)throw new Error("Tensor not found.");s.upload(n)}async download(t,n){gt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${n==null?void 0:n.byteLength}}`);let s=this.tensorTrackersById.get(t);if(!s)throw new Error("Tensor not found.");return s.download(n)}releaseTensorsForSession(t){for(let n of this.freeTensors)n.sessionId===t&&n.destroy();this.freeTensors=this.freeTensors.filter(n=>n.sessionId!==t)}registerTensor(t,n,s,l){let u=this.getMLContext(t),f=pn(),p=new Xr({sessionId:t,context:u,tensor:n,dataType:s,shape:l});return this.tensorTrackersById.set(f,new ri(this,p)),this.externalTensors.add(p),f}async getCachedTensor(t,n,s,l,u,f,p){let g=this.getMLContext(t);for(let[v,w]of this.freeTensors.entries())if(w.canReuseTensor(g,n,s)){gt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${n}, ${p?`fallbackDataType: ${p},`:""} shape: ${s}`);let x=this.freeTensors.splice(v,1)[0];return x.sessionId=t,x}gt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${n}, ${p?`fallbackDataType: ${p},`:""} shape: ${s}}`);let b=await g.createTensor({dataType:p??n,shape:s,dimensions:s,usage:l,writable:u,readable:f});return new Xr({sessionId:t,context:g,tensor:b,dataType:n,shape:s,fallbackDataType:p})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},Ol=(...t)=>new Ti(...t)}),sr,lr,Cn,Ls=T(()=>{rt(),xa(),rr(),Rl(),Tn(),sr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),lr=(t,n)=>{if(t===n)return!0;if(t===void 0||n===void 0)return!1;let s=Object.keys(t).sort(),l=Object.keys(n).sort();return s.length===l.length&&s.every((u,f)=>u===l[f]&&t[u]===n[u])},Cn=class{constructor(t){this.tensorManager=Ol(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,this.mlOpSupportLimitsBySessionId=new Map,Qr(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){gt("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){gt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let n=this.temporarySessionTensorIds.get(t);if(n){for(let s of n)gt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${s}}`),this.tensorManager.releaseTensorId(s);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let s=this.mlContextCache.findIndex(l=>l.gpuDevice===t);if(s!==-1)return this.mlContextCache[s].mlContext;{let l=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:l}),l}}else if(t===void 0){let s=this.mlContextCache.findIndex(l=>l.options===void 0&&l.gpuDevice===void 0);if(s!==-1)return this.mlContextCache[s].mlContext;{let l=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:l}),l}}let n=this.mlContextCache.findIndex(s=>lr(s.options,t));if(n!==-1)return this.mlContextCache[n].mlContext;{let s=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:s}),s}}registerMLContext(t,n){this.mlContextBySessionId.set(t,n);let s=this.sessionIdsByMLContext.get(n);s||(s=new Set,this.sessionIdsByMLContext.set(n,s)),s.add(t),this.mlOpSupportLimitsBySessionId.has(t)||this.mlOpSupportLimitsBySessionId.set(t,n.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let n=this.mlContextBySessionId.get(t);if(!n)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t),this.mlOpSupportLimitsBySessionId.delete(t);let s=this.sessionIdsByMLContext.get(n);if(s.delete(t),s.size===0){this.sessionIdsByMLContext.delete(n);let l=this.mlContextCache.findIndex(u=>u.mlContext===n);l!==-1&&this.mlContextCache.splice(l,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}getMLOpSupportLimits(t){return this.mlOpSupportLimitsBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){gt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,n,s,l,u){let f=sr.get(s);if(!f)throw new Error(`Unsupported ONNX data type: ${s}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,n,f,l,u)}async createTemporaryTensor(t,n,s){gt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${n}, shape: ${s}}`);let l=sr.get(n);if(!l)throw new Error(`Unsupported ONNX data type: ${n}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,u,l,s,!1);let f=this.temporarySessionTensorIds.get(t);return f?f.push(u):this.temporarySessionTensorIds.set(t,[u]),u}uploadTensor(t,n){if(!st().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");gt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${n.byteLength}}`),this.tensorManager.upload(t,n)}async downloadTensor(t,n){return this.tensorManager.download(t,n)}createMLTensorDownloader(t,n){return async()=>{let s=await this.tensorManager.download(t);return $i(s,n)}}registerMLTensor(t,n,s,l){let u=sr.get(s);if(!u)throw new Error(`Unsupported ONNX data type: ${s}`);let f=this.tensorManager.registerTensor(t,n,u,l);return gt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${n}, dataType: ${u}, dimensions: ${l}} -> {tensorId: ${f}}`),f}registerMLConstant(t,n,s,l,u,f,p=!1){if(!f)throw new Error("External mounted files are not available.");let g=t;t.startsWith("./")&&(g=t.substring(2));let b=f.get(g);if(!b)throw new Error(`File with name ${g} not found in preloaded files.`);if(n+s>b.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let v=b.slice(n,n+s).buffer,w;switch(u.dataType){case"float32":w=new Float32Array(v);break;case"float16":w=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(v):new Uint16Array(v);break;case"int32":w=new Int32Array(v);break;case"uint32":w=new Uint32Array(v);break;case"int64":if(p){let x=Ei(new Uint8Array(v),"int64");w=new Int32Array(x.buffer),u.dataType="int32"}else w=new BigInt64Array(v);break;case"uint64":w=new BigUint64Array(v);break;case"int8":w=new Int8Array(v);break;case"int4":case"uint4":case"uint8":w=new Uint8Array(v);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return gt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${p?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),l.constant(u,w)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,n){let s=this.sessionGraphInputs.get(t);return s?s.includes(n):!1}isGraphOutput(t,n){let s=this.sessionGraphOutputs.get(t);return s?s.includes(n):!1}isGraphInputOutputTypeSupported(t,n,s=!0){let l=sr.get(jt(n)),u=this.mlOpSupportLimitsBySessionId.get(t);return typeof l>"u"?!1:s?!!(u!=null&&u.input.dataTypes.includes(l)):!!(u!=null&&u.output.dataTypes.includes(l))}flush(){}}}),Ci=T(()=>{}),zn,Zr,zi,qs,or,ur,Ml,Da,Ai,kl=T(()=>{Tn(),Ci(),zn=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Zr=[],zi=t=>Math.ceil(Number(t)/16)*16,qs=t=>{for(let n=0;n<Zr.length;n++){let s=Zr[n];if(t<=s)return s}return Math.ceil(t/16)*16},or=1,ur=()=>or++,Ml=async(t,n,s,l)=>{let u=zi(s),f=t.device.createBuffer({size:u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let p=t.getCommandEncoder();t.endComputePass(),p.copyBufferToBuffer(n,0,f,0,u),t.flush(),await f.mapAsync(GPUMapMode.READ);let g=f.getMappedRange();if(l){let b=l();return b.set(new Uint8Array(g,0,s)),b}else return new Uint8Array(g.slice(0,s))}finally{f.destroy()}},Da=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[n]of zn)Zr.push(n),this.freeBuffers.set(n,[]),this.freeUniformBuffers.set(n,[]);this.sessionCount=0}upload(t,n){let s=n.buffer,l=n.byteOffset,u=n.byteLength,f=zi(u),p=this.storageCache.get(t);if(!p)throw new Error("gpu data for uploading does not exist");if(Number(p.originalSize)!==u)throw new Error(`inconsistent data size. gpu data size=${p.originalSize}, data size=${u}`);let g=this.backend.device.createBuffer({mappedAtCreation:!0,size:f,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),b=g.getMappedRange();new Uint8Array(b).set(new Uint8Array(s,l,u)),g.unmap();let v=this.backend.device.createCommandEncoder();v.copyBufferToBuffer(g,0,p.gpuData.buffer,0,f),this.backend.device.queue.submit([v.finish()]),g.destroy(),gt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,n){let s=this.storageCache.get(t);if(!s)throw new Error("source gpu data for memcpy does not exist");let l=this.storageCache.get(n);if(!l)throw new Error("destination gpu data for memcpy does not exist");if(s.originalSize!==l.originalSize)throw new Error("inconsistent source and destination gpu data size");let u=zi(s.originalSize),f=this.backend.getCommandEncoder();this.backend.endComputePass(),f.copyBufferToBuffer(s.gpuData.buffer,0,l.gpuData.buffer,0,u)}registerExternalBuffer(t,n,s){let l;if(s){if(l=s[0],t===s[1])return gt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${n}) => id=${l}, buffer is the same, skip.`),l;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else l=ur();return this.storageCache.set(l,{gpuData:{id:l,type:0,buffer:t},originalSize:n}),gt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${n}) => id=${l}, registered.`),l}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),gt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,n=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let s=qs(t),l,u=(n&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,f=(n&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(u||f){let g=(u?this.freeBuffers:this.freeUniformBuffers).get(s);g?g.length>0?l=g.pop():l=this.backend.device.createBuffer({size:s,usage:n}):l=this.backend.device.createBuffer({size:s,usage:n})}else l=this.backend.device.createBuffer({size:s,usage:n});let p={id:ur(),type:0,buffer:l};return this.storageCache.set(p.id,{gpuData:p,originalSize:Number(t)}),gt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${p.id}`),p}get(t){var n;return(n=this.storageCache.get(t))==null?void 0:n.gpuData}release(t){let n=typeof t=="bigint"?Number(t):t,s=this.storageCache.get(n);if(!s){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return gt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${n}), gpuDataId=${s.gpuData.id}`),this.storageCache.delete(n),this.buffersPending.push(s.gpuData.buffer),s.originalSize}async download(t,n){let s=this.storageCache.get(Number(t));if(!s)throw new Error("data does not exist");await Ml(this.backend,s.gpuData.buffer,s.originalSize,n)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let n=zn.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let s=this.freeBuffers.get(t.size)||[];n===void 0||s.length>=n?t.destroy():s.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let s=this.freeUniformBuffers.get(t.size)||[];n===void 0||s.length>=n?t.destroy():s.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let n of this.buffersPending)t.push(n);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(n=>{n.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(n=>{n.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(n=>{n.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let n=this.capturedPendingBuffers.get(t);n&&(n.forEach(s=>{s.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(gt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(s=>{s.gpuData.buffer.destroy()}),this.storageCache=new Map)}},Ai=(...t)=>new Da(...t)}),S,O,I=T(()=>{S=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},O=t=>new S(t)}),F,j,ae,W,Q,re,Ee,ke,xe,de,Ve,J,Ue,Jt,ft,ct,Gt,Ze=T(()=>{rt(),He(),F=64,j=(t,n)=>{if(n===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return n>1?`vec${n}<f16>`:"f16";case 1:return n>1?`vec${n}<f32>`:"f32";case 6:return n>1?`vec${n}<i32>`:"i32";case 12:return n>1?`vec${n}<u32>`:"u32";case 7:if(n>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(n>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(n!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},ae=(t,n=1)=>{let s=j(t,n);return typeof s=="string"?s:s[0]},W=(t,n=1)=>{let s=j(t,n);return typeof s=="string"?s:s[1]},Q=(...t)=>{let n=[];return t.forEach(s=>{s.length!==0&&n.push({type:12,data:s},{type:12,data:pe.computeStrides(s)})}),n},re=t=>t%4===0?4:t%2===0?2:1,Ee=(t="f32",n,s="0")=>!n||n===1?`${t}(${s})`:`vec${n}<${t}>(${s})`,ke=(t,n,s)=>t==="f32"?s:n===1?`f32(${s})`:`vec${n}<f32>(${s})`,xe=(t,n)=>n===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:n===2?`(${t}.x + ${t}.y)`:n===3?`(${t}.x + ${t}.y + ${t}.z)`:t,de=(t,n,s,l)=>t.startsWith("uniforms.")&&s>4?typeof n=="string"?l==="f16"?`${t}[(${n}) / 8][(${n}) % 8 / 4][(${n}) % 8 % 4]`:`${t}[(${n}) / 4][(${n}) % 4]`:l==="f16"?`${t}[${Math.floor(n/8)}][${Math.floor(n%8/4)}][${n%8%4}]`:`${t}[${Math.floor(n/4)}][${n%4}]`:s>1?`${t}[${n}]`:t,Ve=(t,n,s,l,u)=>{let f=typeof s=="number",p=f?s:s.length,g=[...new Array(p).keys()],b=p<2?"u32":p<=4?`vec${p}<u32>`:`array<u32, ${p}>`,v=j(n,u),w=typeof v=="string"?v:v[1],x=typeof v=="string"?v:v[0],C={indices:b,value:w,storage:x,tensor:n},z=Ne=>typeof Ne=="string"?Ne:`${Ne}u`,A={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},B=f?"uniforms.":"",L=`${B}${t}_shape`,U=`${B}${t}_strides`,N="";for(let Ne=0;Ne<p-1;Ne++)N+=`
    let dim${Ne} = current / ${de(U,Ne,p)};
    let rest${Ne} = current % ${de(U,Ne,p)};
    indices[${Ne}] = dim${Ne};
    current = rest${Ne};
    `;N+=`indices[${p-1}] = current;`;let V=p<2?"":`
  fn o2i_${t}(offset: u32) -> ${C.indices} {
    var indices: ${C.indices};
    var current = offset;
    ${N}
    return indices;
  }`,G=Ne=>(A.offsetToIndices=!0,p<2?Ne:`o2i_${t}(${Ne})`),X=[];if(p>=2)for(let Ne=p-1;Ne>=0;Ne--)X.push(`${de(U,Ne,p)} * (indices[${Ne}])`);let ue=p<2?"":`
  fn i2o_${t}(indices: ${C.indices}) -> u32 {
    return ${X.join("+")};
  }`,te=Ne=>(A.indicesToOffset=!0,p<2?Ne:`i2o_${t}(${Ne})`),ge=(...Ne)=>p===0?"0u":`${C.indices}(${Ne.map(z).join(",")})`,ve=(Ne,Ie)=>p<2?`${Ne}`:`${de(Ne,Ie,p)}`,Le=(Ne,Ie,lt)=>p<2?`${Ne}=${lt};`:`${de(Ne,Ie,p)}=${lt};`,nt={},Fe=(Ne,Ie)=>{A.broadcastedIndicesToOffset=!0;let lt=`${Ie.name}broadcastedIndicesTo${t}Offset`;if(lt in nt)return`${lt}(${Ne})`;let pt=[];for(let fa=p-1;fa>=0;fa--){let Jn=Ie.indicesGet("outputIndices",fa+Ie.rank-p);pt.push(`${ve(U,fa)} * (${Jn} % ${ve(L,fa)})`)}return nt[lt]=`fn ${lt}(outputIndices: ${Ie.type.indices}) -> u32 {
             return ${pt.length>0?pt.join("+"):"0u"};
           }`,`${lt}(${Ne})`},tt=(Ne,Ie)=>(()=>{if(C.storage===C.value)return`${t}[${Ne}]=${Ie};`;if(C.storage==="vec2<u32>"&&C.value==="i32")return`${t}[${Ne}]=vec2<u32>(u32(${Ie}), select(0u, 0xFFFFFFFFu, ${Ie} < 0));`;if(C.storage==="vec2<u32>"&&C.value==="u32")return`${t}[${Ne}]=vec2<u32>(u32(${Ie}), 0u);`;if(C.storage==="u32"&&C.value==="vec4<bool>")return`${t}[${Ne}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${Ie}));`;throw new Error(`not supported combination of storage type ${C.storage} and value type ${C.value} yet`)})(),Et=Ne=>(()=>{if(C.storage===C.value)return`${t}[${Ne}]`;if(C.storage==="vec2<u32>"&&C.value==="i32")return`i32(${t}[${Ne}].x)`;if(C.storage==="vec2<u32>"&&C.value==="u32")return`u32(${t}[${Ne}].x)`;if(C.storage==="u32"&&C.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${Ne}] & 0xFFu), bool(${t}[${Ne}] & 0xFF00u), bool(${t}[${Ne}] & 0xFF0000u), bool(${t}[${Ne}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${C.storage} and value type ${C.value} yet`)})(),Tt=p<2?"":`
  fn get_${t}ByIndices(indices: ${C.indices}) -> ${w} {
    return ${Et(`i2o_${t}(indices)`)};
  }`,We=p<2?"":(()=>{let Ne=g.map(lt=>`d${lt}: u32`).join(", "),Ie=g.map(lt=>`d${lt}`).join(", ");return`
  fn get_${t}(${Ne}) -> ${w} {
    return get_${t}ByIndices(${ge(Ie)});
  }`})(),ut=(...Ne)=>{if(Ne.length!==p)throw new Error(`indices length must be ${p}`);let Ie=Ne.map(z).join(",");return p===0?Et("0u"):p===1?Et(Ie[0]):(A.get=!0,A.getByIndices=!0,A.indicesToOffset=!0,`get_${t}(${Ie})`)},Qt=Ne=>p<2?Et(Ne):(A.getByIndices=!0,A.indicesToOffset=!0,`get_${t}ByIndices(${Ne})`),je=p<2?"":`
  fn set_${t}ByIndices(indices: ${C.indices}, value: ${w}) {
    ${tt(`i2o_${t}(indices)`,"value")}
  }`,aa=p<2?"":(()=>{let Ne=g.map(lt=>`d${lt}: u32`).join(", "),Ie=g.map(lt=>`d${lt}`).join(", ");return`
  fn set_${t}(${Ne}, value: ${w}) {
    set_${t}ByIndices(${ge(Ie)}, value);
  }`})();return{impl:()=>{let Ne=[],Ie=!1;return A.offsetToIndices&&(Ne.push(V),Ie=!0),A.indicesToOffset&&(Ne.push(ue),Ie=!0),A.broadcastedIndicesToOffset&&(Object.values(nt).forEach(lt=>Ne.push(lt)),Ie=!0),A.set&&(Ne.push(aa),Ie=!0),A.setByIndices&&(Ne.push(je),Ie=!0),A.get&&(Ne.push(We),Ie=!0),A.getByIndices&&(Ne.push(Tt),Ie=!0),!f&&Ie&&Ne.unshift(`const ${L} = ${C.indices}(${s.join(",")});`,`const ${U} = ${C.indices}(${pe.computeStrides(s).join(",")});`),Ne.join(`
`)},type:C,offsetToIndices:G,indicesToOffset:te,broadcastedIndicesToOffset:Fe,indices:ge,indicesGet:ve,indicesSet:Le,set:(...Ne)=>{if(Ne.length!==p+1)throw new Error(`indices length must be ${p}`);let Ie=Ne[p];if(typeof Ie!="string")throw new Error("value must be string");let lt=Ne.slice(0,p).map(z).join(",");return p===0?tt("0u",Ie):p===1?tt(lt[0],Ie):(A.set=!0,A.setByIndices=!0,A.indicesToOffset=!0,`set_${t}(${lt}, ${Ie})`)},setByOffset:tt,setByIndices:(Ne,Ie)=>p<2?tt(Ne,Ie):(A.setByIndices=!0,A.indicesToOffset=!0,`set_${t}ByIndices(${Ne}, ${Ie});`),get:ut,getByOffset:Et,getByIndices:Qt,usage:l,name:t,strides:U,shape:L,rank:p}},J=(t,n,s,l=1)=>Ve(t,n,s,"input",l),Ue=(t,n,s,l=1)=>Ve(t,n,s,"output",l),Jt=(t,n,s)=>Ve(t,n,s,"atomicOutput",1),ft=(t,n,s,l=1)=>Ve(t,n,s,"internal",l),ct=class{constructor(t,n){this.normalizedDispatchGroup=t,this.limits=n,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=F){let n=typeof t=="number"?t:t[0],s=typeof t=="number"?1:t[1],l=typeof t=="number"?1:t[2];if(n>this.limits.maxComputeWorkgroupSizeX||s>this.limits.maxComputeWorkgroupSizeY||l>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${n}, ${s}, ${l}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(n*s*l>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${n}, ${s}, ${l}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let u=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,f=u?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,p=u?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${n*s*l}u + local_idx;`;return`@compute @workgroup_size(${n}, ${s}, ${l})
  fn main(${f}) {
    ${p}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,n){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let s=t.usage==="input"?"read":"read_write",l=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${n}) var<storage, ${s}> ${t.name}: array<${l}>;`}declareVariables(...t){return t.map(n=>this.declareVariable(n,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(n=>this.registerInternalVariable(n)),this}registerUniform(t,n,s=1){return this.uniforms.push({name:t,type:n,length:s}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:n,type:s,length:l}of this.uniforms)if(l&&l>4)s==="f16"?t.push(`@align(16) ${n}:array<mat2x4<${s}>, ${Math.ceil(l/8)}>`):t.push(`${n}:array<vec4<${s}>, ${Math.ceil(l/4)}>`);else{let u=l==null||l===1?s:`vec${l}<${s}>`;t.push(`${n}:${u}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=n=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(n)];return this.uniforms.map(n=>[t(n.type),n.length??1])}},Gt=(t,n)=>new ct(t,n)}),Ft,Rt,Aa,Ga,Va,js,Ya,ko,Do,Oa=T(()=>{rt(),He(),I(),Ze(),Ft=(t,n)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(n.length!==0&&n.length!==t[0].dims.length)throw new Error(`perm size ${n.length} does not match input rank ${t[0].dims.length}`)},Rt=(t,n)=>n.length!==0?n:[...new Array(t).keys()].reverse(),Aa=(t,n)=>pe.sortBasedOnPerm(t,Rt(t.length,n)),Ga=(t,n,s,l)=>{let u=`fn perm(i: ${l.type.indices}) -> ${s.type.indices} {
    var a: ${s.type.indices};`;for(let f=0;f<n;++f)u+=`a[${t[f]}]=i[${f}];`;return u+="return a;}"},Va=(t,n)=>{let s=[],l=[];for(let u=0;u<t.length;++u)t[u]!==1&&s.push(t[u]),t[n[u]]!==1&&l.push(n[u]);return{newShape:s,newPerm:l}},js=(t,n)=>{let s=0;for(let l=0;l<t.length;++l)if(n[t[l]]!==1){if(t[l]<s)return!1;s=t[l]}return!0},Ya=(t,n)=>{let s=t.dataType,l=t.dims.length,u=Rt(l,n),f=Aa(t.dims,u),p=t.dims,g=f,b=l<2||js(u,t.dims),v;if(b)return v=A=>{let B=J("input",s,p,4),L=Ue("output",s,g,4);return`
  ${A.registerUniform("output_size","u32").declareVariables(B,L)}
  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let A=pe.size(f);return{outputs:[{dims:f,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(A/64/4)},programUniforms:[{type:12,data:Math.ceil(A/4)}]}},getShaderSource:v};let{newShape:w,newPerm:x}=Va(t.dims,u),C=pe.areEqual(x,[2,3,1]),z=pe.areEqual(x,[3,1,2]);if(w.length===2||C||z){p=C?[w[0],w[1]*w[2]]:z?[w[0]*w[1],w[2]]:w,g=[p[1],p[0]];let A=16;return v=B=>{let L=J("a",s,p.length),U=Ue("output",s,g.length);return`
  ${B.registerUniform("output_size","u32").declareVariables(L,U)}
  var<workgroup> tile : array<array<${U.type.value}, ${A+1}>, ${A}>;
  ${B.mainStart([A,A,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${A} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${A}u + local_id.x;
    let input_row = workgroup_id_x * ${A}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${L.getByIndices(`${L.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${A}u + local_id.x;
    let output_row = workgroup_id_y * ${A}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${U.setByIndices(`${U.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let B=pe.size(f);return{outputs:[{dims:f,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(g[1]/A),y:Math.ceil(g[0]/A)},programUniforms:[{type:12,data:B},...Q(p,g)]}},getShaderSource:v}}return v=A=>{let B=J("a",s,p.length),L=Ue("output",s,g.length);return`
  ${A.registerUniform("output_size","u32").declareVariables(B,L)}

  ${Ga(u,l,B,L)}

  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${L.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${L.setByOffset("global_idx",B.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>{let A=pe.size(f);return{outputs:[{dims:f,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:[{type:12,data:A},...Q(p,g)]}},getShaderSource:v}},ko=(t,n)=>{Ft(t.inputs,n.perm),t.compute(Ya(t.inputs[0],n.perm))},Do=t=>O({perm:t.perm})}),Gn,Bo,$t,An,Dl,rn,Gs,va,Ha,Vs,Pa,Bl,cr,si,li,Jr,ba,ra,Xa,es,Nu,Uu=T(()=>{rt(),He(),Ze(),as(),Oa(),Gn={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Bo={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},$t={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},An={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Dl=(t,n)=>{let s=[];for(let l=n-t;l<n;++l)s.push(l);return s},rn=(t,n)=>{let s=[],l=t.length;for(let f=0;f<l;f++)n.indexOf(f)===-1&&s.push(t[f]);let u=n.map(f=>t[f]);return[s,u]},Gs=(t,n)=>{let s=t.length+n.length,l=[],u=0;for(let f=0;f<s;f++)n.indexOf(f)===-1?l.push(t[u++]):l.push(1);return l},va=(t,n)=>{for(let s=0;s<t.length;++s)if(t[t.length-s-1]!==n-1-s)return!1;return!0},Ha=(t,n)=>{let s=[];if(!va(t,n)){for(let l=0;l<n;++l)t.indexOf(l)===-1&&s.push(l);t.forEach(l=>s.push(l))}return s},Vs=(t,n,s,l,u,f,p)=>{let g=s[0].dims,b=pe.size(f),v=pe.size(p),w=J("_A",s[0].dataType,g),x=Ue("output",u,f),C=64;b===1&&(C=256);let z=`
          var<workgroup> aBestValues : array<f32, ${C}>;
       `,A=B=>`
        ${B.registerUniform("reduceSize","u32").declareVariables(w,x)}
        ${z}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${B.mainStart(C)}

          let outputIndex = global_idx / ${C};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${$t[l]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${C}) {
           let candidate = f32(${w.getByOffset("offset + k")});
           bestValue = ${Gn[l]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${C}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Bo[l]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${x.setByOffset("outputIndex",`${l==="mean"?`${x.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${x.type.storage}(${An[l]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${n};${C}`,inputDependencies:["type"]},getShaderSource:A,getRunData:()=>({outputs:[{dims:f,dataType:u}],dispatchGroup:{x:b},programUniforms:[{type:12,data:v}]})}},Pa=(t,n,s,l)=>{let u=t.inputs.length===1?s:No(t.inputs,s),f=u.axes;f.length===0&&!u.noopWithEmptyAxes&&(f=t.inputs[0].dims.map((z,A)=>A));let p=pe.normalizeAxes(f,t.inputs[0].dims.length),g=p,b=t.inputs[0],v=Ha(g,t.inputs[0].dims.length);v.length>0&&(b=t.compute(Ya(t.inputs[0],v),{inputs:[0],outputs:[-1]})[0],g=Dl(g.length,b.dims.length));let[w,x]=rn(b.dims,g),C=w;u.keepDims&&(C=Gs(w,p)),t.compute(Vs(n,u.cacheKey,[b],l,t.inputs[0].dataType,C,x),{inputs:[b]})},Bl=(t,n)=>{Pa(t,"ReduceMeanShared",n,"mean")},cr=(t,n)=>{Pa(t,"ReduceL1Shared",n,"l1")},si=(t,n)=>{Pa(t,"ReduceL2Shared",n,"l2")},li=(t,n)=>{Pa(t,"ReduceLogSumExpShared",n,"logSumExp")},Jr=(t,n)=>{Pa(t,"ReduceMaxShared",n,"max")},ba=(t,n)=>{Pa(t,"ReduceMinShared",n,"min")},ra=(t,n)=>{Pa(t,"ReduceProdShared",n,"prod")},Xa=(t,n)=>{Pa(t,"ReduceSumShared",n,"sum")},es=(t,n)=>{Pa(t,"ReduceSumSquareShared",n,"sumSquare")},Nu=(t,n)=>{Pa(t,"ReduceLogSumShared",n,"logSum")}}),Vn,Cd,Nl,No,Hn,zd,Ad,lh,oh,uh,ch,dh,hn,Ul,Od,Pn,Rd,Md,Iu,fh,Hs,Lu,Il,qu,kd,ts,as=T(()=>{rt(),He(),I(),Ze(),Uu(),Vn=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Cd=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],Nl=(t,n,s,l,u,f,p=!1,g=!1)=>{let b=[],v=s[0].dims,w=v.length,x=pe.normalizeAxes(u,w),C=!g&&x.length===0;v.forEach((B,L)=>{C||x.indexOf(L)>=0?p&&b.push(1):b.push(B)});let z=b.length,A=pe.size(b);return{name:t,shaderCache:n,getShaderSource:B=>{let L=[],U=J("_A",s[0].dataType,w),N=Ue("output",f,z),V=l(U,N,x),G=V[2];for(let X=0,ue=0;X<w;X++)C||x.indexOf(X)>=0?(p&&ue++,G=`for(var j${X}: u32 = 0; j${X} < ${v[X]}; j${X}++) {
                  ${V[2].includes("last_index")?`let last_index = j${X};`:""}
                  ${U.indicesSet("input_indices",X,`j${X}`)}
                  ${G}
                }`):(L.push(`${U.indicesSet("input_indices",X,N.indicesGet("output_indices",ue))};`),ue++);return`

        ${B.registerUniform("output_size","u32").declareVariables(U,N)}

        ${B.mainStart()}
          ${B.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${U.type.indices};
          let output_indices = ${N.offsetToIndices("global_idx")};

          ${L.join(`
`)}
          ${V[0]}       // init ops for reduce max/min
          ${V[1]}
          ${G}
          ${V[3]}
          ${V.length===4?N.setByOffset("global_idx","value"):V.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:b,dataType:f}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:[{type:12,data:A},...Q(v,b)]})}},No=(t,n)=>{let s=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(l=>s.push(Number(l))),O({axes:s,keepDims:n.keepDims,noopWithEmptyAxes:n.noopWithEmptyAxes})},Hn=(t,n,s,l)=>{let u=t.inputs,f=u.length===1?s:No(u,s);t.compute(Nl(n,{hint:f.cacheKey,inputDependencies:["rank"]},[u[0]],f.noopWithEmptyAxes&&f.axes.length===0?Cd:l,f.axes,u[0].dataType,f.keepDims,f.noopWithEmptyAxes),{inputs:[0]})},zd=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceLogSum",n,(s,l)=>[`var value = ${l.type.storage}(0);`,"",`value += ${s.getByIndices("input_indices")};`,"value = log(value);"])},Ad=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceL1",n,(s,l)=>[`var value = ${l.type.storage}(0);`,"",`value += abs(${s.getByIndices("input_indices")});`,""])},lh=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceL2",n,(s,l)=>[`var t = ${l.type.value}(0); var value = ${l.type.value}(0);`,"",`t = ${s.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},oh=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceLogSumExp",n,(s,l)=>[`var value = ${l.type.storage}(0);`,"",`value += exp(${s.getByIndices("input_indices")});`,"value = log(value);"])},uh=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceMax",n,(s,l,u)=>{let f=[];for(let p=0;p<s.rank;p++)(u.indexOf(p)>=0||u.length===0)&&f.push(s.indicesSet("input_indices",p,0));return[`${f.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};`,`value = max(value, ${s.getByIndices("input_indices")});`,""]})},ch=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceMean",n,(s,l,u)=>{let f=1;for(let p=0;p<s.rank;p++)(u.indexOf(p)>=0||u.length===0)&&(f*=t.inputs[0].dims[p]);return["var sum = f32(0);","",`sum += f32(${s.getByIndices("input_indices")});`,`let value = ${l.type.value}(sum / ${f});`]})},dh=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceMin",n,(s,l,u)=>{let f=[];for(let p=0;p<s.rank;p++)(u.indexOf(p)>=0||u.length===0)&&f.push(`input_indices[${p}] = 0;`);return[`${f.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};`,`value = min(value, ${s.getByIndices("input_indices")});`,""]})},hn=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceProd",n,(s,l)=>[`var value = ${l.type.storage}(1);`,"",`value *= ${s.getByIndices("input_indices")};`,""])},Ul=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceSum",n,(s,l)=>[`var value = ${l.type.storage}(0);`,"",`value += ${s.getByIndices("input_indices")};`,""])},Od=(t,n)=>{Vn(t.inputs),Hn(t,"ReduceSumSquare",n,(s,l)=>[`var t = ${l.type.value}(0); var value = ${l.type.value}(0);`,"",`t = ${s.getByIndices("input_indices")}; value += t * t;`,""])},Pn=(t,n,s)=>{if(n.length===0)return s;let l=1,u=1;for(let f=0;f<n.length;f++)n.indexOf(f)===-1?l*=t[f]:u*=t[f];return u<32&&l>1024},Rd=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?ch(t,n):Bl(t,n)},Md=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?Ad(t,n):cr(t,n)},Iu=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?lh(t,n):si(t,n)},fh=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?oh(t,n):li(t,n)},Hs=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?uh(t,n):Jr(t,n)},Lu=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?dh(t,n):ba(t,n)},Il=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?hn(t,n):ra(t,n)},qu=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?Ul(t,n):Xa(t,n)},kd=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?Od(t,n):es(t,n)},ts=(t,n)=>{Pn(t.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?zd(t,n):Nu(t,n)}}),Uo,Dd,ns,ju,ph=T(()=>{rt(),I(),as(),Uo=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},Dd=(t,n)=>{Uo(t.inputs);let s=(l,u,f)=>{let p=[];for(let g=0;g<l.rank;g++)(f.indexOf(g)>=0||f.length===0)&&p.push(`input_indices[${g}] = 0;`);return[`${p.join(`
`)}`,`var value = ${l.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${l.getByIndices("input_indices")} ${n.selectLastIndex>0?"<=":"<"} value) {
         value = ${l.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",u.setByOffset("global_idx","best_index")]};t.compute(Nl("ArgMin",{hint:n.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],s,[n.axis],7,n.keepDims),{inputs:[0]})},ns=(t,n)=>{Uo(t.inputs);let s=(l,u,f)=>{let p=[];for(let g=0;g<l.rank;g++)(f.indexOf(g)>=0||f.length===0)&&p.push(`input_indices[${g}] = 0;`);return[`${p.join(`
`)}`,`var value = ${l.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${l.getByIndices("input_indices")} ${n.selectLastIndex>0?">=":">"} value) {
         value = ${l.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",u.setByOffset("global_idx","best_index")]};t.compute(Nl("argMax",{hint:n.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],s,[n.axis],7,n.keepDims),{inputs:[0]})},ju=t=>O(t)}),Bd,Gu,hh,mh,Nd,Ll,Vu,Fn,ql=T(()=>{rt(),He(),Ci(),Ze(),Bd=(t,n)=>{let s=t[0],l=t[1],u=t[2],f=t[3],p=t[4],g=t[5];if(p&&g)throw new Error("Attention cannot have both past and attention_bias");if(s.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let b=s.dims[0],v=s.dims[1],w=s.dims[2];if(u.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(l.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(l.dims[0]!==w)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(u.dims[0]!==l.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let x=u.dims[0]/3,C=x,z=C;if(n.qkvHiddenSizes.length>0){if(n.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let V of n.qkvHiddenSizes)if(V%n.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");x=n.qkvHiddenSizes[0],C=n.qkvHiddenSizes[1],z=n.qkvHiddenSizes[2]}let A=v;if(x!==C)throw new Error("qkv_hidden_sizes first element should be same as the second");if(u.dims[0]!==x+C+z)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let B=0;if(p){if(C!==z)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(p.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(p.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(p.dims[1]!==b)throw new Error('Input "past" second dimension must be batch_size');if(p.dims[2]!==n.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(p.dims[4]!==C/n.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');n.pastPresentShareBuffer||(B=p.dims[3])}let L=A+B,U=-1,N=0;if(f)throw new Error("Mask not supported");if(p)throw new Error("past is not supported");if(g){if(g.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(g.dims[0]!==b||g.dims[1]!==n.numHeads||g.dims[2]!==v||g.dims[3]!==L)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:b,sequenceLength:v,pastSequenceLength:B,kvSequenceLength:A,totalSequenceLength:L,maxSequenceLength:U,inputHiddenSize:w,hiddenSize:x,vHiddenSize:z,headSize:Math.floor(x/n.numHeads),vHeadSize:Math.floor(z/n.numHeads),numHeads:n.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:n.maskFilterValue,maskType:N,scale:n.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Gu=(t,n,s)=>n&&t?`
      let total_sequence_length_input = u32(${n.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t==null?void 0:t.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${s?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,hh=(t,n,s,l,u,f,p,g)=>{let b=re(p?1:f),v=64,w=f/b;w<v&&(v=32);let x=Math.ceil(f/b/v),C=[{type:12,data:n},{type:12,data:s},{type:12,data:l},{type:12,data:u},{type:12,data:w},{type:12,data:x}],z=ae(t.dataType,b),A=W(1,b),B=["type"];p&&B.push("type"),g&&B.push("type");let L=U=>{let N=Ue("x",t.dataType,t.dims,b),V=[N],G=p?J("seq_lens",p.dataType,p.dims):void 0;G&&V.push(G);let X=g?J("total_sequence_length_input",g.dataType,g.dims):void 0;X&&V.push(X);let ue=W(t.dataType),te=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${v}>;
  var<workgroup> thread_sum: array<f32, ${v}>;
  ${U.registerUniforms(te).declareVariables(...V)}
  ${U.mainStart([v,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${Gu(G,X,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${v}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${p?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${A}(-3.4028234663852886e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${A}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(b){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${b}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.4028234663852886e+38f);
    for (var i = 0u; i < ${v}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${A}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${A}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(b){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${b}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${v}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${N.type.value}(${ue}(1.0) / ${ue}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${A}(x[offset + i]);
        x[offset + i] = ${N.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${p?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${N.type.value}(${ue}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${v};${z};${b}`,inputDependencies:B},getShaderSource:L,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:u,z:n*s},programUniforms:C})}},mh=(t,n,s,l,u,f,p,g,b)=>{let v=p+f.kvSequenceLength,w=[f.batchSize,f.numHeads,f.sequenceLength,v],x=t>1&&l,C=f.kvNumHeads?f.kvNumHeads:f.numHeads,z=x?[f.batchSize,C,v,f.headSize]:void 0,A=f.nReps?f.nReps:1,B=f.scale===0?1/Math.sqrt(f.headSize):f.scale,L=re(f.headSize),U=f.headSize/L,N=12,V={x:Math.ceil(v/N),y:Math.ceil(f.sequenceLength/N),z:f.batchSize*f.numHeads},G=[{type:12,data:f.sequenceLength},{type:12,data:U},{type:12,data:v},{type:12,data:f.numHeads},{type:12,data:f.headSize},{type:1,data:B},{type:12,data:p},{type:12,data:f.kvSequenceLength},{type:12,data:A}],X=x&&l&&pe.size(l.dims)>0,ue=["type","type"];X&&ue.push("type"),u&&ue.push("type"),g&&ue.push("type"),b&&ue.push("type");let te=[{dims:w,dataType:n.dataType,gpuDataType:0}];x&&te.push({dims:z,dataType:n.dataType,gpuDataType:0});let ge=ve=>{let Le=J("q",n.dataType,n.dims,L),nt=J("key",s.dataType,s.dims,L),Fe=[Le,nt];if(X){let je=J("past_key",l.dataType,l.dims,L);Fe.push(je)}u&&Fe.push(J("attention_bias",u.dataType,u.dims));let tt=g?J("seq_lens",g.dataType,g.dims):void 0;tt&&Fe.push(tt);let Et=b?J("total_sequence_length_input",b.dataType,b.dims):void 0;Et&&Fe.push(Et);let Tt=Ue("output",n.dataType,w),We=[Tt];x&&We.push(Ue("present_key",n.dataType,z,L));let ut=W(1,L),Qt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${N}u;

  var<workgroup> tileQ: array<${Le.type.storage}, ${N*N}>;
  var<workgroup> tileK: array<${Le.type.storage}, ${N*N}>;
  ${ve.registerUniforms(Qt).declareVariables(...Fe,...We)}
  ${ve.mainStart([N,N,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${A===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${A===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${Gu(tt,Et,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${X&&x?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${x?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ut}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${X&&x?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${x?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ut}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(L){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${L}`)}})()};
        output[outputIdx] = ${Tt.type.value} (sum * uniforms.alpha) + ${u?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${L};${u!==void 0};${l!==void 0};${t}`,inputDependencies:ue},getRunData:()=>({outputs:te,dispatchGroup:V,programUniforms:G}),getShaderSource:ge}},Nd=(t,n,s,l,u,f,p=void 0,g=void 0)=>{let b=f+u.kvSequenceLength,v=u.nReps?u.nReps:1,w=u.vHiddenSize*v,x=t>1&&l,C=u.kvNumHeads?u.kvNumHeads:u.numHeads,z=x?[u.batchSize,C,b,u.headSize]:void 0,A=[u.batchSize,u.sequenceLength,w],B=12,L={x:Math.ceil(u.vHeadSize/B),y:Math.ceil(u.sequenceLength/B),z:u.batchSize*u.numHeads},U=[{type:12,data:u.sequenceLength},{type:12,data:b},{type:12,data:u.vHeadSize},{type:12,data:u.numHeads},{type:12,data:u.headSize},{type:12,data:w},{type:12,data:f},{type:12,data:u.kvSequenceLength},{type:12,data:v}],N=x&&l&&pe.size(l.dims)>0,V=["type","type"];N&&V.push("type"),p&&V.push("type"),g&&V.push("type");let G=[{dims:A,dataType:n.dataType,gpuDataType:0}];x&&G.push({dims:z,dataType:n.dataType,gpuDataType:0});let X=ue=>{let te=J("probs",n.dataType,n.dims),ge=J("v",s.dataType,s.dims),ve=[te,ge];N&&ve.push(J("past_value",l.dataType,l.dims));let Le=p?J("seq_lens",p.dataType,p.dims):void 0;p&&ve.push(Le);let nt=g?J("total_sequence_length_input",g.dataType,g.dims):void 0;g&&ve.push(nt);let Fe=[Ue("output",n.dataType,A)];x&&Fe.push(Ue("present_value",n.dataType,z));let tt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${B}u;
  var<workgroup> tileQ: array<${te.type.value}, ${B*B}>;
  var<workgroup> tileV: array<${te.type.value}, ${B*B}>;
  ${ue.registerUniforms(tt).declareVariables(...ve,...Fe)}
  ${ue.mainStart([B,B,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${v===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${v===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${Gu(Le,nt,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${N&&x?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${x?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${te.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${N&&x?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${x?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${l!==void 0};${t}`,inputDependencies:V},getRunData:()=>({outputs:G,dispatchGroup:L,programUniforms:U}),getShaderSource:X}},Ll=(t,n,s,l,u,f,p,g,b,v,w=void 0,x=void 0)=>{let C=Math.min(t.outputCount,1+(p?1:0)+(g?1:0)),z=C>1?v.pastSequenceLength:0,A=z+v.kvSequenceLength,B=b&&pe.size(b.dims)>0?b:void 0,L=[n,s];C>1&&p&&pe.size(p.dims)>0&&L.push(p),B&&L.push(B),w&&L.push(w),x&&L.push(x);let U=t.compute(mh(C,n,s,p,B,v,z,w,x),{inputs:L,outputs:C>1?[-1,1]:[-1]})[0];t.compute(hh(U,v.batchSize,v.numHeads,z,v.sequenceLength,A,w,x),{inputs:w&&x?[U,w,x]:[U],outputs:[]});let N=[U,l];C>1&&g&&pe.size(g.dims)>0&&N.push(g),w&&N.push(w),x&&N.push(x),t.compute(Nd(C,U,l,g,v,z,w,x),{inputs:N,outputs:C>1?[0,2]:[0]})},Vu=(t,n)=>{let s=[n.batchSize,n.numHeads,n.sequenceLength,n.headSize],l=n.sequenceLength,u=n.inputHiddenSize,f=n.headSize,p=12,g={x:Math.ceil(n.headSize/p),y:Math.ceil(n.sequenceLength/p),z:n.batchSize*n.numHeads},b=[t.inputs[0],t.inputs[1],t.inputs[2]],v=[{type:12,data:l},{type:12,data:u},{type:12,data:f},{type:12,data:n.numHeads},{type:12,data:n.headSize},{type:12,data:n.hiddenSize},{type:12,data:n.hiddenSize+n.hiddenSize+n.vHiddenSize}],w=x=>{let C=Ue("output_q",b[0].dataType,s),z=Ue("output_k",b[0].dataType,s),A=Ue("output_v",b[0].dataType,s),B=J("input",b[0].dataType,b[0].dims),L=J("weight",b[1].dataType,b[1].dims),U=J("bias",b[2].dataType,b[2].dims),N=B.type.storage,V=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${p}u;
  var<workgroup> tileInput: array<${N}, ${p*p}>;
  var<workgroup> tileWeightQ: array<${N}, ${p*p}>;
  var<workgroup> tileWeightK: array<${N}, ${p*p}>;
  var<workgroup> tileWeightV: array<${N}, ${p*p}>;
  ${x.registerUniforms(V).declareVariables(B,L,U,C,z,A)}
  ${x.mainStart([p,p,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${N}(0);
    var valueK = ${N}(0);
    var valueV = ${N}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:s,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:s,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:s,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:g,programUniforms:v}),getShaderSource:w},{inputs:b,outputs:[-1,-1,-1]})},Fn=(t,n)=>{let s=Bd(t.inputs,n),[l,u,f]=Vu(t,s);return Ll(t,l,u,f,t.inputs[4],void 0,void 0,void 0,t.inputs[5],s)}}),On,Ps,Hu,Io,Pu=T(()=>{oa(),rt(),He(),I(),Ze(),On=(t,n)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let s=(l,u,f)=>{let p=u.length;if(p!==l.length)throw new Error(`${f}: num dimensions != ${p}`);u.forEach((g,b)=>{if(g!==l[b])throw new Error(`${f}: dim[${b}] do not match`)})};if(t[0].dims.length>1){let l=n.format==="NHWC"?n.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,n.spatial?2:void 0);s(t[1].dims,l,"Invalid input scale"),s(t[2].dims,l,"Invalid input B"),s(t[3].dims,l,"Invalid input mean"),s(t[4].dims,l,"Invalid input var")}else s(t[1].dims,[1],"Invalid input scale"),s(t[2].dims,[1],"Invalid input B"),s(t[3].dims,[1],"Invalid input mean"),s(t[4].dims,[1],"Invalid input var")},Ps=(t,n)=>{let{epsilon:s,spatial:l,format:u}=n,f=t[0].dims,p=l?re(f[f.length-1]):1,g=u==="NHWC"&&f.length>1?p:1,b=pe.size(f)/p,v=l,w=v?f.length:f,x=J("x",t[0].dataType,t[0].dims,p),C=J("scale",t[1].dataType,t[1].dims,g),z=J("bias",t[2].dataType,t[2].dims,g),A=J("inputMean",t[3].dataType,t[3].dims,g),B=J("inputVar",t[4].dataType,t[4].dims,g),L=Ue("y",t[0].dataType,w,p),U=()=>{let V="";if(l)V=`let cOffset = ${f.length===1?"0u":u==="NHWC"?`outputIndices[${f.length-1}] / ${p}`:"outputIndices[1]"};`;else if(u==="NCHW")V=`
            ${L.indicesSet("outputIndices","0","0")}
            let cOffset = ${L.indicesToOffset("outputIndices")};`;else{V=`var cIndices = ${C.type.indices}(0);
                       cIndices[0] = outputIndices[${f.length-1}];`;for(let G=1;G<C.rank;G++)V+=`cIndices[${G}] = outputIndices[${G}];`;V+=`let cOffset = ${C.indicesToOffset("cIndices")};`}return V},N=V=>`
  const epsilon = ${s};
  ${V.registerUniform("outputSize","u32").declareVariables(x,C,z,A,B,L)}
  ${V.mainStart()}
  ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${L.offsetToIndices(`global_idx * ${p}`)};
    ${U()}
    let scale = ${C.getByOffset("cOffset")};
    let bias = ${z.getByOffset("cOffset")};
    let inputMean = ${A.getByOffset("cOffset")};
    let inputVar = ${B.getByOffset("cOffset")};
    let x = ${x.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${L.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${n.epsilon}_${n.format}_${l}_${p}`,inputDependencies:v?["rank","type","type","type","type"]:void 0},getShaderSource:N,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:v?[{type:12,data:b},...Q(f)]:[{type:12,data:b}]})}},Hu=t=>O(t),Io=(t,n)=>{let{inputs:s,outputCount:l}=t,u=Hu({...n,outputCount:l});if(Re.webgpu.validateInputContent&&On(s,u),n.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(Ps(s,u))}}),Fu,is,Ud,Ku=T(()=>{He(),Ze(),Fu=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},is=t=>{let n=t[0].dims,s=t[0].dims[2],l=pe.size(n)/4,u=t[0].dataType,f=J("input",u,n,4),p=J("bias",u,[s],4),g=J("residual",u,n,4),b=Ue("output",u,n,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)}}),getShaderSource:v=>`
  const channels = ${s}u / 4;
  ${v.declareVariables(f,p,g,b)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes(l)}
    let value = ${f.getByOffset("global_idx")}
      + ${p.getByOffset("global_idx % channels")} + ${g.getByOffset("global_idx")};
    ${b.setByOffset("global_idx","value")}
  }`}},Ud=t=>{Fu(t.inputs),t.compute(is(t.inputs))}}),Fs,Nt,mn,Wu,Oi,Id,Lo,rs,Qu,Ld,Yu,qd,Rn,Ks,Ws,qo,dr,Mn,sn,fr,oi,ui,Ri,jd,Xu,Zu,Gd,Ba,ea,Mt,pr,kn,Ju,hr,Vd,ec,Qs,mr,jo,jl,tc,ss,Mi,gr,ki,Go=T(()=>{rt(),He(),I(),Ze(),Fs=(t,n,s,l,u,f,p)=>{let g=Math.ceil(n/4),b="";typeof u=="string"?b=`${u}(a)`:b=u("a");let v=J("inputData",s,[g],4),w=Ue("outputData",l,[g],4),x=[{name:"vec_size",type:"u32"}];return p&&x.push(...p),`
      ${t.registerUniforms(x).declareVariables(v,w)}

  ${f??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${v.getByOffset("global_idx")};
    ${w.setByOffset("global_idx",b)}
  }`},Nt=(t,n,s,l,u,f=t.dataType,p,g)=>{let b=[{type:12,data:Math.ceil(pe.size(t.dims)/4)}];return p&&b.push(...p),{name:n,shaderCache:{hint:u,inputDependencies:["type"]},getShaderSource:v=>Fs(v,pe.size(t.dims),t.dataType,f,s,l,g),getRunData:v=>({outputs:[{dims:t.dims,dataType:f}],dispatchGroup:{x:Math.ceil(pe.size(v[0].dims)/64/4)},programUniforms:b})}},mn=t=>{t.compute(Nt(t.inputs[0],"Abs","abs"))},Wu=t=>{t.compute(Nt(t.inputs[0],"Acos","acos"))},Oi=t=>{t.compute(Nt(t.inputs[0],"Acosh","acosh"))},Id=t=>{t.compute(Nt(t.inputs[0],"Asin","asin"))},Lo=t=>{t.compute(Nt(t.inputs[0],"Asinh","asinh"))},rs=t=>{t.compute(Nt(t.inputs[0],"Atan","atan"))},Qu=t=>{t.compute(Nt(t.inputs[0],"Atanh","atanh"))},Ld=t=>O(t),Yu=(t,n)=>{let s;switch(n.to){case 10:s="vec4<f16>";break;case 1:s="vec4<f32>";break;case 12:s="vec4<u32>";break;case 6:s="vec4<i32>";break;case 9:s="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${n.to}`)}t.compute(Nt(t.inputs[0],"Cast",s,void 0,n.cacheKey,n.to))},qd=t=>{let n,s,l=t.length>=2&&t[1].data!==0,u=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:n=l?t[1].getFloat32Array()[0]:-34028234663852886e22,s=u?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:n=l?t[1].getUint16Array()[0]:64511,s=u?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return O({min:n,max:s})},Rn=(t,n)=>{let s=n||qd(t.inputs),l=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"Clip",u=>`clamp(${u}, vec4<${l}>(uniforms.min), vec4<${l}>(uniforms.max))`,void 0,s.cacheKey,void 0,[{type:t.inputs[0].dataType,data:s.min},{type:t.inputs[0].dataType,data:s.max}],[{name:"min",type:l},{name:"max",type:l}]),{inputs:[0]})},Ks=t=>{t.compute(Nt(t.inputs[0],"Ceil","ceil"))},Ws=t=>{t.compute(Nt(t.inputs[0],"Cos","cos"))},qo=t=>{t.compute(Nt(t.inputs[0],"Cosh","cosh"))},dr=t=>O(t),Mn=(t,n)=>{let s=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"Elu",l=>`elu_vf32(${l})`,`
  const elu_alpha_ = ${s}(${n.alpha});

  fn elu_f32(a: ${s}) -> ${s} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${s}>) -> vec4<${s}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,n.cacheKey))},sn=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,fr=t=>{let n=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"Erf",s=>`erf_vf32(${s})`,sn(n)))},oi=t=>{t.compute(Nt(t.inputs[0],"Exp","exp"))},ui=t=>{t.compute(Nt(t.inputs[0],"Floor","floor"))},Ri=t=>{let n=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"Gelu",s=>`0.5 * ${s} * (1.0 + erf_vf32(${s} * 0.7071067811865475))`,sn(n)))},jd=(t,n)=>{let s=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"LeakyRelu",l=>`select(leaky_relu_alpha_ * ${l}, ${l}, ${l} >= vec4<${s}>(0.0))`,`const leaky_relu_alpha_ = ${s}(${n.alpha});`,n.cacheKey))},Xu=t=>{t.compute(Nt(t.inputs[0],"Not",n=>`!${n}`))},Zu=t=>{t.compute(Nt(t.inputs[0],"Neg",n=>`-${n}`))},Gd=t=>{t.compute(Nt(t.inputs[0],"Reciprocal",n=>`1.0/${n}`))},Ba=t=>{let n=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"Relu",s=>`select(vec4<${n}>(0.0), ${s}, ${s} > vec4<${n}>(0.0))`))},ea=t=>{t.compute(Nt(t.inputs[0],"Sigmoid",n=>`(1.0 / (1.0 + exp(-${n})))`))},Mt=t=>O(t),pr=(t,n)=>{let s=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"HardSigmoid",l=>`max(vec4<${s}>(0.0), min(vec4<${s}>(1.0), ${n.alpha} * ${l} + vec4<${s}>(${n.beta})))`,void 0,n.cacheKey))},kn=t=>{t.compute(Nt(t.inputs[0],"Sin","sin"))},Ju=t=>{t.compute(Nt(t.inputs[0],"Sinh","sinh"))},hr=t=>{t.compute(Nt(t.inputs[0],"Sqrt","sqrt"))},Vd=t=>{t.compute(Nt(t.inputs[0],"Tan","tan"))},ec=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,Qs=t=>{t.compute(Nt(t.inputs[0],"Tanh",ec))},mr=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${ec("v")};
}
`,jo=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,jl=t=>{let n=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"FastGelu",jo,mr(n),void 0,t.inputs[0].dataType))},tc=(t,n)=>{let s=W(t.inputs[0].dataType);return t.compute(Nt(t.inputs[0],"ThresholdedRelu",l=>`select(vec4<${s}>(0.0), ${l}, ${l} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${s}>(${n.alpha});`,n.cacheKey)),0},ss=t=>{t.compute(Nt(t.inputs[0],"Log","log"))},Mi=(t,n)=>`
const alpha = vec4<${t}>(${n});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,gr=t=>`quick_gelu_impl(${t})`,ki=(t,n)=>{let s=W(t.inputs[0].dataType);t.compute(Nt(t.inputs[0],"QuickGelu",gr,Mi(s,n.alpha),n.cacheKey,t.inputs[0].dataType))}}),ac,Ys,Vo,Xs=T(()=>{He(),Ze(),Go(),ac=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Ys=t=>{let n=t[0].dims.slice();n[2]=n[2]/2;let s=J("input",t[0].dataType,t[0].dims,4),l=J("bias",t[0].dataType,[t[0].dims[2]],4),u=Ue("output",t[0].dataType,n,4),f=pe.size(n)/4,p=ae(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)}}),getShaderSource:g=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${g.declareVariables(s,l,u)}

  ${sn(p)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes(f)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${u.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Vo=t=>{ac(t.inputs),t.compute(Ys(t.inputs))}}),Na,Ho,Kn,gh,yh,vh,$a,nc,Gl,Vl,ic,Zs,Js,Rm=T(()=>{rt(),He(),Ze(),Na=(t,n,s,l,u,f,p,g,b,v,w,x)=>{let C,z;typeof g=="string"?C=z=(N,V)=>`${g}((${N}),(${V}))`:typeof g=="function"?C=z=g:(C=g.scalar,z=g.vector);let A=Ue("outputData",w,l.length,4),B=J("aData",b,n.length,4),L=J("bData",v,s.length,4),U;if(u)if(f){let N=pe.size(n)===1,V=pe.size(s)===1,G=n.length>0&&n[n.length-1]%4===0,X=s.length>0&&s[s.length-1]%4===0;N||V?U=A.setByOffset("global_idx",z(N?`${B.type.value}(${B.getByOffset("0")}.x)`:B.getByOffset("global_idx"),V?`${L.type.value}(${L.getByOffset("0")}.x)`:L.getByOffset("global_idx"))):U=`
            let outputIndices = ${A.offsetToIndices("global_idx * 4u")};
            let offsetA = ${B.broadcastedIndicesToOffset("outputIndices",A)};
            let offsetB = ${L.broadcastedIndicesToOffset("outputIndices",A)};
            ${A.setByOffset("global_idx",z(p||G?B.getByOffset("offsetA / 4u"):`${B.type.value}(${B.getByOffset("offsetA / 4u")}[offsetA % 4u])`,p||X?L.getByOffset("offsetB / 4u"):`${L.type.value}(${L.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else U=A.setByOffset("global_idx",z(B.getByOffset("global_idx"),L.getByOffset("global_idx")));else{if(!f)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let N=(V,G,X="")=>{let ue=`aData[indexA${G}][componentA${G}]`,te=`bData[indexB${G}][componentB${G}]`;return`
            let outputIndices${G} = ${A.offsetToIndices(`global_idx * 4u + ${G}u`)};
            let offsetA${G} = ${B.broadcastedIndicesToOffset(`outputIndices${G}`,A)};
            let offsetB${G} = ${L.broadcastedIndicesToOffset(`outputIndices${G}`,A)};
            let indexA${G} = offsetA${G} / 4u;
            let indexB${G} = offsetB${G} / 4u;
            let componentA${G} = offsetA${G} % 4u;
            let componentB${G} = offsetB${G} % 4u;
            ${V}[${G}] = ${X}(${C(ue,te)});
          `};w===9?U=`
            var data = vec4<u32>(0);
            ${N("data",0,"u32")}
            ${N("data",1,"u32")}
            ${N("data",2,"u32")}
            ${N("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:U=`
            ${N("outputData[global_idx]",0)}
            ${N("outputData[global_idx]",1)}
            ${N("outputData[global_idx]",2)}
            ${N("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(B,L,A)}

        ${x??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${U}
      }`},Ho=(t,n,s,l,u,f,p=s.dataType)=>{let g=s.dims.map(Number),b=l.dims.map(Number),v=!pe.areEqual(g,b),w=g,x=pe.size(g),C=!1,z=!1,A=[v];if(v){let B=qn.calcShape(g,b,!1);if(!B)throw new Error("Can't perform binary op on the given tensors");w=B.slice(),x=pe.size(w);let L=pe.size(g)===1,U=pe.size(b)===1,N=g.length>0&&g[g.length-1]%4===0,V=b.length>0&&b[b.length-1]%4===0;A.push(L),A.push(U),A.push(N),A.push(V);let G=1;for(let X=1;X<w.length;X++){let ue=g[g.length-X],te=b[b.length-X];if(ue===te)G*=ue;else break}G%4===0?(z=!0,C=!0):(L||U||N||V)&&(C=!0)}else C=!0;return A.push(C),{name:t,shaderCache:{hint:n+A.map(B=>B.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:B=>Na(B,g,b,w,C,v,z,u,s.dataType,l.dataType,p,f),getRunData:()=>({outputs:[{dims:w,dataType:p}],dispatchGroup:{x:Math.ceil(x/64/4)},programUniforms:[{type:12,data:Math.ceil(pe.size(w)/4)},...Q(g,b,w)]})}},Kn=(t,n,s,l,u,f)=>{t.compute(Ho(n,u??"",t.inputs[0],t.inputs[1],s,l,f))},gh=t=>{Kn(t,"Add",(n,s)=>`${n}+${s}`)},yh=t=>{Kn(t,"Div",(n,s)=>`${n}/${s}`)},vh=t=>{Kn(t,"Equal",{scalar:(n,s)=>`u32(${n}==${s})`,vector:(n,s)=>`vec4<u32>(${n}==${s})`},void 0,void 0,9)},$a=t=>{Kn(t,"Mul",(n,s)=>`${n}*${s}`)},nc=t=>{let n=J("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;Kn(t,"Pow",{scalar:(s,l)=>`pow_custom(${s},${l})`,vector:(s,l)=>`pow_vector_custom(${s},${l})`},`
    fn pow_custom(a : ${n}, b : ${n}) -> ${n} {
      if (b == ${n}(0.0)) {
        return ${n}(1.0);
      } else if (a < ${n}(0.0) && f32(b) != floor(f32(b))) {
        return ${n}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${n}(1.0), round(f32(abs(b) % ${n}(2.0))) != 1.0) * ${n}(${n==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${n}>, b : vec4<${n}>) -> vec4<${n}> {
      // TODO: implement vectorized pow
      return vec4<${n}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Gl=t=>{Kn(t,"Sub",(n,s)=>`${n}-${s}`)},Vl=t=>{Kn(t,"Greater",{scalar:(n,s)=>`u32(${n}>${s})`,vector:(n,s)=>`vec4<u32>(${n}>${s})`},void 0,void 0,9)},ic=t=>{Kn(t,"Less",{scalar:(n,s)=>`u32(${n}<${s})`,vector:(n,s)=>`vec4<u32>(${n}<${s})`},void 0,void 0,9)},Zs=t=>{Kn(t,"GreaterOrEqual",{scalar:(n,s)=>`u32(${n}>=${s})`,vector:(n,s)=>`vec4<u32>(${n}>=${s})`},void 0,void 0,9)},Js=t=>{Kn(t,"LessOrEqual",{scalar:(n,s)=>`u32(${n}<=${s})`,vector:(n,s)=>`vec4<u32>(${n}<=${s})`},void 0,void 0,9)}}),Hd,bh,Pd,ls,rc,Po,_h=T(()=>{rt(),He(),I(),Ze(),Hd=(t,n)=>{if(!t||t.length<1)throw new Error("too few inputs");let s=0,l=t[s],u=l.dataType,f=l.dims.length;t.forEach((p,g)=>{if(g!==s){if(p.dataType!==u)throw new Error("input tensors should be one type");if(p.dims.length!==f)throw new Error("input tensors should have the same shape");p.dims.forEach((b,v)=>{if(v!==n&&b!==l.dims[v])throw new Error("non concat dimensions must match")})}})},bh=(t,n)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${n});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,Pd=(t,n)=>{let s=t.length,l=[];for(let u=0;u<s;++u){let f=n.setByOffset("global_idx",t[u].getByIndices("indices"));s===1?l.push(f):u===0?l.push(`if (inputIndex == ${u}u) { ${f} }`):u===s-1?l.push(`else { ${f} }`):l.push(`else if (inputIndex == ${u}) { ${f} }`)}return l.join(`
`)},ls=(t,n,s,l)=>{let u=pe.size(s),f=new Array(t.length),p=new Array(t.length),g=0,b=[],v=[],w=[{type:12,data:u}];for(let B=0;B<t.length;++B)g+=t[B].dims[n],f[B]=g,v.push(t[B].dims.length),p[B]=J(`input${B}`,l,v[B]),b.push("rank"),w.push({type:12,data:f[B]});for(let B=0;B<t.length;++B)w.push(...Q(t[B].dims));w.push(...Q(s));let x=Ue("output",l,s.length),C=x.indicesGet("indices",n),z=Array.from(Array(f.length).keys()).map(B=>`uniforms.sizeInConcatAxis${B}`).join(","),A=B=>`

  ${(()=>{B.registerUniform("outputSize","u32");for(let L=0;L<t.length;L++)B.registerUniform(`sizeInConcatAxis${L}`,"u32");return B.declareVariables(...p,x)})()}

  ${bh(f.length,z)}

  ${B.mainStart()}
    ${B.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${x.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${C});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${f.length}u>(${z});
      ${C} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${Pd(p,x)}
  }`;return{name:"Concat",shaderCache:{hint:`${n}`,inputDependencies:b},getRunData:()=>({outputs:[{dims:s,dataType:l}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:w}),getShaderSource:A}},rc=(t,n)=>{let s=t.inputs,l=s[0].dims,u=pe.normalizeAxis(n.axis,l.length);Hd(s,u);let f=l.slice();f[u]=s.reduce((g,b)=>g+(b.dims.length>u?b.dims[u]:0),0);let p=s.filter(g=>pe.size(g.dims)>0);t.compute(ls(p,u,f,s[0].dataType),{inputs:p})},Po=t=>O({axis:t.axis})}),Wn,yr,Di,Hl,os=T(()=>{rt(),He(),Wn=(t,n,s="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${n}(0.0));`;case"Sigmoid":return`value = (${n}(1.0) / (${n}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${n}(${s}(uniforms.clip_min)), ${n}(${s}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${n}(0.0), min(${n}(1.0), ${s}(uniforms.alpha) * value + ${s}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${s}(uniforms.alpha) * value, value, value >= ${n}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},yr=(t,n)=>{t.activation==="Clip"?n.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?n.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&n.push({type:1,data:t.alpha})},Di=(t,n)=>{t.activation==="Clip"?n.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?n.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&n.push({name:"alpha",type:"f32"})},Hl=t=>{let n=(t==null?void 0:t.activation)||"";if(n==="HardSigmoid"){let[s,l]=(t==null?void 0:t.activation_params)||[.2,.5];return{activation:n,alpha:s,beta:l}}else if(n==="Clip"){let[s,l]=(t==null?void 0:t.activation_params)||[Al,jn];return{activation:n,clipMax:l,clipMin:s}}else if(n==="LeakyRelu"){let[s]=(t==null?void 0:t.activation_params)||[.01];return{activation:n,alpha:s}}return{activation:n}}}),Ra,us,vr=T(()=>{Ra=(t,n)=>{switch(t){case 1:return n;case 2:return`vec2<${n}>`;case 3:return`vec3<${n}>`;case 4:return`vec4<${n}>`;default:throw new Error(`${t}-component is not supported.`)}},us=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Fd,wh=T(()=>{Fd=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),Bi,el,Pl=T(()=>{rt(),He(),Ze(),os(),Bi=(t,n,s,l,u)=>{let f=l-s;return`
      ${Array.from({length:s}).map((p,g)=>`
      if (${de(n.shape,g,n.rank)} != 1) {
        ${n.indicesSet(t,g,de(u,g+f,l))}
      } else {
        ${n.indicesSet(t,g,0)}
      }`).join("")}
`},el=(t,n,s,l,u=!1,f)=>{let p=t[0].dims,g=t[1].dims,b=p[p.length-2],v=g[g.length-1],w=p[p.length-1],x=re(v),C=re(w),z=re(b),A=pe.size(s)/x/z,B=t.length>2,L=l?l.slice(0,-2):s.slice(0,-2),U=[pe.size(L),b,v],N=[{type:12,data:A},{type:12,data:b},{type:12,data:v},{type:12,data:w}];yr(n,N),N.push(...Q(L,p,g)),B&&N.push(...Q(t[2].dims)),N.push(...Q(U));let V=G=>{let X=ft("batch_dims",t[0].dataType,L.length),ue=J("a",t[0].dataType,p.length,C),te=J("b",t[1].dataType,g.length,x),ge=Ue("output",t[0].dataType,U.length,x),ve=ae(ge.type.tensor),Le=Wn(n,ge.type.value,ve),nt=[ue,te],Fe="";if(B){let Tt=u?x:1;nt.push(J("bias",t[2].dataType,t[2].dims.length,Tt)),Fe=`${u?`value += bias[col / ${Tt}];`:`value += ${ge.type.value}(bias[row + i]);`}`}let tt=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Di(n,tt);let Et=()=>{let Tt=`var a_data: ${ue.type.value};`;for(let We=0;We<C;We++)Tt+=`
              let b_data${We} = b[(b_offset + (k + ${We}) * uniforms.N + col) / ${x}];`;for(let We=0;We<z;We++){Tt+=`a_data = a[(a_offset + (row + ${We}) * uniforms.K + k) / ${C}];`;for(let ut=0;ut<C;ut++)Tt+=`
            values[${We}] = fma(${te.type.value}(a_data${C===1?"":`[${ut}]`}), b_data${ut}, values[${We}]);
`}return Tt};return`
  ${G.registerUniforms(tt).registerInternalVariables(X).declareVariables(...nt,ge)}
  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${x})) * ${x};
    var index1 = global_idx / (uniforms.N / ${x});
    let stride1 = uniforms.M / ${z};
    let row = (index1 % stride1) * ${z};
    let batch = index1 / stride1;

    ${s.length===2?"":`let batch_indices = ${X.offsetToIndices("batch")};`}

    var a_indices: ${ue.type.indices};
    ${Bi("a_indices",ue,ue.rank-2,X.rank,"batch_indices")}
    ${ue.indicesSet("a_indices",ue.rank-2,0)}
    ${ue.indicesSet("a_indices",ue.rank-1,0)}
    let a_offset = ${ue.indicesToOffset("a_indices")};

    var b_indices: ${te.type.indices};
    ${Bi("b_indices",te,te.rank-2,X.rank,"batch_indices")}
    ${te.indicesSet("b_indices",te.rank-2,0)}
    ${te.indicesSet("b_indices",te.rank-1,0)}
    let b_offset = ${te.indicesToOffset("b_indices")};
    var values: array<${ge.type.value}, ${z}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${C}) {
      ${Et()}
    }
    for (var i = 0u; i < ${z}u; i++) {
      var value = values[i];
      ${Fe}
      ${Le}
      let cur_indices = ${ge.type.indices}(batch, row + i, col);
      let offset = ${ge.indicesToOffset("cur_indices")};
      ${ge.setByOffset(`offset / ${x}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${n.activation};${x};${C};${z};${u}`,inputDependencies:B?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:f?f(s):s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(A/64)},programUniforms:N}),getShaderSource:V}}}),Fl,Fo,sc,br,Kd,Ni,lc,Kl,Ui=T(()=>{rt(),He(),Ze(),os(),Pl(),vr(),Fl=(t,n)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${n?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${n?", batchIndices":""});
        `,Fo=(t,n)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${n===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${n===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${n===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,sc=(t,n,s="f32",l,u=!1,f=32,p=!1,g=32)=>{let b=n[1]*t[1],v=n[0]*t[0],w=u?b:f,x=u?f:b,C=w/n[0],z=f/n[1];if(!((u&&C===4&&t[1]===4||!u&&(C===3||C===4))&&w%n[0]===0&&f%n[1]===0&&t[0]===4))throw new Error(`If transposeA ${u} is true, innerElementSize ${C} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${C} must be 3 or 4.
  tileAWidth ${w} must be divisible by workgroupSize[0]${n[0]}. tileInner ${f} must be divisible by workgroupSize[1] ${n[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${C}<${s}>, ${w/C}>, ${x}>;
var<workgroup> mm_Bsub: array<array<vec4<${s}>, ${v/t[0]}>, ${f}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${C};
const tileInner = ${f};

@compute @workgroup_size(${n[0]}, ${n[1]}, ${n[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${p?"0":"i32(globalId.z)"};
  ${l?`let batchIndices = ${l.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${b};

  let num_tiles = ${p?`${Math.ceil(g/f)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${p?`i32(globalId.z) * ${g}`:"0"};

  var acc: array<vec4<${s}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${z};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${Fl(u,l)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${z}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${l?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${C===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${Fo(u,C)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},br=(t,n)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${n?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${n?", batchIndices":""});
            `,Kd=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Ni=(t,n,s="f32",l,u=!1,f=32,p=!1,g=32,b=!1)=>{let v=t[1]*n[1],w=t[0]*n[0],x=u?v:f,C=u?f:v;if(!(C%n[1]===0&&x%n[0]===0&&f%n[1]===0))throw new Error(`tileAHight ${C} must be divisible by workgroupSize[1]${n[1]}, tileAWidth ${x} must be divisible by workgroupSize[0]${n[0]}, tileInner ${f} must be divisible by workgroupSize[1]${n[1]}`);let z=C/n[1],A=x/n[0],B=f/n[1],L=b?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${v};
    let globalColStart = i32(workgroupId.x) * ${w};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${C}; inputRow = inputRow + ${n[1]}) {
        for (var inputCol = localCol; inputCol < ${x}; inputCol = inputCol + ${n[0]}) {
          ${br(u,l)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${f}; inputRow = inputRow + ${n[1]}) {
            for (var inputCol = localCol; inputCol < ${w}; inputCol = inputCol + ${n[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${l?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${s}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${n[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${u?`mm_Asub[k][localRow + innerRow * ${n[1]}];`:`mm_Asub[localRow + innerRow * ${n[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${n[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${n[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${v};

let tileRowA = i32(localId.y) * ${z};
let tileColA = i32(localId.x) * ${A};
let tileRowB = i32(localId.y) * ${B};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${z}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${A}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${br(u,l)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${B}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${l?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${s}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${Kd(u)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${s}, ${x}>, ${C}>;
  var<workgroup> mm_Bsub : array<array<${s}, ${w}>, ${f}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${f};

@compute @workgroup_size(${n[0]}, ${n[1]}, ${n[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${p?"0":"i32(globalId.z)"};
    ${l?`let batchIndices = ${l.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${p?`${Math.ceil(g/f)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${p?`i32(globalId.z) * ${g}`:"0"};

    var acc : array<array<${s}, colPerThread>, rowPerThread>;
    ${L}
  }
`},lc=(t,n,s,l,u=!1)=>{let[f,p,g,b]=l,v=ae(l[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${f.type.indices}) -> ${Ra(t,v)} {
      var value = ${Ra(t,v)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${p.type.indices};
        ${Bi("aIndices",p,p.rank-2,f.rank,"batchIndices")}
        ${p.indicesSet("aIndices",p.rank-2,"u32(row)")}
        ${p.indicesSet("aIndices",p.rank-1,"u32(colIn)")}
        value = ${p.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${f.type.indices}) -> ${Ra(t,v)} {
      var value = ${Ra(t,v)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${g.type.indices};
        ${Bi("bIndices",g,g.rank-2,f.rank,"batchIndices")}
        ${g.indicesSet("bIndices",g.rank-2,"u32(row)")}
        ${g.indicesSet("bIndices",g.rank-1,"u32(colIn)")}
        value = ${g.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ra(t,v)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${n?`value = value + ${u?"bias[colIn]":`${Ra(t,v)}(bias[row])`};`:""}
        ${s}
        ${b.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Kl=(t,n,s,l,u=!1,f)=>{let p=t[0].dims,g=t[1].dims,b=p.slice(0,-2),v=g.slice(0,-2),w=l?l.slice(0,-2):s.slice(0,-2),x=pe.size(w),C=p[p.length-2],z=p[p.length-1],A=g[g.length-1],B=z%4===0&&A%4===0,L=C<=8?[4,1,1]:[4,4,1],U=[8,8,1],N=[Math.ceil(A/U[0]/L[0]),Math.ceil(C/U[1]/L[1]),Math.ceil(x/U[2]/L[2])],V=B?4:1,G=[...b,C,z/V],X=G.length,ue=[...v,z,A/V],te=ue.length,ge=[x,C,A/V],ve=[{type:6,data:C},{type:6,data:A},{type:6,data:z}];yr(n,ve),ve.push(...Q(w,G,ue));let Le=["rank","rank"],nt=t.length>2;nt&&(ve.push(...Q(t[2].dims)),Le.push("rank")),ve.push(...Q(ge));let Fe=tt=>{let Et=w.length,Tt=ft("batchDims",t[0].dataType,Et,1),We=ae(t[0].dataType),ut=J("a",t[0].dataType,X,V),Qt=J("b",t[1].dataType,te,V),je=Ue("result",t[0].dataType,ge.length,V),aa=[ut,Qt];if(nt){let fa=u?V:1;aa.push(J("bias",t[2].dataType,t[2].dims.length,fa))}let Ne=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Di(n,Ne);let Ie=ae(je.type.tensor),lt=Wn(n,je.type.value,Ie),pt=lc(V,nt,lt,[Tt,ut,Qt,je],u);return`
  ${tt.registerUniforms(Ne).registerInternalVariables(Tt).declareVariables(...aa,je)}
  ${pt}
  ${B?sc(L,U,We,Tt):Ni(L,U,We,Tt)}
                   `};return{name:"MatMul",shaderCache:{hint:`${L};${n.activation};${B};${u}`,inputDependencies:Le},getRunData:()=>({outputs:[{dims:f?f(s):s,dataType:t[0].dataType}],dispatchGroup:{x:N[0],y:N[1],z:N[2]},programUniforms:ve}),getShaderSource:Fe}}}),_r,Wl,Wd=T(()=>{rt(),Tn(),Ze(),os(),vr(),wh(),Ui(),_r=(t,n,s,l,u=!1,f,p=4,g=4,b=4,v="f32")=>{let w=ve=>{switch(ve){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${v}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${ve} is not supported.`)}},x=ve=>{switch(ve){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${ve} is not supported.`)}},C=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,z=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,A=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",B=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",L=t?"row":"col",U=t?"col":"row",N=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${L} / outWidth;
    let outCol = ${L} % outWidth;

    let WRow = ${U} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${U} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${U} % inChannels;
    var resData = ${Ra(p,v)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${A} && xCol >= 0 && xCol < ${B}) {
      ${C}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${w(p)}
    }
    return resData;`,V=t?n&&l?`
    let col = colIn * ${p};
    ${N}`:`
    let col = colIn * ${p};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${N}
    }
    return ${Ra(p,v)}(0.0);`:l&&s?`
    let col = colIn * ${p};
    ${N}`:`
    let col = colIn * ${p};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${N}
    }
    return ${Ra(p,v)}(0.0);`,G=t?l&&s?x(g):`
    let col = colIn * ${g};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${x(g)}
    }
    return ${Ra(g,v)}(0.0);`:`
    let col = colIn * ${g};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${x(g)}
    }
    return ${Ra(g,v)}(0.0);`,X=Ra(b,v),ue=Ra(t?p:g,v),te=Ra(t?g:p,v),ge=Wn(f,X,v);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${ue} {
      ${t?V:G}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${te} {
      ${t?G:V}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${X}) {
      let col = colIn * ${b};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${z}
      ${us(u)}
      ${ge}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Wl=(t,n,s,l,u,f,p,g,b)=>{let v=n.format==="NHWC",w=v?t[0].dims[3]:t[0].dims[1],x=s[0],C=v?s[2]:s[3],z=v?s[1]:s[2],A=v?s[3]:s[1],B=v&&(w%4===0||w%3===0)&&A%4===0,L=v?A:C*z,U=v?C*z:A,N=[8,8,1],V=l<=8?[4,1,1]:[4,4,1],G=[Math.ceil(L/N[0]/V[0]),Math.ceil(U/N[1]/V[1]),Math.ceil(x/N[2]/V[2])];gt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${G}`);let X=B?v&&w%4!==0?3:4:1,ue=N[1]*V[1],te=N[0]*V[0],ge=Math.max(N[0]*X,N[1]),ve=l%ue===0,Le=u%te===0,nt=f%ge===0,Fe=B?[X,4,4]:[1,1,1],tt=[{type:6,data:l},{type:6,data:u},{type:6,data:f},{type:6,data:[n.pads[0],n.pads[1]]},{type:6,data:n.strides},{type:6,data:n.dilations}];yr(n,tt),tt.push(...Q(t[0].dims,t[1].dims));let Et=["rank","rank"];p&&(tt.push(...Q(t[2].dims)),Et.push("rank")),tt.push(...Q(s));let Tt=We=>{let ut=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Di(n,ut);let Qt=B?4:1,je=ae(t[0].dataType),aa=`
      fn setOutputAtIndex(flatIndex : i32, value : ${B?`vec4<${je}>`:je}) {
        result[flatIndex] = ${B?`vec4<${je}>`:je}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${B?`vec4<${je}>`:je}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${B?"/ 4":""}, value);
      }`,Ne=J("x",t[0].dataType,t[0].dims.length,X===3?1:X),Ie=J("w",t[1].dataType,t[1].dims.length,Qt),lt=[Ne,Ie],pt=Ue("result",t[0].dataType,s.length,Qt);if(p){let fa=J("bias",t[2].dataType,t[2].dims.length,Qt);lt.push(fa),aa+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${B?`vec4<${je}>`:je} {
          return bias[coords.${v?"w":"y"}${B?"/ 4":""}];
        }`}return`
        ${Fd("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${We.registerUniforms(ut).declareVariables(...lt,pt)}
        ${aa}
        ${_r(v,ve,Le,nt,p,n,Fe[0],Fe[1],Fe[2],je)}
        ${B?sc(V,N,je,void 0,!v,ge):Ni(V,N,je,void 0,!v,ge,!1,void 0,g)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${n.cacheKey};${X};${B};${ve};${Le};${nt};${ue};${te};${ge}`,inputDependencies:Et},getRunData:()=>({outputs:[{dims:b?b(s):s,dataType:t[0].dataType}],dispatchGroup:{x:G[0],y:G[1],z:G[2]},programUniforms:tt}),getShaderSource:Tt}}}),oc,tl,wr,Qd,uc,al,Ko,Yd,Xd=T(()=>{rt(),Tn(),He(),Ze(),os(),vr(),oc=t=>{let n=1;for(let s=0;s<t.length;s++)n*=t[s];return n},tl=t=>typeof t=="number"?[t,t,t]:t,wr=(t,n)=>n<=1?t:t+(t-1)*(n-1),Qd=(t,n,s,l=1)=>{let u=wr(n,l);return Math.floor((t[0]*(s-1)-s+u)/2)},uc=(t,n,s,l,u)=>{u==null&&(u=Qd(t,n[0],l[0]));let f=[0,0,0,s];for(let p=0;p<3;p++)t[p]+2*u>=n[p]&&(f[p]=Math.trunc((t[p]-n[p]+2*u)/l[p]+1));return f},al=(t,n,s,l,u,f,p,g,b,v)=>{let w,x,C,z;if(t==="VALID"&&(t=0),typeof t=="number"){w={top:t,bottom:t,left:t,right:t,front:t,back:t};let A=uc([n,s,l,1],[g,b,v],1,[u,f,p],t);x=A[0],C=A[1],z=A[2]}else if(Array.isArray(t)){if(!t.every((B,L,U)=>B===U[0]))throw Error(`Unsupported padding parameter: ${t}`);w={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let A=uc([n,s,l,1],[g,b,v],1,[u,f,p],t[0]);x=A[0],C=A[1],z=A[2]}else if(t==="SAME_UPPER"){x=Math.ceil(n/u),C=Math.ceil(s/f),z=Math.ceil(l/p);let A=(x-1)*u+g-n,B=(C-1)*f+b-s,L=(z-1)*p+v-l,U=Math.floor(A/2),N=A-U,V=Math.floor(B/2),G=B-V,X=Math.floor(L/2),ue=L-X;w={top:V,bottom:G,left:X,right:ue,front:U,back:N}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:w,outDepth:x,outHeight:C,outWidth:z}},Ko=(t,n,s,l,u,f=!1,p="channelsLast")=>{let g,b,v,w,x;if(p==="channelsLast")[g,b,v,w,x]=t;else if(p==="channelsFirst")[g,x,b,v,w]=t;else throw new Error(`Unknown dataFormat ${p}`);let[C,,z,A,B]=n,[L,U,N]=tl(s),[V,G,X]=tl(l),ue=wr(z,V),te=wr(A,G),ge=wr(B,X),{padInfo:ve,outDepth:Le,outHeight:nt,outWidth:Fe}=al(u,b,v,w,L,U,N,ue,te,ge),tt=f?C*x:C,Et=[0,0,0,0,0];return p==="channelsFirst"?Et=[g,tt,Le,nt,Fe]:p==="channelsLast"&&(Et=[g,Le,nt,Fe,tt]),{batchSize:g,dataFormat:p,inDepth:b,inHeight:v,inWidth:w,inChannels:x,outDepth:Le,outHeight:nt,outWidth:Fe,outChannels:tt,padInfo:ve,strideDepth:L,strideHeight:U,strideWidth:N,filterDepth:z,filterHeight:A,filterWidth:B,effectiveFilterDepth:ue,effectiveFilterHeight:te,effectiveFilterWidth:ge,dilationDepth:V,dilationHeight:G,dilationWidth:X,inShape:t,outShape:Et,filterShape:n}},Yd=(t,n,s,l,u,f)=>{let p=f==="channelsLast";p?t[0].dims[3]:t[0].dims[1];let g=[64,1,1],b={x:s.map((L,U)=>U)},v=[Math.ceil(oc(b.x.map(L=>s[L]))/g[0]),1,1];gt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${v}`);let w=1,x=pe.size(s),C=[{type:12,data:x},{type:12,data:l},{type:12,data:u},{type:12,data:n.strides},{type:12,data:n.dilations}];yr(n,C),C.push(...Q(t[0].dims,t[1].dims));let z=["rank","rank"],A=t.length===3;A&&(C.push(...Q(t[2].dims)),z.push("rank")),C.push(...Q(s));let B=L=>{let U=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:l.length},{name:"pads",type:"u32",length:u.length},{name:"strides",type:"u32",length:n.strides.length},{name:"dilations",type:"u32",length:n.dilations.length}];Di(n,U);let N=1,V=ae(t[0].dataType),G=J("x",t[0].dataType,t[0].dims.length,w),X=J("W",t[1].dataType,t[1].dims.length,N),ue=[G,X],te=Ue("result",t[0].dataType,s.length,N),ge="";if(A){let nt=J("bias",t[2].dataType,t[2].dims.length,N);ue.push(nt),ge+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${V} {
          return bias[${p?de("coords",4,5):de("coords",1,5)}];
        }`}let ve=Ra(w,V),Le=Wn(n,ve,V);return`
            ${ge}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${G.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${X.getByIndices("aIndices")};
            }
          ${L.registerUniforms(U).declareVariables(...ue,te)}
          ${L.mainStart()}
          ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${te.offsetToIndices("global_idx")};
              let batch = ${de("coords",0,G.rank)};
              let d2 = ${p?de("coords",G.rank-1,G.rank):de("coords",1,G.rank)};
              let xFRCCorner = vec3<u32>(${p?de("coords",1,G.rank):de("coords",2,G.rank)},
              ${p?de("coords",2,G.rank):de("coords",3,G.rank)},
              ${p?de("coords",3,G.rank):de("coords",4,G.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${p?de("uniforms.x_shape",1,G.rank):de("uniforms.x_shape",2,G.rank)};
              let xShapeZ = ${p?de("uniforms.x_shape",2,G.rank):de("uniforms.x_shape",3,G.rank)};
              let xShapeW = ${p?de("uniforms.x_shape",3,G.rank):de("uniforms.x_shape",4,G.rank)};
              let xShapeU = ${p?de("uniforms.x_shape",4,G.rank):de("uniforms.x_shape",1,G.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${p?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${p?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${p?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${p?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${A?"value = value + getBiasByOutputCoords(coords)":""};
              ${Le}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${n.cacheKey};${p};${w};${A}`,inputDependencies:z},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:v[0],y:v[1],z:v[2]},programUniforms:C}),getShaderSource:B}}}),cc,gn,Qn=T(()=>{rt(),He(),Ze(),os(),cc=(t,n,s,l)=>{let u=t.length>2,f=u?"value += b[output_channel];":"",p=t[0].dims,g=t[1].dims,b=n.format==="NHWC",v=b?s[3]:s[1],w=v/n.group,x=b&&w>=4?re(v):1,C=pe.size(s)/x,z=[{type:12,data:C},{type:12,data:n.dilations},{type:12,data:[n.strides[0],n.strides[1]]},{type:12,data:[n.pads[0],n.pads[1]]},{type:12,data:w}];yr(n,z),z.push(...Q(p,[g[0],g[1],g[2],g[3]/x]));let A=u?["rank","rank","rank"]:["rank","rank"];z.push(...Q([s[0],s[1],s[2],s[3]/x]));let B=L=>{let U=Ue("output",t[0].dataType,s.length,x),N=ae(U.type.tensor),V=Wn(n,U.type.value,N),G=J("x",t[0].dataType,p.length),X=J("w",t[1].dataType,g.length,x),ue=[G,X];u&&ue.push(J("b",t[2].dataType,t[2].dims,x));let te=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:n.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Di(n,te);let ge=b?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${G.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${X.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${G.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${X.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${L.registerUniforms(te).declareVariables(...ue,U)}

  ${L.mainStart()}
    ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${U.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${b?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${b?1:2}], outputIndices[${b?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${x} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${b?2:1}];

    var value: ${U.type.value} = ${U.type.value}(0);
    ${ge}
    ${f}
    ${V}
    ${U.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${n.cacheKey}_${x}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:l?l(s):s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(C/64)},programUniforms:z}),getShaderSource:B}},gn=(t,n,s,l)=>{let u=t.length>2,f=re(s[3]),p=re(s[2]),g=pe.size(s)/f/p,b=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/f],v=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/f],w=[s[0],s[1],s[2],s[3]/f],x=[{type:12,data:g},{type:6,data:[n.strides[0],n.strides[1]]},{type:6,data:[n.pads[0],n.pads[1]]}];yr(n,x),x.push(...Q(b,v,w));let C=(p-1)*n.strides[1]+v[1],z=A=>{let B=Ue("output",t[0].dataType,w.length,f),L=ae(B.type.tensor),U=Wn(n,B.type.value,L),N=J("x",t[0].dataType,b.length,f),V=J("w",t[1].dataType,v.length,f),G=[N,V];u&&G.push(J("b",t[2].dataType,t[2].dims,f));let X=u?"value += b[output_channel];":"",ue=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Di(n,ue),`
  ${A.registerUniforms(ue).declareVariables(...G,B)}
  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${p}u;
    let col = (index1 % width1) * ${p}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${N.type.value}, ${C}>;
    var values: array<${B.type.value}, ${p}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${v[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${C}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${N.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${N.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${v[1]}; w_width++) {
          let w_val = ${V.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${p}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${p}u; i++) {
      var value = values[i];
      ${X}
      ${U}
      ${B.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${n.cacheKey};${f};${p};${C};${v[0]};${v[1]}`,inputDependencies:u?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:l?l(s):s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:x}),getShaderSource:z}}}),xr,Ql,Zd,ci,ln,ua,Wo,Ii,yt,Kt=T(()=>{He(),Wd(),Xd(),Ui(),Qn(),os(),Pl(),Oa(),xr=(t,n,s,l,u,f)=>{let p=t[0],g=t.slice(f?1:2,f?3:4),b=g.length,v=n[0],w=n.slice(2).map((C,z)=>C+(C-1)*(s[z]-1)),x=g.map((C,z)=>C+l[z]+l[z+b]).map((C,z)=>Math.floor((C-w[z]+u[z])/u[z]));return x.splice(0,0,p),x.splice(f?3:1,0,v),x},Ql=[2,3,1,0],Zd=(t,n)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let s=t[0].dims[n.format==="NHWC"?t[0].dims.length-1:1],l=t[1].dims[1]*n.group;if(s!==l)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let u=t[0].dims.length-2;if(n.dilations.length!==u)throw new Error(`dilations should be ${u}D`);if(n.strides.length!==u)throw new Error(`strides should be ${u}D`);if(n.pads.length!==u*2)throw new Error(`pads should be ${u*2}D`);if(n.kernelShape.length!==0&&n.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},ci=(t,n)=>{let s=t.kernelShape.slice();s.length<n[1].dims.length-2&&s.push(...Array(n[1].dims.length-2-s.length).fill(0));for(let f=2;f<n[1].dims.length;++f)s[f-2]===0&&(s[f-2]=n[1].dims[f]);let l=t.pads.slice();xi.adjustPadsBasedOnAutoPad(n[0].dims,t.strides,t.dilations,s,l,t.format==="NHWC",t.autoPad);let u=Object.assign({},t);return Object.assign(u,{kernelShape:s,pads:l}),u},ln=t=>{let n=Hl(t),s=t.format,l=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],u=t.dilations,f=t.group,p=t.kernel_shape,g=t.pads,b=t.strides,v=t.w_is_const();return{autoPad:l,format:s,dilations:u,group:f,kernelShape:p,pads:g,strides:b,wIsConst:v,...n,cacheKey:`${t.format};${n.activation};`}},ua=(t,n,s,l)=>{let u=s.format==="NHWC",f=xr(n[0].dims,n[1].dims,s.dilations,s.pads,s.strides,u);if(s.group!==1){let ue=[n[0]];if(u){let te=t.kernelCustomData.wT??t.compute(Ya(n[1],Ql),{inputs:[1],outputs:[s.wIsConst?-2:-1]})[0];s.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=te),ue.push(te)}else ue.push(n[1]);n.length===3&&ue.push(n[2]),!t.adapterInfo.isArchitecture("ampere")&&u&&n[1].dims[0]===s.group&&n[1].dims[1]===1&&s.dilations[0]===1&&s.dilations[1]===1?t.compute(gn(ue,s,f,l),{inputs:ue}):t.compute(cc(ue,s,f,l),{inputs:ue});return}let p=n.length===3,g=n[0].dims[u?1:2],b=n[0].dims[u?2:3],v=n[0].dims[u?3:1],w=n[1].dims[2],x=n[1].dims[3],C=f[u?1:2],z=f[u?2:3],A=f[u?3:1],B=u&&w===g&&x===b&&s.pads[0]===0&&s.pads[1]===0;if(B||w===1&&x===1&&s.dilations[0]===1&&s.dilations[1]===1&&s.strides[0]===1&&s.strides[1]===1&&s.pads[0]===0&&s.pads[1]===0){let ue=f[0],te,ge,ve,Le=[];if(u){let tt=t.kernelCustomData.wT??t.compute(Ya(n[1],Ql),{inputs:[1],outputs:[s.wIsConst?-2:-1]})[0];if(s.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=tt),B){let Et=g*b*v;te=n[0].reshape([1,ue,Et]),ge=tt.reshape([1,Et,A]),ve=[1,ue,A]}else te=n[0].reshape([ue,g*b,v]),ge=tt.reshape([1,v,A]),ve=[ue,C*z,A];Le.push(te),Le.push(ge)}else te=n[0].reshape([ue,v,g*b]),ge=n[1].reshape([1,A,v]),ve=[ue,A,C*z],Le.push(ge),Le.push(te);p&&Le.push(n[2]);let nt=ve[2],Fe=Le[0].dims[Le[0].dims.length-1];nt<8&&Fe<8?t.compute(el(Le,s,f,ve,u,l),{inputs:Le}):t.compute(Kl(Le,s,f,ve,u,l),{inputs:Le});return}let L=!0,U=t.kernelCustomData.wT??t.compute(Ya(n[1],Ql),{inputs:[1],outputs:[s.wIsConst?-2:-1]})[0];s.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=U);let N=[n[0],U];p&&N.push(n[2]);let V=u?C*z:A,G=u?A:C*z,X=w*x*v;t.compute(Wl(N,s,f,V,G,X,p,L,l),{inputs:N})},Wo=(t,n)=>{let s=n.format==="NHWC",l=[t.inputs[0].reshape(s?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&l.push(t.inputs[2]);let u=[0,n.pads[0],0,n.pads[1]],f=[1].concat(n.strides),p=[1].concat(n.dilations),g=[1].concat(n.kernelShape),b=ci({...n,pads:u,strides:f,dilations:p,kernelShape:g},l);ua(t,l,b,v=>s?[v[0],v[2],v[3]]:[v[0],v[1],v[3]])},Ii=(t,n,s)=>{let l=s.format==="NHWC"?"channelsLast":"channelsFirst",u=ci(s,n),f=s.autoPad==="NOTSET"?s.pads:s.autoPad,p=Ko(n[0].dims,n[1].dims,s.strides,s.dilations,f,!1,l);t.compute(Yd(n,u,p.outShape,[p.filterDepth,p.filterHeight,p.filterWidth],[p.padInfo.front,p.padInfo.top,p.padInfo.left],l))},yt=(t,n)=>{if(Zd(t.inputs,n),t.inputs[0].dims.length===3)Wo(t,n);else if(t.inputs[0].dims.length===5)Ii(t,t.inputs,n);else{let s=ci(n,t.inputs);ua(t,t.inputs,s)}}}),Sa,dc=T(()=>{rt(),Tn(),He(),Ze(),Sa=(t,n,s)=>{let l=t.length>2,u=n.outputShape,f=n.format==="NHWC",p=n.group,g=t[1].dims,b=g[2]/p,v=g[3],w=f?re(b):1,x=f&&v===1&&b>=4,C=x?Math.floor(b/4)*4:Math.floor(b/w)*w,z=b-C,A=f?re(v):1,B=f?v===1?w:A:1,L=pe.size(u)/A,U=[Math.ceil(L/64),1,1];gt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${U}`);let N=["rank","rank"],V=[n.strides[0],n.strides[1]],G=[n.kernelShape[f?1:2],n.kernelShape[f?2:3]],X=[n.dilations[0],n.dilations[1]],ue=[G[0]+(n.dilations[0]<=1?0:(n.kernelShape[f?1:2]-1)*(n.dilations[0]-1)),G[1]+(n.dilations[1]<=1?0:(n.kernelShape[f?2:3]-1)*(n.dilations[1]-1))],te=[ue[0]-1-Math.floor((n.pads[0]+n.pads[2])/2),ue[1]-1-Math.floor((n.pads[1]+n.pads[3])/2)],ge=[{type:12,data:L},{type:12,data:V},{type:12,data:G},{type:12,data:X},{type:12,data:ue},{type:6,data:te},{type:12,data:C},{type:12,data:b},{type:12,data:v},...Q(t[0].dims,t[1].dims)];l&&(ge.push(...Q(t[2].dims)),N.push("rank")),ge.push(...Q(u));let ve=Le=>{let nt=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:V.length},{name:"filter_dims",type:"u32",length:G.length},{name:"dilations",type:"u32",length:G.length},{name:"effective_filter_dims",type:"u32",length:ue.length},{name:"pads",type:"i32",length:te.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],Fe=ae(t[0].dataType),tt=f?1:2,Et=f?2:3,Tt=f?3:1,We=J("W",t[1].dataType,t[1].dims.length,B),ut=J("Dy",t[0].dataType,t[0].dims.length,w),Qt=[ut,We];l&&Qt.push(J("bias",t[2].dataType,[u[Tt]].length,A));let je=Ue("result",t[0].dataType,u.length,A),aa=()=>{let lt="";if(x)w===4?lt+=`
        let xValue = ${ut.getByOffset("x_offset")};
        let wValue = ${We.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:w===2?lt+=`
          dotProd = dotProd + dot(vec4<${Fe}>(${ut.getByOffset("x_offset")}, ${ut.getByOffset("x_offset + 1u")}), vec4<${Fe}>(${We.getByOffset("w_offset")}, ${We.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:w===1&&(lt+=`
          dotProd = dotProd + dot(vec4<${Fe}>(${ut.getByOffset("x_offset")}, ${ut.getByOffset("x_offset + 1u")}, ${ut.getByOffset("x_offset + 2u")}, ${ut.getByOffset("x_offset + 3u")}), vec4<${Fe}>(${We.getByOffset("w_offset")}, ${We.getByOffset("w_offset + 1u")}, ${We.getByOffset("w_offset + 2u")}, ${We.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(lt+=`
                  let xValue = ${f?ut.getByOffset(`${ut.indicesToOffset(`${ut.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${w}`):ut.get("batch","inputChannel","idyR","idyC")};
        `,w===1)lt+=`
          let w_offset = ${We.indicesToOffset(`${We.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${We.getByOffset(`w_offset / ${B}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let pt=0;pt<w;pt++)lt+=`
            let wValue${pt} = ${We.getByOffset(`${We.indicesToOffset(`${We.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${pt}, wOutChannel)`)} / ${B}`)};
            dotProd = dotProd + xValue[${pt}] * wValue${pt};`;return lt},Ne=()=>{if(z===0)return"";if(!x)throw new Error(`packInputAs4 ${x} is not true.`);let lt="";if(w===1){lt+="dotProd = dotProd";for(let pt=0;pt<z;pt++)lt+=`
            + ${ut.getByOffset(`x_offset + ${pt}`)} * ${We.getByOffset(`w_offset + ${pt}`)}`;lt+=";"}else if(w===2){if(z!==2)throw new Error(`Invalid inputChannelsRemainder ${z}.`);lt+=`
          let xValue = ${ut.getByOffset("x_offset")};
          let wValue = ${We.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return lt},Ie=`
            let outputIndices = ${je.offsetToIndices(`global_idx * ${A}`)};
            let batch = ${je.indicesGet("outputIndices",0)};
            let d1 = ${je.indicesGet("outputIndices",Tt)};
            let r = ${je.indicesGet("outputIndices",tt)};
            let c = ${je.indicesGet("outputIndices",Et)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${je.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${Fe}(dyRCorner) + ${Fe}(wR)) / ${Fe}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${Fe}(uniforms.Dy_shape[${tt}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${Fe}(dyCCorner) + ${Fe}(wC)) / ${Fe}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${Fe}(uniforms.Dy_shape[${Et}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${x?`
                var x_offset = ${ut.indicesToOffset(`${ut.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${w};
                var w_offset = ${We.indicesToOffset(`${We.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${B};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${x?4:w}) {
                  ${aa()}
                  inputChannel = inputChannel + ${x?4:w};
                }
                ${Ne()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${l?` + bias[d1 / ${A}]`:""};
            ${je.setByOffset("global_idx","value")};
          `;return`
    ${Le.registerUniforms(nt).declareVariables(...Qt,je)}
      ${Le.mainStart()}
      ${Le.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${Ie}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${n.cacheKey};${w}${B}${A}${x}${z}`,inputDependencies:N},getRunData:()=>({dispatchGroup:{x:U[0],y:U[1],z:U[2]},outputs:[{dims:s?s(u):u,dataType:t[0].dataType}],programUniforms:ge}),getShaderSource:ve}}}),nl,cs,Qo,il,rl,xh,la,fc,pc,$h=T(()=>{dc(),os(),Oa(),nl=(t,n,s,l,u,f)=>(t-1)*n+s+(l-1)*u+1-f,cs=(t,n,s,l,u)=>{let f=Math.floor(t/2);n==="SAME_UPPER"?(s[l]=f,s[u]=t-f):n==="SAME_LOWER"&&(s[l]=t-f,s[u]=f)},Qo=(t,n,s,l,u,f,p,g,b,v)=>{let w=t.length-2,x=v.length===0;b.length<w&&b.push(...Array(w-b.length).fill(0));let C=t[0],z=n[g?3:1]*u;for(let A=0,B=t.length-w-(g?1:0);A<w;++A,++B){let L=t[B],U=x?L*p[A]:v[A],N=nl(L,p[A],f[A],n[B],s[A],U);cs(N,l,f,A,A+w),x&&v.push(p[A]*(L-1)+b[A]+(n[B]-1)*s[A]+1-f[A]-f[A+w])}v.splice(0,0,C),v.splice(g?3:1,0,z)},il=(t,n)=>{let s=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((x,C)=>x*C,1)===0){s.length=0;for(let x=2;x<n[1].dims.length;++x)s.push(n[1].dims[x])}let l=t.format==="NHWC";s.splice(0,0,n[1].dims[0]),s.splice(l?3:1,0,n[1].dims[1]);let u=t.pads.slice(),f=t.outputShape.slice(),p=t.outputPadding.slice(),g=n[0].dims,b=t.dilations.slice();if(b.reduce((x,C)=>x+C,0)===0){let x=n[0].dims.length-2;b=new Array(x).fill(1)}let v=t.strides.slice();if(v.reduce((x,C)=>x+C,0)===0){let x=n[0].dims.length-2;v=new Array(x).fill(1)}Qo(g,s,b,t.autoPad,t.group,u,v,l,p,f);let w=Object.assign({},t);return Object.assign(w,{kernelShape:s,pads:u,outputPadding:p,outputShape:f,dilations:b,strides:v}),w},rl=t=>{let n=Hl(t),s=t.format,l=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],u=t.dilations,f=t.group??1,p=t.kernelShape,g=t.pads,b=t.strides,v=t.wIsConst(),w=t.outputPadding,x=t.outputShape;return{autoPad:l,format:s,dilations:u,group:f,kernelShape:p,outputPadding:w,outputShape:x,pads:g,strides:b,wIsConst:v,...n,cacheKey:`${t.format};${n.activation};`}},xh=(t,n)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let s=t[0].dims[n.format==="NHWC"?t[0].dims.length-1:1],l=t[1].dims[0];if(s!==l)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let u=t[1].dims[1]*n.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==u))throw new Error("invalid bias");let f=t[0].dims.length-2;if(n.dilations.reduce((p,g)=>p+g,0)>0&&n.dilations.length!==f)throw new Error(`dilations should be ${f}D`);if(n.strides.reduce((p,g)=>p+g,0)>0&&n.strides.length!==f)throw new Error(`strides should be ${f}D`);if(n.pads.reduce((p,g)=>p+g,0)>0&&n.pads.length!==f*2)throw new Error(`pads should be ${f*2}D`);if(n.outputPadding.length!==f&&n.outputPadding.length!==0)throw new Error(`output_padding should be ${f}D`);if(n.kernelShape.reduce((p,g)=>p+g,0)>0&&n.kernelShape.length!==0&&n.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(n.outputShape.length!==0&&n.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},la=(t,n,s,l)=>{let u=t.kernelCustomData.wT??t.compute(Ya(n[1],[2,3,0,1]),{inputs:[1],outputs:[s.wIsConst?-2:-1]})[0];s.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=u);let f=[n[0],u];n.length===3&&f.push(n[2]),t.compute(Sa(f,s,l),{inputs:f})},fc=(t,n)=>{let s=n.format==="NHWC",l=[t.inputs[0].reshape(s?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&l.push(t.inputs[2]);let u=n.kernelShape;(u.length===0||u[0]===0)&&(u=[t.inputs[1].dims[2]]);let f=n.dilations;(f.length===0||f[0]===0)&&(f=[1]);let p=n.strides;(p.length===0||p[0]===0)&&(p=[1]);let g=n.pads;g.length===0&&(g=[0,0]),g=[0,g[0],0,g[1]],p=[1].concat(p),f=[1].concat(f),u=[1].concat(u);let b=n.outputPadding;b=[0].concat(b);let v=il({...n,pads:g,strides:p,dilations:f,kernelShape:u,outputPadding:b},l);la(t,l,v,w=>s?[w[0],w[2],w[3]]:[w[0],w[1],w[3]])},pc=(t,n)=>{if(xh(t.inputs,n),t.inputs[0].dims.length===3)fc(t,n);else{let s=il(n,t.inputs);la(t,t.inputs,s)}}}),Jd,Sh,hc,ef=T(()=>{rt(),He(),I(),Ze(),Jd=(t,n,s,l)=>{let u=pe.size(n),f=n.length,p=J("input",t,f),g=Ue("output",t,f),b=s.dataType===6?s.getInt32Array()[0]:Number(s.getBigInt64Array()[0]),v=pe.normalizeAxis(b,f),w=x=>{let C=` i32(${p.indicesGet("inputIndices","uniforms.axis")}) `,z=de("uniforms.input_shape","uniforms.axis",f),A=l.reverse?C+(l.exclusive?" + 1":""):"0",B=l.reverse?z:C+(l.exclusive?"":" + 1");return`
                ${x.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(p,g)}
                ${x.mainStart()}
                  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${g.offsetToIndices("global_idx")};
                  var sum = ${g.type.value}(0);
                  let first : i32 = ${A};
                  let last : i32 = ${B};
                  for (var i : i32 = first; i < last; i++) {
                    ${p.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${p.getByIndices("inputIndices")};
                  }
                  ${g.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:l.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:[{type:12,data:u},{type:12,data:v},...Q(n,n)]}),getShaderSource:w}},Sh=(t,n)=>{let s=t.inputs[0].dims,l=t.inputs[0].dataType,u=t.inputs[1];t.compute(Jd(l,s,u,n),{inputs:[0]})},hc=t=>{let n=t.exclusive===1,s=t.reverse===1;return O({exclusive:n,reverse:s})}}),mc,Za,_a,Yo,Yl,gc=T(()=>{rt(),He(),I(),Ze(),mc=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Za=(t,n,s,l)=>{let u=[];u.push(`fn perm(i: ${l.type.indices}) -> ${s.type.indices} {
    var a: ${s.type.indices};`);for(let f=0;f<n;++f)u.push(s.indicesSet("a",t[f],`i[${f}]`));return u.push("return a;}"),u.join(`
`)},_a=(t,n)=>{let s,l,u,f,p,g,b=n.format==="NHWC",v=n.blocksize,w=n.mode==="DCR";b?([s,l,u,f]=t.dims,p=w?[s,l,u,v,v,f/v**2]:[s,l,u,f/v**2,v,v],g=w?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([s,l,u,f]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],p=w?[s,v,v,f/v**2,l,u]:[s,f/v**2,v,v,l,u],g=w?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let x=t.reshape(p),C=x.dims.length,z=t.dataType,A=J("a",z,C),B=Ue("output",z,C),L=U=>`
  ${U.registerUniform("output_size","u32").declareVariables(A,B)}

  ${Za(g,C,A,B)}

  ${U.mainStart()}
    ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${B.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${B.setByOffset("global_idx",A.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${n.blocksize};${n.mode}`,inputDependencies:["rank"]},getRunData:U=>{let N=b?[s,l*v,u*v,f/v**2]:[s,f/v**2,l*v,u*v],V=pe.size(N),G=x.dims,X=pe.sortBasedOnPerm(G,g);return{outputs:[{dims:N,dataType:U[0].dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:[{type:12,data:V},...Q(G,X)]}},getShaderSource:L}},Yo=(t,n)=>{mc(t.inputs),t.compute(_a(t.inputs[0],n))},Yl=t=>O({blocksize:t.blocksize,mode:t.mode,format:t.format})}),Xl,Dn,Zl,yc,vc,tf,af,bc,nf,rf,sf,lf=T(()=>{rt(),He(),I(),Ze(),Xl="[a-zA-Z]|\\.\\.\\.",Dn="("+Xl+")+",Zl="^"+Dn+"$",yc="("+Dn+",)*"+Dn,vc="^"+yc+"$",tf=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,n){let s=this.symbolToIndices.get(t);s===void 0?s=[n]:s.push(n),this.symbolToIndices.set(t,s)}},af=class{constructor(t,n){var u;this.equation=n,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[s,l]=n.includes("->")?n.split("->",2):[n,""];if(!s.match(RegExp(vc)))throw new Error("Invalid LHS term");if(s.split(",").forEach((f,p)=>{let g=t[p].dims.slice();if(!f.match(RegExp(Zl)))throw new Error("Invalid LHS term");let b=this.processTerm(f,!0,g,p);this.lhs.push(b)}),l==="")l+=[...this.symbolToInfo.entries()].filter(([f,p])=>p.count===1||f==="...").map(([f])=>f).join("");else if(!l.match(RegExp(Dn)))throw new Error("Invalid RHS");(u=l.match(RegExp(Xl,"g")))==null||u.forEach(f=>{if(f==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let p=this.symbolToInfo.get(f);if(p===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(p.dimValue)}}),this.rhs=this.processTerm(l,!1,this.outputDims)}addSymbol(t,n,s){let l=this.symbolToInfo.get(t);if(l!==void 0){if(l.dimValue!==n&&l.count!==1)throw new Error("Dimension mismatch");l.count++,l.inputIndices.push(s)}else l={count:1,dimValue:n,inputIndices:[s]};this.symbolToInfo.set(t,l)}processTerm(t,n,s,l=-1){let u=s.length,f=!1,p=[],g=0;if(!t.match(RegExp(Zl))&&!n&&t!=="")throw new Error("Invalid LHS term");let b=t.match(RegExp(Xl,"g")),v=new tf(l);return b==null||b.forEach((w,x)=>{if(w==="..."){if(f)throw new Error("Only one ellipsis is allowed per input term");f=!0;let C=u-b.length+1;if(C<0)throw new Error("Ellipsis out of bounds");if(p=s.slice(g,g+C),this.hasEllipsis){if(this.ellipsisDims.length!==p.length||this.ellipsisDims.toString()!==p.toString())throw new Error("Ellipsis dimensions mismatch")}else if(n)this.hasEllipsis=!0,this.ellipsisDims=p;else throw new Error("Ellipsis must be specified in the LHS");for(let z=0;z<p.length;z++){let A=String.fromCharCode(48+z);v.addSymbol(A,x+z),this.addSymbol(A,s[g++],l)}}else v.addSymbol(w,x+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(w,s[g++],l)}),v}},bc=t=>t+"_max",nf=(t,n,s,l)=>{let u=t.map(v=>v.length).map((v,w)=>J(`input${w}`,n,v)),f=pe.size(l),p=Ue("output",n,l.length),g=[...s.symbolToInfo.keys()].filter(v=>!s.rhs.symbolToIndices.has(v)),b=v=>{let w=[],x="var prod = 1.0;",C="var sum = 0.0;",z="sum += prod;",A=[],B=[],L=[],U=[],N=s.symbolToInfo.size===s.rhs.symbolToIndices.size;s.symbolToInfo.forEach((G,X)=>{var ue;if(s.rhs.symbolToIndices.has(X)){let te=(ue=s.rhs.symbolToIndices.get(X))==null?void 0:ue[0];te!==void 0&&s.lhs.forEach((ge,ve)=>{if(G.inputIndices.includes(ve)){let Le=ge.symbolToIndices.get(X);if(Le===void 0)throw new Error("Invalid symbol error");Le.forEach(nt=>{w.push(`${u[ve].indicesSet(`input${ve}Indices`,nt,p.indicesGet("outputIndices",te))}`)})}})}else s.lhs.forEach((te,ge)=>{if(G.inputIndices.includes(ge)){let ve=te.symbolToIndices.get(X);if(ve===void 0)throw new Error("Invalid symbol error");ve.forEach(Le=>{A.push(`${u[ge].indicesSet(`input${ge}Indices`,Le,`${X}`)}`)}),U.push(`prod *= ${u[ge].getByIndices(`input${ge}Indices`)};`)}}),B.push(`for(var ${X}: u32 = 0; ${X} < uniforms.${bc(X)}; ${X}++) {`),L.push("}")});let V=N?[...w,`let sum = ${u.map((G,X)=>G.getByIndices(`input${X}Indices`)).join(" * ")};`]:[...w,C,...B,...A,x,...U,z,...L];return`
            ${v.registerUniforms(g.map(G=>({name:`${bc(G)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...u,p)}

            ${v.mainStart()}
            ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${p.offsetToIndices("global_idx")};
            ${u.map((G,X)=>`var input${X}Indices: ${u[X].type.indices};`).join(`
`)}
            ${V.join(`
`)};
            ${p.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:s.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let v=g.filter(x=>s.symbolToInfo.has(x)).map(x=>{var C;return{type:12,data:((C=s.symbolToInfo.get(x))==null?void 0:C.dimValue)||0}});v.push({type:12,data:f});let w=t.map((x,C)=>[...Q(x)]).reduce((x,C)=>x.concat(C),v);return w.push(...Q(l)),{outputs:[{dims:l,dataType:n}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:w}},getShaderSource:b}},rf=(t,n)=>{let s=new af(t.inputs,n.equation),l=s.outputDims,u=t.inputs.map((f,p)=>f.dims);t.compute(nf(u,t.inputs[0].dataType,s,l))},sf=t=>{let n=t.equation.replace(/\s+/g,"");return O({equation:n})}}),of,uf,cf,df,ff,pf=T(()=>{rt(),He(),Ze(),of=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let n=t[0].dims,s=Array.from(t[1].getBigInt64Array(),Number),l=s.length<n.length?0:s.length-n.length,u=n.length<s.length?0:n.length-s.length;for(;l<s.length&&u<n.length;++l,++u)if(s[l]!==n[u]&&s[l]!==1&&n[u]!==1)throw new Error("Expand requires shape to be broadcastable to input")},uf=(t,n)=>{let s=t.length-n.length,l=[];for(let u=0;u<s;++u)l.push(t[u]);for(let u=0;u<n.length;++u)l.push(n[u]===1?t[u+s]:n[u]);return l},cf=(t,n)=>t.length>n.length?uf(t,n):uf(n,t),df=t=>{let n=t[0].dims,s=Array.from(t[1].getBigInt64Array(),Number),l=cf(n,s),u=t[0].dataType,f=u===9||pe.size(n)===1,p=u===9||n.length>0&&n[n.length-1]%4===0?4:1,g=f||l.length>0&&l[l.length-1]%4===0?4:1,b=Math.ceil(pe.size(l)/g),v=x=>{let C=J("input",u,n.length,p),z=Ue("output",u,l.length,g),A;if(u===9){let B=(L,U,N="")=>`
          let outputIndices${U} = ${z.offsetToIndices(`outputOffset + ${U}u`)};
          let offset${U} = ${C.broadcastedIndicesToOffset(`outputIndices${U}`,z)};
          let index${U} = offset${U} / 4u;
          let component${U} = offset${U} % 4u;
          ${L}[${U}] = ${N}(${C.getByOffset(`index${U}`)}[component${U}]);
        `;A=`
        let outputOffset = global_idx * ${g};
        var data = vec4<u32>(0);
        ${B("data",0,"u32")}
        ${B("data",1,"u32")}
        ${B("data",2,"u32")}
        ${B("data",3,"u32")}
        ${z.setByOffset("global_idx","data")}
      }`}else A=`
        let outputIndices = ${z.offsetToIndices(`global_idx * ${g}`)};
        let inputOffset = ${C.broadcastedIndicesToOffset("outputIndices",z)};
        let data = ${z.type.value}(${C.getByOffset(`inputOffset / ${p}`)});
        ${z.setByOffset("global_idx","data")}
      }`;return`
    ${x.registerUniform("vec_size","u32").declareVariables(C,z)}
    ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${A}`},w=[{type:12,data:b},...Q(n,l)];return{name:"Expand",shaderCache:{hint:`${l.length};${p}${g}`,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:l,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:w})}},ff=t=>{of(t.inputs),t.compute(df(t.inputs),{inputs:[0]})}}),hf,mf,Eh=T(()=>{rt(),He(),Ze(),Go(),hf=t=>{let n=t[0].dataType,s=pe.size(t[0].dims),l=pe.size(t[1].dims),u=l%4===0,f=p=>{let g=J("x",n,[1],4),b=J("bias",n,[1],4),v=Ue("y",n,[1],4),w=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],x=z=>`
      let bias${z}_offset: u32 = (global_idx * 4 + ${z}) % uniforms.bias_size;
      let bias${z} = ${b.getByOffset(`bias${z}_offset / 4`)}[bias${z}_offset % 4];`,C=u?`
      let bias = ${b.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${x(0)}${x(1)}${x(2)}${x(3)}
      let bias = ${g.type.value}(bias0, bias1, bias2, bias3);`;return`${p.registerUniforms(w).declareVariables(g,b,v)}

    ${mr(W(n))}

    ${p.mainStart(F)}
      ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${g.getByOffset("global_idx")};
      ${C}
      let x_in = x + bias;
      ${v.setByOffset("global_idx",jo("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${u}`,inputDependencies:["type","type"]},getShaderSource:f,getRunData:p=>({outputs:[{dims:p[0].dims,dataType:p[0].dataType}],programUniforms:[{type:12,data:Math.ceil(s/4)},{type:12,data:l}],dispatchGroup:{x:Math.ceil(s/F/4)}})}},mf=t=>{t.inputs.length<2||pe.size(t.inputs[1].dims)===0?jl(t):t.compute(hf(t.inputs))}}),gf,yf,Th,vf,Jl=T(()=>{rt(),He(),I(),Ze(),gf=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},yf=(t,n)=>{let s=t[0].dims,l=t[1].dims,u=s.length,f=pe.normalizeAxis(n.axis,u),p=s.slice(0);p.splice(f,1,...l);let g=s[f],b=t[0].dataType===9?4:1,v=Math.ceil(pe.size(p)/b),w=[{type:12,data:v},{type:6,data:g},{type:12,data:f},...Q(t[0].dims,t[1].dims,p)],x=C=>{let z=J("data",t[0].dataType,t[0].dims.length,b),A=J("inputIndices",t[1].dataType,t[1].dims.length),B=Ue("output",t[0].dataType,p.length,b),L=N=>{let V=l.length,G=`var indicesIndices${N}  = ${A.type.indices}(0);`;for(let X=0;X<V;X++)G+=`${V>1?`indicesIndices${N}[${X}]`:`indicesIndices${N}`} = ${p.length>1?`outputIndices${N}[uniforms.axis + ${X}]`:`outputIndices${N}`};`;G+=`
          var idx${N} = ${A.getByIndices(`indicesIndices${N}`)};
          if (idx${N} < 0) {
            idx${N} = idx${N} + uniforms.axisDimLimit;
          }
          var dataIndices${N} : ${z.type.indices};
        `;for(let X=0,ue=0;X<u;X++)X===f?(G+=`${u>1?`dataIndices${N}[${X}]`:`dataIndices${N}`} = u32(idx${N});`,ue+=V):(G+=`${u>1?`dataIndices${N}[${X}]`:`dataIndices${N}`} = ${p.length>1?`outputIndices${N}[${ue}]`:`outputIndices${N}`};`,ue++);return G},U;if(t[0].dataType===9){let N=(V,G,X="")=>`
          let outputIndices${G} = ${B.offsetToIndices(`outputOffset + ${G}u`)};
          ${L(G)};
          let offset${G} = ${z.indicesToOffset(`dataIndices${G}`)};
          let index${G} = offset${G} / 4u;
          let component${G} = offset${G} % 4u;
          ${V}[${G}] = ${X}(${z.getByOffset(`index${G}`)}[component${G}]);
        `;U=`
        let outputOffset = global_idx * ${b};
        var value = vec4<u32>(0);
        ${N("value",0,"u32")}
        ${N("value",1,"u32")}
        ${N("value",2,"u32")}
        ${N("value",3,"u32")}
        ${B.setByOffset("global_idx","value")}
      `}else U=`
      let outputIndices = ${B.offsetToIndices("global_idx")};
      ${L("")};
      let value = ${z.getByIndices("dataIndices")};
      ${B.setByOffset("global_idx","value")};
      `;return`
      ${C.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(z,A,B)}
      ${C.mainStart()}
        ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${U}
      }`};return{name:"Gather",shaderCache:{hint:n.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:p,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:w}),getShaderSource:x}},Th=t=>O({axis:t.axis}),vf=(t,n)=>{let s=t.inputs;gf(s),t.compute(yf(t.inputs,n))}}),bf,Xo,Zo,Ch=T(()=>{rt(),He(),Ze(),bf=(t,n,s,l,u,f,p,g,b)=>{let v=[{type:12,data:f},{type:12,data:l},{type:12,data:u},{type:12,data:s},{type:12,data:p},{type:12,data:g},{type:12,data:b}],w=[f];v.push(...Q(n.dims,w));let x=C=>{let z=J("indices_data",n.dataType,n.dims.length),A=Ue("input_slice_offsets_data",12,1,1),B=[z,A],L=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:u.length},{name:"sizes_from_slice_dims_data",type:"u32",length:s.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${C.registerUniforms(L).declareVariables(...B)}
  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${u.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${s.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${u.length}_${s.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:w,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:v}),getShaderSource:x},{inputs:[n],outputs:[-1]})[0]},Xo=(t,n)=>{let s=t.inputs,l=s[0].dims,u=s[0].dataType,f=s[1].dims,p=f[f.length-1],g=pe.sizeToDimension(f,f.length-1),b=pe.sizeFromDimension(l,n.batchDims+p),v=pe.sizeToDimension(l,n.batchDims),w=pe.sizeFromDimension(l,n.batchDims),x=g/v,C=new Array(p),z=b;for(let G=0;G<p;++G)C[p-1-G]=z,z*=l[n.batchDims+p-1-G];let A=bf(t,s[1],C,n.batchDims,l,g,x,w,p),B=n.batchDims+p;if(B>l.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let L=f.slice(0,-1).concat(l.slice(B)),U=pe.size(L),N=[{type:12,data:U},{type:12,data:b},...Q(s[0].dims,A.dims,L)],V=G=>{let X=J("data",s[0].dataType,s[0].dims.length),ue=J("slice_offsets",12,A.dims.length),te=Ue("output",s[0].dataType,L.length);return`
          ${G.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(X,ue,te)}
            ${G.mainStart()}
            ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:n.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:L,dataType:u}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:N}),getShaderSource:V},{inputs:[s[0],A]})},Zo=t=>({batchDims:t.batch_dims,cacheKey:""})}),_c,zh,_f,wf,Ah=T(()=>{rt(),He(),I(),Ze(),_c=(t,n)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let s=pe.normalizeAxis(n.quantizeAxis,t[0].dims.length),l=n.blockSize,u=t[0],f=t[2],p=t.length===4?t[3]:void 0;if(f.dims.length!==u.dims.length||!u.dims.map((g,b)=>b===s?Math.ceil(g/l)===f.dims[b]:g===f.dims[b]).reduce((g,b)=>g&&b,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(p){if(p.dataType!==u.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(p.dims.length!==f.dims.length||!p.dims.map((g,b)=>g===f.dims[b]).reduce((g,b)=>g&&b,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},zh=(t,n)=>{let s=t[0].dims,l=t[1].dims,u=s.length,f=pe.normalizeAxis(n.gatherAxis,u),p=pe.normalizeAxis(n.quantizeAxis,u),g=s.slice(0);g.splice(f,1,...l);let b=pe.size(g),v=t[2].dataType,w=t[0].dataType===22,x=[{type:12,data:b},{type:12,data:p},{type:12,data:f},{type:12,data:n.blockSize},...Q(...t.map((z,A)=>z.dims),g)],C=z=>{let A=J("data",t[0].dataType,t[0].dims.length),B=J("inputIndices",t[1].dataType,t[1].dims.length),L=J("scales",t[2].dataType,t[2].dims.length),U=t.length>3?J("zeroPoint",t[3].dataType,t[3].dims.length):void 0,N=Ue("output",v,g.length),V=[A,B,L];U&&V.push(U);let G=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${z.registerUniforms(G).declareVariables(...V,N)}
        ${z.mainStart()}
        let output_indices = ${N.offsetToIndices("global_idx")};
        var indices_indices = ${B.type.indices}(0);
        ${l.length>1?`
          for (var i: u32 = 0; i < ${l.length}; i++) {
            let index = ${N.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${B.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${N.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${A.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${N.indicesGet("output_indices","i")};
          ${A.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${B.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${s[f]};
        }
        ${A.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${g.length}; i++) {
          let index = ${N.indicesGet("output_indices",`i + ${l.length} - 1`)};
          ${A.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${A.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${A.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${w?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${L.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${L.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${L.getByIndices("scale_indices")};
        ${U?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${U.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${U.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${w?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${W(v)}(quantized_data - zero_point) * scale;
        ${N.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${n.cacheKey};${t.filter((z,A)=>A!==1).map(z=>z.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(z,A)=>"rank")},getRunData:()=>({outputs:[{dims:g,dataType:v}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:x}),getShaderSource:C}},_f=(t,n)=>{let s=t.inputs;_c(s,n),t.compute(zh(t.inputs,n))},wf=t=>O({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),xf,$f,wc,Sf,Oh=T(()=>{rt(),He(),I(),Ze(),xf=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},$f=(t,n)=>{let s=t[0].dims,l=t[0].dataType,u=s.length,f=t[1].dims,p=t[1].dataType,g=pe.normalizeAxis(n.axis,u),b=s[g],v=f.slice(0),w=pe.size(v),x=J("input",l,u),C=J("indicesInput",p,f.length),z=Ue("output",l,v.length),A=[{type:12,data:w},{type:6,data:b},{type:12,data:g}];return A.push(...Q(s,f,v)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:v,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:A}),getShaderSource:B=>`
      ${B.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(x,C,z)}
      ${B.mainStart()}
      ${B.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${z.offsetToIndices("global_idx")};

      var idx = ${C.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${x.type.indices}(outputIndices);
      ${x.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${x.getByIndices("inputIndices")};

      ${z.setByOffset("global_idx","value")};
  }`}},wc=t=>O({axis:t.axis}),Sf=(t,n)=>{let s=t.inputs;xf(s),t.compute($f(t.inputs,n))}}),xc,Ef,Tf,Rh,Cf=T(()=>{rt(),He(),Ze(),xc=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},Ef=(t,n)=>{let s=t[0].dims.slice(),l=t[1].dims.slice(),[u,f,p]=ii.getShapeOfGemmResult(s,n.transA,l,n.transB,t.length===3?t[2].dims:void 0),g=[u,f];if(!g)throw new Error("Can't use gemm on the given tensors");let b=16,v=Math.ceil(f/b),w=Math.ceil(u/b),x=!0,C=pe.size(g),z=[{type:12,data:x?v:C},{type:12,data:u},{type:12,data:f},{type:12,data:p},{type:1,data:n.alpha},{type:1,data:n.beta}],A=["type","type"];t.length===3&&(z.push(...Q(t[2].dims)),A.push("rank")),z.push(...Q(g));let B=U=>{let N="";n.transA&&n.transB?N="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":n.transA&&!n.transB?N="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!n.transA&&n.transB?N="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!n.transA&&!n.transB&&(N="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let V=n.alpha===1?"":"value *= uniforms.alpha;",G=J("a",t[0].dataType,t[0].dims),X=J("b",t[1].dataType,t[1].dims),ue=G.type.value,te=null,ge=[G,X];t.length===3&&(te=J("c",t[2].dataType,t[2].dims.length),ge.push(te));let ve=Ue("output",t[0].dataType,g.length);ge.push(ve);let Le=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${U.registerUniforms(Le).declareVariables(...ge)}

  ${U.mainStart()}
    ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${ue}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${N}
    }

    ${V}
    ${te!=null?`let cOffset = ${te.broadcastedIndicesToOffset("vec2(m, n)",ve)}; value += ${ue}(uniforms.beta) * ${te.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},L=U=>{let N=J("a",t[0].dataType,t[0].dims),V=J("b",t[1].dataType,t[1].dims),G=null,X=[N,V];t.length===3&&(G=J("c",t[2].dataType,t[2].dims.length),X.push(G));let ue=Ue("output",t[0].dataType,g.length);X.push(ue);let te=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],ge="",ve="";n.transA&&n.transB?(ve=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${N.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${V.type.value}(0);
      }
      `,ge="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):n.transA&&!n.transB?(ve=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${N.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${V.type.value}(0);
      }
      `,ge="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!n.transA&&n.transB?(ve=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${N.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${V.type.value}(0);
      }
      `,ge="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!n.transA&&!n.transB&&(ve=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${N.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${V.type.value}(0);
      }
      `,ge="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let Le=n.alpha===1?"":"value *= uniforms.alpha;";return`
  ${U.registerUniforms(te).declareVariables(...X)}
  var<workgroup> tile_a: array<array<${N.type.storage}, ${b}>, ${b}>;
  var<workgroup> tile_b: array<array<${V.type.storage}, ${b}>, ${b}>;
  ${U.mainStart([b,b,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${b};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${b};
    let num_tiles = (uniforms.K - 1) / ${b} + 1;
    var k_start = 0u;
    var value = ${ue.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${ve}
      k_start = k_start + ${b};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${b}; k++) {
        ${ge}
      }
      workgroupBarrier();
    }

    ${Le}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${G!=null?`let cOffset = ${G.broadcastedIndicesToOffset("vec2(m, n)",ue)}; value += ${ue.type.value}(uniforms.beta) * ${G.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return x?{name:"GemmShared",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:g,dataType:t[0].dataType}],dispatchGroup:{x:v*w},programUniforms:z}),getShaderSource:L}:{name:"Gemm",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:g,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(C/64)},programUniforms:z}),getShaderSource:B}},Tf=t=>{let n=t.transA,s=t.transB,l=t.alpha,u=t.beta;return{transA:n,transB:s,alpha:l,beta:u,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},Rh=(t,n)=>{xc(t.inputs),t.compute(Ef(t.inputs,n))}}),di,Li,$r,ds,zf,Mh,kh,Af,eo,$c,Jo,Of,Rf,to,Dh=T(()=>{rt(),He(),I(),Ze(),[di,Li,$r,ds]=[0,1,2,3],zf=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},Mh=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,kh=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Af=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,eo=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,$c=(t,n,s)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${n} {
     var pixel = ${n}(0);
     var indices = vec4<u32>(0);
     indices[${di}] = batch;
     indices[${Li}] = channel;`+(()=>{switch(s.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${$r}] = u32(r);
            indices[${ds}] = u32(c);
          } else {
            return ${n}(0);
          }
        `;case"border":return`
          indices[${$r}] = u32(clamp(r, 0, H - 1));
          indices[${ds}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${$r}] = gs_reflect(r, border[1], border[3]);
          indices[${ds}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${s.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,Jo=(t,n,s)=>(()=>{switch(s.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${di}], indices[${Li}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${di}], indices[${Li}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${di}], indices[${Li}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${di}], indices[${Li}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${di}], indices[${Li}], border);

          let dx2 = ${n}(f32(x2) - x);
          let dx1 = ${n}(x - f32(x1));
          let dy2 = ${n}(f32(y2) - y);
          let dy1 = ${n}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${n}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${di}], indices[${Li}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${s.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,Of=(t,n)=>{let s=J("x",t[0].dataType,t[0].dims.length),l=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],u=J("grid",t[1].dataType,l.length,2),f=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];n.format==="NHWC"&&(f=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[di,Li,$r,ds]=[0,3,1,2]);let p=Ue("output",t[0].dataType,f.length),g=s.type.value,b=pe.size(f),v=[{type:12,data:b},...Q(t[0].dims,l,f)],w=x=>`
  ${x.registerUniform("output_size","u32").declareVariables(s,u,p)}
  ${Mh}
  ${kh(g)}
  ${Af(n)}
  ${eo(n)}
  ${$c(s,g,n)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${$r}]);
      let W_in = i32(uniforms.x_shape[${ds}]);

      ${n.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${p.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${di}], indices[${$r}], indices[${ds}]);
      let nxy = ${u.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${Jo(p,g,n)}
  }`;return{name:"GridSample",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:["type","type"]},getRunData:x=>{let C=pe.size(f);return{outputs:[{dims:f,dataType:x[0].dataType}],dispatchGroup:{x:Math.ceil(C/64)},programUniforms:v}},getShaderSource:w}},Rf=(t,n)=>{zf(t.inputs),t.compute(Of(t.inputs,n))},to=t=>O({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),Fa,Mf,Sc,eu,kf,ao,fs,Df=T(()=>{rt(),He(),I(),Ci(),ql(),Ze(),Oa(),Fa=(t,n)=>t.length>n&&t[n].dims.length>0?t[n]:void 0,Mf=(t,n)=>{let s=t[0],l=Fa(t,1),u=Fa(t,2),f=Fa(t,3),p=Fa(t,4),g=Fa(t,5),b=Fa(t,6),v=Fa(t,7);if(s.dims.length!==3&&s.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let w=s.dims[0],x=s.dims[1],C=s.dims.length===3?s.dims[2]:n.numHeads*s.dims[4],z=x,A=0,B=0,L=Math.floor(C/n.numHeads);if(b&&v&&pe.size(b.dims)&&pe.size(v.dims)){if(b.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(b.dims[0]!==w||b.dims[1]!==n.numHeads||b.dims[3]!==L)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(v.dims[0]!==w||v.dims[1]!==n.numHeads||v.dims[3]!==L)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(b.dims[2]!==v.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(v.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');A=b.dims[2],B=b.dims[2]}else if(b&&pe.size(b.dims)||v&&pe.size(v.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let U;if(l&&pe.size(l.dims)>0){if(s.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(l.dims.length<3||l.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(s.dims[0]!==l.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(l.dims.length===3){if(l.dims[2]!==s.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');U=2,z=l.dims[1]}else if(l.dims.length===5){if(l.dims[2]!==n.numHeads||l.dims[3]!==2||l.dims[4]!==L)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(u)throw new Error('Expect "value" be none when "key" has packed kv format.');U=5,z=l.dims[1]}else{if(l.dims[1]!==n.numHeads||l.dims[3]!==L)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');U=0,z=l.dims[2]}}else{if(s.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(s.dims[2]!==n.numHeads||s.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');U=3}if(f&&pe.size(f.dims)>0){if(f.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(l&&l.dims.length===5&&l.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let N=A+z,V=0;if(p&&pe.size(p.dims)>0){V=8;let te=p.dims;throw te.length===1?te[0]===w?V=1:te[0]===3*w+2&&(V=3):te.length===2&&te[0]===w&&te[1]===N&&(V=5),V===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let G=!1,X=C;if(u&&pe.size(u.dims)>0){if(u.dims.length!==3&&u.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(s.dims[0]!==u.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(u.dims.length===3){if(z!==u.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');X=u.dims[2]}else{if(z!==u.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');X=u.dims[1]*u.dims[3],G=!0}}let ue=!1;if(p&&pe.size(p.dims)>0)throw new Error("Key padding mask is not supported");if(g&&pe.size(g.dims)>0){if(g.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(g.dims[0]!==w||g.dims[1]!==n.numHeads||g.dims[2]!==x||g.dims[3]!==N)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:w,sequenceLength:x,pastSequenceLength:A,kvSequenceLength:z,totalSequenceLength:N,maxSequenceLength:B,inputHiddenSize:0,hiddenSize:C,vHiddenSize:X,headSize:L,vHeadSize:Math.floor(X/n.numHeads),numHeads:n.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:n.maskFilterValue,maskType:V,scale:n.scale,broadcastResPosBias:ue,passPastInKv:G,qkvFormat:U}},Sc=t=>O({...t}),eu=O({perm:[0,2,1,3]}),kf=(t,n,s,l,u,f,p)=>{let g=[l,u,f],b=pe.size(g),v=[{type:12,data:b},{type:12,data:p},{type:12,data:f}],w=x=>{let C=Ue("qkv_with_bias",n.dataType,g),z=J("qkv",n.dataType,g),A=J("bias",s.dataType,g),B=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${x.registerUniforms(B).declareVariables(z,A,C)}
  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:g,dataType:n.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:v}),getShaderSource:w},{inputs:[n,s],outputs:[-1]})[0]},ao=(t,n,s,l,u,f,p,g)=>{let b=f;if(p&&pe.size(p.dims)>0){if(l===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return b=kf(t,f,p,n,l,s*u,g),b=b.reshape([n,l,s,u]),s===1||l===1?b:t.compute(Ya(b,eu.perm),{inputs:[b],outputs:[-1]})[0]}else return f.dims.length===3&&(b=f.reshape([n,l,s,u])),s===1||l===1?b:t.compute(Ya(b,eu.perm),{inputs:[b],outputs:[-1]})[0]},fs=(t,n)=>{let s=Mf(t.inputs,n),l=t.inputs[0],u=Fa(t.inputs,1),f=Fa(t.inputs,2),p=Fa(t.inputs,3),g=Fa(t.inputs,4),b=Fa(t.inputs,5),v=Fa(t.inputs,6),w=Fa(t.inputs,7);if(l.dims.length===5)throw new Error("Packed QKV is not implemented");if((u==null?void 0:u.dims.length)===5)throw new Error("Packed KV is not implemented");let x=u&&f&&u.dims.length===4&&f.dims.length===4,C=ao(t,s.batchSize,s.numHeads,s.sequenceLength,s.headSize,l,p,0);if(x)return Ll(t,C,u,f,g,void 0,v,w,b,s);if(!u||!f)throw new Error("key and value must be provided");let z=ao(t,s.batchSize,s.numHeads,s.kvSequenceLength,s.headSize,u,p,s.hiddenSize),A=ao(t,s.batchSize,s.numHeads,s.kvSequenceLength,s.vHeadSize,f,p,2*s.hiddenSize);Ll(t,C,z,A,g,void 0,v,w,b,s)}}),Bf,Nf,tu,Uf,au,If,Lf,Bh=T(()=>{rt(),He(),I(),Ze(),Bf=t=>{if(!t||t.length<1)throw new Error("too few inputs")},Nf=(t,n)=>{let s=[],l=n.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(u=>s.push(Number(u))),l=s.length),O({numOutputs:l,axis:n.axis,splitSizes:s})},tu=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${de("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,Uf=t=>{let n=t.length,s=[];for(let l=0;l<n;++l){let u=t[l].setByIndices("indices","input[global_idx]");n===1?s.push(u):l===0?s.push(`if (output_number == ${l}u) { ${u} }`):l===n-1?s.push(`else { ${u} }`):s.push(`else if (output_number == ${l}) { ${u} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${s.join(`
`)}
      }`},au=(t,n)=>{let s=t[0].dims,l=pe.size(s),u=t[0].dataType,f=pe.normalizeAxis(n.axis,s.length),p=new Array(n.numOutputs),g=J("input",u,s.length),b=new Array(n.numOutputs),v=[],w=[],x=0,C=[{type:12,data:l}];for(let A=0;A<n.numOutputs;A++){x+=n.splitSizes[A],b[A]=x;let B=s.slice();B[f]=n.splitSizes[A],w.push(B),p[A]=Ue(`output${A}`,u,B.length),v.push({dims:w[A],dataType:t[0].dataType})}C.push({type:12,data:b},...Q(s,...w));let z=A=>`
  ${A.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",b.length).declareVariables(g,...p)}
  ${tu(b.length)}
  ${Uf(p)}

  ${A.mainStart()}
    ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${g.offsetToIndices("global_idx")};
    var index = ${g.indicesGet("indices",f)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${de("uniforms.size_in_split_axis","output_number - 1u",b.length)};
      ${g.indicesSet("indices",f,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getShaderSource:z,getRunData:()=>({outputs:v,dispatchGroup:{x:Math.ceil(l/64)},programUniforms:C})}},If=(t,n)=>{Bf(t.inputs);let s=t.inputs.length===1?n:Nf(t.inputs,n);t.compute(au(t.inputs,s),{inputs:[0]})},Lf=t=>{let n=t.axis,s=t.splitSizes,l=t.numOutputs<0?s.length:t.numOutputs;if(l!==s.length)throw new Error("numOutputs and splitSizes length must be equal");return O({axis:n,numOutputs:l,splitSizes:s})}}),Ec,ca,Ua,qf=T(()=>{rt(),He(),I(),Ze(),Ec=(t,n)=>{let[s,l,u,f]=t,{numHeads:p,rotaryEmbeddingDim:g}=n;if(s.dims.length!==3&&s.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${s.dims.length}`);if(!pe.areEqual(l.dims,[])&&!pe.areEqual(l.dims,[1])&&l.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${l.dims.length}`);if(u.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${u.dims.length}`);if(f.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${f.dims.length}`);if(!pe.areEqual(u.dims,f.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(g>0&&p===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let b=s.dims[0],v=s.dims[s.dims.length-2],w=u.dims[0],x=pe.sizeFromDimension(s.dims,1)/v,C=g===0?u.dims[1]*2:x/p;if(g>C)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(l.dims.length===2){if(b!==l.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${l.dims[0]}`);if(v!==l.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${l.dims[1]}`)}if(C/2!==u.dims[1]&&g/2!==u.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${u.dims[1]}`);if(v>w)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},ca=(t,n)=>{let{interleaved:s,numHeads:l,rotaryEmbeddingDim:u,scale:f}=n,p=t[0].dims[0],g=pe.sizeFromDimension(t[0].dims,1),b=t[0].dims[t[0].dims.length-2],v=g/b,w=t[2].dims[1],x=u===0?w*2:v/l,C=new Array(p,b,v/x,x-w),z=pe.computeStrides(C),A=[{type:1,data:f},{type:12,data:C},{type:12,data:z},...t[0].dims.length===3?new Array({type:12,data:[g,v,x,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[g,x,b*x,1]}):[],...Q(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],B=L=>{let U=J("input",t[0].dataType,t[0].dims.length),N=J("position_ids",t[1].dataType,t[1].dims.length),V=J("cos_cache",t[2].dataType,t[2].dims.length),G=J("sin_cache",t[3].dataType,t[3].dims.length),X=Ue("output",t[0].dataType,t[0].dims.length);return L.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:C.length},{name:"global_strides",type:"u32",length:z.length},{name:"input_output_strides",type:"u32",length:z.length}]),`
        ${L.declareVariables(U,N,V,G,X)}

        ${L.mainStart(F)}
          let half_rotary_emb_dim = uniforms.${V.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${L.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${N.broadcastedIndicesToOffset("bsnh.xy",Ue("",N.type.tensor,2))};
            let position_id =
                u32(${N.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${s});
            let j = i + select(half_rotary_emb_dim, 1, ${s});
            let re = ${U.getByOffset("i")} * ${V.get("position_id","bsnh[3]")} -
                ${U.getByOffset("j")} * ${G.get("position_id","bsnh[3]")};
            ${X.setByOffset("i","re")}
            let im = ${U.getByOffset("i")} * ${G.get("position_id","bsnh[3]")} +
                ${U.getByOffset("j")} * ${V.get("position_id","bsnh[3]")};
            ${X.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${X.setByOffset("k",U.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:O({interleaved:s}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:B,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(pe.size(C)/F)},programUniforms:A})}},Ua=(t,n)=>{Ec(t.inputs,n),t.compute(ca(t.inputs,n))}}),jf,Gf,Tc,no,Vf,Cc=T(()=>{I(),rt(),ql(),Df(),Bh(),Oa(),qf(),Ze(),jf=(t,n)=>{if(n.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let s=t[0],l=t[1],u=t[2],f=t[3],p=t[4];if(n.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(n.localWindowSize!==-1)throw new Error("Local attention is not supported");if(n.softcap!==0)throw new Error("Softcap is not supported");if(n.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(n.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(s.dims.length!==3&&s.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let g=!1,b=s.dims[0],v=s.dims[1],w=s.dims.length===3?g?s.dims[2]/3:s.dims[2]:n.numHeads*s.dims[4],x=v,C=0,z=!l||l.dims.length===0,A=Math.floor(z?w/(n.numHeads+2*n.kvNumHeads):w/n.numHeads);z&&(w=A*n.numHeads);let B=f&&f.dims.length!==0,L=p&&p.dims.length!==0;if(B&&f.dims.length===4&&f.dims[0]===b&&f.dims[1]!==n.kvNumHeads&&f.dims[2]===n.kvNumHeads&&f.dims[3]===A)throw new Error("BSNH pastKey/pastValue is not supported");if(B&&L){if(f.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(p.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');C=f.dims[2]}else if(B||L)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let U=1;if(l&&l.dims.length>0){if(s.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(l.dims.length<3||l.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(s.dims[0]!==l.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(l.dims.length===3){if(s.dims[2]%l.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');x=l.dims[1]}else if(l.dims.length===5){if(l.dims[2]!==n.numHeads||l.dims[3]!==2||l.dims[4]!==A)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(u)throw new Error('Expect "value" be none when "key" has packed kv format.');x=l.dims[1]}else{if(l.dims[1]!==n.numHeads||l.dims[3]!==A)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');x=l.dims[2]}}else{if(s.dims.length!==3&&s.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(s.dims.length===5&&(s.dims[2]!==n.numHeads||s.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');U=3}let N=0,V=!1,G=n.kvNumHeads?A*n.kvNumHeads:w;if(u&&u.dims.length>0){if(u.dims.length!==3&&u.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(s.dims[0]!==u.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(u.dims.length===3){if(x!==u.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');G=u.dims[2]}else{if(x!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');G=u.dims[1]*u.dims[3],V=!0}}let X=t.length>4?t[5]:void 0;if(X&&X.dims.length!==1&&X.dims[0]!==b)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:b,sequenceLength:v,pastSequenceLength:C,kvSequenceLength:x,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:w,vHiddenSize:G,headSize:A,vHeadSize:Math.floor(G/n.kvNumHeads),numHeads:n.numHeads,kvNumHeads:n.kvNumHeads,nReps:n.numHeads/n.kvNumHeads,pastPresentShareBuffer:!1,maskType:N,scale:n.scale,broadcastResPosBias:!1,passPastInKv:V,qkvFormat:U}},Gf=O({perm:[0,2,1,3]}),Tc=(t,n,s)=>{let l=n,u=s.kvNumHeads;return n.dims.length===3&&s.kvSequenceLength!==0&&(l=n.reshape([s.batchSize,s.kvSequenceLength,u,s.headSize]),l=t.compute(Ya(l,Gf.perm),{inputs:[l],outputs:[-1]})[0]),l},no=(t,n,s,l)=>{let u=7,f=["type","type"],p=[t*n],g=t*n,b=[{type:12,data:g},{type:12,data:n},{type:12,data:t}],v=w=>{let x=J("seq_lens",s.dataType,s.dims),C=J("total_seq_lens",l.dataType,l.dims),z=Ue("pos_ids",u,p),A=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${w.registerUniforms(A).declareVariables(x,C,z)}
  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${C.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${x.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${z.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${z.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${z.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${n}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:p,dataType:u}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:b}),getShaderSource:v}},Vf=(t,n)=>{var G;let s=jf(t.inputs,n);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((G=t.inputs[1])==null?void 0:G.dims.length)===5)throw new Error("Packed KV is not implemented");let l=t.inputs[0],u=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,f=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,p=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,g=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,b=t.inputs.length>4?t.inputs[5]:void 0,v=t.inputs.length>5?t.inputs[6]:void 0,w=s.kvNumHeads?s.kvNumHeads:s.numHeads,x=O({axis:2,numOutputs:3,splitSizes:[s.numHeads*s.headSize,w*s.headSize,w*s.headSize]}),[C,z,A]=!u&&!f?t.compute(au([l],x),{inputs:[l],outputs:[-1,-1,-1]}):[l,u,f],B,L;if(n.doRotary){let X=t.compute(no(s.batchSize,s.sequenceLength,b,v),{inputs:[b,v],outputs:[-1]})[0],ue=t.inputs[7],te=t.inputs[8],ge=O({interleaved:n.rotaryInterleaved!==0,numHeads:s.numHeads,rotaryEmbeddingDim:0,scale:n.scale}),ve=[C,X,ue,te],Le=[-1];B=t.compute(ca(ve,ge),{inputs:ve,outputs:Le})[0],ve.splice(0,1,z);let nt=O({interleaved:n.rotaryInterleaved!==0,numHeads:s.kvNumHeads,rotaryEmbeddingDim:0,scale:n.scale});L=t.compute(ca(ve,nt),{inputs:ve,outputs:Le})[0]}let U=ao(t,s.batchSize,s.numHeads,s.sequenceLength,s.headSize,n.doRotary?B:C,void 0,0),N=Tc(t,n.doRotary?L:z,s),V=Tc(t,A,s);Ll(t,U,N,V,void 0,void 0,p,g,void 0,s,b,v)}}),zc,Nh,nu,Ac,Uh=T(()=>{rt(),He(),Oa(),Ze(),zc=(t,n,s,l,u,f,p,g)=>{let b=re(f),v=b===1?"f32":`vec${b}f`,w=b===1?"vec2f":`mat2x${b}f`,x=u*p,C=64;x===1&&(C=256);let z=[u,p,f/b],A=[u,p,2],B=["rank","type","type"],L=[];L.push(...Q(z,A));let U=N=>{let V=J("x",n.dataType,3,b),G=J("scale",s.dataType,s.dims),X=J("bias",l.dataType,l.dims),ue=Ue("output",1,3,2),te=[V,G,X,ue];return`
  var<workgroup> workgroup_shared : array<${w}, ${C}>;
  const workgroup_size = ${C}u;
  ${N.declareVariables(...te)}
  ${N.mainStart(C)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${v}(0);
    var squared_sum = ${v}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${v}(${V.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${w}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${xe("workgroup_shared[0][0]",b)} / f32(hight * ${b});
      let squared_sum_final = ${xe("workgroup_shared[0][1]",b)} / f32(hight * ${b});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${g}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${b};${g};${C}`,inputDependencies:B},getRunData:()=>({outputs:[{dims:A,dataType:1}],dispatchGroup:{x},programUniforms:L}),getShaderSource:U},{inputs:[n,s,l],outputs:[-1]})[0]},Nh=(t,n,s)=>{let l=n[0].dims,u=l,f=2,p=l[0],g=l[1],b=pe.sizeFromDimension(l,f),v=re(b),w=pe.size(u)/v,x=zc(t,n[0],n[1],n[2],p,b,g,s.epsilon),C=[p,g,b/v],z=[p,g],A=["type","none"],B=L=>{let U=J("x",n[0].dataType,C.length,v),N=J("scale_shift",1,z.length,2),V=Ue("output",n[0].dataType,C.length,v),G=[U,N,V];return`
  ${L.registerUniform("output_size","u32").declareVariables(...G)}
  ${L.mainStart()}
  ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${V.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${N.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${U.getByOffset("global_idx")} * ${V.type.value}(scale_shift.x) + ${V.type.value}(scale_shift.y);
      ${V.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${v}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:u,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:[{type:12,data:w},...Q(C,z,C)]}),getShaderSource:B},{inputs:[n[0],x]})},nu=(t,n,s)=>{let l=n[0].dims,u=l,f=l[0],p=l[l.length-1],g=pe.sizeFromDimension(l,1)/p,b=re(p),v=pe.size(u)/b,w=[{type:12,data:g},{type:12,data:Math.floor(p/b)}],x=["type","type"],C=!1,z=[0,l.length-1];for(let U=0;U<l.length-2;U++)C=C||l[U+1]!==1,z.push(U+1);C=C&&l[l.length-1]!==1;let A=C?t.compute(Ya(t.inputs[0],z),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:l.length},(U,N)=>l[z[N]])),B=zc(t,A,n[1],n[2],f,g,p,s.epsilon),L=U=>{let N=ae(n[0].dataType),V=b===1?"vec2f":`mat${b}x2f`,G=te=>{let ge=te===0?"x":"y",ve=b===1?"f32":`vec${b}f`;switch(b){case 1:return`${N}(${ve}(scale.${ge}))`;case 2:return`vec2<${N}>(${ve}(scale[0].${ge}, scale[1].${ge}))`;case 4:return`vec4<${N}>(${ve}(scale[0].${ge}, scale[1].${ge}, scale[2].${ge}, scale[3].${ge}))`;default:throw new Error(`Not supported compoents ${b}`)}},X=J("input",n[0].dataType,n[0].dims,b),ue=Ue("output",n[0].dataType,u,b);return`
  @group(0) @binding(0) var<storage, read> input : array<${X.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${V}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${ue.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${U.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${G(0)}, ${G(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${b}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:u,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:w}),getShaderSource:L},{inputs:[n[0],B]})},Ac=(t,n)=>{n.format==="NHWC"?nu(t,t.inputs,n):Nh(t,t.inputs,n)}}),Hf,Pf,Oc,Ff=T(()=>{rt(),He(),Ze(),Hf=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},Pf=(t,n,s)=>{let l=n.simplified,u=t[0].dims,f=t[1],p=!l&&t[2],g=u,b=pe.normalizeAxis(n.axis,u.length),v=pe.sizeToDimension(u,b),w=pe.sizeFromDimension(u,b),x=pe.size(f.dims),C=p?pe.size(p.dims):0;if(x!==w||p&&C!==w)throw new Error(`Size of X.shape()[axis:] == ${w}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${x} and bias size of ${C}`);let z=[];for(let X=0;X<u.length;++X)X<b?z.push(u[X]):z.push(1);let A=re(w),B=["type","type"],L=[{type:12,data:v},{type:1,data:w},{type:12,data:Math.floor(w/A)},{type:1,data:n.epsilon}];p&&B.push("type");let U=s>1,N=s>2,V=X=>{let ue=ae(t[0].dataType),te=[J("x",t[0].dataType,t[0].dims,A),J("scale",f.dataType,f.dims,A)];p&&te.push(J("bias",p.dataType,p.dims,A)),te.push(Ue("output",t[0].dataType,g,A)),U&&te.push(Ue("mean_data_output",1,z)),N&&te.push(Ue("inv_std_output",1,z));let ge=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${X.registerUniforms(ge).declareVariables(...te)}
  ${X.mainStart()}
    ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Ee("f32",A)};
    var mean_square_vector = ${Ee("f32",A)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${ke(ue,A,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${xe("mean_vector",A)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${xe("mean_square_vector",A)} / uniforms.norm_size ${l?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${ke(ue,A,"x[j + offset]")};
      let f32scale = ${ke(ue,A,"scale[j]")};
      output[j + offset] = ${te[0].type.value}((f32input ${l?"":"- mean"}) * inv_std_dev * f32scale
        ${p?`+ ${ke(ue,A,"bias[j]")}`:""}
      );
    }

    ${U?"mean_data_output[global_idx] = mean":""};
    ${N?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},G=[{dims:g,dataType:t[0].dataType}];return U&&G.push({dims:z,dataType:1}),N&&G.push({dims:z,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${A};${s};${l}`,inputDependencies:B},getRunData:()=>({outputs:G,dispatchGroup:{x:Math.ceil(v/64)},programUniforms:L}),getShaderSource:V}},Oc=(t,n)=>{Hf(t.inputs),t.compute(Pf(t.inputs,n,t.outputCount))}}),Rc,Kf,Wf=T(()=>{He(),Pl(),Ui(),Rc=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},Kf=t=>{Rc(t.inputs);let n=qn.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!n)throw new Error("Can't use matmul on the given tensors");let s=n[n.length-1],l=t.inputs[0].dims[t.inputs[0].dims.length-1];if(s<8&&l<8)t.compute(el(t.inputs,{activation:""},n));else{let u=n[n.length-2],f=pe.size(t.inputs[0].dims.slice(0,-2)),p=pe.size(t.inputs[1].dims.slice(0,-2));if(f!==1&&u===1&&p===1){let g=t.inputs[0].reshape([1,f,l]),b=t.inputs[1].reshape([1,l,s]),v=[1,f,s],w=[g,b];t.compute(Kl(w,{activation:""},n,v),{inputs:w})}else t.compute(Kl(t.inputs,{activation:""},n))}}}),iu,Mc,Qf,kc,Yf,Sr=T(()=>{rt(),He(),I(),Ze(),iu=(t,n)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let s=t[0],l=s.dims.length;if(s.dims[l-1]!==n.k)throw new Error("The last dim of input shape does not match the k value");let u=Math.floor((n.k+n.blockSize-1)/n.blockSize),f=n.blockSize/8*n.bits,p=t[1];if(!pe.areEqual(p.dims,[n.n,u,f]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let g=t[2].dims;if(pe.size(g)!==n.n*u)throw new Error("scales input size error.");if(t.length===4){let b=t[3].dims,v=n.n*(n.bits===8?u:Math.floor((u*n.bits+7)/8));if(pe.size(b)!==v)throw new Error("zeroPoints input size error.")}},Mc=(t,n)=>{let s=t[0].dims,l=s.length,u=s[l-2],f=n.k,p=n.n,g=s.slice(0,l-2),b=pe.size(g),v=t[1].dims[2]/4,w=t[0].dataType,x=re(n.k),C=re(v),z=re(p),A=g.concat([u,p]),B=u>1&&p/z%2===0?2:1,L=pe.size(A)/z/B,U=64,N=[],V=[b,u,f/x],G=pe.convertShape(t[1].dims).slice();G.splice(-1,1,v/C),N.push(...Q(V)),N.push(...Q(G)),N.push(...Q(t[2].dims)),t.length===4&&N.push(...Q(pe.convertShape(t[3].dims)));let X=[b,u,p/z];N.push(...Q(X));let ue=te=>{let ge=V.length,ve=J("a",t[0].dataType,ge,x),Le=J("b",12,G.length,C),nt=J("scales",t[2].dataType,t[2].dims.length),Fe=[ve,Le,nt],tt=t.length===4?J("zero_points",12,t[3].dims.length):void 0;tt&&Fe.push(tt);let Et=X.length,Tt=Ue("output",t[0].dataType,Et,z),We=ae(t[0].dataType),ut=(()=>{switch(x){case 1:return`array<${We}, 8>`;case 2:return`mat4x2<${We}>`;case 4:return`mat2x4<${We}>`;default:throw new Error(`${x}-component is not supported.`)}})(),Qt=()=>{let Ne=`
          // reuse a data
            var input_offset = ${ve.indicesToOffset(`${ve.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ut};
            for (var j: u32 = 0; j < ${8/x}; j++) {
              a_data[j] = ${ve.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let Ie=0;Ie<z*B;Ie++)Ne+=`
            b_value = ${C===1?`b${Ie}_data`:`b${Ie}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ut}(${Array.from({length:4},(lt,pt)=>`${We}(b_value_lower[${pt}]), ${We}(b_value_upper[${pt}])`).join(", ")});
            b_dequantized_values = ${x===1?`${ut}(${Array.from({length:8},(lt,pt)=>`(b_quantized_values[${pt}] - ${tt?`zero_point${Ie}`:"zero_point"}) * scale${Ie}`).join(", ")});`:`(b_quantized_values - ${ut}(${Array(8).fill(`${tt?`zero_point${Ie}`:"zero_point"}`).join(",")})) * scale${Ie};`};
            workgroup_shared[local_id.x * ${B} + ${Math.floor(Ie/z)}]${z>1?`[${Ie%z}]`:""} += ${Array.from({length:8/x},(lt,pt)=>`${x===1?`a_data[${pt}] * b_dequantized_values[${pt}]`:`dot(a_data[${pt}], b_dequantized_values[${pt}])`}`).join(" + ")};
          `;return Ne},je=()=>{let Ne=`
            var col_index = col * ${z};
            ${tt?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${We}(8);`}
            `;for(let Ie=0;Ie<z*B;Ie++)Ne+=`
            let scale${Ie} = ${nt.getByOffset("col_index * nBlocksPerCol + block")};
            ${tt?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${tt.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${Ie} = ${We}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return Ne},aa=()=>{let Ne=`col_index = col * ${z};`;for(let Ie=0;Ie<z*B;Ie++)Ne+=`
            let b${Ie}_data = ${Le.getByIndices(`${Le.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return Ne+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ut};
            var b_dequantized_values: ${ut};`,Ne};return`
        var<workgroup> workgroup_shared: array<${Tt.type.value}, ${B*U}>;
        ${te.declareVariables(...Fe,Tt)}
        ${te.mainStart([U,1,1])}
          let output_indices = ${Tt.offsetToIndices(`(global_idx / ${U}) * ${B}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${U}) {
            //process one block
            var word_offset: u32 = block * ${n.blockSize/x};
            ${je()}
            for (var word: u32 = 0; word < ${v}; word += ${C}) {
              ${aa()}
              for (var i: u32 = 0; i < ${C}; i++) {
                ${Qt()}
                word_offset += ${8/x};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${B}) {
            var output_value: ${Tt.type.value} = ${Tt.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${U}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${B};
            }
            ${Tt.setByIndices(`${Tt.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${n.blockSize};${n.bits};${x};${C};${z};${B};${U}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:A,dataType:w}],dispatchGroup:{x:L},programUniforms:N}),getShaderSource:ue}},Qf=(t,n)=>{let s=t[0].dims,l=s.length,u=s[l-2],f=n.k,p=n.n,g=s.slice(0,l-2),b=pe.size(g),v=t[1].dims[2]/4,w=t[0].dataType,x=re(n.k),C=re(v),z=g.concat([u,p]),A=128,B=p%8===0?8:p%4===0?4:1,L=A/B,U=L*C*8,N=U/x,V=U/n.blockSize,G=pe.size(z)/B,X=[],ue=[b,u,f/x],te=pe.convertShape(t[1].dims).slice();te.splice(-1,1,v/C),X.push(...Q(ue)),X.push(...Q(te)),X.push(...Q(t[2].dims)),t.length===4&&X.push(...Q(pe.convertShape(t[3].dims)));let ge=[b,u,p];X.push(...Q(ge));let ve=Le=>{let nt=ue.length,Fe=J("a",t[0].dataType,nt,x),tt=J("b",12,te.length,C),Et=J("scales",t[2].dataType,t[2].dims.length),Tt=[Fe,tt,Et],We=t.length===4?J("zero_points",12,t[3].dims.length):void 0;We&&Tt.push(We);let ut=ge.length,Qt=Ue("output",t[0].dataType,ut),je=ae(t[0].dataType),aa=()=>{switch(x){case 1:return`
          let a_data0 = vec4<${je}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${je}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${je}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${je}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${x}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${Fe.type.value}, ${N}>;
        var<workgroup> inter_results: array<array<${Qt.type.value}, ${L}>, ${B}>;
        ${Le.declareVariables(...Tt,Qt)}
        ${Le.mainStart([L,B,1])}
          let output_indices = ${Qt.offsetToIndices(`workgroup_index * ${B}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${V} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${N};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${N}; a_offset += ${A})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${Fe.getByIndices(`${Fe.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${Fe.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${V} + local_id.x;
            ${We?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${We.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${je}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${je}(8);`}
            let scale = ${Et.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${tt.getByIndices(`${tt.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${n.blockSize/x};
            for (var i: u32 = 0; i < ${C}; i++) {
              ${aa()}
              let b_value = ${C===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${je}>(${Array.from({length:4},(Ne,Ie)=>`${je}(b_value_lower[${Ie}]), ${je}(b_value_upper[${Ie}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${je}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(Ne,Ie)=>`${`dot(a_data${Ie}, b_dequantized_values[${Ie}])`}`).join(" + ")};
              word_offset += ${8/x};
            }
            workgroupBarrier();
          }

          if (local_idx < ${B}) {
            var output_value: ${Qt.type.value} = ${Qt.type.value}(0);
            for (var b = 0u; b < ${L}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${Qt.setByIndices(`${Qt.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${n.blockSize};${x};${C};${L};${B}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:z,dataType:w}],dispatchGroup:{x:G},programUniforms:X}),getShaderSource:ve}},kc=(t,n)=>{iu(t.inputs,n),n.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(Qf(t.inputs,n)):t.compute(Mc(t.inputs,n))},Yf=t=>O(t)}),Dc,Ih,Xf,qi,Bc,Zf,ru,io,ta,Mm=T(()=>{rt(),He(),Ze(),Dc=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let n=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(n=t[3].dims[0]*2===t[1].dims[0]),!n)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Ih=(t,n,s)=>{let l="";for(let u=n-1;u>=0;--u)l+=`
            k = i32(${t.indicesGet("indices",u)}) - ${de("uniforms.pads",u,s)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${de("uniforms.x_shape",u,n)})) {
              break;
            }
            offset += k * i32(${de("uniforms.x_strides",u,n)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${l}
            value = x[offset];
          }
      `},Xf=(t,n,s)=>{let l="";for(let u=n-1;u>=0;--u)l+=`
                k = i32(${t.indicesGet("indices",u)}) - ${de("uniforms.pads",u,s)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${de("uniforms.x_shape",u,n)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${de("uniforms.x_shape",u,n)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${de("uniforms.x_strides",u,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${l}
              value = x[offset];
          `},qi=(t,n,s)=>{let l="";for(let u=n-1;u>=0;--u)l+=`
                k = i32(${t.indicesGet("indices",u)}) - ${de("uniforms.pads",u,s)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${de("uniforms.x_shape",u,n)})) {
                  k = i32(${de("uniforms.x_shape",u,n)}) - 1;
                }
                offset += k * i32(${de("uniforms.x_strides",u,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${l}
              value = x[offset];
          `},Bc=(t,n,s)=>{let l="";for(let u=n-1;u>=0;--u)l+=`
                k = i32(${t.indicesGet("indices",u)}) - ${de("uniforms.pads",u,s)};
                if (k < 0)  {
                  k += i32(${de("uniforms.x_shape",u,n)}]);
                }
                if (k >= i32(${de("uniforms.x_shape",u,n)})) {
                  k -= i32(${de("uniforms.x_shape",u,n)});
                }
                offset += k * i32(${de("uniforms.x_strides",u,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${l}
              value = x[offset];
          `},Zf=(t,n,s)=>{switch(s.mode){case 0:return Ih(t,n,s.pads.length);case 1:return Xf(t,n,s.pads.length);case 2:return qi(t,n,s.pads.length);case 3:return Bc(t,n,s.pads.length);default:throw new Error("Invalid mode")}},ru=(t,n)=>{let s=pe.padShape(t[0].dims.slice(),n.pads),l=t[0].dims,u=pe.size(s),f=[{type:12,data:u},{type:6,data:n.pads}],p=t.length>=3&&t[2].data;n.mode===0&&f.push({type:p?t[2].dataType:1,data:n.value}),f.push(...Q(t[0].dims,s));let g=["rank"],b=v=>{let w=Ue("output",t[0].dataType,s.length),x=J("x",t[0].dataType,l.length),C=x.type.value,z=Zf(w,l.length,n),A=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:n.pads.length}];return n.mode===0&&A.push({name:"constant_value",type:p?C:"f32"}),`
            ${v.registerUniforms(A).declareVariables(x,w)}
            ${v.mainStart()}
            ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${w.offsetToIndices("global_idx")};

            var value = ${C}(0);
            ${z}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${n.mode}${p}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(pe.size(s)/64)},programUniforms:f}),getShaderSource:b}},io=(t,n)=>{if(t.length>1){let s=t[1].getBigInt64Array(),l=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,u=t[0].dims.length,f=new Int32Array(2*u).fill(0);if(t.length>=4){let g=t[3].getBigInt64Array();for(let b=0;b<g.length;b++)f[Number(g[b])]=Number(s[b]),f[Number(g[b])+u]=Number(s[b+g.length])}else s.forEach((g,b)=>f[Number(b)]=Number(g));let p=[];return f.forEach(g=>p.push(g)),{mode:n.mode,value:l,pads:p}}else return n},ta=(t,n)=>{Dc(t.inputs);let s=io(t.inputs,n);t.compute(ru(t.inputs,s),{inputs:[0]})}}),su,Nc,sl,ji,Uc,Jf,ro,Yn,Ic,Lc,ep,lu,qc,ou,jc,Gi,Ea,Gc,tp,Ia=T(()=>{oa(),rt(),He(),Ze(),su=t=>{if(Re.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},Nc=(t,n,s)=>{let l=n.format==="NHWC",u=t.dims.slice();l&&u.splice(1,0,u.pop());let f=Object.hasOwnProperty.call(n,"dilations"),p=n.kernelShape.slice(),g=n.strides.slice(),b=f?n.dilations.slice():[],v=n.pads.slice();xi.adjustPoolAttributes(s,u,p,g,b,v);let w=xi.computePoolOutputShape(s,u,g,b,p,v,n.autoPad),x=Object.assign({},n);f?Object.assign(x,{kernelShape:p,strides:g,pads:v,dilations:b,cacheKey:n.cacheKey}):Object.assign(x,{kernelShape:p,strides:g,pads:v,cacheKey:n.cacheKey});let C=w.slice();return C.push(C.splice(1,1)[0]),[x,l?C:w]},sl=(t,n)=>{let s=n.format==="NHWC",l=pe.size(t),u=pe.size(n.kernelShape),f=[{type:12,data:l},{type:12,data:u}],p=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(n.kernelShape.length<=2){let g=n.kernelShape[n.kernelShape.length-1],b=n.strides[n.strides.length-1],v=n.pads[n.pads.length/2-1],w=n.pads[n.pads.length-1],x=!!(v+w);f.push({type:12,data:g},{type:12,data:b},{type:12,data:v},{type:12,data:w}),p.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let C=!1;if(n.kernelShape.length===2){let z=n.kernelShape[n.kernelShape.length-2],A=n.strides[n.strides.length-2],B=n.pads[n.pads.length/2-2],L=n.pads[n.pads.length-2];C=!!(B+L),f.push({type:12,data:z},{type:12,data:A},{type:12,data:B},{type:12,data:L}),p.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[f,p,!0,x,C]}else{if(s)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let g=pe.computeStrides(n.kernelShape);f.push({type:12,data:g},{type:12,data:n.pads},{type:12,data:n.strides}),p.push({name:"kernelStrides",type:"u32",length:g.length},{name:"pads",type:"u32",length:n.pads.length},{name:"strides",type:"u32",length:n.strides.length});let b=n.pads.reduce((v,w)=>v+w);return[f,p,!!b,!1,!1]}},ji=(t,n,s,l,u,f,p,g,b,v,w,x)=>{let C=u.format==="NHWC",z=n.type.value,A=Ue("output",n.type.tensor,l);if(u.kernelShape.length<=2){let B="",L="",U="",N=s-(C?2:1);if(w?B=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${N}] = indices[${N}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${N}] < 0 || xIndices[${N}]
                      >= uniforms.x_shape[${N}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${n.indicesToOffset("xIndices")}];
                  ${f}
                }`:B=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${N}] = indices[${N}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${n.indicesToOffset("xIndices")}];
                  ${f}
                }`,u.kernelShape.length===2){let V=s-(C?3:2);x?L=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${V}] = indices[${V}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${V}] < 0 || xIndices[${V}] >= uniforms.x_shape[${V}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:L=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${V}] = indices[${V}] * uniforms.sh - uniforms.phStart + j;
                `,U=`
              }
            `}return`
            ${t.registerUniforms(b).declareVariables(n,A)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${A.offsetToIndices("global_idx")};
              var xIndices = ${A.offsetToIndices("global_idx")};

              var value = ${z}(${g});
              var pad = 0;
              ${L}
              ${B}
              ${U}
              ${p}

              output[global_idx] = value;
            }`}else{if(C)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let B=u.kernelShape.length,L=u.pads.length,U="";return v?U=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${n.indicesToOffset("xIndices")}];
                ${f}
              }`:U=`
              }
              let x_val = x[${n.indicesToOffset("xIndices")}];
              ${f}
            `,`
            ${t.registerUniforms(b).declareVariables(n,A)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${A.offsetToIndices("global_idx")};
              var xIndices = ${A.offsetToIndices("global_idx")};

              var offsets: array<u32, ${B}>;

              var value = ${z}(${g});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${B-1}u; j++) {
                  offsets[j] = offset / ${de("uniforms.kernelStrides","j",B)};
                  offset -= offsets[j] * ${de("uniforms.kernelStrides","j",B)};
                }
                offsets[${B-1}] = offset;

                isPad = false;
                for (var j = ${s-B}u; j < ${s}u; j++) {
                  xIndices[j] = indices[j] * ${de("uniforms.strides",`j - ${s-B}u`,B)}
                    + offsets[j - ${s-B}u] - ${de("uniforms.pads","j - 2u",L)};
                  ${U}
              }
              ${p}

              output[global_idx] = value;
            }`}},Uc=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,Jf=t=>`${Uc(t)};${t.countIncludePad}`,ro=t=>`${Uc(t)};${t.storageOrder};${t.dilations}`,Yn=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),Ic=(t,n,s,l)=>{let[u,f]=Nc(n,l,s),p=J("x",n.dataType,n.dims.length),g=p.type.value,b="value += x_val;",v="";u.countIncludePad?v+=`value /= ${g}(uniforms.kernelSize);`:v+=`value /= ${g}(i32(uniforms.kernelSize) - pad);`;let[w,x,C,z,A]=sl(f,u);w.push(...Q(n.dims,f));let B=["rank"];return{name:t,shaderCache:{hint:`${l.cacheKey};${C};${z};${A}`,inputDependencies:B},getRunData:()=>({outputs:[{dims:f,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(pe.size(f)/64)},programUniforms:w}),getShaderSource:L=>ji(L,p,n.dims.length,f.length,u,b,v,0,x,C,z,A)}},Lc=t=>{let n=t.count_include_pad!==0,s=Yn(t);if(s.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let l={countIncludePad:n,...s,cacheKey:""};return{...l,cacheKey:Jf(l)}},ep=(t,n)=>{su(t.inputs),t.compute(Ic("AveragePool",t.inputs[0],!1,n))},lu={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},qc=t=>{let n=t.format;return{format:n,...lu,cacheKey:n}},ou=(t,n)=>{su(t.inputs),t.compute(Ic("GlobalAveragePool",t.inputs[0],!0,n))},jc=(t,n,s,l)=>{let[u,f]=Nc(n,l,s),p=`
      value = max(x_val, value);
    `,g="",b=J("x",n.dataType,n.dims.length),v=["rank"],[w,x,C,z,A]=sl(f,u);return w.push(...Q(n.dims,f)),{name:t,shaderCache:{hint:`${l.cacheKey};${C};${z};${A}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:f,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(pe.size(f)/64)},programUniforms:w}),getShaderSource:B=>ji(B,b,n.dims.length,f.length,u,p,g,n.dataType===10?-65504:-1e5,x,C,z,A)}},Gi=(t,n)=>{su(t.inputs),t.compute(jc("MaxPool",t.inputs[0],!1,n))},Ea=t=>{let n=t.storage_order,s=t.dilations,l=Yn(t);if(n!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(l.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let u={storageOrder:n,dilations:s,...l,cacheKey:""};return{...u,cacheKey:ro(u)}},Gc=t=>{let n=t.format;return{format:n,...lu,cacheKey:n}},tp=(t,n)=>{su(t.inputs),t.compute(jc("GlobalMaxPool",t.inputs[0],!0,n))}}),Lh,ap,np,sa,yn=T(()=>{rt(),He(),I(),Ze(),Lh=(t,n)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((s,l)=>s===t[2].dims[l]).reduce((s,l)=>s&&l,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(n.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((u,f)=>f===n.axis||u===t[0].dims[f]).reduce((u,f)=>u&&f,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let s=t[0].dims[n.axis],l=t[1].dims[n.axis];if(n.blockSize<Math.ceil(s/l)||n.blockSize>Math.ceil(s/(l-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},ap=(t,n)=>{let s=pe.normalizeAxis(n.axis,t[0].dims.length),l=t[0].dataType,u=l===3,f=t[0].dims,p=t[1].dataType,g=pe.size(f),b=l===3||l===2,v=b?[Math.ceil(pe.size(t[0].dims)/4)]:t[0].dims,w=t[1].dims,x=t.length>2?t[2]:void 0,C=x?b?[Math.ceil(pe.size(x.dims)/4)]:x.dims:void 0,z=w.length===0||w.length===1&&w[0]===1,A=z===!1&&w.length===1,B=re(g),L=z&&(!b||B===4),U=L?B:1,N=L&&!b?B:1,V=J("input",b?12:l,v.length,N),G=J("scale",p,w.length),X=x?J("zero_point",b?12:l,C.length):void 0,ue=Ue("output",p,f.length,U),te=[V,G];X&&te.push(X);let ge=[v,w];x&&ge.push(C);let ve=[{type:12,data:g/U},{type:12,data:s},{type:12,data:n.blockSize},...Q(...ge,f)],Le=nt=>{let Fe=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${nt.registerUniforms(Fe).declareVariables(...te,ue)}
      ${nt.mainStart()}
          ${nt.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${ue.offsetToIndices("global_idx")};

          // Set input x
          ${b?`
            let input = ${V.getByOffset("global_idx / 4")};
            let x_vec = ${u?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${U===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${V.getByOffset("global_idx")};`};

          // Set scale input
          ${z?`let scale_value= ${G.getByOffset("0")}`:A?`
            let scale_index = ${ue.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${G.getByOffset("scale_index")};`:`
            var scale_indices: ${G.type.indices} = output_indices;
            let index = ${G.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${G.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${G.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${X?z?b?`
                let zero_point_input = ${X.getByOffset("0")};
                let zero_point_vec =  ${u?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${X.getByOffset("0")}`:A?b?`
                let zero_point_index = ${ue.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${X.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${u?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${ue.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${X.getByOffset("zero_point_index")};`:b?`
                let zero_point_offset = ${G.indicesToOffset("scale_indices")};
                let zero_point_input = ${X.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${u?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${X.getByIndices("scale_indices")};`:`let zero_point_value = ${b?u?"i32":"u32":V.type.value}(0);`};
      // Compute and write output
      ${ue.setByOffset("global_idx",`${ue.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:n.cacheKey,inputDependencies:X?["rank","rank","rank"]:["rank","rank"]},getShaderSource:Le,getRunData:()=>({outputs:[{dims:f,dataType:p}],dispatchGroup:{x:Math.ceil(g/U/64),y:1,z:1},programUniforms:ve})}},np=(t,n)=>{Lh(t.inputs,n),t.compute(ap(t.inputs,n))},sa=t=>O({axis:t.axis,blockSize:t.blockSize})}),Vi,ip,rp,qh=T(()=>{oa(),rt(),Ze(),Vi=(t,n,s)=>{let l=t===n,u=t<n&&s<0,f=t>n&&s>0;if(l||u||f)throw new Error("Range these inputs' contents are invalid.")},ip=(t,n,s,l)=>{let u=Math.abs(Math.ceil((n-t)/s)),f=[u],p=u,g=[{type:12,data:p},{type:l,data:t},{type:l,data:s},...Q(f)],b=v=>{let w=Ue("output",l,f.length),x=w.type.value,C=[{name:"outputSize",type:"u32"},{name:"start",type:x},{name:"delta",type:x}];return`
        ${v.registerUniforms(C).declareVariables(w)}
        ${v.mainStart()}
        ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${x}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${l}`},getShaderSource:b,getRunData:()=>({outputs:[{dims:f,dataType:l}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:g})}},rp=t=>{let n=0,s=0,l=0;t.inputs[0].dataType===6?(n=t.inputs[0].getInt32Array()[0],s=t.inputs[1].getInt32Array()[0],l=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(n=t.inputs[0].getFloat32Array()[0],s=t.inputs[1].getFloat32Array()[0],l=t.inputs[2].getFloat32Array()[0]),Re.webgpu.validateInputContent&&Vi(n,s,l),t.compute(ip(n,s,l,t.inputs[0].dataType),{inputs:[]})}}),jh,uu,on,Xn,Gh=T(()=>{rt(),He(),I(),Ze(),jh=(t,n,s,l)=>{if(t!=="none"&&l!=="i32"&&l!=="u32"&&l!=="f32")throw new Error(`Input ${l} is not supported with reduction ${t}.`);let u=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,f=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${n}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${n}=${s};`;case"add":return l==="i32"||l==="u32"?`atomicAdd(&${n}, bitcast<${l}>(${s}));`:`
              ${u}bitcast<${l}>(oldValue) + (${s})${f}`;case"max":return l==="i32"||l==="u32"?`atomicMax(&${n}, bitcast<${l}>(${s}));`:`
                ${u}max(bitcast<f32>(oldValue), (${s}))${f}`;case"min":return l==="i32"||l==="u32"?`atomicMin(&${n}, bitcast<${l}>(${s}));`:`${u}min(bitcast<${l}>(oldValue), (${s}))${f}`;case"mul":return`${u}(bitcast<${l}>(oldValue) * (${s}))${f}`;default:throw new Error(`Reduction ${t} is not supported.`)}},uu=(t,n)=>{let s=t[0].dims,l=t[1].dims,u=s,f=1,p=Math.ceil(pe.sizeToDimension(l,l.length-1)/f),g=l[l.length-1],b=pe.sizeFromDimension(s,g),v=[{type:12,data:p},{type:12,data:g},{type:12,data:b},...Q(t[1].dims,t[2].dims,u)],w=x=>{let C=J("indices",t[1].dataType,t[1].dims.length),z=J("updates",t[2].dataType,t[2].dims.length,f),A=n.reduction!=="none"&&n.reduction!==""?Jt("output",t[0].dataType,u.length):Ue("output",t[0].dataType,u.length,f);return`
      ${x.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(C,z,A)}
      ${x.mainStart()}
        ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${t[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${jh(n.reduction,"output[data_offset + i]","value",A.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${n.cacheKey}_${n.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:v}),getShaderSource:w}},on=t=>O({reduction:t.reduction}),Xn=(t,n)=>{t.compute(uu(t.inputs,n),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),un,sp,Hi,Er,Pi,Vc,Hc,Zn,lp,ll,so,lo,ps,op,up,oo,cp,cu,dp,Vh,km=T(()=>{rt(),He(),I(),Ze(),un=(t,n)=>{if(t.every(s=>s>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(n.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(n.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},sp=(t,n,s)=>{n.every(u=>u>=0&&u<s||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let l=new Array(s).fill(1);return n.forEach((u,f)=>l[u]=t[f]),l},Hi=(t,n,s,l,u,f)=>{let[p,g,b]=s>10?[1,2,3]:[-1,t.length>1?1:-1,-1],v=t[0].dims.length;if(p>0&&t.length>p&&t[p].dims.length>0)t[p].getFloat32Array().forEach(w=>f.push(w));else if(n.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(g>0&&t.length>g&&t[g].dims.length===1&&t[g].dims[0]>0){if(t[g].getFloat32Array().forEach(w=>l.push(w)),l.length!==0&&l.length!==v&&s>=18&&l.length!==n.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");un(l,n),n.axes.length>0&&sp(l,n.axes,v).forEach((w,x)=>l[x]=w)}if(b>0&&t.length>b&&t[b].dims.length===1&&t[b].dims[0]>0&&(t[b].getBigInt64Array().forEach(w=>u.push(Number(w))),u.length!==0&&u.length!==v&&s>=18&&u.length!==n.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(n.axes.length>0){if(l.length!==0&&l.length!==n.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(u.length!==0&&u.length!==n.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof l<"u"&&typeof u<"u"&&l.length>0&&u.length>v)throw new Error("Resize requires only of scales or sizes to be specified")},Er=(t,n,s,l)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${n});
  let whole = ${l}(big / (${s}));
  let fract = ${l}(big % (${s})) / ${l}(${s});
  return whole + fract;
`,Pi=(t,n)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${n} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${n}(xResized) / ${n}(xScale);
          } else {
            ${Er("xResized","lengthOriginal","lengthResized",n)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${n}(xResized) + 0.5) / ${n}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${n}(xResized) + 0.5) / ${n}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Er("xResized","lengthOriginal - 1","lengthResized - 1",n)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${n}(roiStart) * ${n}(lengthOriginal - 1) +
                        (${n}(xResized) * ${n}(roiEnd - roiStart) * ${n}(lengthOriginal - 1)) /
                        ${n}(lengthResized - 1);
                  } else {
                    return 0.5 * ${n}(roiStart + roiEnd) * ${n}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${n}xScale * ${n}(lengthResized);
                  const adjustment = ${n}(lengthResized) / outputWidth;
                  const center = ${n}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${n}(xResized) + 0.5) / ${n}(xScale)) - 0.5;`;case"half_pixel":return`return ((${n}(xResized) + 0.5) / ${n}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",Vc=(t,n,s)=>`fn getNearestPixelFromOriginal(xOriginal: ${s}, isDownSample: bool) -> ${s} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(n<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",Hc=(t,n,s)=>{let l=new Array(s).fill(0).concat(new Array(s).fill(1)),u=t.length===0?l:t.slice();return n.length>0?(n.forEach((f,p)=>{l[f]=u[p],l[p+s]=u[n.length+p]}),l):u},Zn=(t,n,s,l)=>{let u=[];if(s.length>0)if(l.length>0){if(t.forEach(f=>u.push(f)),Math.max(...l)>t.length)throw new Error("axes is out of bound");l.forEach((f,p)=>u[f]=s[p])}else s.forEach(f=>u.push(f));else{if(n.length===0)throw new Error("Resize requires either scales or sizes.");u=t.map((f,p)=>Math.round(f*n[p]))}return u},lp=(t,n,s)=>{let l=(()=>{switch(s.keepAspectRatioPolicy){case"not_larger":return s.axes.length>0?Math.min(...s.axes.map(f=>n[f]),Number.MAX_VALUE):Math.min(...n,Number.MAX_VALUE);case"not_smaller":return s.axes.length>0?Math.max(...s.axes.map(f=>n[f]),Number.MIN_VALUE):Math.max(...n,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${s.keepAspectRatioPolicy} is not supported`)}})();n.fill(1,0,n.length);let u=t.slice();return s.axes.length>0?(s.axes.forEach(f=>n[f]=l),s.axes.forEach(f=>u[f]=Math.round(t[f]*n[f]))):(n.fill(l,0,n.length),u.forEach((f,p)=>u[p]=Math.round(f*n[p]))),u},ll=(t,n,s,l,u)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${s.length}> {
      var original_indices: array<${t.type.value}, ${s.length}>;
      for (var i:u32 = 0; i < ${s.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${de("uniforms.scales","i",l)};
        var roi_low = ${de("uniforms.roi","i",u)};
        var roi_hi = ${de("uniforms.roi",`i + ${n.length}`,u)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${de("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${de("uniforms.output_shape","i",s.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,so=(t,n,s,l,u,f,p)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${n.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${l.length}; i++) {
        var output_index = ${n.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${de("uniforms.scales","i",u)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${de("uniforms.roi","i",f)};
          var roi_hi = ${de("uniforms.roi",`i + ${s.length}`,f)};
          var input_shape_i = ${de("uniforms.input_shape","i",s.length)};
          var output_shape_i = ${de("uniforms.output_shape","i",l.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${p} || (original_idx >= 0 && original_idx < ${n.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${n.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,lo=(t,n)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${de("uniforms.input_shape","i",n.length)}) {
          return false;
        }
      }
      return true;
    }`,ps=(t,n,s,l)=>t.rank>l?`
    ${t.indicesSet("input_indices",n,"channel")};
    ${t.indicesSet("input_indices",s,"batch")};
`:"",op=(t,n,s,l,u)=>{let[f,p,g,b]=s.length===2?[-1,0,1,-1]:[0,2,3,1],v=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${v} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",p,`max(0, min(row, ${s[p]} - 1))`)};
      ${t.indicesSet("input_indices",g,`max(0, min(col, ${s[g]} - 1))`)};
      ${ps(t,b,f,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${n.type.indices}) -> ${v} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${v} = originalIndices[${p}];
      var col:${v} = originalIndices[${g}];
      ${l?`if (row < 0 || row > (${s[p]} - 1) || col < 0 || col > (${s[g]} - 1)) {
        return ${u};
      }`:""};
      row = max(0, min(row, ${s[p]} - 1));
      col = max(0, min(col, ${s[g]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${s.length>2?`u32(originalIndices[${b}])`:"0"};
      var batch: u32 =  ${s.length>2?`u32(originalIndices[${f}])`:"0"};
      var x11: ${v} = getInputValue(batch, channel, row1, col1);
      var x12: ${v} = getInputValue(batch, channel, row1, col2);
      var x21: ${v} = getInputValue(batch, channel, row2, col1);
      var x22: ${v} = getInputValue(batch, channel, row2, col2);
      var dx1: ${v} = abs(row - ${v}(row1));
      var dx2: ${v} = abs(${v}(row2) - row);
      var dy1: ${v} = abs(col - ${v}(col1));
      var dy2: ${v} = abs(${v}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},up=(t,n,s,l,u,f,p,g,b,v)=>{let w=s.length===2,[x,C]=w?[0,1]:[2,3],z=t.type.value,A=B=>{let L=B===x?"row":"col";return`
      fn ${L}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${n.type.indices}) -> ${z} {
        var output_index = ${n.indicesGet("output_indices",B)};
        var originalIdx: ${z} = getOriginalCoordinateFromResizedCoordinate(output_index, ${u[B]},
        ${l[B]}, ${s[B]}, ${f[B]}, ${f[B]} + ${s.length});
        var fractOriginalIdx: ${z} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${g} && (originalIdx < 0 || originalIdx > (${s[B]} - 1))) {
          return ${b};
        }
        var data: array<${z}, 4> = array<${z}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${L}: ${z} = originalIdx + ${z}(i);
          if (${L} < 0 || ${L} >= ${s[B]}) {
            ${v?`coefs[i + 1] = 0.0;
                        continue;`:g?`return ${b};`:`${L} = max(0, min(${L}, ${s[B]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",B,`u32(${L})`)};
          data[i + 1] = ${B===x?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${A(x)};
    ${A(C)};
  fn getCubicInterpolationCoefs(s: ${z}) -> array<${z}, 4> {
    var absS = abs(s);
    var coeffs: array<${z}, 4> = array<${z}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${z} = 1.0 - absS;
    var twoMinusAbsS: ${z} = 2.0 - absS;
    var onePlusAbsS: ${z} = 1.0 + absS;
    coeffs[0] = ((${p} * onePlusAbsS - 5 * ${p}) * onePlusAbsS + 8 * ${p}) * onePlusAbsS - 4 * ${p};
    coeffs[1] = ((${p} + 2) * absS - (${p} + 3)) * absS * absS + 1;
    coeffs[2] = ((${p} + 2) * oneMinusAbsS - (${p} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${p} * twoMinusAbsS - 5 * ${p}) * twoMinusAbsS + 8 * ${p}) * twoMinusAbsS - 4 * ${p};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${z}, 4>, coefs: array<${z}, 4>) -> ${z} {
    var coefsSum: ${z} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${n.type.indices}) -> ${z} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},oo=(t,n,s,l,u)=>{let[f,p,g,b,v]=s.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],w=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${w} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",p,`max(0, min(depth, ${s[p]} - 1))`)};
      ${t.indicesSet("input_indices",g,`max(0, min(height, ${s[g]} - 1))`)};
      ${t.indicesSet("input_indices",b,`max(0, min(width, ${s[b]} - 1))`)};
      ${ps(t,v,f,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${n.type.indices}) -> ${w} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${w} = originalIndices[${p}];
      var height:${w} = originalIndices[${g}];
      var width:${w} = originalIndices[${b}];
      ${l?`if (depth < 0 || depth > (${s[p]} - 1) || height < 0 || height > (${s[g]} - 1) || width < 0 || (width > ${s[b]} - 1)) {
      return ${u};
        }`:""};

    depth = max(0, min(depth, ${s[p]} - 1));
      height = max(0, min(height, ${s[g]} - 1));
      width = max(0, min(width, ${s[b]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${s.length>3?`u32(originalIndices[${v}])`:"0"};
      var batch: u32 =  ${s.length>3?`u32(originalIndices[${f}])`:"0"};

      var x111: ${w} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${w} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${w} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${w} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${w} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${w} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${w} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${w} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${w} = abs(depth - ${w}(depth1));
      var dx2: ${w} = abs(${w}(depth2) - depth);
      var dy1: ${w} = abs(height - ${w}(height1));
      var dy2: ${w} = abs(${w}(height2) - height);
      var dz1: ${w} = abs(width - ${w}(width1));
      var dz2: ${w} = abs(${w}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},cp=(t,n,s,l,u,f)=>{let p=t.dims,g=Hc(f,n.axes,p.length),b=Zn(p,l,u,n.axes),v=l.slice();l.length===0&&(v=p.map((N,V)=>N===0?1:b[V]/N),n.keepAspectRatioPolicy!=="stretch"&&(b=lp(p,v,n)));let w=Ue("output",t.dataType,b.length),x=J("input",t.dataType,p.length),C=pe.size(b),z=p.length===b.length&&p.every((N,V)=>N===b[V]),A=n.coordinateTransformMode==="tf_crop_and_resize",B=n.extrapolationValue,L=x.type.value,U=N=>`
      ${z?"":`
      ${Pi(n.coordinateTransformMode,L)};
      ${(()=>{switch(n.mode){case"nearest":return`
              ${lo(x,p)};
              ${Vc(n.nearestMode,s,L)};
              ${so(x,w,p,b,v.length,g.length,A)};
              `;case"linear":return`
              ${ll(w,p,b,v.length,g.length)};
              ${(()=>{if(p.length===2||p.length===4)return`${op(x,w,p,A,B)}`;if(p.length===3||p.length===5)return`${oo(x,w,p,A,B)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(p.length===2||p.length===4)return`${up(x,w,p,b,v,g,n.cubicCoeffA,A,n.extrapolationValue,n.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${N.registerUniform("output_size","u32").registerUniform("scales","f32",v.length).registerUniform("roi","f32",g.length).declareVariables(x,w)}
      ${N.mainStart()}
        ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${z?"output[global_idx] = input[global_idx];":`
        let output_indices = ${w.offsetToIndices("global_idx")};
        var input_indices: ${x.type.indices};
        ${(()=>{switch(n.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${x.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${n.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${p.length===2||p.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${n.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${n.cacheKey}|${s}|${v.length>0?n.mode==="cubic"?v:v.length:""}|${u.length>0?u:""}|${g.length>0?g:""}|${z}|${n.mode==="nearest"?p.length:p}`,inputDependencies:["rank"]},getShaderSource:U,getRunData:()=>({outputs:[{dims:b,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(C/64)},programUniforms:[{type:12,data:C},{type:1,data:v},{type:1,data:g},...Q(p,b)]})}},cu=t=>{let n=t.customDataBuffer;return new Uint32Array(n,n.byteOffset,1)[0]},dp=(t,n)=>{let s=[],l=[],u=[],f=cu(t);if(n.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Hi(t.inputs,n,f,s,l,u),t.compute(cp(t.inputs[0],n,f,s,l,u),{inputs:[0]})},Vh=t=>{let n=t.antialias,s=t.axes,l=t.coordinateTransformMode,u=t.cubicCoeffA,f=t.excludeOutside!==0,p=t.extrapolationValue,g=t.keepAspectRatioPolicy,b=t.mode,v=t.nearestMode===""?"simple":t.nearestMode;return O({antialias:n,axes:s,coordinateTransformMode:l,cubicCoeffA:u,excludeOutside:f,extrapolationValue:p,keepAspectRatioPolicy:g,mode:b,nearestMode:v})}}),qt,Wt,Ot,kt=T(()=>{rt(),He(),Ze(),qt=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let n=t[0],s=t[1],l=t[2];if(n.dataType!==s.dataType||n.dataType!==l.dataType)throw new Error("All inputs must have the same data type");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Input must be 2D or 3D");if(s.dims.length!==3&&s.dims.length!==2)throw new Error("Skip must be 2D or 3D");let u=n.dims[n.dims.length-1],f=n.dims[n.dims.length-2];if(s.dims[s.dims.length-1]!==u)throw new Error("Skip must have the same hidden size as input");if(s.dims[s.dims.length-2]!==f)throw new Error("Skip must have the same sequence length as input");if(l.dims.length!==1)throw new Error("Gamma must be 1D");if(l.dims[l.dims.length-1]!==u)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let p=t[3];if(p.dims.length!==1)throw new Error("Beta must be 1D");if(p.dims[p.dims.length-1]!==u)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let p=t[4];if(p.dims.length!==1)throw new Error("Bias must be 1D");if(p.dims[p.dims.length-1]!==u)throw new Error("Bias must have the same hidden size as input")}},Wt=(t,n,s,l)=>{let u=n.simplified,f=t[0].dims,p=pe.size(f),g=f,b=p,v=f.slice(-1)[0],w=l?f.slice(0,-1).concat(1):[],x=!u&&t.length>3,C=t.length>4,z=l&&s>1,A=l&&s>2,B=s>3,L=64,U=re(v),N=[{type:12,data:b},{type:12,data:U},{type:12,data:v},{type:1,data:n.epsilon}],V=X=>{let ue=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],te=[J("x",t[0].dataType,t[0].dims,U),J("skip",t[1].dataType,t[1].dims,U),J("gamma",t[2].dataType,t[2].dims,U)];x&&te.push(J("beta",t[3].dataType,t[3].dims,U)),C&&te.push(J("bias",t[4].dataType,t[4].dims,U)),te.push(Ue("output",t[0].dataType,g,U)),z&&te.push(Ue("mean_output",1,w)),A&&te.push(Ue("inv_std_output",1,w)),B&&te.push(Ue("input_skip_bias_sum",t[0].dataType,g,U));let ge=ae(t[0].dataType),ve=ae(1,U);return`

      ${X.registerUniforms(ue).declareVariables(...te)}
      var<workgroup> sum_shared : array<${ve}, ${L}>;
      var<workgroup> sum_squared_shared : array<${ve}, ${L}>;

      ${X.mainStart([L,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${L};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${L};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${L-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${C?"bias[offset1d + i]":ge+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${B?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${ke(ge,U,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${L};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${xe("sum",U)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${xe("square_sum",U)} / f32(uniforms.hidden_size) ${u?"":"- mean * mean"} + uniforms.epsilon);
        ${z?"mean_output[global_idx] = mean;":""}
        ${A?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${u?"":`- ${ge}(mean)`}) *
            ${ge}(inv_std_dev) * gamma[offset1d + i]
            ${x?"+ beta[offset1d + i]":""};
        }
      }`},G=[{dims:g,dataType:t[0].dataType}];return s>1&&G.push({dims:w,dataType:1}),s>2&&G.push({dims:w,dataType:1}),s>3&&G.push({dims:f,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${U};${z};${A};${B}`,inputDependencies:t.map((X,ue)=>"type")},getShaderSource:V,getRunData:()=>({outputs:G,dispatchGroup:{x:Math.ceil(b/v)},programUniforms:N})}},Ot=(t,n)=>{qt(t.inputs);let s=[0];t.outputCount>1&&s.push(-3),t.outputCount>2&&s.push(-3),t.outputCount>3&&s.push(3),t.compute(Wt(t.inputs,n,t.outputCount,!1),{outputs:s})}}),Vt,Ka,Tr,hs,Pc,Fi,da,Cr,ol=T(()=>{rt(),He(),I(),Ze(),Vt=(t,n)=>{if(!t||t.length<1)throw new Error("too few inputs");if(n.axes.length!==0){if(n.axes.length!==n.starts.length||n.axes.length!==n.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(n.starts.length!==n.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((s,l)=>{if(t[l+1].dataType!==6&&t[l+1].dataType!==7)throw new Error(`Input ${l} must be an array of int32 or int64`)})},Ka=(t,n)=>{let s=[];if(t.length>n)if(t[n].dataType===7)t[n].getBigInt64Array().forEach(l=>s.push(Number(l)));else if(t[n].dataType===6)t[n].getInt32Array().forEach(l=>s.push(Number(l)));else throw new Error(`Input ${n} must be an array of int32 or int64`);return s},Tr=(t,n)=>{if(t.length>1){let s=Ka(t,1),l=Ka(t,2),u=Ka(t,3);return u.length===0&&(u=[...Array(t[0].dims.length).keys()]),O({starts:s,ends:l,axes:u})}else return n},hs=(t,n,s,l,u)=>{let f=t;return t<0&&(f+=s[l[n]]),u[n]<0?Math.max(0,Math.min(f,s[l[n]]-1)):Math.max(0,Math.min(f,s[l[n]]))},Pc=(t,n,s)=>`fn calculateInputIndices(output_indices: ${n.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${s.length-1}; i >= 0; i--) {
            let input_shape_i = ${de("uniforms.input_shape","i",s.length)};
            let steps_i = ${de("uniforms.steps","i",s.length)};
            let signs_i = ${de("uniforms.signs","i",s.length)};
            let starts_i = ${de("uniforms.starts","i",s.length)};
            var output_index = ${n.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,Fi=(t,n)=>{let s=t[0].dims,l=pe.size(s),u=n.axes.length>0?pe.normalizeAxes(n.axes,s.length):[...Array(s.length).keys()],f=Ka(t,4);f.forEach(U=>U!==0||(()=>{throw new Error("step cannot be 0")})),f.length===0&&(f=Array(u.length).fill(1));let p=n.starts.map((U,N)=>hs(U,N,s,u,f)),g=n.ends.map((U,N)=>hs(U,N,s,u,f));if(u.length!==p.length||u.length!==g.length)throw new Error("start, ends and axes should have the same number of elements");if(u.length!==s.length)for(let U=0;U<s.length;++U)u.includes(U)||(p.splice(U,0,0),g.splice(U,0,s[U]),f.splice(U,0,1));let b=f.map(U=>Math.sign(U));f.forEach((U,N,V)=>{if(U<0){let G=(g[N]-p[N])/U,X=p[N],ue=X+G*f[N];p[N]=ue,g[N]=X,V[N]=-U}});let v=s.slice(0);u.forEach((U,N)=>{v[U]=Math.ceil((g[U]-p[U])/f[U])});let w={dims:v,dataType:t[0].dataType},x=Ue("output",t[0].dataType,v.length),C=J("input",t[0].dataType,t[0].dims.length),z=pe.size(v),A=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:p.length},{name:"signs",type:"i32",length:b.length},{name:"steps",type:"u32",length:f.length}],B=[{type:12,data:z},{type:12,data:p},{type:6,data:b},{type:12,data:f},...Q(t[0].dims,v)],L=U=>`
      ${U.registerUniforms(A).declareVariables(C,x)}
        ${Pc(C,x,s)}
        ${U.mainStart()}
          ${U.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${x.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${x.setByOffset("global_idx",C.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${b.length}_${p.length}_${f.length}`,inputDependencies:["rank"]},getShaderSource:L,getRunData:()=>({outputs:[w],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:B})}},da=(t,n)=>{Vt(t.inputs,n);let s=Tr(t.inputs,n);t.compute(Fi(t.inputs,s),{inputs:[0]})},Cr=t=>{let n=t.starts,s=t.ends,l=t.axes;return O({starts:n,ends:s,axes:l})}}),Fc,vn,ul,uo,bn=T(()=>{rt(),He(),I(),Oa(),Ze(),Fc=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},vn=(t,n)=>{let s=t.inputs[0],l=s.dims,u=pe.size(l),f=l.length,p=pe.normalizeAxis(n.axis,f),g=p<l.length-1,b,v=[];g?(v=Array.from({length:f},(te,ge)=>ge),v[p]=f-1,v[f-1]=p,b=t.compute(Ya(s,v),{inputs:[s],outputs:[-1]})[0]):b=s;let w=b.dims,x=w[f-1],C=u/x,z=re(x),A=x/z,B=64;C===1&&(B=256);let L=(te,ge)=>ge===4?`max(max(${te}.x, ${te}.y), max(${te}.z, ${te}.w))`:ge===2?`max(${te}.x, ${te}.y)`:ge===3?`max(max(${te}.x, ${te}.y), ${te}.z)`:te,U=J("x",b.dataType,b.dims,z),N=Ue("result",b.dataType,b.dims,z),V=U.type.value,G=ae(b.dataType)==="f32"?`var threadMax = ${V}(-3.4028234663852886e+38f);`:`var threadMax = ${V}(-65504.0h);`,X=te=>`
      var<workgroup> rowMaxShared : ${V};
      var<workgroup> rowSumShared : ${V};
      var<workgroup> threadShared : array<${V}, ${B}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${V} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${V}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${te.registerUniform("packedCols","i32").declareVariables(U,N)}
      ${te.mainStart(B)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${B};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${G}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${V}(${L("threadShared[0]",z)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${V}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${V}(${xe("threadShared[0]",z)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${V}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,ue=t.compute({name:"Softmax",shaderCache:{hint:`${z};${B}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:w,dataType:b.dataType}],dispatchGroup:{x:C},programUniforms:[{type:6,data:A}]}),getShaderSource:X},{inputs:[b],outputs:[g?-1:0]})[0];g&&t.compute(Ya(ue,v),{inputs:[ue]})},ul=(t,n)=>{Fc(t.inputs),vn(t,n)},uo=t=>O({axis:t.axis})}),du,fu,fp,pu,hu,ms=T(()=>{rt(),He(),Ze(),du=t=>Array.from(t.getBigInt64Array(),Number),fu=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(du(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},fp=(t,n)=>{let s=[];for(let l=0;l<t.length;++l)s.push(t[l]*n[l]);return s},pu=(t,n)=>{let s=t[0].dims,l=n??du(t[1]),u=fp(s,l),f=pe.size(u),p=t[0].dataType,g=J("input",p,s.length),b=Ue("output",p,u.length),v=w=>`
      const inputShape = ${g.indices(...s)};
      ${w.registerUniform("output_size","u32").declareVariables(g,b)}
      ${w.mainStart()}
      ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${b.offsetToIndices("global_idx")};
      var input_indices: ${g.type.indices};
      for (var i = 0; i < ${s.length}; i++) {
        let input_dim_i = ${g.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${b.indicesGet("output_indices","i")}  % input_dim_i;

        ${g.indicesSet("input_indices","i","input_dim_value")}
      }
      ${b.setByOffset("global_idx",g.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${l}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},...Q(t[0].dims,u)]}),getShaderSource:v}},hu=t=>{fu(t.inputs),t.compute(pu(t.inputs),{inputs:[0]})}}),Ta,zr,cl,Ar=T(()=>{rt(),He(),Ze(),Ta=(t,n,s,l,u)=>{let f=Ue("output_data",u,s.length,4),p=J("a_data",n[1].dataType,n[1].dims.length,4),g=J("b_data",n[2].dataType,n[2].dims.length,4),b=J("c_data",n[0].dataType,n[0].dims.length,4),v,w=(x,C,z)=>`select(${C}, ${x}, ${z})`;if(!l)v=f.setByOffset("global_idx",w(p.getByOffset("global_idx"),g.getByOffset("global_idx"),b.getByOffset("global_idx")));else{let x=(C,z,A="")=>{let B=`a_data[index_a${z}][component_a${z}]`,L=`b_data[index_b${z}][component_b${z}]`,U=`bool(c_data[index_c${z}] & (0xffu << (component_c${z} * 8)))`;return`
            let output_indices${z} = ${f.offsetToIndices(`global_idx * 4u + ${z}u`)};
            let offset_a${z} = ${p.broadcastedIndicesToOffset(`output_indices${z}`,f)};
            let offset_b${z} = ${g.broadcastedIndicesToOffset(`output_indices${z}`,f)};
            let offset_c${z} = ${b.broadcastedIndicesToOffset(`output_indices${z}`,f)};
            let index_a${z} = offset_a${z} / 4u;
            let index_b${z} = offset_b${z} / 4u;
            let index_c${z} = offset_c${z} / 4u;
            let component_a${z} = offset_a${z} % 4u;
            let component_b${z} = offset_b${z} % 4u;
            let component_c${z} = offset_c${z} % 4u;
            ${C}[${z}] = ${A}(${w(B,L,U)});
          `};u===9?v=`
            var data = vec4<u32>(0);
            ${x("data",0,"u32")}
            ${x("data",1,"u32")}
            ${x("data",2,"u32")}
            ${x("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:v=`
            ${x("output_data[global_idx]",0)}
            ${x("output_data[global_idx]",1)}
            ${x("output_data[global_idx]",2)}
            ${x("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(b,p,g,f)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${v}
      }`},zr=t=>{let n=t[1].dims,s=t[2].dims,l=t[0].dims,u=t[1].dataType,f=!(pe.areEqual(n,s)&&pe.areEqual(s,l)),p=n,g=pe.size(n);if(f){let v=qn.calcShape(qn.calcShape(n,s,!1),l,!1);if(!v)throw new Error("Can't perform where op on the given tensors");p=v,g=pe.size(p)}let b=Math.ceil(g/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:v=>Ta(v,t,p,f,u),getRunData:()=>({outputs:[{dims:p,dataType:u}],dispatchGroup:{x:Math.ceil(g/64/4)},programUniforms:[{type:12,data:b},...Q(l,n,s,p)]})}},cl=t=>{t.compute(zr(t.inputs))}}),Kc,pp=T(()=>{ph(),ql(),Pu(),Ku(),Xs(),Rm(),_h(),Kt(),$h(),ef(),gc(),lf(),pf(),Eh(),Jl(),Ch(),Ah(),Oh(),Cf(),Dh(),Cc(),Uh(),Ff(),Wf(),Sr(),Df(),Mm(),Ia(),yn(),qh(),Gh(),as(),km(),qf(),kt(),ol(),bn(),Bh(),ms(),Oa(),Go(),Ar(),Kc=new Map([["Abs",[mn]],["Acos",[Wu]],["Acosh",[Oi]],["Add",[gh]],["ArgMax",[ns,ju]],["ArgMin",[Dd,ju]],["Asin",[Id]],["Asinh",[Lo]],["Atan",[rs]],["Atanh",[Qu]],["Attention",[Fn]],["AveragePool",[ep,Lc]],["BatchNormalization",[Io]],["BiasAdd",[Ud]],["BiasSplitGelu",[Vo]],["Cast",[Yu,Ld]],["Ceil",[Ks]],["Clip",[Rn]],["Concat",[rc,Po]],["Conv",[yt,ln]],["ConvTranspose",[pc,rl]],["Cos",[Ws]],["Cosh",[qo]],["CumSum",[Sh,hc]],["DepthToSpace",[Yo,Yl]],["DequantizeLinear",[np,sa]],["Div",[yh]],["Einsum",[rf,sf]],["Elu",[Mn,dr]],["Equal",[vh]],["Erf",[fr]],["Exp",[oi]],["Expand",[ff]],["FastGelu",[mf]],["Floor",[ui]],["FusedConv",[yt,ln]],["Gather",[vf,Th]],["GatherElements",[Sf,wc]],["GatherBlockQuantized",[_f,wf]],["GatherND",[Xo,Zo]],["Gelu",[Ri]],["Gemm",[Rh,Tf]],["GlobalAveragePool",[ou,qc]],["GlobalMaxPool",[tp,Gc]],["Greater",[Vl]],["GreaterOrEqual",[Zs]],["GridSample",[Rf,to]],["GroupQueryAttention",[Vf]],["HardSigmoid",[pr,Mt]],["InstanceNormalization",[Ac]],["LayerNormalization",[Oc]],["LeakyRelu",[jd,dr]],["Less",[ic]],["LessOrEqual",[Js]],["Log",[ss]],["MatMul",[Kf]],["MatMulNBits",[kc,Yf]],["MaxPool",[Gi,Ea]],["Mul",[$a]],["MultiHeadAttention",[fs,Sc]],["Neg",[Zu]],["Not",[Xu]],["Pad",[ta]],["Pow",[nc]],["QuickGelu",[ki,dr]],["Range",[rp]],["Reciprocal",[Gd]],["ReduceMin",[Lu]],["ReduceMean",[Rd]],["ReduceMax",[Hs]],["ReduceSum",[qu]],["ReduceProd",[Il]],["ReduceL1",[Md]],["ReduceL2",[Iu]],["ReduceLogSum",[ts]],["ReduceLogSumExp",[fh]],["ReduceSumSquare",[kd]],["Relu",[Ba]],["Resize",[dp,Vh]],["RotaryEmbedding",[Ua]],["ScatterND",[Xn,on]],["Sigmoid",[ea]],["Sin",[kn]],["Sinh",[Ju]],["Slice",[da,Cr]],["SkipLayerNormalization",[Ot]],["Split",[If,Lf]],["Sqrt",[hr]],["Softmax",[ul,uo]],["Sub",[Gl]],["Tan",[Vd]],["Tanh",[Qs]],["ThresholdedRelu",[tc,dr]],["Tile",[hu]],["Transpose",[ko,Do]],["Where",[cl]]])}),hp,mu=T(()=>{oa(),Tn(),Ze(),hp=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,n){this.repo.set(t,n)}run(t,n,s,l,u){ia(t.programInfo.name);let f=this.backend.device,p=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let g=[];for(let v of n)g.push({binding:g.length,resource:{buffer:v.buffer}});for(let v of s)g.push({binding:g.length,resource:{buffer:v.buffer}});u&&g.push({binding:g.length,resource:u});let b=f.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:g,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let v={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:b,dispatchGroup:l};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(v)}p.setPipeline(t.computePipeline),p.setBindGroup(0,b),p.dispatchWorkgroups(...l),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),ga(t.programInfo.name)}dispose(){}build(t,n){ia(t.name);let s=this.backend.device,l=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(v=>{s.features.has(v.feature)&&l.push(`enable ${v.extension};`)});let u=Gt(n,this.backend.device.limits),f=t.getShaderSource(u),p=`${l.join(`
`)}
${u.additionalImplementations}
${f}`,g=s.createShaderModule({code:p,label:t.name});gt("verbose",()=>`[WebGPU] ${t.name} shader code: ${p}`);let b=s.createComputePipeline({compute:{module:g,entryPoint:"main"},layout:"auto",label:t.name});return ga(t.name),{programInfo:t,computePipeline:b,uniformVariablesInfo:u.variablesInfo}}normalizeDispatchGroupSize(t){let n=typeof t=="number"?t:t.x,s=typeof t=="number"?1:t.y||1,l=typeof t=="number"?1:t.z||1,u=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(n<=u&&s<=u&&l<=u)return[n,s,l];let f=n*s*l,p=Math.ceil(Math.sqrt(f));if(p>u){if(p=Math.ceil(Math.cbrt(f)),p>u)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[p,p,p]}else return[p,p,1]}}}),Wc={};M(Wc,{WebGpuBackend:()=>gp});var _n,mp,cn,gp,Hh=T(()=>{oa(),rt(),Tn(),rr(),kl(),pp(),mu(),_n=(t,n)=>{if(n.length!==t.length)throw new Error(`inputDependencies length ${n.length} is not equal to inputTensors length ${t.length}.`);let s=[];for(let l=0;l<t.length;++l){let u=t[l].dataType;switch(n[l]){case"none":{s.push("");break}case"type":{s.push(`${u}`);break}case"rank":{let f=t[l].dims.length;s.push(`${u};${f}`);break}case"dims":{let f=t[l].dims.join(",");s.push(`${u};${f}`);break}default:throw new Error(`unsupported input dependency: ${n[l]}`)}}return s.join("|")},mp=(t,n,s)=>{var u,f;let l=t.name;return(u=t.shaderCache)!=null&&u.hint&&(l+="["+t.shaderCache.hint+"]"),l+=":"+s+`:${_n(n,((f=t.shaderCache)==null?void 0:f.inputDependencies)??new Array(n.length).fill("dims"))}`,l},cn=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},gp=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,n){this.env=t;let s=[],l={requiredLimits:{maxComputeWorkgroupStorageSize:n.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:n.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:n.limits.maxStorageBufferBindingSize,maxBufferSize:n.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:n.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:n.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:n.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:n.limits.maxComputeWorkgroupSizeZ},requiredFeatures:s},u=f=>n.features.has(f)&&s.push(f)&&!0;u("chromium-experimental-timestamp-query-inside-passes")||u("timestamp-query"),u("shader-f16"),u("subgroups"),this.device=await n.requestDevice(l),this.adapterInfo=new cn(n.info||await n.requestAdapterInfo()),this.gpuDataManager=Ai(this),this.programManager=new hp(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Qr(t.logLevel,!!t.debug),this.device.onuncapturederror=f=>{f.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${f.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:n,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),n={};this.queryType==="at-passes"&&(n.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(n)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;ia(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{var l;let n=new BigUint64Array(t.getMappedRange()),s=this.pendingQueries.get(t);for(let u=0;u<n.length/2;u++){let f=s[u],p=f.kernelId,g=this.kernels.get(p),b=g.kernelType,v=g.kernelName,w=f.programName,x=f.inputTensorViews,C=f.outputTensorViews,z=n[u*2],A=n[u*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=z);let B=Number(z-this.queryTimeBase),L=Number(A-this.queryTimeBase);if(!Number.isSafeInteger(B)||!Number.isSafeInteger(L))throw new RangeError("incorrect timestamp range");if((l=this.env.webgpu.profiling)!=null&&l.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:x.map(U=>({dims:U.dims,dataType:an(U.dataType)})),outputsMetadata:C.map(U=>({dims:U.dims,dataType:an(U.dataType)})),kernelId:p,kernelType:b,kernelName:v,programName:w,startTime:B,endTime:L});else{let U="";x.forEach((V,G)=>{U+=`input[${G}]: [${V.dims}] | ${an(V.dataType)}, `});let N="";C.forEach((V,G)=>{N+=`output[${G}]: [${V.dims}] | ${an(V.dataType)}, `}),console.log(`[profiling] kernel "${p}|${b}|${v}|${w}" ${U}${N}start time: ${B} ns, execution time: ${L-B} ns`)}Nn("GPU",`${w}::${z}::${A}`)}t.unmap(),this.pendingQueries.delete(t)}),ga()}run(t,n,s,l,u,f){ia(t.name);let p=[];for(let N=0;N<n.length;++N){let V=n[N].data;if(V===0)continue;let G=this.gpuDataManager.get(V);if(!G)throw new Error(`no GPU data for input: ${V}`);p.push(G)}let{outputs:g,dispatchGroup:b,programUniforms:v}=t.getRunData(n),w=s.length===0?g.map((N,V)=>V):s;if(w.length!==g.length)throw new Error(`Output size ${w.length} must be equal to ${g.length}.`);let x=[],C=[];for(let N=0;N<g.length;++N){if(!Number.isInteger(w[N])||w[N]<-3||w[N]>=f)throw new Error(`Invalid output index: ${w[N]}`);if(w[N]===-3)continue;let V=w[N]===-1,G=w[N]===-2,X=V||G?u(g[N].dataType,g[N].dims):l(w[N],g[N].dataType,g[N].dims);if(x.push(X),X.data===0)continue;let ue=this.gpuDataManager.get(X.data);if(!ue)throw new Error(`no GPU data for output: ${X.data}`);if(V&&this.temporaryData.push(ue),G){let te=this.kernelPersistentData.get(this.currentKernelId);te||(te=[],this.kernelPersistentData.set(this.currentKernelId,te)),te.push(ue)}C.push(ue)}if(p.length!==n.length||C.length!==x.length){if(C.length===0)return ga(t.name),x;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let z;if(v){let N=0,V=[];v.forEach(te=>{let ge=typeof te.data=="number"?[te.data]:te.data;if(ge.length===0)return;let ve=te.type===10?2:4,Le,nt;te.type===10?(nt=ge.length>4?16:ge.length>2?8:ge.length*ve,Le=ge.length>4?16:ve*ge.length):(nt=ge.length<=2?ge.length*ve:16,Le=16),N=Math.ceil(N/nt)*nt,V.push(N);let Fe=te.type===10?8:4;N+=ge.length>4?Math.ceil(ge.length/Fe)*Le:ge.length*ve});let G=16;N=Math.ceil(N/G)*G;let X=new ArrayBuffer(N);v.forEach((te,ge)=>{let ve=V[ge],Le=typeof te.data=="number"?[te.data]:te.data;if(te.type===6)new Int32Array(X,ve,Le.length).set(Le);else if(te.type===12)new Uint32Array(X,ve,Le.length).set(Le);else if(te.type===10)new Uint16Array(X,ve,Le.length).set(Le);else if(te.type===1)new Float32Array(X,ve,Le.length).set(Le);else throw new Error(`Unsupported uniform type: ${an(te.type)}`)});let ue=this.gpuDataManager.create(N,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(ue.buffer,0,X,0,N),this.gpuDataManager.release(ue.id),z={offset:0,size:N,buffer:ue.buffer}}let A=this.programManager.normalizeDispatchGroupSize(b),B=A[1]===1&&A[2]===1,L=mp(t,n,B),U=this.programManager.getArtifact(L);if(U||(U=this.programManager.build(t,A),this.programManager.setArtifact(L,U),gt("info",()=>`[artifact] key: ${L}, programName: ${t.name}`)),v&&U.uniformVariablesInfo){if(v.length!==U.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${U.uniformVariablesInfo.length}, got ${v.length} in program "${U.programInfo.name}".`);for(let N=0;N<v.length;N++){let V=v[N],G=V.type,X=typeof V.data=="number"?1:V.data.length,[ue,te]=U.uniformVariablesInfo[N];if(G!==ue||X!==te)throw new Error(`Uniform variable ${N} mismatch: expect type ${ue} with size ${te}, got type ${G} with size ${X} in program "${U.programInfo.name}".`)}}if(gt("info",()=>`[ProgramManager] run "${t.name}" (key=${L}) with ${A[0]}x${A[1]}x${A[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let N={kernelId:this.currentKernelId,programName:U.programInfo.name,inputTensorViews:n,outputTensorViews:x};this.pendingKernels.push(N),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(N)}return this.programManager.run(U,p,C,A,z),ga(t.name),x}upload(t,n){this.gpuDataManager.upload(t,n)}memcpy(t,n){this.gpuDataManager.memcpy(t,n)}async download(t,n){await this.gpuDataManager.download(t,n)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,n,s,l){let u=Kc.get(t);if(!u)throw new Error(`kernel not implemented: ${t}`);let f={kernelType:t,kernelName:l,kernelEntry:u[0],attributes:[u[1],s]};this.kernels.set(n,f)}releaseKernel(t){let n=this.kernelPersistentData.get(t);if(n){for(let s of n)this.gpuDataManager.release(s.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,n,s){let l=this.kernels.get(t);if(!l)throw new Error(`kernel not created: ${t}`);let u=l.kernelType,f=l.kernelName,p=l.kernelEntry,g=l.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${u}] ${f}" is not allowed to be called recursively`);this.currentKernelId=t,g[0]&&(g[1]=g[0](g[1]),g[0]=void 0),gt("info",()=>`[WebGPU] Start to run kernel "[${u}] ${f}"...`);let b=this.env.debug;this.temporaryData=[];try{return b&&this.device.pushErrorScope("validation"),p(n,g[1]),0}catch(v){return s.push(Promise.resolve(`[WebGPU] Kernel "[${u}] ${f}" failed. ${v}`)),1}finally{b&&s.push(this.device.popErrorScope().then(v=>v?`GPU validation error for kernel "[${u}] ${f}": ${v.message}`:null));for(let v of this.temporaryData)this.gpuDataManager.release(v.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,n,s,l){let u=this.sessionExternalDataMapping.get(t);u||(u=new Map,this.sessionExternalDataMapping.set(t,u));let f=u.get(n),p=this.gpuDataManager.registerExternalBuffer(s,l,f);return u.set(n,[p,s]),p}unregisterBuffers(t){let n=this.sessionExternalDataMapping.get(t);n&&(n.forEach(s=>this.gpuDataManager.unregisterExternalBuffer(s[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let n=this.gpuDataManager.get(t);if(!n)throw new Error(`no GPU data for buffer: ${t}`);return n.buffer}createDownloader(t,n,s){return async()=>{let l=await Ml(this,t,n);return $i(l.buffer,s)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){var t;this.queryType="none",(((t=this.env.webgpu.profiling)==null?void 0:t.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){gt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){gt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){gt("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),n=this.capturedPendingKernels.get(this.currentSessionId),s=t.length;this.pendingKernels=[];for(let l=0;l<s;l++){let u=this.getComputePassEncoder(),f=t[l];this.writeTimestamp(this.pendingDispatchNumber*2),u.setPipeline(f.computePipeline),u.setBindGroup(0,f.bindGroup),u.dispatchWorkgroups(...f.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(n[l]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),Ph={};M(Ph,{init:()=>Qc});var fi,gu,Qc,co=T(()=>{rt(),Tn(),He(),Ls(),fi=class j0{constructor(n,s,l,u){this.module=n,this.dataType=s,this.data=l,this.dims=u}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let n=pe.size(this.dims);return n===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,n)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let n=pe.size(this.dims);return n===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,n)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let n=pe.size(this.dims);return n===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,n)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let n=pe.size(this.dims);return n===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,n)}reshape(n){if(pe.size(n)!==pe.size(this.dims))throw new Error("Invalid new shape");return new j0(this.module,this.dataType,this.data,n)}},gu=class{constructor(t,n,s){this.module=t,this.backend=n,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=n.adapterInfo;let l=t.PTR_SIZE,u=s/t.PTR_SIZE,f=l===4?"i32":"i64";this.opKernelContext=Number(t.getValue(l*u++,f));let p=Number(t.getValue(l*u++,f));this.outputCount=Number(t.getValue(l*u++,f)),this.customDataOffset=Number(t.getValue(l*u++,"*")),this.customDataSize=Number(t.getValue(l*u++,f));let g=[];for(let b=0;b<p;b++){let v=Number(t.getValue(l*u++,f)),w=Number(t.getValue(l*u++,"*")),x=Number(t.getValue(l*u++,f)),C=[];for(let z=0;z<x;z++)C.push(Number(t.getValue(l*u++,f)));g.push(new fi(t,v,w,C))}this.inputs=g}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,n){var p;let s=((p=n==null?void 0:n.inputs)==null?void 0:p.map(g=>typeof g=="number"?this.inputs[g]:g))??this.inputs,l=(n==null?void 0:n.outputs)??[],u=(g,b,v)=>new fi(this.module,b,this.output(g,v),v),f=(g,b)=>{let v=nn(g,b);if(!v)throw new Error(`Unsupported data type: ${g}`);let w=v>0?this.backend.gpuDataManager.create(v).id:0;return new fi(this.module,g,w,b)};return this.backend.run(t,s,l,u,f,this.outputCount)}output(t,n){let s=this.module.stackSave();try{let l=this.module.PTR_SIZE,u=l===4?"i32":"i64",f=this.module.stackAlloc((1+n.length)*l);this.module.setValue(f,n.length,u);for(let p=0;p<n.length;p++)this.module.setValue(f+l*(p+1),n[p],u);return this.module._JsepOutput(this.opKernelContext,t,f)}catch(l){throw new Error(`Failed to generate kernel's output[${t}] with dims [${n}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${l}`)}finally{this.module.stackRestore(s)}}},Qc=async(t,n,s,l)=>{let u=n.jsepInit;if(!u)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let f=(Hh(),q(Wc)).WebGpuBackend,p=new f;await p.initialize(s,l),u("webgpu",[p,g=>p.alloc(Number(g)),g=>p.free(g),(g,b,v,w=!1)=>{if(w)gt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(g)}, dst=${Number(b)}, size=${Number(v)}`),p.memcpy(Number(g),Number(b));else{gt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(g)}, gpuDataId=${Number(b)}, size=${Number(v)}`);let x=n.HEAPU8.subarray(Number(g>>>0),Number(g>>>0)+Number(v));p.upload(Number(b),x)}},async(g,b,v)=>{gt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${g}, dataOffset=${b}, size=${v}`),await p.download(Number(g),()=>n.HEAPU8.subarray(Number(b)>>>0,Number(b+v)>>>0))},(g,b,v)=>p.createKernel(g,Number(b),v,n.UTF8ToString(n._JsepGetNodeName(Number(b)))),g=>p.releaseKernel(g),(g,b,v,w)=>{gt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${v}, kernel=${g}, contextDataOffset=${b}`);let x=new gu(n,p,Number(b));return p.computeKernel(Number(g),x,w)},()=>p.captureBegin(),()=>p.captureEnd(),()=>p.replay()])}else{let f=new Cn(s);u("webnn",[f,()=>f.reserveTensorId(),p=>f.releaseTensorId(p),async(p,g,b,v,w)=>f.ensureTensor(p,g,b,v,w),(p,g)=>{f.uploadTensor(p,g)},async(p,g)=>f.downloadTensor(p,g),(p,g)=>f.registerMLContext(p,g),!!s.trace])}}}),yp,Yc,Xc,Or,yu,vu,Zc,vp,bp,Jc,ed,gs,fo,_p=T(()=>{oa(),Td(),Fr(),rt(),xa(),ar(),Wr(),yp=(t,n)=>{st()._OrtInit(t,n)!==0&&Ke("Can't initialize onnxruntime.")},Yc=async t=>{yp(t.wasm.numThreads,Ln(t.logLevel))},Xc=async(t,n)=>{var l,u;(u=(l=st()).asyncInit)==null||u.call(l);let s=t.webgpu.adapter;if(n==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(s){if(typeof s.limits!="object"||typeof s.features!="object"||typeof s.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let f=t.webgpu.powerPreference;if(f!==void 0&&f!=="low-power"&&f!=="high-performance")throw new Error(`Invalid powerPreference setting: "${f}"`);let p=t.webgpu.forceFallbackAdapter;if(p!==void 0&&typeof p!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${p}"`);if(s=await navigator.gpu.requestAdapter({powerPreference:f,forceFallbackAdapter:p}),!s)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(n==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let f=(co(),q(Ph)).init;n==="webgpu"&&await f("webgpu",st(),t,s),n==="webnn"&&await f("webnn",st(),t)}},Or=new Map,yu=t=>{let n=st(),s=n.stackSave();try{let l=n.PTR_SIZE,u=n.stackAlloc(2*l);n._OrtGetInputOutputCount(t,u,u+l)!==0&&Ke("Can't get session input/output count.");let f=l===4?"i32":"i64";return[Number(n.getValue(u,f)),Number(n.getValue(u+l,f))]}finally{n.stackRestore(s)}},vu=(t,n)=>{let s=st(),l=s.stackSave(),u=0;try{let f=s.PTR_SIZE,p=s.stackAlloc(2*f);s._OrtGetInputOutputMetadata(t,n,p,p+f)!==0&&Ke("Can't get session input/output metadata.");let g=Number(s.getValue(p,"*"));u=Number(s.getValue(p+f,"*"));let b=s.HEAP32[u/4];if(b===0)return[g,0];let v=s.HEAPU32[u/4+1],w=[];for(let x=0;x<v;x++){let C=Number(s.getValue(u+8+x*f,"*"));w.push(C!==0?s.UTF8ToString(C):Number(s.getValue(u+8+(x+v)*f,"*")))}return[g,b,w]}finally{s.stackRestore(l),u!==0&&s._OrtFree(u)}},Zc=t=>{let n=st(),s=n._malloc(t.byteLength);if(s===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return n.HEAPU8.set(t,s),[s,t.byteLength]},vp=async(t,n)=>{var x,C,z,A;let s,l,u=st();Array.isArray(t)?[s,l]=t:t.buffer===u.HEAPU8.buffer?[s,l]=[t.byteOffset,t.byteLength]:[s,l]=Zc(t);let f=0,p=0,g=0,b=[],v=[],w=[];try{if([p,b]=await ir(n),(n==null?void 0:n.externalData)&&u.mountExternalData){let ge=[];for(let ve of n.externalData){let Le=typeof ve=="string"?ve:ve.path;ge.push(_i(typeof ve=="string"?ve:ve.data).then(nt=>{u.mountExternalData(Le,nt)}))}await Promise.all(ge)}for(let ge of(n==null?void 0:n.executionProviders)??[])if((typeof ge=="string"?ge:ge.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof ge!="string"){let ve=ge,Le=ve==null?void 0:ve.context,nt=ve==null?void 0:ve.gpuDevice,Fe=ve==null?void 0:ve.deviceType,tt=ve==null?void 0:ve.powerPreference;Le?u.currentContext=Le:nt?u.currentContext=await u.webnnCreateMLContext(nt):u.currentContext=await u.webnnCreateMLContext({deviceType:Fe,powerPreference:tt})}else u.currentContext=await u.webnnCreateMLContext();break}f=await u._OrtCreateSession(s,l,p),(x=u.webgpuOnCreateSession)==null||x.call(u,f),f===0&&Ke("Can't create a session."),(C=u.jsepOnCreateSession)==null||C.call(u),u.currentContext&&(u.webnnRegisterMLContext(f,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[B,L]=yu(f),U=!!(n!=null&&n.enableGraphCapture),N=[],V=[],G=[],X=[],ue=[];for(let ge=0;ge<B;ge++){let[ve,Le,nt]=vu(f,ge);ve===0&&Ke("Can't get an input name."),v.push(ve);let Fe=u.UTF8ToString(ve);N.push(Fe),G.push(Le===0?{name:Fe,isTensor:!1}:{name:Fe,isTensor:!0,type:an(Le),shape:nt})}for(let ge=0;ge<L;ge++){let[ve,Le,nt]=vu(f,ge+B);ve===0&&Ke("Can't get an output name."),w.push(ve);let Fe=u.UTF8ToString(ve);V.push(Fe),X.push(Le===0?{name:Fe,isTensor:!1}:{name:Fe,isTensor:!0,type:an(Le),shape:nt});{if(U&&(n==null?void 0:n.preferredOutputLocation)===void 0){ue.push("gpu-buffer");continue}let tt=typeof(n==null?void 0:n.preferredOutputLocation)=="string"?n.preferredOutputLocation:((z=n==null?void 0:n.preferredOutputLocation)==null?void 0:z[Fe])??"cpu",Et=u.webnnIsGraphOutput;if(tt==="cpu"&&Et&&Et(f,Fe)){ue.push("ml-tensor-cpu-output");continue}if(tt!=="cpu"&&tt!=="cpu-pinned"&&tt!=="gpu-buffer"&&tt!=="ml-tensor")throw new Error(`Not supported preferred output location: ${tt}.`);if(U&&tt!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${tt}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);ue.push(tt)}}let te=null;return ue.some(ge=>ge==="gpu-buffer"||ge==="ml-tensor"||ge==="ml-tensor-cpu-output")&&(g=u._OrtCreateBinding(f),g===0&&Ke("Can't create IO binding."),te={handle:g,outputPreferredLocations:ue,outputPreferredLocationsEncoded:ue.map(ge=>ge==="ml-tensor-cpu-output"?"ml-tensor":ge).map(ge=>Ds(ge))}),Or.set(f,[f,v,w,te,U,!1]),[f,N,V,G,X]}catch(B){throw v.forEach(L=>u._OrtFree(L)),w.forEach(L=>u._OrtFree(L)),g!==0&&u._OrtReleaseBinding(g)!==0&&Ke("Can't release IO binding."),f!==0&&u._OrtReleaseSession(f)!==0&&Ke("Can't release session."),B}finally{u._free(s),p!==0&&u._OrtReleaseSessionOptions(p)!==0&&Ke("Can't release session options."),b.forEach(B=>u._free(B)),(A=u.unmountExternalData)==null||A.call(u)}},bp=t=>{var b,v,w;let n=st(),s=Or.get(t);if(!s)throw new Error(`cannot release session. invalid session id: ${t}`);let[l,u,f,p,g]=s;p&&(g&&n._OrtClearBoundOutputs(p.handle)!==0&&Ke("Can't clear bound outputs."),n._OrtReleaseBinding(p.handle)!==0&&Ke("Can't release IO binding.")),(b=n.jsepOnReleaseSession)==null||b.call(n,t),(v=n.webnnOnReleaseSession)==null||v.call(n,t),(w=n.webgpuOnReleaseSession)==null||w.call(n,t),u.forEach(x=>n._OrtFree(x)),f.forEach(x=>n._OrtFree(x)),n._OrtReleaseSession(l)!==0&&Ke("Can't release session."),Or.delete(t)},Jc=async(t,n,s,l,u,f,p=!1)=>{if(!t){n.push(0);return}let g=st(),b=g.PTR_SIZE,v=t[0],w=t[1],x=t[3],C=x,z,A;if(v==="string"&&(x==="gpu-buffer"||x==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&x!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${f} when enableGraphCapture is true.`);if(x==="gpu-buffer"){let U=t[2].gpuBuffer;A=nn(jt(v),w);{let N=g.jsepRegisterBuffer;if(!N)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');z=N(l,f,U,A)}}else if(x==="ml-tensor"){let U=t[2].mlTensor;A=nn(jt(v),w);let N=g.webnnRegisterMLTensor;if(!N)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');z=N(l,U,jt(v),w)}else{let U=t[2];if(Array.isArray(U)){A=b*U.length,z=g._malloc(A),s.push(z);for(let N=0;N<U.length;N++){if(typeof U[N]!="string")throw new TypeError(`tensor data at index ${N} is not a string`);g.setValue(z+N*b,St(U[N],s),"*")}}else{let N=g.webnnIsGraphInput,V=g.webnnIsGraphOutput;if(v!=="string"&&N&&V){let G=g.UTF8ToString(u);if(N(l,G)||V(l,G)){let X=jt(v);A=nn(X,w),C="ml-tensor";let ue=g.webnnCreateTemporaryTensor,te=g.webnnUploadTensor;if(!ue||!te)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ge=await ue(l,X,w);te(ge,new Uint8Array(U.buffer,U.byteOffset,U.byteLength)),z=ge}else A=U.byteLength,z=g._malloc(A),s.push(z),g.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,A),z)}else A=U.byteLength,z=g._malloc(A),s.push(z),g.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,A),z)}}let B=g.stackSave(),L=g.stackAlloc(4*w.length);try{w.forEach((N,V)=>g.setValue(L+V*b,N,b===4?"i32":"i64"));let U=g._OrtCreateTensor(jt(v),z,A,L,w.length,Ds(C));U===0&&Ke(`Can't create tensor for input/output. session=${l}, index=${f}.`),n.push(U)}finally{g.stackRestore(B)}},ed=async(t,n,s,l,u,f)=>{var Fe,tt,Et,Tt;let p=st(),g=p.PTR_SIZE,b=Or.get(t);if(!b)throw new Error(`cannot run inference. invalid session id: ${t}`);let v=b[0],w=b[1],x=b[2],C=b[3],z=b[4],A=b[5],B=n.length,L=l.length,U=0,N=[],V=[],G=[],X=[],ue=[],te=p.stackSave(),ge=p.stackAlloc(B*g),ve=p.stackAlloc(B*g),Le=p.stackAlloc(L*g),nt=p.stackAlloc(L*g);try{[U,N]=Mo(f),Ma("wasm prepareInputOutputTensor");for(let je=0;je<B;je++)await Jc(s[je],V,X,t,w[n[je]],n[je],z);for(let je=0;je<L;je++)await Jc(u[je],G,X,t,x[l[je]],B+l[je],z);Wa("wasm prepareInputOutputTensor");for(let je=0;je<B;je++)p.setValue(ge+je*g,V[je],"*"),p.setValue(ve+je*g,w[n[je]],"*");for(let je=0;je<L;je++)p.setValue(Le+je*g,G[je],"*"),p.setValue(nt+je*g,x[l[je]],"*");if(C&&!A){let{handle:je,outputPreferredLocations:aa,outputPreferredLocationsEncoded:Ne}=C;if(w.length!==B)throw new Error(`input count from feeds (${B}) is expected to be always equal to model's input count (${w.length}).`);Ma("wasm bindInputsOutputs");for(let Ie=0;Ie<B;Ie++){let lt=n[Ie];await p._OrtBindInput(je,w[lt],V[Ie])!==0&&Ke(`Can't bind input[${Ie}] for session=${t}.`)}for(let Ie=0;Ie<L;Ie++){let lt=l[Ie];(Fe=u[Ie])!=null&&Fe[3]?(ue.push(G[Ie]),p._OrtBindOutput(je,x[lt],G[Ie],0)!==0&&Ke(`Can't bind pre-allocated output[${Ie}] for session=${t}.`)):p._OrtBindOutput(je,x[lt],0,Ne[lt])!==0&&Ke(`Can't bind output[${Ie}] to ${aa[Ie]} for session=${t}.`)}Wa("wasm bindInputsOutputs"),Or.set(t,[v,w,x,C,z,!0])}(tt=p.jsepOnRunStart)==null||tt.call(p,v),(Et=p.webnnOnRunStart)==null||Et.call(p,v);let We;C?We=await p._OrtRunWithBinding(v,C.handle,L,Le,U):We=await p._OrtRun(v,ve,ge,B,nt,L,Le,U),We!==0&&Ke("failed to call OrtRun().");let ut=[],Qt=[];Ma("wasm ProcessOutputTensor");for(let je=0;je<L;je++){let aa=Number(p.getValue(Le+je*g,"*"));if(aa===G[je]||ue.includes(G[je])){ut.push(u[je]),aa!==G[je]&&p._OrtReleaseTensor(aa)!==0&&Ke("Can't release tensor.");continue}let Ne=p.stackSave(),Ie=p.stackAlloc(4*g),lt=!1,pt,fa=0;try{p._OrtGetTensorData(aa,Ie,Ie+g,Ie+2*g,Ie+3*g)!==0&&Ke(`Can't access output tensor data on index ${je}.`);let Jn=g===4?"i32":"i64",Su=Number(p.getValue(Ie,Jn));fa=p.getValue(Ie+g,"*");let Sp=p.getValue(Ie+g*2,"*"),Ep=Number(p.getValue(Ie+g*3,Jn)),ys=[];for(let Ca=0;Ca<Ep;Ca++)ys.push(Number(p.getValue(Sp+Ca*g,Jn)));p._OrtFree(Sp)!==0&&Ke("Can't free memory for tensor dims.");let vs=ys.reduce((Ca,pa)=>Ca*pa,1);pt=an(Su);let mo=C==null?void 0:C.outputPreferredLocations[l[je]];if(pt==="string"){if(mo==="gpu-buffer"||mo==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Ca=[];for(let pa=0;pa<vs;pa++){let Dr=p.getValue(fa+pa*g,"*"),ei=p.getValue(fa+(pa+1)*g,"*"),Tp=pa===vs-1?void 0:ei-Dr;Ca.push(p.UTF8ToString(Dr,Tp))}ut.push([pt,ys,Ca,"cpu"])}else if(mo==="gpu-buffer"&&vs>0){let Ca=p.jsepGetBuffer;if(!Ca)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let pa=Ca(fa),Dr=nn(Su,vs);if(Dr===void 0||!ks(pt))throw new Error(`Unsupported data type: ${pt}`);lt=!0,ut.push([pt,ys,{gpuBuffer:pa,download:p.jsepCreateDownloader(pa,Dr,pt),dispose:()=>{p._OrtReleaseTensor(aa)!==0&&Ke("Can't release tensor.")}},"gpu-buffer"])}else if(mo==="ml-tensor"&&vs>0){let Ca=p.webnnEnsureTensor,pa=p.webnnIsGraphInputOutputTypeSupported;if(!Ca||!pa)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(nn(Su,vs)===void 0||!Kr(pt))throw new Error(`Unsupported data type: ${pt}`);if(!pa(t,pt,!1))throw new Error(`preferredLocation "ml-tensor" for ${pt} output is not supported by current WebNN Context.`);let Dr=await Ca(t,fa,Su,ys,!1);lt=!0,ut.push([pt,ys,{mlTensor:Dr,download:p.webnnCreateMLTensorDownloader(fa,pt),dispose:()=>{p.webnnReleaseTensorId(fa),p._OrtReleaseTensor(aa)}},"ml-tensor"])}else if(mo==="ml-tensor-cpu-output"&&vs>0){let Ca=p.webnnCreateMLTensorDownloader(fa,pt)(),pa=ut.length;lt=!0,Qt.push((async()=>{let Dr=[pa,await Ca];return p.webnnReleaseTensorId(fa),p._OrtReleaseTensor(aa),Dr})()),ut.push([pt,ys,[],"cpu"])}else{let Ca=Sn(pt),pa=new Ca(vs);new Uint8Array(pa.buffer,pa.byteOffset,pa.byteLength).set(p.HEAPU8.subarray(fa,fa+pa.byteLength)),ut.push([pt,ys,pa,"cpu"])}}finally{p.stackRestore(Ne),pt==="string"&&fa&&p._free(fa),lt||p._OrtReleaseTensor(aa)}}C&&!z&&(p._OrtClearBoundOutputs(C.handle)!==0&&Ke("Can't clear bound outputs."),Or.set(t,[v,w,x,C,z,!1]));for(let[je,aa]of await Promise.all(Qt))ut[je][2]=aa;return Wa("wasm ProcessOutputTensor"),ut}finally{(Tt=p.webnnOnRunEnd)==null||Tt.call(p,v),p.stackRestore(te),V.forEach(We=>p._OrtReleaseTensor(We)),G.forEach(We=>p._OrtReleaseTensor(We)),X.forEach(We=>p._free(We)),U!==0&&p._OrtReleaseRunOptions(U),N.forEach(We=>p._free(We))}},gs=t=>{let n=st(),s=Or.get(t);if(!s)throw new Error("invalid session id");let l=s[0],u=n._OrtEndProfiling(l);u===0&&Ke("Can't get an profile file name."),n._OrtFree(u)},fo=t=>{let n=[];for(let s of t){let l=s[2];!Array.isArray(l)&&"buffer"in l&&n.push(l.buffer)}return n}}),Rr,dn,dl,po,ho,fl,td,bu,Bt,Mr,Fh,wp,Kh,Wh,Qh,_u,pl,ad,wu=T(()=>{oa(),_p(),xa(),er(),Rr=()=>!!Re.wasm.proxy&&typeof document<"u",dl=!1,po=!1,ho=!1,bu=new Map,Bt=(t,n)=>{let s=bu.get(t);s?s.push(n):bu.set(t,[n])},Mr=()=>{if(dl||!po||ho||!dn)throw new Error("worker not ready")},Fh=t=>{switch(t.data.type){case"init-wasm":dl=!1,t.data.err?(ho=!0,td[1](t.data.err)):(po=!0,td[0]()),fl&&(URL.revokeObjectURL(fl),fl=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let n=bu.get(t.data.type);t.data.err?n.shift()[1](t.data.err):n.shift()[0](t.data.out);break}}},wp=async()=>{if(!po){if(dl)throw new Error("multiple calls to 'initWasm()' detected.");if(ho)throw new Error("previous call to 'initWasm()' failed.");if(dl=!0,Rr())return new Promise((t,n)=>{dn==null||dn.terminate(),Ji().then(([s,l])=>{try{dn=l,dn.onerror=f=>n(f),dn.onmessage=Fh,td=[t,n];let u={type:"init-wasm",in:Re};if(!u.in.wasm.wasmPaths&&s){let f=zs();f&&(u.in.wasm.wasmPaths=f)}dn.postMessage(u),fl=s}catch(u){n(u)}},n)});try{await Pr(Re.wasm),await Yc(Re),po=!0}catch(t){throw ho=!0,t}finally{dl=!1}}},Kh=async t=>{if(Rr())return Mr(),new Promise((n,s)=>{Bt("init-ep",[n,s]);let l={type:"init-ep",in:{epName:t,env:Re}};dn.postMessage(l)});await Xc(Re,t)},Wh=async t=>Rr()?(Mr(),new Promise((n,s)=>{Bt("copy-from",[n,s]);let l={type:"copy-from",in:{buffer:t}};dn.postMessage(l,[t.buffer])})):Zc(t),Qh=async(t,n)=>{if(Rr()){if(n!=null&&n.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Mr(),new Promise((s,l)=>{Bt("create",[s,l]);let u={type:"create",in:{model:t,options:{...n}}},f=[];t instanceof Uint8Array&&f.push(t.buffer),dn.postMessage(u,f)})}else return vp(t,n)},_u=async t=>{if(Rr())return Mr(),new Promise((n,s)=>{Bt("release",[n,s]);let l={type:"release",in:t};dn.postMessage(l)});bp(t)},pl=async(t,n,s,l,u,f)=>{if(Rr()){if(s.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return Mr(),new Promise((p,g)=>{Bt("run",[p,g]);let b=s,v={type:"run",in:{sessionId:t,inputIndices:n,inputs:b,outputIndices:l,options:f}};dn.postMessage(v,fo(b))})}else return ed(t,n,s,l,u,f)},ad=async t=>{if(Rr())return Mr(),new Promise((n,s)=>{Bt("end-profiling",[n,s]);let l={type:"end-profiling",in:t};dn.postMessage(l)});gs(t)}}),xu,kr,pi,$u=T(()=>{oa(),wu(),rt(),Es(),Wr(),xu=(t,n)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${n()}`)}},kr=t=>{switch(t[3]){case"cpu":return new Xt(t[0],t[2],t[1]);case"gpu-buffer":{let n=t[0];if(!ks(n))throw new Error(`not supported data type: ${n} for deserializing GPU tensor`);let{gpuBuffer:s,download:l,dispose:u}=t[2];return Xt.fromGpuBuffer(s,{dataType:n,dims:t[1],download:l,dispose:u})}case"ml-tensor":{let n=t[0];if(!Kr(n))throw new Error(`not supported data type: ${n} for deserializing MLTensor tensor`);let{mlTensor:s,download:l,dispose:u}=t[2];return Xt.fromMLTensor(s,{dataType:n,dims:t[1],download:l,dispose:u})}default:throw new Error(`invalid data location: ${t[3]}`)}},pi=class{async fetchModelAndCopyToWasmMemory(t){return Wh(await _i(t))}async loadModel(t,n){ia();let s;typeof t=="string"?s=await this.fetchModelAndCopyToWasmMemory(t):s=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Qh(s,n),ga()}async dispose(){return _u(this.sessionId)}async run(t,n,s){ia();let l=[],u=[];Object.entries(t).forEach(x=>{let C=x[0],z=x[1],A=this.inputNames.indexOf(C);if(A===-1)throw new Error(`invalid input '${C}'`);l.push(z),u.push(A)});let f=[],p=[];Object.entries(n).forEach(x=>{let C=x[0],z=x[1],A=this.outputNames.indexOf(C);if(A===-1)throw new Error(`invalid output '${C}'`);f.push(z),p.push(A)});let g=l.map((x,C)=>xu(x,()=>`input "${this.inputNames[u[C]]}"`)),b=f.map((x,C)=>x?xu(x,()=>`output "${this.outputNames[p[C]]}"`):null),v=await pl(this.sessionId,u,g,p,b,s),w={};for(let x=0;x<v.length;x++)w[this.outputNames[p[x]]]=f[x]??kr(v[x]);return ga(),w}startProfiling(){}endProfiling(){ad(this.sessionId)}}}),Yh={};M(Yh,{OnnxruntimeWebAssemblyBackend:()=>id,initializeFlags:()=>nd,wasmBackend:()=>xp});var nd,id,xp,Xh=T(()=>{oa(),wu(),$u(),nd=()=>{(typeof Re.wasm.initTimeout!="number"||Re.wasm.initTimeout<0)&&(Re.wasm.initTimeout=0);let t=Re.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),Re.wasm.simd=!1),typeof Re.wasm.proxy!="boolean"&&(Re.wasm.proxy=!1),typeof Re.wasm.trace!="boolean"&&(Re.wasm.trace=!1),typeof Re.wasm.numThreads!="number"||!Number.isInteger(Re.wasm.numThreads)||Re.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Re.wasm.numThreads=1;else{let n=typeof navigator>"u"?D("node:os").cpus().length:navigator.hardwareConcurrency;Re.wasm.numThreads=Math.min(4,Math.ceil((n||1)/2))}},id=class{async init(t){nd(),await wp(),await Kh(t)}async createInferenceSessionHandler(t,n){let s=new pi;return await s.loadModel(t,n),s}},xp=new id}),Zh={};M(Zh,{InferenceSession:()=>Yi,TRACE:()=>Nn,TRACE_EVENT_BEGIN:()=>Ma,TRACE_EVENT_END:()=>Wa,TRACE_FUNC_BEGIN:()=>ia,TRACE_FUNC_END:()=>ga,Tensor:()=>Xt,default:()=>Jh,env:()=>Re,registerBackend:()=>ce}),oa(),oa(),oa();var $p="1.24.2",Jh=Sl;{let t=(Xh(),q(Yh)).wasmBackend;ce("webgpu",t,5),ce("webnn",t,5),ce("cpu",t,10),ce("wasm",t,10)}return Object.defineProperty(Re.versions,"web",{value:$p,enumerable:!0}),q(Zh)})();/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */o.exports=m})(ag)),ag.exports}var Eu={},ng={},Ly;function Xw(){return Ly||(Ly=1,Object.defineProperty(ng,"__esModule",{value:!0})),ng}var Vp={},qy;function Zw(){if(qy)return Vp;qy=1;var o;Object.defineProperty(Vp,"__esModule",{value:!0}),Vp.SileroLegacy=void 0;const d=sh();class m{constructor($,E,R,D,T){this.ortInstance=$,this._session=E,this._h=R,this._c=D,this._sr=T,this.reset_state=()=>{const M=Array(128).fill(0);this._h=new this.ortInstance.Tensor("float32",M,[2,1,64]),this._c=new this.ortInstance.Tensor("float32",M,[2,1,64])},this.process=async M=>{var ee;const q={input:new this.ortInstance.Tensor("float32",M,[1,M.length]),h:this._h,c:this._c,sr:this._sr},Z=await this._session.run(q);this._h=Z.hn,this._c=Z.cn;const[se]=(ee=Z.output)==null?void 0:ee.data;return{notSpeech:1-se,isSpeech:se}},this.release=async()=>{await this._session.release(),this._h.dispose(),this._c.dispose(),this._sr.dispose()}}}return Vp.SileroLegacy=m,o=m,m.new=async(y,$)=>{d.log.debug("initializing vad");const E=await $(),R=await y.InferenceSession.create(E),D=new y.Tensor("int64",[16000n]),T=Array(128).fill(0),M=new y.Tensor("float32",T,[2,1,64]),H=new y.Tensor("float32",T,[2,1,64]);return d.log.debug("vad is initialized"),new o(y,R,M,H,D)},Vp}var Hp={},jy;function Jw(){if(jy)return Hp;jy=1;var o;Object.defineProperty(Hp,"__esModule",{value:!0}),Hp.SileroV5=void 0;const d=sh();function m($){const E=Array(256).fill(0);return new $.Tensor("float32",E,[2,1,128])}class y{constructor(E,R,D,T){this._session=E,this._state=R,this._sr=D,this.ortInstance=T,this.reset_state=()=>{this._state=m(this.ortInstance)},this.process=async M=>{var ee;const q={input:new this.ortInstance.Tensor("float32",M,[1,M.length]),state:this._state,sr:this._sr},Z=await this._session.run(q);if(!Z.stateN)throw new Error("No state from model");if(this._state=Z.stateN,!((ee=Z.output)!=null&&ee.data))throw new Error("No output from model");const se=Z.output.data[0];if(typeof se!="number")throw new Error("Weird output data");return{notSpeech:1-se,isSpeech:se}},this.release=async()=>{await this._session.release(),this._state.dispose(),this._sr.dispose()}}}return Hp.SileroV5=y,o=y,y.new=async($,E)=>{d.log.debug("Loading VAD...");const R=await E(),D=await $.InferenceSession.create(R),T=new $.Tensor("int64",[16000n]),M=m($);return d.log.debug("...finished loading VAD"),new o(D,M,T,$)},Hp}var Gy;function G0(){return Gy||(Gy=1,(function(o){var d=Eu&&Eu.__createBinding||(Object.create?(function(E,R,D,T){T===void 0&&(T=D);var M=Object.getOwnPropertyDescriptor(R,D);(!M||("get"in M?!R.__esModule:M.writable||M.configurable))&&(M={enumerable:!0,get:function(){return R[D]}}),Object.defineProperty(E,T,M)}):(function(E,R,D,T){T===void 0&&(T=D),E[T]=R[D]})),m=Eu&&Eu.__exportStar||function(E,R){for(var D in E)D!=="default"&&!Object.prototype.hasOwnProperty.call(R,D)&&d(R,E,D)};Object.defineProperty(o,"__esModule",{value:!0}),o.SileroV5=o.SileroLegacy=void 0,m(Xw(),o);var y=Zw();Object.defineProperty(o,"SileroLegacy",{enumerable:!0,get:function(){return y.SileroLegacy}});var $=Jw();Object.defineProperty(o,"SileroV5",{enumerable:!0,get:function(){return $.SileroV5}})})(Eu)),Eu}var Pp={},Vy;function V0(){if(Vy)return Pp;Vy=1,Object.defineProperty(Pp,"__esModule",{value:!0}),Pp.Resampler=void 0;const o=sh();class d{constructor(y){this.options=y,this.process=$=>{const E=[];for(const R of $)for(this.inputBuffer.push(R);this.hasEnoughDataForFrame();){const D=this.generateOutputFrame();E.push(D)}return E},y.nativeSampleRate<16e3&&o.log.error("nativeSampleRate is too low. Should have 16000 = targetSampleRate <= nativeSampleRate"),this.inputBuffer=[]}async*stream(y){for(const $ of y)for(this.inputBuffer.push($);this.hasEnoughDataForFrame();)yield this.generateOutputFrame()}hasEnoughDataForFrame(){return this.inputBuffer.length*this.options.targetSampleRate/this.options.nativeSampleRate>=this.options.targetFrameSize}generateOutputFrame(){const y=new Float32Array(this.options.targetFrameSize);let $=0,E=0;for(;$<this.options.targetFrameSize;){let R=0,D=0;for(;E<Math.min(this.inputBuffer.length,($+1)*this.options.nativeSampleRate/this.options.targetSampleRate);){const T=this.inputBuffer[E];T!==void 0&&(R+=T,D++),E++}y[$]=R/D,$++}return this.inputBuffer=this.inputBuffer.slice(E),y}}return Pp.Resampler=d,Pp}var Hy;function e1(){return Hy||(Hy=1,(function(o){var d=yl&&yl.__createBinding||(Object.create?(function(Z,se,ce,ee){ee===void 0&&(ee=ce);var he=Object.getOwnPropertyDescriptor(se,ce);(!he||("get"in he?!se.__esModule:he.writable||he.configurable))&&(he={enumerable:!0,get:function(){return se[ce]}}),Object.defineProperty(Z,ee,he)}):(function(Z,se,ce,ee){ee===void 0&&(ee=ce),Z[ee]=se[ce]})),m=yl&&yl.__setModuleDefault||(Object.create?(function(Z,se){Object.defineProperty(Z,"default",{enumerable:!0,value:se})}):function(Z,se){Z.default=se}),y=yl&&yl.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var se={};if(Z!=null)for(var ce in Z)ce!=="default"&&Object.prototype.hasOwnProperty.call(Z,ce)&&d(se,Z,ce);return m(se,Z),se};Object.defineProperty(o,"__esModule",{value:!0}),o.NonRealTimeVAD=o.defaultNonRealTimeVADOptions=void 0;const $=y(Yw()),E=L0(),R=Eg(),D=Tg(),T=Om(),M=G0(),H=V0();o.defaultNonRealTimeVADOptions={...D.defaultFrameProcessorOptions,modelURL:E.baseAssetPath+"silero_vad_legacy.onnx",modelFetcher:R.defaultModelFetcher};class q{static async new(se={}){const ce={...o.defaultNonRealTimeVADOptions,...se};(0,D.validateOptions)(ce),ce.ortConfig!==void 0&&ce.ortConfig($);const ee=()=>ce.modelFetcher(ce.modelURL),he=await M.SileroLegacy.new($,ee),$e=new D.FrameProcessor(he.process,he.reset_state,{positiveSpeechThreshold:ce.positiveSpeechThreshold,negativeSpeechThreshold:ce.negativeSpeechThreshold,redemptionMs:ce.redemptionMs,preSpeechPadMs:ce.preSpeechPadMs,minSpeechMs:ce.minSpeechMs,submitUserSpeechOnPause:ce.submitUserSpeechOnPause},1536/16);return $e.resume(),new this(ee,$,ce,$e)}constructor(se,ce,ee,he){this.modelFetcher=se,this.ort=ce,this.options=ee,this.frameProcessor=he,this.frameSamples=1536}async*run(se,ce){const ee={nativeSampleRate:ce,targetSampleRate:16e3,targetFrameSize:this.frameSamples},he=new H.Resampler(ee);let $e=0,De=0,me=0;for await(const Me of he.stream(se)){const Be=[];await this.frameProcessor.process(Me,qe=>{Be.push(qe)});for(const qe of Be)switch(qe.msg){case T.Message.SpeechStart:$e=me*this.frameSamples/16;break;case T.Message.SpeechEnd:De=(me+1)*this.frameSamples/16,yield{audio:qe.audio,start:$e,end:De};break}me++}const be=[];this.frameProcessor.endSegment(Me=>{be.push(Me)});for(const Me of be)switch(Me.msg){case T.Message.SpeechEnd:yield{audio:Me.audio,start:$e,end:me*this.frameSamples/16}}}}o.NonRealTimeVAD=q})(yl)),yl}var Br={},Py;function t1(){if(Py)return Br;Py=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.audioFileToArray=Br.encodeWAV=Br.arrayBufferToBase64=Br.minFramesForTargetMS=void 0;function o(D,T,M=16e3){return Math.ceil(D*M/1e3/T)}Br.minFramesForTargetMS=o;function d(D){const T=new Uint8Array(D),M=T.byteLength,H=new Array(M);for(let q=0;q<M;q++){const Z=T[q];if(Z===void 0)break;H[q]=String.fromCharCode(Z)}return btoa(H.join(""))}Br.arrayBufferToBase64=d;function m(D,T=3,M=16e3,H=1,q=32){const Z=q/8,se=H*Z,ce=new ArrayBuffer(44+D.length*Z),ee=new DataView(ce);return E(ee,0,"RIFF"),ee.setUint32(4,36+D.length*Z,!0),E(ee,8,"WAVE"),E(ee,12,"fmt "),ee.setUint32(16,16,!0),ee.setUint16(20,T,!0),ee.setUint16(22,H,!0),ee.setUint32(24,M,!0),ee.setUint32(28,M*se,!0),ee.setUint16(32,se,!0),ee.setUint16(34,q,!0),E(ee,36,"data"),ee.setUint32(40,D.length*Z,!0),T===1?$(ee,44,D):y(ee,44,D),ce}Br.encodeWAV=m;function y(D,T,M){for(let H=0;H<M.length;H++,T+=4)D.setFloat32(T,M[H],!0)}function $(D,T,M){for(let H=0;H<M.length;H++,T+=2){const q=Math.max(-1,Math.min(1,M[H]));D.setInt16(T,q<0?q*32768:q*32767,!0)}}function E(D,T,M){for(let H=0;H<M.length;H++)D.setUint8(T+H,M.charCodeAt(H))}async function R(D){const T=new OfflineAudioContext(1,1,44100),M=new FileReader;let H=null;if(await new Promise(se=>{M.addEventListener("loadend",()=>{const ce=M.result;T.decodeAudioData(ce,ee=>{H=ee,T.startRendering().then(()=>{console.log("Rendering completed successfully"),se()}).catch(he=>{console.error("Rendering failed: ",he)})},ee=>{console.log("Error with decoding audio data: ",ee)})}),M.readAsArrayBuffer(D)}),H===null)throw Error("some shit");const q=H,Z=new Float32Array(q.length);for(let se=0;se<q.length;se++)for(let ce=0;ce<q.numberOfChannels;ce++){const ee=q.getChannelData(ce)[se],he=Z[se];if(ee===void 0||he===void 0)throw new Error("sample or out[i] is undefined");Z[se]=he+ee}return{audio:Z,sampleRate:q.sampleRate}}return Br.audioFileToArray=R,Br}var vl={},ig={exports:{}};/*!
 * ONNX Runtime Web v1.24.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Fy;function a1(){return Fy||(Fy=1,(function(o,d){var m=(()=>{var y=Object.defineProperty,$=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyNames,R=Object.prototype.hasOwnProperty,D=(S=>typeof Qi<"u"?Qi:typeof Proxy<"u"?new Proxy(S,{get:(O,I)=>(typeof Qi<"u"?Qi:O)[I]}):S)(function(S){if(typeof Qi<"u")return Qi.apply(this,arguments);throw Error('Dynamic require of "'+S+'" is not supported')}),T=(S,O)=>()=>(S&&(O=S(S=0)),O),M=(S,O)=>{for(var I in O)y(S,I,{get:O[I],enumerable:!0})},H=(S,O,I,F)=>{if(O&&typeof O=="object"||typeof O=="function")for(let j of E(O))!R.call(S,j)&&j!==I&&y(S,j,{get:()=>O[j],enumerable:!(F=$(O,j))||F.enumerable});return S},q=S=>H(y({},"__esModule",{value:!0}),S),Z,se,ce,ee,he,$e=T(()=>{Z=new Map,se=[],ce=(S,O,I)=>{if(O&&typeof O.init=="function"&&typeof O.createInferenceSessionHandler=="function"){let F=Z.get(S);if(F===void 0)Z.set(S,{backend:O,priority:I});else{if(F.priority>I)return;if(F.priority===I&&F.backend!==O)throw new Error(`cannot register backend "${S}" using priority ${I}`)}if(I>=0){let j=se.indexOf(S);j!==-1&&se.splice(j,1);for(let ae=0;ae<se.length;ae++)if(Z.get(se[ae]).priority<=I){se.splice(ae,0,S);return}se.push(S)}return}throw new TypeError("not a valid backend")},ee=async S=>{let O=Z.get(S);if(!O)return"backend not found.";if(O.initialized)return O.backend;if(O.aborted)return O.error;{let I=!!O.initPromise;try{return I||(O.initPromise=O.backend.init(S)),await O.initPromise,O.initialized=!0,O.backend}catch(F){return I||(O.error=`${F}`,O.aborted=!0),O.error}finally{delete O.initPromise}}},he=async S=>{let O=S.executionProviders||[],I=O.map(re=>typeof re=="string"?re:re.name),F=I.length===0?se:I,j,ae=[],W=new Set;for(let re of F){let Ee=await ee(re);typeof Ee=="string"?ae.push({name:re,err:Ee}):(j||(j=Ee),j===Ee&&W.add(re))}if(!j)throw new Error(`no available backend found. ERR: ${ae.map(re=>`[${re.name}] ${re.err}`).join(", ")}`);for(let{name:re,err:Ee}of ae)I.includes(re)&&console.warn(`removing requested execution provider "${re}" from session options because it is not available: ${Ee}`);let Q=O.filter(re=>W.has(typeof re=="string"?re:re.name));return[j,new Proxy(S,{get:(re,Ee)=>Ee==="executionProviders"?Q:Reflect.get(re,Ee)})]}}),De=T(()=>{$e()}),me,be=T(()=>{me="1.24.2"}),Me,Be,qe=T(()=>{be(),Me="warning",Be={wasm:{},webgl:{},webgpu:{},versions:{common:me},set logLevel(S){if(S!==void 0){if(typeof S!="string"||["verbose","info","warning","error","fatal"].indexOf(S)===-1)throw new Error(`Unsupported logging level: ${S}`);Me=S}},get logLevel(){return Me}},Object.defineProperty(Be,"logLevel",{enumerable:!0})}),Re,at=T(()=>{qe(),Re=Be}),Xe,et,Qe=T(()=>{Xe=(S,O)=>{let I=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);I.width=S.dims[3],I.height=S.dims[2];let F=I.getContext("2d");if(F!=null){let j,ae;(O==null?void 0:O.tensorLayout)!==void 0&&O.tensorLayout==="NHWC"?(j=S.dims[2],ae=S.dims[3]):(j=S.dims[3],ae=S.dims[2]);let W=(O==null?void 0:O.format)!==void 0?O.format:"RGB",Q=O==null?void 0:O.norm,re,Ee;Q===void 0||Q.mean===void 0?re=[255,255,255,255]:typeof Q.mean=="number"?re=[Q.mean,Q.mean,Q.mean,Q.mean]:(re=[Q.mean[0],Q.mean[1],Q.mean[2],0],Q.mean[3]!==void 0&&(re[3]=Q.mean[3])),Q===void 0||Q.bias===void 0?Ee=[0,0,0,0]:typeof Q.bias=="number"?Ee=[Q.bias,Q.bias,Q.bias,Q.bias]:(Ee=[Q.bias[0],Q.bias[1],Q.bias[2],0],Q.bias[3]!==void 0&&(Ee[3]=Q.bias[3]));let ke=ae*j,xe=0,de=ke,Ve=ke*2,J=-1;W==="RGBA"?(xe=0,de=ke,Ve=ke*2,J=ke*3):W==="RGB"?(xe=0,de=ke,Ve=ke*2):W==="RBG"&&(xe=0,Ve=ke,de=ke*2);for(let Ue=0;Ue<ae;Ue++)for(let Jt=0;Jt<j;Jt++){let ft=(S.data[xe++]-Ee[0])*re[0],ct=(S.data[de++]-Ee[1])*re[1],Gt=(S.data[Ve++]-Ee[2])*re[2],Ze=J===-1?255:(S.data[J++]-Ee[3])*re[3];F.fillStyle="rgba("+ft+","+ct+","+Gt+","+Ze+")",F.fillRect(Jt,Ue,1,1)}if("toDataURL"in I)return I.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},et=(S,O)=>{let I=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),F;if(I!=null){let j,ae,W;(O==null?void 0:O.tensorLayout)!==void 0&&O.tensorLayout==="NHWC"?(j=S.dims[2],ae=S.dims[1],W=S.dims[3]):(j=S.dims[3],ae=S.dims[2],W=S.dims[1]);let Q=O!==void 0&&O.format!==void 0?O.format:"RGB",re=O==null?void 0:O.norm,Ee,ke;re===void 0||re.mean===void 0?Ee=[255,255,255,255]:typeof re.mean=="number"?Ee=[re.mean,re.mean,re.mean,re.mean]:(Ee=[re.mean[0],re.mean[1],re.mean[2],255],re.mean[3]!==void 0&&(Ee[3]=re.mean[3])),re===void 0||re.bias===void 0?ke=[0,0,0,0]:typeof re.bias=="number"?ke=[re.bias,re.bias,re.bias,re.bias]:(ke=[re.bias[0],re.bias[1],re.bias[2],0],re.bias[3]!==void 0&&(ke[3]=re.bias[3]));let xe=ae*j;if(O!==void 0&&(O.format!==void 0&&W===4&&O.format!=="RGBA"||W===3&&O.format!=="RGB"&&O.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let de=4,Ve=0,J=1,Ue=2,Jt=3,ft=0,ct=xe,Gt=xe*2,Ze=-1;Q==="RGBA"?(ft=0,ct=xe,Gt=xe*2,Ze=xe*3):Q==="RGB"?(ft=0,ct=xe,Gt=xe*2):Q==="RBG"&&(ft=0,Gt=xe,ct=xe*2),F=I.createImageData(j,ae);for(let Ft=0;Ft<ae*j;Ve+=de,J+=de,Ue+=de,Jt+=de,Ft++)F.data[Ve]=(S.data[ft++]-ke[0])*Ee[0],F.data[J]=(S.data[ct++]-ke[1])*Ee[1],F.data[Ue]=(S.data[Gt++]-ke[2])*Ee[2],F.data[Jt]=Ze===-1?255:(S.data[Ze++]-ke[3])*Ee[3]}else throw new Error("Can not access image data");return F}}),_t,Dt,ma,_e,Oe,Pe,At=T(()=>{Yt(),_t=(S,O)=>{if(S===void 0)throw new Error("Image buffer must be defined");if(O.height===void 0||O.width===void 0)throw new Error("Image height and width must be defined");if(O.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:I,width:F}=O,j=O.norm??{mean:255,bias:0},ae,W;typeof j.mean=="number"?ae=[j.mean,j.mean,j.mean,j.mean]:ae=[j.mean[0],j.mean[1],j.mean[2],j.mean[3]??255],typeof j.bias=="number"?W=[j.bias,j.bias,j.bias,j.bias]:W=[j.bias[0],j.bias[1],j.bias[2],j.bias[3]??0];let Q=O.format!==void 0?O.format:"RGBA",re=O.tensorFormat!==void 0&&O.tensorFormat!==void 0?O.tensorFormat:"RGB",Ee=I*F,ke=re==="RGBA"?new Float32Array(Ee*4):new Float32Array(Ee*3),xe=4,de=0,Ve=1,J=2,Ue=3,Jt=0,ft=Ee,ct=Ee*2,Gt=-1;Q==="RGB"&&(xe=3,de=0,Ve=1,J=2,Ue=-1),re==="RGBA"?Gt=Ee*3:re==="RBG"?(Jt=0,ct=Ee,ft=Ee*2):re==="BGR"&&(ct=0,ft=Ee,Jt=Ee*2);for(let Ze=0;Ze<Ee;Ze++,de+=xe,J+=xe,Ve+=xe,Ue+=xe)ke[Jt++]=(S[de]+W[0])/ae[0],ke[ft++]=(S[Ve]+W[1])/ae[1],ke[ct++]=(S[J]+W[2])/ae[2],Gt!==-1&&Ue!==-1&&(ke[Gt++]=(S[Ue]+W[3])/ae[3]);return re==="RGBA"?new xt("float32",ke,[1,4,I,F]):new xt("float32",ke,[1,3,I,F])},Dt=async(S,O)=>{let I=typeof HTMLImageElement<"u"&&S instanceof HTMLImageElement,F=typeof ImageData<"u"&&S instanceof ImageData,j=typeof ImageBitmap<"u"&&S instanceof ImageBitmap,ae=typeof S=="string",W,Q=O??{},re=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},Ee=ke=>typeof HTMLCanvasElement<"u"&&ke instanceof HTMLCanvasElement||ke instanceof OffscreenCanvas?ke.getContext("2d"):null;if(I){let ke=re();ke.width=S.width,ke.height=S.height;let xe=Ee(ke);if(xe!=null){let de=S.height,Ve=S.width;if(O!==void 0&&O.resizedHeight!==void 0&&O.resizedWidth!==void 0&&(de=O.resizedHeight,Ve=O.resizedWidth),O!==void 0){if(Q=O,O.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");Q.tensorFormat="RGBA",Q.height=de,Q.width=Ve}else Q.tensorFormat="RGBA",Q.height=de,Q.width=Ve;xe.drawImage(S,0,0),W=xe.getImageData(0,0,Ve,de).data}else throw new Error("Can not access image data")}else if(F){let ke,xe;if(O!==void 0&&O.resizedWidth!==void 0&&O.resizedHeight!==void 0?(ke=O.resizedHeight,xe=O.resizedWidth):(ke=S.height,xe=S.width),O!==void 0&&(Q=O),Q.format="RGBA",Q.height=ke,Q.width=xe,O!==void 0){let de=re();de.width=xe,de.height=ke;let Ve=Ee(de);if(Ve!=null)Ve.putImageData(S,0,0),W=Ve.getImageData(0,0,xe,ke).data;else throw new Error("Can not access image data")}else W=S.data}else if(j){if(O===void 0)throw new Error("Please provide image config with format for Imagebitmap");let ke=re();ke.width=S.width,ke.height=S.height;let xe=Ee(ke);if(xe!=null){let de=S.height,Ve=S.width;return xe.drawImage(S,0,0,Ve,de),W=xe.getImageData(0,0,Ve,de).data,Q.height=de,Q.width=Ve,_t(W,Q)}else throw new Error("Can not access image data")}else{if(ae)return new Promise((ke,xe)=>{let de=re(),Ve=Ee(de);if(!S||!Ve)return xe();let J=new Image;J.crossOrigin="Anonymous",J.src=S,J.onload=()=>{de.width=J.width,de.height=J.height,Ve.drawImage(J,0,0,de.width,de.height);let Ue=Ve.getImageData(0,0,de.width,de.height);Q.height=de.height,Q.width=de.width,ke(_t(Ue.data,Q))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(W!==void 0)return _t(W,Q);throw new Error("Input data provided is not supported - aborted tensor creation")},ma=(S,O)=>{let{width:I,height:F,download:j,dispose:ae}=O,W=[1,F,I,4];return new xt({location:"texture",type:"float32",texture:S,dims:W,download:j,dispose:ae})},_e=(S,O)=>{let{dataType:I,dims:F,download:j,dispose:ae}=O;return new xt({location:"gpu-buffer",type:I??"float32",gpuBuffer:S,dims:F,download:j,dispose:ae})},Oe=(S,O)=>{let{dataType:I,dims:F,download:j,dispose:ae}=O;return new xt({location:"ml-tensor",type:I??"float32",mlTensor:S,dims:F,download:j,dispose:ae})},Pe=(S,O,I)=>new xt({location:"cpu-pinned",type:S,data:O,dims:I??[O.length]})}),ht,K,Ce,Ge,Ye=T(()=>{ht=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),K=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ce=!1,Ge=()=>{if(!Ce){Ce=!0;let S=typeof BigInt64Array<"u"&&BigInt64Array.from,O=typeof BigUint64Array<"u"&&BigUint64Array.from,I=globalThis.Float16Array,F=typeof I<"u"&&I.from;S&&(ht.set("int64",BigInt64Array),K.set(BigInt64Array,"int64")),O&&(ht.set("uint64",BigUint64Array),K.set(BigUint64Array,"uint64")),F?(ht.set("float16",I),K.set(I,"float16")):ht.set("float16",Uint16Array)}}}),mt,wt,Lt=T(()=>{Yt(),mt=S=>{let O=1;for(let I=0;I<S.length;I++){let F=S[I];if(typeof F!="number"||!Number.isSafeInteger(F))throw new TypeError(`dims[${I}] must be an integer, got: ${F}`);if(F<0)throw new RangeError(`dims[${I}] must be a non-negative integer, got: ${F}`);O*=F}return O},wt=(S,O)=>{switch(S.location){case"cpu":return new xt(S.type,S.data,O);case"cpu-pinned":return new xt({location:"cpu-pinned",data:S.data,type:S.type,dims:O});case"texture":return new xt({location:"texture",texture:S.texture,type:S.type,dims:O});case"gpu-buffer":return new xt({location:"gpu-buffer",gpuBuffer:S.gpuBuffer,type:S.type,dims:O});case"ml-tensor":return new xt({location:"ml-tensor",mlTensor:S.mlTensor,type:S.type,dims:O});default:throw new Error(`tensorReshape: tensor location ${S.location} is not supported`)}}}),xt,Yt=T(()=>{Qe(),At(),Ye(),Lt(),xt=class{constructor(S,O,I){Ge();let F,j;if(typeof S=="object"&&"location"in S)switch(this.dataLocation=S.location,F=S.type,j=S.dims,S.location){case"cpu-pinned":{let W=ht.get(F);if(!W)throw new TypeError(`unsupported type "${F}" to create tensor from pinned buffer`);if(!(S.data instanceof W))throw new TypeError(`buffer should be of type ${W.name}`);this.cpuData=S.data;break}case"texture":{if(F!=="float32")throw new TypeError(`unsupported type "${F}" to create tensor from texture`);this.gpuTextureData=S.texture,this.downloader=S.download,this.disposer=S.dispose;break}case"gpu-buffer":{if(F!=="float32"&&F!=="float16"&&F!=="int32"&&F!=="int64"&&F!=="uint32"&&F!=="uint8"&&F!=="bool"&&F!=="uint4"&&F!=="int4")throw new TypeError(`unsupported type "${F}" to create tensor from gpu buffer`);this.gpuBufferData=S.gpuBuffer,this.downloader=S.download,this.disposer=S.dispose;break}case"ml-tensor":{if(F!=="float32"&&F!=="float16"&&F!=="int32"&&F!=="int64"&&F!=="uint32"&&F!=="uint64"&&F!=="int8"&&F!=="uint8"&&F!=="bool"&&F!=="uint4"&&F!=="int4")throw new TypeError(`unsupported type "${F}" to create tensor from MLTensor`);this.mlTensorData=S.mlTensor,this.downloader=S.download,this.disposer=S.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let W,Q;if(typeof S=="string")if(F=S,Q=I,S==="string"){if(!Array.isArray(O))throw new TypeError("A string tensor's data must be a string array.");W=O}else{let re=ht.get(S);if(re===void 0)throw new TypeError(`Unsupported tensor type: ${S}.`);if(Array.isArray(O)){if(S==="float16"&&re===Uint16Array||S==="uint4"||S==="int4")throw new TypeError(`Creating a ${S} tensor from number array is not supported. Please use ${re.name} as data.`);S==="uint64"||S==="int64"?W=re.from(O,BigInt):W=re.from(O)}else if(O instanceof re)W=O;else if(O instanceof Uint8ClampedArray)if(S==="uint8")W=Uint8Array.from(O);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(S==="float16"&&O instanceof Uint16Array&&re!==Uint16Array)W=new globalThis.Float16Array(O.buffer,O.byteOffset,O.length);else throw new TypeError(`A ${F} tensor's data must be type of ${re}`)}else if(Q=O,Array.isArray(S)){if(S.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let re=typeof S[0];if(re==="string")F="string",W=S;else if(re==="boolean")F="bool",W=Uint8Array.from(S);else throw new TypeError(`Invalid element type of data array: ${re}.`)}else if(S instanceof Uint8ClampedArray)F="uint8",W=Uint8Array.from(S);else{let re=K.get(S.constructor);if(re===void 0)throw new TypeError(`Unsupported type for tensor data: ${S.constructor}.`);F=re,W=S}if(Q===void 0)Q=[W.length];else if(!Array.isArray(Q))throw new TypeError("A tensor's dims must be a number array");j=Q,this.cpuData=W,this.dataLocation="cpu"}let ae=mt(j);if(this.cpuData&&ae!==this.cpuData.length&&!((F==="uint4"||F==="int4")&&Math.ceil(ae/2)===this.cpuData.length))throw new Error(`Tensor's size(${ae}) does not match data length(${this.cpuData.length}).`);this.type=F,this.dims=j,this.size=ae}static async fromImage(S,O){return Dt(S,O)}static fromTexture(S,O){return ma(S,O)}static fromGpuBuffer(S,O){return _e(S,O)}static fromMLTensor(S,O){return Oe(S,O)}static fromPinnedBuffer(S,O,I){return Pe(S,O,I)}toDataURL(S){return Xe(this,S)}toImageData(S){return et(this,S)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(S){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let O=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=O,S&&this.disposer&&(this.disposer(),this.disposer=void 0),O}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(S){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return wt(this,S)}}}),Xt,qr=T(()=>{Yt(),Xt=xt}),Nn,jr,ia,ga,Ma,Wa,$l=T(()=>{qe(),Nn=(S,O)=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.timeStamp(`${S}::ORT::${O}`)},jr=(S,O)=>{var j;let I=((j=new Error().stack)==null?void 0:j.split(/\r\n|\r|\n/g))||[],F=!1;for(let ae=0;ae<I.length;ae++){if(F&&!I[ae].includes("TRACE_FUNC")){let W=`FUNC_${S}::${I[ae].trim().split(" ")[1]}`;O&&(W+=`::${O}`),Nn("CPU",W);return}I[ae].includes("TRACE_FUNC")&&(F=!0)}},ia=S=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||jr("BEGIN",S)},ga=S=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||jr("END",S)},Ma=S=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.time(`ORT::${S}`)},Wa=S=>{(typeof Be.trace>"u"?!Be.wasm.trace:!Be.trace)||console.timeEnd(`ORT::${S}`)}}),Ss,Ro=T(()=>{$e(),qr(),$l(),Ss=class H0{constructor(O){this.handler=O}async run(O,I,F){ia(),Ma("InferenceSession.run");let j={},ae={};if(typeof O!="object"||O===null||O instanceof Xt||Array.isArray(O))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let W=!0;if(typeof I=="object"){if(I===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(I instanceof Xt)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(I)){if(I.length===0)throw new TypeError("'fetches' cannot be an empty array.");W=!1;for(let Ee of I){if(typeof Ee!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(Ee)===-1)throw new RangeError(`'fetches' contains invalid output name: ${Ee}.`);j[Ee]=null}if(typeof F=="object"&&F!==null)ae=F;else if(typeof F<"u")throw new TypeError("'options' must be an object.")}else{let Ee=!1,ke=Object.getOwnPropertyNames(I);for(let xe of this.outputNames)if(ke.indexOf(xe)!==-1){let de=I[xe];(de===null||de instanceof Xt)&&(Ee=!0,W=!1,j[xe]=de)}if(Ee){if(typeof F=="object"&&F!==null)ae=F;else if(typeof F<"u")throw new TypeError("'options' must be an object.")}else ae=I}}else if(typeof I<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let Ee of this.inputNames)if(typeof O[Ee]>"u")throw new Error(`input '${Ee}' is missing in 'feeds'.`);if(W)for(let Ee of this.outputNames)j[Ee]=null;let Q=await this.handler.run(O,j,ae),re={};for(let Ee in Q)if(Object.hasOwnProperty.call(Q,Ee)){let ke=Q[Ee];ke instanceof Xt?re[Ee]=ke:re[Ee]=new Xt(ke.type,ke.data,ke.dims)}return Wa("InferenceSession.run"),ga(),re}async release(){return this.handler.dispose()}static async create(O,I,F,j){ia(),Ma("InferenceSession.create");let ae,W={};if(typeof O=="string"){if(ae=O,typeof I=="object"&&I!==null)W=I;else if(typeof I<"u")throw new TypeError("'options' must be an object.")}else if(O instanceof Uint8Array){if(ae=O,typeof I=="object"&&I!==null)W=I;else if(typeof I<"u")throw new TypeError("'options' must be an object.")}else if(O instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&O instanceof SharedArrayBuffer){let ke=O,xe=0,de=O.byteLength;if(typeof I=="object"&&I!==null)W=I;else if(typeof I=="number"){if(xe=I,!Number.isSafeInteger(xe))throw new RangeError("'byteOffset' must be an integer.");if(xe<0||xe>=ke.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${ke.byteLength}).`);if(de=O.byteLength-xe,typeof F=="number"){if(de=F,!Number.isSafeInteger(de))throw new RangeError("'byteLength' must be an integer.");if(de<=0||xe+de>ke.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${ke.byteLength-xe}].`);if(typeof j=="object"&&j!==null)W=j;else if(typeof j<"u")throw new TypeError("'options' must be an object.")}else if(typeof F<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof I<"u")throw new TypeError("'options' must be an object.");ae=new Uint8Array(ke,xe,de)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[Q,re]=await he(W),Ee=await Q.createInferenceSessionHandler(ae,re);return Wa("InferenceSession.create"),ga(),new H0(Ee)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Yi,$d=T(()=>{Ro(),Yi=Ss}),Sd=T(()=>{}),en=T(()=>{}),Ed=T(()=>{}),Bu=T(()=>{}),Sl={};M(Sl,{InferenceSession:()=>Yi,TRACE:()=>Nn,TRACE_EVENT_BEGIN:()=>Ma,TRACE_EVENT_END:()=>Wa,TRACE_FUNC_BEGIN:()=>ia,TRACE_FUNC_END:()=>ga,Tensor:()=>Xt,env:()=>Re,registerBackend:()=>ce});var oa=T(()=>{De(),at(),$d(),qr(),Sd(),en(),$l(),Ed(),Bu()}),Es=T(()=>{}),El={};M(El,{default:()=>Xi});var Ts,Cs,Xi,tn=T(()=>{var S;Al(),xa(),er(),Ts="ort-wasm-proxy-worker",Cs=((S=globalThis.self)==null?void 0:S.name)===Ts,Cs&&(self.onmessage=O=>{let{type:I,in:F}=O.data;try{switch(I){case"init-wasm":Pr(F.wasm).then(()=>{qa(F).then(()=>{postMessage({type:I})},j=>{postMessage({type:I,err:j})})},j=>{postMessage({type:I,err:j})});break;case"init-ep":{let{epName:j,env:ae}=F;Bs(ae,j).then(()=>{postMessage({type:I})},W=>{postMessage({type:I,err:W})});break}case"copy-from":{let{buffer:j}=F,ae=gt(j);postMessage({type:I,out:ae});break}case"create":{let{model:j,options:ae}=F;Tn(j,ae).then(W=>{postMessage({type:I,out:W})},W=>{postMessage({type:I,err:W})});break}case"release":ja(F),postMessage({type:I});break;case"run":{let{sessionId:j,inputIndices:ae,inputs:W,outputIndices:Q,options:re}=F;pe(j,ae,W,Q,new Array(Q.length).fill(null),re).then(Ee=>{Ee.some(ke=>ke[3]!=="cpu")?postMessage({type:I,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:I,out:Ee},ii([...W,...Ee]))},Ee=>{postMessage({type:I,err:Ee})});break}case"end-profiling":xi(F),postMessage({type:I});break;default:}}catch(j){postMessage({type:I,err:j})}}),Xi=Cs?null:O=>new Worker(O??Zt,{type:"classic",name:Ts})}),Un,La,Zt,zs,Zi,Gr,Vr,yi,ai,vi,Ji,As,Tl,er=T(()=>{Es(),Un=typeof location>"u"?void 0:location.origin,La=()=>{var S,O;return typeof document<"u"?(S=document.currentScript)==null?void 0:S.src:typeof self<"u"?(O=self.location)==null?void 0:O.href:void 0},Zt=La(),zs=()=>{if(Zt&&!Zt.startsWith("blob:"))return Zt.substring(0,Zt.lastIndexOf("/")+1)},Zi=(S,O)=>{try{let I=O??Zt;return(I?new URL(S,I):new URL(S)).origin===Un}catch{return!1}},Gr=(S,O)=>{let I=O??Zt;try{return(I?new URL(S,I):new URL(S)).href}catch{return}},Vr=(S,O)=>`${O??"./"}${S}`,yi=async S=>{let O=await(await fetch(S,{credentials:"same-origin"})).blob();return URL.createObjectURL(O)},ai=async S=>(await import(S)).default,vi=(tn(),q(El)).default,Ji=async()=>{if(!Zt)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Zi(Zt))return[void 0,vi()];let S=await yi(Zt);return[S,vi(S)]},As=void 0,Tl=async(S,O,I,F)=>{let j=As&&!(S||O);if(j)if(Zt)j=Zi(Zt);else if(F&&!I)j=!0;else throw new Error("cannot determine the script source URL.");if(j)return[void 0,As];{let ae="ort-wasm-simd-threaded.mjs",W=S??Gr(ae,O),Q=I&&W&&!Zi(W,O),re=Q?await yi(W):W??Vr(ae,O);return[Q?re:void 0,await ai(re)]}}}),ni,tr,In,Hr,Cl,Os,Rs,Pr,st,xa=T(()=>{er(),tr=!1,In=!1,Hr=!1,Cl=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Os=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Rs=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Pr=async S=>{if(tr)return Promise.resolve();if(In)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Hr)throw new Error("previous call to 'initializeWebAssembly()' failed.");In=!0;let O=S.initTimeout,I=S.numThreads;if(S.simd!==!1){if(S.simd==="relaxed"){if(!Rs())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Os())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let F=Cl();I>1&&!F&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+I+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),S.numThreads=I=1);let j=S.wasmPaths,ae=typeof j=="string"?j:void 0,W=j==null?void 0:j.mjs,Q=(W==null?void 0:W.href)??W,re=j==null?void 0:j.wasm,Ee=(re==null?void 0:re.href)??re,ke=S.wasmBinary,[xe,de]=await Tl(Q,ae,I>1,!!ke||!!Ee),Ve=!1,J=[];if(O>0&&J.push(new Promise(Ue=>{setTimeout(()=>{Ve=!0,Ue()},O)})),J.push(new Promise((Ue,Jt)=>{let ft={numThreads:I};if(ke)ft.wasmBinary=ke;else if(Ee||ae)ft.locateFile=ct=>Ee??ae+ct;else if(Q&&Q.indexOf("blob:")!==0)ft.locateFile=ct=>new URL(ct,Q).href;else if(xe){let ct=zs();ct&&(ft.locateFile=Gt=>ct+Gt)}de(ft).then(ct=>{In=!1,tr=!0,ni=ct,Ue(),xe&&URL.revokeObjectURL(xe)},ct=>{In=!1,Hr=!0,Jt(ct)})})),await Promise.race(J),Ve)throw new Error(`WebAssembly backend initializing failed due to timeout: ${O}ms`)},st=()=>{if(tr&&ni)return ni;throw new Error("WebAssembly is not initialized yet.")}}),St,ya,Ke,ar=T(()=>{xa(),St=(S,O)=>{let I=st(),F=I.lengthBytesUTF8(S)+1,j=I._malloc(F);return I.stringToUTF8(S,j,F),O.push(j),j},ya=(S,O,I,F)=>{if(typeof S=="object"&&S!==null){if(I.has(S))throw new Error("Circular reference in options");I.add(S)}Object.entries(S).forEach(([j,ae])=>{let W=O?O+j:j;if(typeof ae=="object")ya(ae,W+".",I,F);else if(typeof ae=="string"||typeof ae=="number")F(W,ae.toString());else if(typeof ae=="boolean")F(W,ae?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof ae}`)})},Ke=S=>{let O=st(),I=O.stackSave();try{let F=O.PTR_SIZE,j=O.stackAlloc(2*F);O._OrtGetLastError(j,j+F);let ae=Number(O.getValue(j,F===4?"i32":"i64")),W=O.getValue(j+F,"*"),Q=W?O.UTF8ToString(W):"";throw new Error(`${S} ERROR_CODE: ${ae}, ERROR_MESSAGE: ${Q}`)}finally{O.stackRestore(I)}}}),Mo,Td=T(()=>{xa(),ar(),Mo=S=>{let O=st(),I=0,F=[],j=S||{};try{if((S==null?void 0:S.logSeverityLevel)===void 0)j.logSeverityLevel=2;else if(typeof S.logSeverityLevel!="number"||!Number.isInteger(S.logSeverityLevel)||S.logSeverityLevel<0||S.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${S.logSeverityLevel}`);if((S==null?void 0:S.logVerbosityLevel)===void 0)j.logVerbosityLevel=0;else if(typeof S.logVerbosityLevel!="number"||!Number.isInteger(S.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${S.logVerbosityLevel}`);(S==null?void 0:S.terminate)===void 0&&(j.terminate=!1);let ae=0;return(S==null?void 0:S.tag)!==void 0&&(ae=St(S.tag,F)),I=O._OrtCreateRunOptions(j.logSeverityLevel,j.logVerbosityLevel,!!j.terminate,ae),I===0&&Ke("Can't create run options."),(S==null?void 0:S.extra)!==void 0&&ya(S.extra,"",new WeakSet,(W,Q)=>{let re=St(W,F),Ee=St(Q,F);O._OrtAddRunConfigEntry(I,re,Ee)!==0&&Ke(`Can't set a run config entry: ${W} - ${Q}.`)}),[I,F]}catch(ae){throw I!==0&&O._OrtReleaseRunOptions(I),F.forEach(W=>O._free(W)),ae}}}),zl,nr,Ms,Qa,bi,ir,Fr=T(()=>{xa(),ar(),zl=S=>{switch(S){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${S}`)}},nr=S=>{switch(S){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${S}`)}},Ms=S=>{S.extra||(S.extra={}),S.extra.session||(S.extra.session={});let O=S.extra.session;O.use_ort_model_bytes_directly||(O.use_ort_model_bytes_directly="1"),S.executionProviders&&S.executionProviders.some(I=>(typeof I=="string"?I:I.name)==="webgpu")&&(S.enableMemPattern=!1)},Qa=(S,O,I,F)=>{let j=St(O,F),ae=St(I,F);st()._OrtAddSessionConfigEntry(S,j,ae)!==0&&Ke(`Can't set a session config entry: ${O} - ${I}.`)},bi=async(S,O,I)=>{let F=O.executionProviders;for(let j of F){let ae=typeof j=="string"?j:j.name,W=[];switch(ae){case"webnn":if(ae="WEBNN",typeof j!="string"){let xe=j==null?void 0:j.deviceType;xe&&Qa(S,"deviceType",xe,I)}break;case"webgpu":if(ae="JS",typeof j!="string"){let xe=j;if(xe!=null&&xe.preferredLayout){if(xe.preferredLayout!=="NCHW"&&xe.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${xe.preferredLayout}`);Qa(S,"preferredLayout",xe.preferredLayout,I)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${ae}`)}let Q=St(ae,I),re=W.length,Ee=0,ke=0;if(re>0){Ee=st()._malloc(re*st().PTR_SIZE),I.push(Ee),ke=st()._malloc(re*st().PTR_SIZE),I.push(ke);for(let xe=0;xe<re;xe++)st().setValue(Ee+xe*st().PTR_SIZE,W[xe][0],"*"),st().setValue(ke+xe*st().PTR_SIZE,W[xe][1],"*")}await st()._OrtAppendExecutionProvider(S,Q,Ee,ke,re)!==0&&Ke(`Can't append execution provider: ${ae}.`)}},ir=async S=>{let O=st(),I=0,F=[],j=S||{};Ms(j);try{let ae=zl(j.graphOptimizationLevel??"all"),W=nr(j.executionMode??"sequential"),Q=typeof j.logId=="string"?St(j.logId,F):0,re=j.logSeverityLevel??2;if(!Number.isInteger(re)||re<0||re>4)throw new Error(`log severity level is not valid: ${re}`);let Ee=j.logVerbosityLevel??0;if(!Number.isInteger(Ee)||Ee<0||Ee>4)throw new Error(`log verbosity level is not valid: ${Ee}`);let ke=typeof j.optimizedModelFilePath=="string"?St(j.optimizedModelFilePath,F):0;if(I=O._OrtCreateSessionOptions(ae,!!j.enableCpuMemArena,!!j.enableMemPattern,W,!!j.enableProfiling,0,Q,re,Ee,ke),I===0&&Ke("Can't create session options."),j.executionProviders&&await bi(I,j,F),j.enableGraphCapture!==void 0){if(typeof j.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${j.enableGraphCapture}`);Qa(I,"enableGraphCapture",j.enableGraphCapture.toString(),F)}if(j.freeDimensionOverrides)for(let[xe,de]of Object.entries(j.freeDimensionOverrides)){if(typeof xe!="string")throw new Error(`free dimension override name must be a string: ${xe}`);if(typeof de!="number"||!Number.isInteger(de)||de<0)throw new Error(`free dimension override value must be a non-negative integer: ${de}`);let Ve=St(xe,F);O._OrtAddFreeDimensionOverride(I,Ve,de)!==0&&Ke(`Can't set a free dimension override: ${xe} - ${de}.`)}return j.extra!==void 0&&ya(j.extra,"",new WeakSet,(xe,de)=>{Qa(I,xe,de,F)}),[I,F]}catch(ae){throw I!==0&&O._OrtReleaseSessionOptions(I)!==0&&Ke("Can't release session options."),F.forEach(W=>O._free(W)),ae}}}),jt,an,nn,Sn,Ln,ks,Kr,Ds,rt=T(()=>{jt=S=>{switch(S){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${S}`)}},an=S=>{switch(S){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${S}`)}},nn=(S,O)=>{let I=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][S],F=typeof O=="number"?O:O.reduce((j,ae)=>j*ae,1);return I>0?Math.ceil(F*I):void 0},Sn=S=>{switch(S){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${S}`)}},Ln=S=>{switch(S){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${S}`)}},ks=S=>S==="float32"||S==="float16"||S==="int32"||S==="int64"||S==="uint32"||S==="uint8"||S==="bool"||S==="uint4"||S==="int4",Kr=S=>S==="float32"||S==="float16"||S==="int32"||S==="int64"||S==="uint32"||S==="uint64"||S==="int8"||S==="uint8"||S==="bool"||S==="uint4"||S==="int4",Ds=S=>{switch(S){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${S}`)}}}),_i,Wr=T(()=>{Es(),_i=async S=>{if(typeof S=="string"){let O=await fetch(S);if(!O.ok)throw new Error(`failed to load external data file: ${S}`);let I=O.headers.get("Content-Length"),F=I?parseInt(I,10):0;if(F<1073741824)return new Uint8Array(await O.arrayBuffer());{if(!O.body)throw new Error(`failed to load external data file: ${S}, no response body.`);let j=O.body.getReader(),ae;try{ae=new ArrayBuffer(F)}catch(Q){if(Q instanceof RangeError){let re=Math.ceil(F/65536);ae=new WebAssembly.Memory({initial:re,maximum:re}).buffer}else throw Q}let W=0;for(;;){let{done:Q,value:re}=await j.read();if(Q)break;let Ee=re.byteLength;new Uint8Array(ae,W,Ee).set(re),W+=Ee}return new Uint8Array(ae,0,F)}}else return S instanceof Blob?new Uint8Array(await S.arrayBuffer()):S instanceof Uint8Array?S:new Uint8Array(S)}}),En,qa,Bs,wi,Qr,Ns,gt,Tn,ja,qn,pe,xi,ii,Al=T(()=>{oa(),Td(),Fr(),rt(),xa(),ar(),Wr(),En=(S,O)=>{st()._OrtInit(S,O)!==0&&Ke("Can't initialize onnxruntime.")},qa=async S=>{En(S.wasm.numThreads,Ln(S.logLevel))},Bs=async(S,O)=>{var F,j;(j=(F=st()).asyncInit)==null||j.call(F);let I=S.webgpu.adapter;if(O==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(I){if(typeof I.limits!="object"||typeof I.features!="object"||typeof I.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let ae=S.webgpu.powerPreference;if(ae!==void 0&&ae!=="low-power"&&ae!=="high-performance")throw new Error(`Invalid powerPreference setting: "${ae}"`);let W=S.webgpu.forceFallbackAdapter;if(W!==void 0&&typeof W!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${W}"`);if(I=await navigator.gpu.requestAdapter({powerPreference:ae,forceFallbackAdapter:W}),!I)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(O==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment")},wi=new Map,Qr=S=>{let O=st(),I=O.stackSave();try{let F=O.PTR_SIZE,j=O.stackAlloc(2*F);O._OrtGetInputOutputCount(S,j,j+F)!==0&&Ke("Can't get session input/output count.");let ae=F===4?"i32":"i64";return[Number(O.getValue(j,ae)),Number(O.getValue(j+F,ae))]}finally{O.stackRestore(I)}},Ns=(S,O)=>{let I=st(),F=I.stackSave(),j=0;try{let ae=I.PTR_SIZE,W=I.stackAlloc(2*ae);I._OrtGetInputOutputMetadata(S,O,W,W+ae)!==0&&Ke("Can't get session input/output metadata.");let Q=Number(I.getValue(W,"*"));j=Number(I.getValue(W+ae,"*"));let re=I.HEAP32[j/4];if(re===0)return[Q,0];let Ee=I.HEAPU32[j/4+1],ke=[];for(let xe=0;xe<Ee;xe++){let de=Number(I.getValue(j+8+xe*ae,"*"));ke.push(de!==0?I.UTF8ToString(de):Number(I.getValue(j+8+(xe+Ee)*ae,"*")))}return[Q,re,ke]}finally{I.stackRestore(F),j!==0&&I._OrtFree(j)}},gt=S=>{let O=st(),I=O._malloc(S.byteLength);if(I===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${S.byteLength}.`);return O.HEAPU8.set(S,I),[I,S.byteLength]},Tn=async(S,O)=>{var ke,xe,de;let I,F,j=st();Array.isArray(S)?[I,F]=S:S.buffer===j.HEAPU8.buffer?[I,F]=[S.byteOffset,S.byteLength]:[I,F]=gt(S);let ae=0,W=0,Q=[],re=[],Ee=[];try{if([W,Q]=await ir(O),(O==null?void 0:O.externalData)&&j.mountExternalData){let Ft=[];for(let Rt of O.externalData){let Aa=typeof Rt=="string"?Rt:Rt.path;Ft.push(_i(typeof Rt=="string"?Rt:Rt.data).then(Ga=>{j.mountExternalData(Aa,Ga)}))}await Promise.all(Ft)}for(let Ft of(O==null?void 0:O.executionProviders)??[])if((typeof Ft=="string"?Ft:Ft.name)==="webnn"){if(j.shouldTransferToMLTensor=!1,typeof Ft!="string"){let Rt=Ft,Aa=Rt==null?void 0:Rt.context,Ga=Rt==null?void 0:Rt.gpuDevice,Va=Rt==null?void 0:Rt.deviceType,js=Rt==null?void 0:Rt.powerPreference;Aa?j.currentContext=Aa:Ga?j.currentContext=await j.webnnCreateMLContext(Ga):j.currentContext=await j.webnnCreateMLContext({deviceType:Va,powerPreference:js})}else j.currentContext=await j.webnnCreateMLContext();break}ae=await j._OrtCreateSession(I,F,W),(ke=j.webgpuOnCreateSession)==null||ke.call(j,ae),ae===0&&Ke("Can't create a session."),(xe=j.jsepOnCreateSession)==null||xe.call(j),j.currentContext&&(j.webnnRegisterMLContext(ae,j.currentContext),j.currentContext=void 0,j.shouldTransferToMLTensor=!0);let[Ve,J]=Qr(ae),Ue=!!(O!=null&&O.enableGraphCapture),Jt=[],ft=[],ct=[],Gt=[],Ze=[];for(let Ft=0;Ft<Ve;Ft++){let[Rt,Aa,Ga]=Ns(ae,Ft);Rt===0&&Ke("Can't get an input name."),re.push(Rt);let Va=j.UTF8ToString(Rt);Jt.push(Va),ct.push(Aa===0?{name:Va,isTensor:!1}:{name:Va,isTensor:!0,type:an(Aa),shape:Ga})}for(let Ft=0;Ft<J;Ft++){let[Rt,Aa,Ga]=Ns(ae,Ft+Ve);Rt===0&&Ke("Can't get an output name."),Ee.push(Rt);let Va=j.UTF8ToString(Rt);ft.push(Va),Gt.push(Aa===0?{name:Va,isTensor:!1}:{name:Va,isTensor:!0,type:an(Aa),shape:Ga})}return wi.set(ae,[ae,re,Ee,null,Ue,!1]),[ae,Jt,ft,ct,Gt]}catch(Ve){throw re.forEach(J=>j._OrtFree(J)),Ee.forEach(J=>j._OrtFree(J)),ae!==0&&j._OrtReleaseSession(ae)!==0&&Ke("Can't release session."),Ve}finally{j._free(I),W!==0&&j._OrtReleaseSessionOptions(W)!==0&&Ke("Can't release session options."),Q.forEach(Ve=>j._free(Ve)),(de=j.unmountExternalData)==null||de.call(j)}},ja=S=>{var re,Ee,ke;let O=st(),I=wi.get(S);if(!I)throw new Error(`cannot release session. invalid session id: ${S}`);let[F,j,ae,W,Q]=I;W&&(Q&&O._OrtClearBoundOutputs(W.handle)!==0&&Ke("Can't clear bound outputs."),O._OrtReleaseBinding(W.handle)!==0&&Ke("Can't release IO binding.")),(re=O.jsepOnReleaseSession)==null||re.call(O,S),(Ee=O.webnnOnReleaseSession)==null||Ee.call(O,S),(ke=O.webgpuOnReleaseSession)==null||ke.call(O,S),j.forEach(xe=>O._OrtFree(xe)),ae.forEach(xe=>O._OrtFree(xe)),O._OrtReleaseSession(F)!==0&&Ke("Can't release session."),wi.delete(S)},qn=async(S,O,I,F,j,ae,W=!1)=>{if(!S){O.push(0);return}let Q=st(),re=Q.PTR_SIZE,Ee=S[0],ke=S[1],xe=S[3],de=xe,Ve,J;if(Ee==="string"&&(xe==="gpu-buffer"||xe==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(W&&xe!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${ae} when enableGraphCapture is true.`);if(xe==="gpu-buffer"){let ft=S[2].gpuBuffer;J=nn(jt(Ee),ke);{let ct=Q.jsepRegisterBuffer;if(!ct)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');Ve=ct(F,ae,ft,J)}}else if(xe==="ml-tensor"){let ft=S[2].mlTensor;J=nn(jt(Ee),ke);let ct=Q.webnnRegisterMLTensor;if(!ct)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');Ve=ct(F,ft,jt(Ee),ke)}else{let ft=S[2];if(Array.isArray(ft)){J=re*ft.length,Ve=Q._malloc(J),I.push(Ve);for(let ct=0;ct<ft.length;ct++){if(typeof ft[ct]!="string")throw new TypeError(`tensor data at index ${ct} is not a string`);Q.setValue(Ve+ct*re,St(ft[ct],I),"*")}}else{let ct=Q.webnnIsGraphInput,Gt=Q.webnnIsGraphOutput;if(Ee!=="string"&&ct&&Gt){let Ze=Q.UTF8ToString(j);if(ct(F,Ze)||Gt(F,Ze)){let Ft=jt(Ee);J=nn(Ft,ke),de="ml-tensor";let Rt=Q.webnnCreateTemporaryTensor,Aa=Q.webnnUploadTensor;if(!Rt||!Aa)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let Ga=await Rt(F,Ft,ke);Aa(Ga,new Uint8Array(ft.buffer,ft.byteOffset,ft.byteLength)),Ve=Ga}else J=ft.byteLength,Ve=Q._malloc(J),I.push(Ve),Q.HEAPU8.set(new Uint8Array(ft.buffer,ft.byteOffset,J),Ve)}else J=ft.byteLength,Ve=Q._malloc(J),I.push(Ve),Q.HEAPU8.set(new Uint8Array(ft.buffer,ft.byteOffset,J),Ve)}}let Ue=Q.stackSave(),Jt=Q.stackAlloc(4*ke.length);try{ke.forEach((ct,Gt)=>Q.setValue(Jt+Gt*re,ct,re===4?"i32":"i64"));let ft=Q._OrtCreateTensor(jt(Ee),Ve,J,Jt,ke.length,Ds(de));ft===0&&Ke(`Can't create tensor for input/output. session=${F}, index=${ae}.`),O.push(ft)}finally{Q.stackRestore(Ue)}},pe=async(S,O,I,F,j,ae)=>{var Ya,ko,Do;let W=st(),Q=W.PTR_SIZE,re=wi.get(S);if(!re)throw new Error(`cannot run inference. invalid session id: ${S}`);let Ee=re[0],ke=re[1],xe=re[2],de=re[3],Ve=re[4];re[5];let J=O.length,Ue=F.length,Jt=0,ft=[],ct=[],Gt=[],Ze=[],Ft=[],Rt=W.stackSave(),Aa=W.stackAlloc(J*Q),Ga=W.stackAlloc(J*Q),Va=W.stackAlloc(Ue*Q),js=W.stackAlloc(Ue*Q);try{[Jt,ft]=Mo(ae),Ma("wasm prepareInputOutputTensor");for(let $t=0;$t<J;$t++)await qn(I[$t],ct,Ze,S,ke[O[$t]],O[$t],Ve);for(let $t=0;$t<Ue;$t++)await qn(j[$t],Gt,Ze,S,xe[F[$t]],J+F[$t],Ve);Wa("wasm prepareInputOutputTensor");for(let $t=0;$t<J;$t++)W.setValue(Aa+$t*Q,ct[$t],"*"),W.setValue(Ga+$t*Q,ke[O[$t]],"*");for(let $t=0;$t<Ue;$t++)W.setValue(Va+$t*Q,Gt[$t],"*"),W.setValue(js+$t*Q,xe[F[$t]],"*");(Ya=W.jsepOnRunStart)==null||Ya.call(W,Ee),(ko=W.webnnOnRunStart)==null||ko.call(W,Ee);let Oa;Oa=await W._OrtRun(Ee,Ga,Aa,J,js,Ue,Va,Jt),Oa!==0&&Ke("failed to call OrtRun().");let Gn=[],Bo=[];Ma("wasm ProcessOutputTensor");for(let $t=0;$t<Ue;$t++){let An=Number(W.getValue(Va+$t*Q,"*"));if(An===Gt[$t]||Ft.includes(Gt[$t])){Gn.push(j[$t]),An!==Gt[$t]&&W._OrtReleaseTensor(An)!==0&&Ke("Can't release tensor.");continue}let Dl=W.stackSave(),rn=W.stackAlloc(4*Q),Gs=!1,va,Ha=0;try{W._OrtGetTensorData(An,rn,rn+Q,rn+2*Q,rn+3*Q)!==0&&Ke(`Can't access output tensor data on index ${$t}.`);let Vs=Q===4?"i32":"i64",Pa=Number(W.getValue(rn,Vs));Ha=W.getValue(rn+Q,"*");let Bl=W.getValue(rn+Q*2,"*"),cr=Number(W.getValue(rn+Q*3,Vs)),si=[];for(let ba=0;ba<cr;ba++)si.push(Number(W.getValue(Bl+ba*Q,Vs)));W._OrtFree(Bl)!==0&&Ke("Can't free memory for tensor dims.");let li=si.reduce((ba,ra)=>ba*ra,1);va=an(Pa);let Jr=de==null?void 0:de.outputPreferredLocations[F[$t]];if(va==="string"){if(Jr==="gpu-buffer"||Jr==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let ba=[];for(let ra=0;ra<li;ra++){let Xa=W.getValue(Ha+ra*Q,"*"),es=W.getValue(Ha+(ra+1)*Q,"*"),Nu=ra===li-1?void 0:es-Xa;ba.push(W.UTF8ToString(Xa,Nu))}Gn.push([va,si,ba,"cpu"])}else if(Jr==="gpu-buffer"&&li>0){let ba=W.jsepGetBuffer;if(!ba)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let ra=ba(Ha),Xa=nn(Pa,li);if(Xa===void 0||!ks(va))throw new Error(`Unsupported data type: ${va}`);Gs=!0,Gn.push([va,si,{gpuBuffer:ra,download:W.jsepCreateDownloader(ra,Xa,va),dispose:()=>{W._OrtReleaseTensor(An)!==0&&Ke("Can't release tensor.")}},"gpu-buffer"])}else if(Jr==="ml-tensor"&&li>0){let ba=W.webnnEnsureTensor,ra=W.webnnIsGraphInputOutputTypeSupported;if(!ba||!ra)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(nn(Pa,li)===void 0||!Kr(va))throw new Error(`Unsupported data type: ${va}`);if(!ra(S,va,!1))throw new Error(`preferredLocation "ml-tensor" for ${va} output is not supported by current WebNN Context.`);let Xa=await ba(S,Ha,Pa,si,!1);Gs=!0,Gn.push([va,si,{mlTensor:Xa,download:W.webnnCreateMLTensorDownloader(Ha,va),dispose:()=>{W.webnnReleaseTensorId(Ha),W._OrtReleaseTensor(An)}},"ml-tensor"])}else if(Jr==="ml-tensor-cpu-output"&&li>0){let ba=W.webnnCreateMLTensorDownloader(Ha,va)(),ra=Gn.length;Gs=!0,Bo.push((async()=>{let Xa=[ra,await ba];return W.webnnReleaseTensorId(Ha),W._OrtReleaseTensor(An),Xa})()),Gn.push([va,si,[],"cpu"])}else{let ba=Sn(va),ra=new ba(li);new Uint8Array(ra.buffer,ra.byteOffset,ra.byteLength).set(W.HEAPU8.subarray(Ha,Ha+ra.byteLength)),Gn.push([va,si,ra,"cpu"])}}finally{W.stackRestore(Dl),va==="string"&&Ha&&W._free(Ha),Gs||W._OrtReleaseTensor(An)}}de&&!Ve&&(W._OrtClearBoundOutputs(de.handle)!==0&&Ke("Can't clear bound outputs."),wi.set(S,[Ee,ke,xe,de,Ve,!1]));for(let[$t,An]of await Promise.all(Bo))Gn[$t][2]=An;return Wa("wasm ProcessOutputTensor"),Gn}finally{(Do=W.webnnOnRunEnd)==null||Do.call(W,Ee),W.stackRestore(Rt),ct.forEach(Oa=>W._OrtReleaseTensor(Oa)),Gt.forEach(Oa=>W._OrtReleaseTensor(Oa)),Ze.forEach(Oa=>W._free(Oa)),Jt!==0&&W._OrtReleaseRunOptions(Jt),ft.forEach(Oa=>W._free(Oa))}},xi=S=>{let O=st(),I=wi.get(S);if(!I)throw new Error("invalid session id");let F=I[0],j=O._OrtEndProfiling(F);j===0&&Ke("Can't get an profile file name."),O._OrtFree(j)},ii=S=>{let O=[];for(let I of S){let F=I[2];!Array.isArray(F)&&"buffer"in F&&O.push(F.buffer)}return O}}),jn,He,$i,rr,Si,Ei,Us,Is,pn,ka,Yr,Xr,ri,Ti,Ol,Rl,sr,lr,Cn=T(()=>{oa(),Al(),xa(),er(),jn=()=>!!Re.wasm.proxy&&typeof document<"u",$i=!1,rr=!1,Si=!1,Is=new Map,pn=(S,O)=>{let I=Is.get(S);I?I.push(O):Is.set(S,[O])},ka=()=>{if($i||!rr||Si||!He)throw new Error("worker not ready")},Yr=S=>{switch(S.data.type){case"init-wasm":$i=!1,S.data.err?(Si=!0,Us[1](S.data.err)):(rr=!0,Us[0]()),Ei&&(URL.revokeObjectURL(Ei),Ei=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let O=Is.get(S.data.type);S.data.err?O.shift()[1](S.data.err):O.shift()[0](S.data.out);break}}},Xr=async()=>{if(!rr){if($i)throw new Error("multiple calls to 'initWasm()' detected.");if(Si)throw new Error("previous call to 'initWasm()' failed.");if($i=!0,jn())return new Promise((S,O)=>{He==null||He.terminate(),Ji().then(([I,F])=>{try{He=F,He.onerror=ae=>O(ae),He.onmessage=Yr,Us=[S,O];let j={type:"init-wasm",in:Re};if(!j.in.wasm.wasmPaths&&I){let ae=zs();ae&&(j.in.wasm.wasmPaths=ae)}He.postMessage(j),Ei=I}catch(j){O(j)}},O)});try{await Pr(Re.wasm),await qa(Re),rr=!0}catch(S){throw Si=!0,S}finally{$i=!1}}},ri=async S=>{if(jn())return ka(),new Promise((O,I)=>{pn("init-ep",[O,I]);let F={type:"init-ep",in:{epName:S,env:Re}};He.postMessage(F)});await Bs(Re,S)},Ti=async S=>jn()?(ka(),new Promise((O,I)=>{pn("copy-from",[O,I]);let F={type:"copy-from",in:{buffer:S}};He.postMessage(F,[S.buffer])})):gt(S),Ol=async(S,O)=>{if(jn()){if(O!=null&&O.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return ka(),new Promise((I,F)=>{pn("create",[I,F]);let j={type:"create",in:{model:S,options:{...O}}},ae=[];S instanceof Uint8Array&&ae.push(S.buffer),He.postMessage(j,ae)})}else return Tn(S,O)},Rl=async S=>{if(jn())return ka(),new Promise((O,I)=>{pn("release",[O,I]);let F={type:"release",in:S};He.postMessage(F)});ja(S)},sr=async(S,O,I,F,j,ae)=>{if(jn()){if(I.some(W=>W[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(j.some(W=>W))throw new Error("pre-allocated output tensor is not supported for proxy.");return ka(),new Promise((W,Q)=>{pn("run",[W,Q]);let re=I,Ee={type:"run",in:{sessionId:S,inputIndices:O,inputs:re,outputIndices:F,options:ae}};He.postMessage(Ee,ii(re))})}else return pe(S,O,I,F,j,ae)},lr=async S=>{if(jn())return ka(),new Promise((O,I)=>{pn("end-profiling",[O,I]);let F={type:"end-profiling",in:S};He.postMessage(F)});xi(S)}}),Ls,Ci,zn,Zr=T(()=>{oa(),Cn(),rt(),Es(),Wr(),Ls=(S,O)=>{switch(S.location){case"cpu":return[S.type,S.dims,S.data,"cpu"];case"gpu-buffer":return[S.type,S.dims,{gpuBuffer:S.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[S.type,S.dims,{mlTensor:S.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${S.location} for ${O()}`)}},Ci=S=>{switch(S[3]){case"cpu":return new Xt(S[0],S[2],S[1]);case"gpu-buffer":{let O=S[0];if(!ks(O))throw new Error(`not supported data type: ${O} for deserializing GPU tensor`);let{gpuBuffer:I,download:F,dispose:j}=S[2];return Xt.fromGpuBuffer(I,{dataType:O,dims:S[1],download:F,dispose:j})}case"ml-tensor":{let O=S[0];if(!Kr(O))throw new Error(`not supported data type: ${O} for deserializing MLTensor tensor`);let{mlTensor:I,download:F,dispose:j}=S[2];return Xt.fromMLTensor(I,{dataType:O,dims:S[1],download:F,dispose:j})}default:throw new Error(`invalid data location: ${S[3]}`)}},zn=class{async fetchModelAndCopyToWasmMemory(S){return Ti(await _i(S))}async loadModel(S,O){ia();let I;typeof S=="string"?I=await this.fetchModelAndCopyToWasmMemory(S):I=S,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Ol(I,O),ga()}async dispose(){return Rl(this.sessionId)}async run(S,O,I){ia();let F=[],j=[];Object.entries(S).forEach(xe=>{let de=xe[0],Ve=xe[1],J=this.inputNames.indexOf(de);if(J===-1)throw new Error(`invalid input '${de}'`);F.push(Ve),j.push(J)});let ae=[],W=[];Object.entries(O).forEach(xe=>{let de=xe[0],Ve=xe[1],J=this.outputNames.indexOf(de);if(J===-1)throw new Error(`invalid output '${de}'`);ae.push(Ve),W.push(J)});let Q=F.map((xe,de)=>Ls(xe,()=>`input "${this.inputNames[j[de]]}"`)),re=ae.map((xe,de)=>xe?Ls(xe,()=>`output "${this.outputNames[W[de]]}"`):null),Ee=await sr(this.sessionId,j,Q,W,re,I),ke={};for(let xe=0;xe<Ee.length;xe++)ke[this.outputNames[W[xe]]]=ae[xe]??Ci(Ee[xe]);return ga(),ke}startProfiling(){}endProfiling(){lr(this.sessionId)}}}),zi={};M(zi,{OnnxruntimeWebAssemblyBackend:()=>or,initializeFlags:()=>qs,wasmBackend:()=>ur});var qs,or,ur,Ml=T(()=>{oa(),Cn(),Zr(),qs=()=>{(typeof Re.wasm.initTimeout!="number"||Re.wasm.initTimeout<0)&&(Re.wasm.initTimeout=0);let S=Re.wasm.simd;if(typeof S!="boolean"&&S!==void 0&&S!=="fixed"&&S!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${S}". Reset it to \`false\` and ignore SIMD feature checking.`),Re.wasm.simd=!1),typeof Re.wasm.proxy!="boolean"&&(Re.wasm.proxy=!1),typeof Re.wasm.trace!="boolean"&&(Re.wasm.trace=!1),typeof Re.wasm.numThreads!="number"||!Number.isInteger(Re.wasm.numThreads)||Re.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Re.wasm.numThreads=1;else{let O=typeof navigator>"u"?D("node:os").cpus().length:navigator.hardwareConcurrency;Re.wasm.numThreads=Math.min(4,Math.ceil((O||1)/2))}},or=class{async init(S){qs(),await Xr(),await ri(S)}async createInferenceSessionHandler(S,O){let I=new zn;return await I.loadModel(S,O),I}},ur=new or}),Da={};M(Da,{InferenceSession:()=>Yi,TRACE:()=>Nn,TRACE_EVENT_BEGIN:()=>Ma,TRACE_EVENT_END:()=>Wa,TRACE_FUNC_BEGIN:()=>ia,TRACE_FUNC_END:()=>ga,Tensor:()=>Xt,default:()=>kl,env:()=>Re,registerBackend:()=>ce}),oa(),oa(),oa();var Ai="1.24.2",kl=Sl;{let S=(Ml(),q(zi)).wasmBackend;ce("cpu",S,10),ce("wasm",S,10)}return Object.defineProperty(Re.versions,"web",{value:Ai,enumerable:!0}),q(Da)})();o.exports=m})(ig)),ig.exports}var Ky;function n1(){return Ky||(Ky=1,(function(o){var d=vl&&vl.__createBinding||(Object.create?(function(me,be,Me,Be){Be===void 0&&(Be=Me);var qe=Object.getOwnPropertyDescriptor(be,Me);(!qe||("get"in qe?!be.__esModule:qe.writable||qe.configurable))&&(qe={enumerable:!0,get:function(){return be[Me]}}),Object.defineProperty(me,Be,qe)}):(function(me,be,Me,Be){Be===void 0&&(Be=Me),me[Be]=be[Me]})),m=vl&&vl.__setModuleDefault||(Object.create?(function(me,be){Object.defineProperty(me,"default",{enumerable:!0,value:be})}):function(me,be){me.default=be}),y=vl&&vl.__importStar||function(me){if(me&&me.__esModule)return me;var be={};if(me!=null)for(var Me in me)Me!=="default"&&Object.prototype.hasOwnProperty.call(me,Me)&&d(be,me,Me);return m(be,me),be};Object.defineProperty(o,"__esModule",{value:!0}),o.MicVAD=o.getDefaultRealTimeVADOptions=o.ort=o.DEFAULT_MODEL=void 0;const $=y(a1()),E=Eg(),R=Tg(),D=sh(),T=Om(),M=G0(),H=V0();o.DEFAULT_MODEL="legacy",o.ort=$;const q="vad.worklet.bundle.min.js",Z="silero_vad_v5.onnx",se="silero_vad_legacy.onnx",ce=me=>({...R.defaultFrameProcessorOptions,onFrameProcessed:()=>{},onVADMisfire:()=>{D.log.debug("VAD misfire")},onSpeechStart:()=>{D.log.debug("Detected speech start")},onSpeechEnd:()=>{D.log.debug("Detected speech end")},onSpeechRealStart:()=>{D.log.debug("Detected real speech start")},baseAssetPath:"./",onnxWASMBasePath:"./",model:me,workletOptions:{},getStream:async()=>await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}}),pauseStream:async be=>{be.getTracks().forEach(Me=>{Me.stop()})},resumeStream:async()=>await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0}}),ortConfig:be=>{be.env.logLevel="error"},startOnLoad:!0,processorType:"auto"});o.getDefaultRealTimeVADOptions=ce;const ee=me=>"audioWorklet"in me&&typeof AudioWorkletNode=="function"?"AudioWorklet":"ScriptProcessor";async function he(me,be,Me,Be,qe){await Me.audioWorklet.addModule(me),be.processorOptions={...be.processorOptions??{},frameSamples:Be};const Re=new AudioWorkletNode(Me,"vad-helper-worklet",be);return Re.port.onmessage=async at=>{const Xe=at.data;if(!(typeof Xe=="object"&&Xe&&"message"in Xe)){console.error("Invalid message event",Xe);return}switch(Xe.message){case T.Message.AudioFrame:{if(!("data"in Xe&&Xe.data instanceof ArrayBuffer)){console.log("Audio frame message has no data");return}const et=new Float32Array(Xe.data);await qe(et);break}}},Re}async function $e(me,be,Me){const Be=new H.Resampler({nativeSampleRate:me.sampleRate,targetSampleRate:16e3,targetFrameSize:be});D.log.debug("using script processor");const Re=me.createScriptProcessor(4096,1,1);let at=!1;return Re.onaudioprocess=async Xe=>{if(!at){at=!0;try{const et=Xe.inputBuffer.getChannelData(0);Xe.outputBuffer.getChannelData(0).fill(0);const _t=Be.process(et);for(const Dt of _t)await Me(Dt)}catch(et){console.error("Error processing audio:",et)}finally{at=!1}}},Re.connect(me.destination),Re}class De{constructor(be,Me,Be,qe,Re=!1,at=null,Xe=null,et=null,Qe=null,_t=null,Dt=null,ma="uninitialized",_e=!1){this.options=be,this.frameProcessor=Me,this.model=Be,this.frameSamples=qe,this.listening=Re,this.errored=at,this._stream=Xe,this._audioContext=et,this._vadNode=Qe,this._mediaStreamAudioSourceNode=_t,this._audioProcessorAdapterType=Dt,this.initializationState=ma,this.ownsAudioContext=_e,this.getAudioInstances=()=>{if(this._stream===null||this._audioContext===null||this._vadNode==null||this._mediaStreamAudioSourceNode==null)throw new Error("MicVAD has null stream, audio context, or processor adapter");return{stream:this._stream,audioContext:this._audioContext,vadNode:this._vadNode,mediaStreamAudioSourceNode:this._mediaStreamAudioSourceNode}},this.setErrored=Oe=>{this.initializationState="errored",this.errored=Oe},this.start=async()=>{switch(this.initializationState){case"uninitialized":{D.log.debug("initializing micVAD"),this.initializationState="initializing",this.frameProcessor.resume();try{this._stream=await this.options.getStream()}catch(Oe){throw Oe instanceof Error?this.setErrored(Oe.message):this.setErrored(String(Oe)),Oe}if(this.options.audioContext?(console.log("using custom audio context"),this._audioContext=this.options.audioContext):(console.log("using default audio context"),this._audioContext=new AudioContext,this.ownsAudioContext=!0),!this._audioContext)throw this.setErrored("Audio context is null"),Error("Audio context is null");switch(this._audioProcessorAdapterType=this.options.processorType=="auto"?ee(this._audioContext):this.options.processorType,this._audioProcessorAdapterType){case"AudioWorklet":this._vadNode=await he(this.options.baseAssetPath+q,this.options.workletOptions,this._audioContext,this.frameSamples,this.processFrame);break;case"ScriptProcessor":this._vadNode=await $e(this._audioContext,this.frameSamples,this.processFrame);break;default:throw new Error(`Unsupported audio processor adapter type: ${this._audioProcessorAdapterType}`)}this._mediaStreamAudioSourceNode=new MediaStreamAudioSourceNode(this._audioContext,{mediaStream:this._stream}),this._mediaStreamAudioSourceNode.connect(this._vadNode),D.log.debug("started micVAD"),this.listening=!0,this.initializationState="initialized";break}case"initializing":{D.log.warn("start called while initializing");break}case"initialized":{if(this.listening)return;this.listening=!0,this.frameProcessor.resume();const{stream:Oe,audioContext:Pe,vadNode:At}=this.getAudioInstances();this._stream=await this.options.resumeStream(Oe);const ht=new MediaStreamAudioSourceNode(Pe,{mediaStream:this._stream});this._mediaStreamAudioSourceNode=ht,ht.connect(At);break}case"destroyed":{D.log.warn("start called after destroyed");break}case"errored":{D.log.error("start called after errored");break}default:{D.log.warn("weird initialization state");break}}},this.pause=async()=>{if(!this.listening)return;this.listening=!1;const{stream:Oe,mediaStreamAudioSourceNode:Pe}=this.getAudioInstances();await this.options.pauseStream(Oe),Pe.disconnect(),this.frameProcessor.pause(this.handleFrameProcessorEvent)},this.destroy=async()=>{var Pe;D.log.debug("destroy called"),this.initializationState="destroyed";const{vadNode:Oe}=this.getAudioInstances();Oe instanceof AudioWorkletNode&&Oe.port.postMessage(T.Message.SpeechStop),this.listening&&await this.pause(),await this.model.release(),this.ownsAudioContext&&await((Pe=this._audioContext)==null?void 0:Pe.close())},this.setOptions=Oe=>{this.frameProcessor.setOptions(Oe)},this.processFrame=async Oe=>{await this.frameProcessor.process(Oe,this.handleFrameProcessorEvent)},this.handleFrameProcessorEvent=Oe=>{switch(Oe.msg){case T.Message.FrameProcessed:this.options.onFrameProcessed(Oe.probs,Oe.frame);break;case T.Message.SpeechStart:this.options.onSpeechStart();break;case T.Message.SpeechRealStart:this.options.onSpeechRealStart();break;case T.Message.VADMisfire:this.options.onVADMisfire();break;case T.Message.SpeechEnd:this.options.onSpeechEnd(Oe.audio);break}}}static async new(be={}){const Me={...(0,o.getDefaultRealTimeVADOptions)(be.model??o.DEFAULT_MODEL),...be};(0,R.validateOptions)(Me),o.ort.env.wasm.wasmPaths=Me.onnxWASMBasePath,Me.ortConfig!==void 0&&Me.ortConfig(o.ort);const Be=Me.model==="v5"?Z:se,qe=Me.baseAssetPath+Be,Re=Me.model==="v5"?M.SileroV5.new:M.SileroLegacy.new;let at;try{at=await Re(o.ort,()=>(0,E.defaultModelFetcher)(qe))}catch(Dt){throw console.error(`Encountered an error while loading model file ${qe}`),Dt}const Xe=Me.model==="v5"?512:1536,et=Xe/16,Qe=new R.FrameProcessor(at.process,at.reset_state,{positiveSpeechThreshold:Me.positiveSpeechThreshold,negativeSpeechThreshold:Me.negativeSpeechThreshold,redemptionMs:Me.redemptionMs,preSpeechPadMs:Me.preSpeechPadMs,minSpeechMs:Me.minSpeechMs,submitUserSpeechOnPause:Me.submitUserSpeechOnPause},et),_t=new De(Me,Qe,at,Xe);if(Me.startOnLoad)try{await _t.start()}catch(Dt){throw console.error("Error starting micVad",Dt),Dt}return _t}}o.MicVAD=De})(vl)),vl}var Wy;function i1(){return Wy||(Wy=1,(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.getDefaultRealTimeVADOptions=o.MicVAD=o.DEFAULT_MODEL=o.utils=o.NonRealTimeVAD=o.Message=o.FrameProcessor=o.defaultModelFetcher=o.baseAssetPath=void 0;var d=L0();Object.defineProperty(o,"baseAssetPath",{enumerable:!0,get:function(){return d.baseAssetPath}});var m=Eg();Object.defineProperty(o,"defaultModelFetcher",{enumerable:!0,get:function(){return m.defaultModelFetcher}});var y=Tg();Object.defineProperty(o,"FrameProcessor",{enumerable:!0,get:function(){return y.FrameProcessor}});var $=Om();Object.defineProperty(o,"Message",{enumerable:!0,get:function(){return $.Message}});var E=e1();Object.defineProperty(o,"NonRealTimeVAD",{enumerable:!0,get:function(){return E.NonRealTimeVAD}});const R=t1();o.utils={audioFileToArray:R.audioFileToArray,minFramesForTargetMS:R.minFramesForTargetMS,arrayBufferToBase64:R.arrayBufferToBase64,encodeWAV:R.encodeWAV};var D=n1();Object.defineProperty(o,"DEFAULT_MODEL",{enumerable:!0,get:function(){return D.DEFAULT_MODEL}}),Object.defineProperty(o,"MicVAD",{enumerable:!0,get:function(){return D.MicVAD}}),Object.defineProperty(o,"getDefaultRealTimeVADOptions",{enumerable:!0,get:function(){return D.getDefaultRealTimeVADOptions}})})(tg)),tg}var r1=i1();const s1=["C'MON, LET IT OUT!","WE CAN'T HEAR YOU!","LOUDER! LOUDER!","DON'T BE SHY!","GIVE IT SOME POWER!","TURN IT UP!","BELT IT OUT!","YOU GOT THIS, LOUDER!","WAKE UP THAT VOICE!","UNLEASH THE BEAST!"],l1=["KEEP GOING!","NICE, NICE!","NOT BAD!","WARMING UP!","GETTING THERE!","THAT'S THE SPIRIT!","FEELING IT!"],o1=["AMAZING!","YESSS!","ON FIRE!","INCREDIBLE!","SUPERSTAR!","CROWD GOES WILD!","LEGENDARY!","UNSTOPPABLE!","ABSOLUTE BANGER!","WHAT A VOICE!","SLAY!","ICONIC!"];function u1(o){const{frameCount:d,totalRMS:m,activeFrames:y,pitchBuckets:$,elapsed:E,hasBumpers:R}=o,D=d>0?m/d:0;let T=Math.min(100,D*500),M=Math.min(100,$.size*5);const H=d>0?y/d*100:0;let q=Math.min(100,H),Z=Math.min(100,Math.min(E,Ry)/Ry*100);R&&(T=Math.min(100,T*gm),M=Math.min(100,M*gm),q=Math.min(100,q*gm),Z=Math.min(100,Z*gm));const se=Math.round(T*ym.energy+M*ym.pitch+q*ym.sustain+Z*ym.duration);return{total:Math.min(100,Math.max(0,se)),energy:Math.round(T),pitch:Math.round(M),sustain:Math.round(q),duration:Math.round(Z),time:E,bumpers:R}}function c1(o,d){const m=o.length,y=new Float32Array(m);let $=0;for(let M=0;M<m;M++)y[M]=(o[M]-128)/128,Math.abs(y[M])>$&&($=Math.abs(y[M]));if($<fg)return-1;const E=new Float32Array(m);for(let M=0;M<m;M++){let H=0;for(let q=0;q<m-M;q++)H+=y[q]*y[q+M];E[M]=H}let R=0;for(;R<m/2&&E[R]>E[R+1];)R++;let D=-1,T=R;for(let M=R;M<m/2;M++)E[M]>D&&(D=E[M],T=M);return D<.01?-1:d/T}let fn=null,ti=null,Fp=null,Tu=null,Kp=!1,vm=!1;function d1(){const[o,d]=ne.useState(!1),[m,y]=ne.useState({elapsed:0,energyPct:0,avgEnergy:0,pitchHits:0}),[$,E]=ne.useState({message:"",colorClass:""}),R=ne.useRef(0),D=ne.useRef(0),T=ne.useRef(0),M=ne.useRef(0),H=ne.useRef(new Set),q=ne.useRef(-1),Z=ne.useRef(null),se=ne.useRef(!1),ce=ne.useRef(0),ee=ne.useRef(0),he=ne.useRef(0),$e=ne.useRef(new Uint8Array(0)),De=ne.useRef(new Uint8Array(0)),me=ne.useRef(null),be=ne.useCallback((Xe=800,et=100)=>{try{if(!fn)return;const Qe=fn.createOscillator(),_t=fn.createGain();Qe.connect(_t),_t.connect(fn.destination),Qe.frequency.value=Xe,Qe.type="sine",_t.gain.setValueAtTime(.1,fn.currentTime),_t.gain.exponentialRampToValueAtTime(.01,fn.currentTime+et/1e3),Qe.start(fn.currentTime),Qe.stop(fn.currentTime+et/1e3)}catch{}},[]),Me=ne.useCallback(async()=>{if(fn&&Fp){ti&&($e.current=new Uint8Array(ti.fftSize),De.current=new Uint8Array(ti.frequencyBinCount),me.current=ti);return}Fp=await navigator.mediaDevices.getUserMedia({audio:!0}),fn=new AudioContext;const Xe=fn.createMediaStreamSource(Fp);ti=fn.createAnalyser(),ti.fftSize=2048,ti.smoothingTimeConstant=.4;const et=fn.createBiquadFilter();et.type="highpass",et.frequency.value=100;const Qe=fn.createBiquadFilter();Qe.type="lowpass",Qe.frequency.value=3500,Xe.connect(et),et.connect(Qe),Qe.connect(ti),$e.current=new Uint8Array(ti.fftSize),De.current=new Uint8Array(ti.frequencyBinCount),me.current=ti;try{Tu=await r1.MicVAD.new({getStream:async()=>Fp,pauseStream:async()=>{},resumeStream:async()=>Fp,onSpeechStart:()=>{Kp=!0},onSpeechEnd:()=>{Kp=!1}}),vm=!0}catch(_t){console.warn("VAD init failed  scoring all frames:",_t),vm=!1}},[]),Be=ne.useCallback((Xe,et)=>{if(et<1.5)return;const Qe=performance.now();if(Qe-ce.current<Ow)return;let _t="",Dt="";Xe<fg*1.5?(ee.current++,he.current=0,ee.current>=3&&(_t=eg(s1),Dt="neon-pink")):Xe>.08?(he.current++,ee.current=0,he.current>=2&&(_t=eg(o1),Dt="neon-gold")):(ee.current=0,he.current=0,Math.random()<.3&&(_t=eg(l1),Dt="neon-cyan")),_t&&(E({message:_t,colorClass:Dt}),ce.current=Qe)},[]),qe=ne.useCallback(()=>{if(!se.current||!ti)return;Z.current=requestAnimationFrame(qe),ti.getByteTimeDomainData($e.current),ti.getByteFrequencyData(De.current);let Xe=0;for(let Oe=0;Oe<$e.current.length;Oe++){const Pe=($e.current[Oe]-128)/128;Xe+=Pe*Pe}const et=Math.sqrt(Xe/$e.current.length);(!vm||Kp)&&(D.current++,T.current+=et,et>fg&&M.current++);const Qe=(fn==null?void 0:fn.sampleRate)??44100,_t=c1($e.current,Qe);if(_t>0){const Oe=Math.round(12*Math.log2(_t/440));(!vm||Kp)&&H.current.add(Oe),q.current!==-1&&q.current,q.current=Oe}const Dt=(performance.now()-R.current)/1e3,ma=Math.min(100,Math.round(et*400)),_e=Math.round(D.current>0?T.current/D.current*300:0);y({elapsed:Dt,energyPct:ma,avgEnergy:_e,pitchHits:H.current.size}),Be(et,Dt)},[Be]),Re=ne.useCallback(()=>{D.current=0,T.current=0,M.current=0,H.current=new Set,q.current=-1,ee.current=0,he.current=0,ce.current=0,Kp=!1,R.current=performance.now(),se.current=!0,d(!0),y({elapsed:0,energyPct:0,avgEnergy:0,pitchHits:0}),E({message:"",colorClass:""}),Tu==null||Tu.start(),qe()},[qe]),at=ne.useCallback(Xe=>{se.current=!1,d(!1),Tu==null||Tu.pause(),Z.current!==null&&(cancelAnimationFrame(Z.current),Z.current=null);const et=(performance.now()-R.current)/1e3;return u1({frameCount:D.current,totalRMS:T.current,activeFrames:M.current,pitchBuckets:H.current,elapsed:et,hasBumpers:Xe})},[]);return{isListening:o,stats:m,feedback:$,dataArray:$e,freqArray:De,analyserRef:me,initAudio:Me,startListening:Re,stopListening:at,playSound:be}}function f1(){const[o,d]=ne.useState(!1),[m,y]=ne.useState(""),$=ne.useCallback(async(E,R)=>{d(!0);for(let D=3;D>=1;D--)y(D),R==null||R(600+D*100,150),await Sy(900);y(""),R==null||R(1200,200),await Sy(600),d(!1),y(""),E()},[]);return{isActive:o,value:m,run:$}}function p1(){const o=Du(),{players:d,currentPlayer:m,currentRound:y,totalRounds:$,recordScore:E,advancePlayer:R}=rh(),{isListening:D,stats:T,feedback:M,freqArray:H,initAudio:q,startListening:Z,stopListening:se,playSound:ce}=d1(),{isActive:ee,value:he,run:$e}=f1(),[De,me]=ne.useState(!0),be=d[m],Me=be?hi[m%hi.length]:hi[0];async function Be(){me(!1);try{await q()}catch{me(!0);return}ce(900,100),$e(()=>{Z()},ce)}function qe(){if(!be)return;const at=se(be.bumpers);ce(400,150),E(at),m+1<d.length?(R(),setTimeout(()=>{me(!0)},600)):setTimeout(()=>{o("/results")},800)}const Re=$>1?`ROUND ${y}/${$}  SINGER ${m+1} OF ${d.length}`:`SINGER ${m+1} OF ${d.length}`;return we.jsxs("div",{className:"screen-container px-10 relative",children:[De&&we.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-[rgba(10,10,26,0.92)] z-10",children:[we.jsx(vd,{as:"div",color:Me.name,className:"text-[clamp(2.5rem,7vw,5rem)] mb-3",children:(be==null?void 0:be.name)||`Player ${m+1}`}),we.jsx("p",{className:"text-lg opacity-60 mb-3 tracking-[2px]",children:"GET READY TO SING!"}),we.jsxs("p",{className:"text-sm opacity-35 mb-1 tracking-[2px]",children:["Singer ",m+1," of ",d.length]}),$>1&&we.jsxs("p",{className:"text-sm opacity-30 tracking-[2px]",children:["Round ",y," of ",$]}),m===0&&y===1&&we.jsxs("div",{className:"mt-5 mb-5 px-5 py-3 rounded-xl border border-white/10 bg-white/5 text-center space-y-1",children:[we.jsx("p",{className:"text-xs uppercase tracking-[2px] opacity-40 mb-2",children:"How to play"}),we.jsx("p",{className:"text-sm opacity-60",children:" Play a song in the background"}),we.jsx("p",{className:"text-sm opacity-60",children:" Sing near your device's microphone"})]}),!(m===0&&y===1)&&we.jsx("div",{className:"mb-8"}),we.jsx(xs,{variant:"pink",onClick:()=>void Be(),children:" Start Singing"})]}),we.jsx(Qw,{isActive:ee,value:he}),we.jsx("p",{className:"text-base uppercase tracking-[4px] opacity-60 mb-2",children:Re}),we.jsx(vd,{as:"h2",color:Me.name,className:"text-[clamp(2rem,6vw,4rem)] mb-8",children:(be==null?void 0:be.name)||`Player ${m+1}`}),we.jsx(Fw,{freqArray:H,isActive:D}),we.jsx(Ww,{message:M.message,colorClass:M.colorClass}),we.jsx(Kw,{percent:T.energyPct}),we.jsxs("div",{className:"flex gap-10 my-6",children:[we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"text-xs uppercase tracking-[2px] opacity-50 mb-1",children:"Time"}),we.jsx("div",{className:"text-3xl font-extrabold neon-cyan",children:dw(T.elapsed)})]}),we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"text-xs uppercase tracking-[2px] opacity-50 mb-1",children:"Energy"}),we.jsx("div",{className:"text-3xl font-extrabold neon-pink",children:T.avgEnergy})]}),we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"text-xs uppercase tracking-[2px] opacity-50 mb-1",children:"Pitch Hits"}),we.jsx("div",{className:"text-3xl font-extrabold neon-gold",children:T.pitchHits})]})]}),D&&we.jsx(xs,{variant:"red",onClick:qe,children:" Stop"}),!D&&!De&&!ee&&we.jsx("p",{className:"text-sm opacity-40 mt-3",children:"SING YOUR HEART OUT! Hit STOP when done."}),De&&we.jsx("p",{className:"text-sm opacity-40 mt-3",children:"Hit the button when you're ready to sing!"})]})}const h1=["","",""];function m1({player:o,rank:d}){const m=ne.useRef(null);ne.useEffect(()=>{const $=m.current;if(!$)return;const E=o.score.total;let R=0;const D=Math.max(1,Math.ceil(E/40)),T=setInterval(()=>{R=Math.min(R+D,E),$.textContent=String(R),R>=E&&clearInterval(T)},40);return()=>clearInterval(T)},[o.score.total]);const y=d<3?h1[d]:"";return we.jsxs("div",{className:mi("flex flex-col items-center p-4 px-5 rounded-2xl","flex-1 min-w-[110px] max-w-[180px]","bg-white/[0.04] border border-white/[0.08]","transition-all duration-500",d===0&&"scale-105 border-[#ffd700] shadow-[0_0_40px_rgba(255,215,0,0.2)]",d===1&&"border-[#c0c0c0] shadow-[0_0_20px_rgba(192,192,192,0.13)]",d===2&&"border-[#cd7f32] shadow-[0_0_20px_rgba(205,127,50,0.13)]"),children:[we.jsx("div",{className:"text-2xl mb-1",children:y}),we.jsxs("div",{className:"text-base font-extrabold mb-0.5 truncate w-full text-center",style:{color:o.color.hex},children:[o.name,o.score.bumpers&&we.jsx("span",{className:"ml-1 text-xs opacity-50",children:""})]}),we.jsxs("div",{className:"text-xs uppercase tracking-widest opacity-40 mb-2",children:["#",d+1]}),we.jsx("div",{ref:m,className:mi("font-display text-[clamp(2.5rem,8vw,3.5rem)] leading-none",d===0?"neon-gold":""),children:"0"}),we.jsx("div",{className:"text-xs opacity-50 mt-0.5",children:"/ 100"})]})}function Wp({label:o,value:d}){return we.jsxs("div",{className:"flex justify-between text-sm py-0.5 opacity-70",children:[we.jsx("span",{children:o}),we.jsx("span",{className:"font-extrabold opacity-100",children:d})]})}function g1({players:o}){return we.jsx("div",{className:"flex gap-3 flex-wrap justify-center w-full max-w-[900px]",children:o.map(d=>we.jsxs("div",{className:"text-center p-3 px-4 rounded-2xl bg-white/[0.03] min-w-[130px] flex-1",children:[we.jsx("h4",{className:"text-xs uppercase tracking-widest opacity-50 mb-2",children:d.name}),we.jsx(Wp,{label:"Energy",value:d.score.energy}),we.jsx(Wp,{label:"Pitch Range",value:d.score.pitch}),we.jsx(Wp,{label:"Sustain",value:d.score.sustain}),we.jsx(Wp,{label:"Duration",value:d.score.duration}),we.jsx(Wp,{label:"Time",value:`${Math.round(d.score.time)}s`})]},d.index))})}function y1({players:o,cumulativeScores:d,currentRound:m}){const y=o.map(($,E)=>({player:$,index:E,cum:d[E]??0,color:hi[E%hi.length]})).sort(($,E)=>E.cum-$.cum);return we.jsxs("div",{className:"w-full max-w-[600px] px-0",children:[we.jsx("div",{className:"text-xs uppercase tracking-[3px] opacity-40 text-center mb-2.5",children:"Tournament Standings"}),we.jsx("div",{className:"flex flex-col gap-1.5",children:y.map(($,E)=>{const R=m>0?Math.round($.cum/m):0;return we.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 rounded-xl bg-white/[0.03]",children:[we.jsx("div",{className:"font-display text-lg w-7 text-center opacity-50",children:E+1}),we.jsx("div",{className:"flex-1 font-bold text-base",style:{color:$.color.hex},children:$.player.name||`Player ${$.index+1}`}),we.jsx("div",{className:mi("font-display text-2xl",E===0?"neon-gold":""),children:$.cum}),we.jsxs("div",{className:"text-xs opacity-40 min-w-[56px] text-right",children:["avg ",R,"/rd"]})]},$.index)})})]})}function v1({totalRounds:o,currentRound:d}){return o<=1?null:we.jsx("div",{className:"flex gap-2 items-center justify-center",children:Array.from({length:o},(m,y)=>{const $=y+1;return we.jsx("div",{className:mi("w-2.5 h-2.5 rounded-full transition-all duration-300",$<d&&"bg-[#ffd700] shadow-[0_0_8px_rgba(255,215,0,0.53)]",$===d&&"bg-[#ff2d95] shadow-[0_0_8px_rgba(255,45,149,0.53)]",$>d&&"bg-white/15")},$)})})}const Qy=["#ff2d95","#00e5ff","#ffd700","#ff6ec7","#00b8d4","#ff3b3b","#a855f7","#39ff14"];function b1(){return{spawn:ne.useCallback(()=>{for(let d=0;d<100;d++){const m=document.createElement("div"),y=6+Math.random()*8,$=Qy[Math.floor(Math.random()*Qy.length)],E=2+Math.random()*3,R=Math.random()*1.5;Object.assign(m.style,{position:"fixed",width:`${y}px`,height:`${y}px`,left:`${Math.random()*100}vw`,top:"-20px",background:$,borderRadius:Math.random()>.5?"50%":"2px",zIndex:"100",opacity:"0",animation:`confetti-fall ${E}s linear ${R}s forwards`,pointerEvents:"none"}),document.body.appendChild(m),setTimeout(()=>m.remove(),(E+R+.5)*1e3)}},[])}}function _1(){var Re,at;const o=Du(),{spawn:d}=b1(),{players:m,scores:y,cumulativeScores:$,currentRound:E,totalRounds:R,selectedMode:D,nextRound:T,initNewGame:M,resetToPlayerSetup:H}=rh(),q=E>=R,Z=R>1,se=m.map((Xe,et)=>{const Qe=y[et]??{total:0,energy:0,pitch:0,sustain:0,duration:0,time:0,bumpers:!1};return{name:Xe.name||`Player ${et+1}`,index:et,score:Qe,color:hi[et%hi.length]}}).sort((Xe,et)=>et.score.total-Xe.score.total),ce=se.length>1&&se[0].score.total===se[1].score.total,ee=[...m].map((Xe,et)=>({i:et,cum:$[et]??0})).sort((Xe,et)=>et.cum-Xe.cum),he=ee.length>1&&ee[0].cum===ee[1].cum,$e=m[((Re=ee[0])==null?void 0:Re.i)??0],De=Z?q?"FINAL RESULTS":`ROUND ${E} RESULTS`:"RESULTS",me=Z?q?`${Am[D].label} complete!`:`${R-E} round${R-E!==1?"s":""} remaining`:"THE MOMENT OF TRUTH",be=q&&Z?he?"IT'S A TIE! SHARED GLORY!":` ${($e==null?void 0:$e.name)||"Player"} IS THE CHAMPION! `:ce?"ROUND TIE!":` ${((at=se[0])==null?void 0:at.name)||"Player"} WINS THIS ROUND!`;ne.useEffect(()=>{q&&d()},[q,d]);function Me(){T(),o("/sing")}function Be(){M(),o("/sing")}function qe(){H(),o("/players")}return we.jsxs("div",{className:"screen-container overflow-y-auto justify-start py-8 px-4 gap-4",children:[we.jsx(vd,{as:"h2",color:"pink",className:"text-[clamp(1.8rem,6vw,4rem)]",children:De}),we.jsx("p",{className:"text-sm opacity-50 tracking-[3px]",children:me}),we.jsx(v1,{totalRounds:R,currentRound:E}),we.jsx("div",{className:"font-display text-[clamp(1.1rem,3.5vw,2.2rem)] animate-glow-pulse neon-gold text-center px-2",children:be}),we.jsx("div",{className:"flex gap-3 items-end justify-center flex-wrap w-full max-w-[900px]",children:se.map((Xe,et)=>we.jsx(m1,{player:Xe,rank:et},Xe.index))}),Z&&we.jsx(y1,{players:m,cumulativeScores:$,currentRound:E}),we.jsx(g1,{players:se}),we.jsxs("div",{className:"flex gap-4 flex-wrap justify-center mt-2 pb-4",children:[!q&&we.jsx(xs,{variant:"pink",onClick:Me,children:" Next Round"}),q&&we.jsx(xs,{variant:"gold",onClick:Be,children:" Rematch"}),we.jsx(xs,{variant:"outline",size:"sm",onClick:qe,children:"New Game"})]})]})}function w1(){return we.jsx($_,{basename:"/karaoke-king",children:we.jsx("div",{className:"relative w-screen h-screen overflow-hidden bg-game flex items-stretch justify-center",children:we.jsxs(Jb,{children:[we.jsx(Cu,{path:"/",element:we.jsx(Rw,{})}),we.jsx(Cu,{path:"/players",element:we.jsx(qw,{})}),we.jsx(Cu,{path:"/mode",element:we.jsx(Vw,{})}),we.jsx(Cu,{path:"/sing",element:we.jsx(p1,{})}),we.jsx(Cu,{path:"/results",element:we.jsx(_1,{})}),we.jsx(Cu,{path:"*",element:we.jsx(Xb,{to:"/",replace:!0})})]})})})}const x1=new Jv,P0=document.getElementById("root");if(!P0)throw new Error("Root element not found");Tv.createRoot(P0).render(we.jsx(ne.StrictMode,{children:we.jsx(tb,{client:x1,children:we.jsx(w1,{})})}));
